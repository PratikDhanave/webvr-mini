!function(e){function t(i){if(r[i])return r[i].exports;var n=r[i]={exports:{},id:i,loaded:!1};return e[i].call(n.exports,n,n.exports,t),n.loaded=!0,n.exports}var r={};return t.m=e,t.c=r,t.p="",t(0)}([function(e,t,r){e.exports=r(10)},function(e,t){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),n=function(){function e(t){r(this,e),this.util=t,this.emitter=t.emitter,this.MIN_WAIT_TIME=100,this.MAX_TRIES=6,this.NOT_IN_LIST=this.util.NOT_IN_LIST,this.keyList=[],this.defaultKey=null}return i(e,[{key:"getPlaceholder",value:function(){return this.defaultKey?this.keyList[this.defaultKey]:null}},{key:"getAssetByKey",value:function(e){if(e){if(this.keyList[e])return this.keyList[e]}else console.error("AssetPool::getAssetByKey(): undefined key");return null}},{key:"getAssetByName",value:function(e){if(e)for(var t in this.keyList){var r=this.keyList[t];if(r.name&&r.name===e)return r}return null}},{key:"getAllAssets",value:function(){return this.keyList}},{key:"pathInList",value:function(e){if(e)for(var t in this.keyList){var r=this.keyList[t];if(r.path&&r.path===e)return r}return null}},{key:"getKey",value:function(e){for(var t in this.keyList){var r=this.keyList[t];if(r===e)return t}return null}},{key:"assetInList",value:function(e){if(e)for(var t in this.keyList){var r=this.keyList[t];if(r===e)return r}return null}},{key:"addAsset",value:function(e,t){if(e)if(t){if(this.keyList[t]){if(this.keyList[t]===e)return console.warn("AssetPool::addAsset(): asset "+t+" already added to pool"),e;console.warn("AssetPool::addAsset(): replacing old asset at same key:"+t)}else this.keyList[t]=e;e.key=t}else e.key=this.util.computeId(),this.keyList[e.key]=e;return e}},{key:"removeAsset",value:function(e){var t=null;return this.keyList[e]?(t=this.keyList[e],t&&delete this.keyList[e],t):(console.warn("AssetPool::removeAsset(): key not found in assetList"),null)}},{key:"getWrappedPromise",value:function(){var e={},t=new Promise(function(t,r){e.resolve=t,e.reject=r});return e.then=t.then.bind(t),e.catch=t.catch.bind(t),e.promise=t,e}},{key:"getWrappedFetch",value:function(e,t,r,i){var n=this,o=this.getWrappedPromise(),a=new Request(e,t);return o.url=e,o.params=t,o.tries=r,o.pos=i,o.timeoutId=setTimeout(function(){console.warn("AssetPool::getWrappedFetch(): TIMEOUT for "+(n.MIN_WAIT_TIME*o.tries+1)+"msec "+o.url),o.catch(0)},this.MIN_WAIT_TIME*o.tries),fetch(a).then(function(e){if(e.ok)return e;throw new Error("Network response was not ok for "+o.url)}).then(function(e){return clearTimeout(o.timeoutId),o.resolve(e)},function(e){return console.warn("AssetPool::getWrappedFetch(): NOT OK, REJECT "+o.url),clearTimeout(o.timeoutId),o.reject(e)}).catch(function(e){return console.warn("AssetPool::getWrappedFetch(): NOT OK, CATCH "+o.url),clearTimeout(o.timeoutId),o.catch(e)}),o}},{key:"doRequest",value:function(e,t,r){var i=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],n=this,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"text/plain",a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,s=new Headers({"Content-Type":o+"; charset: UTF-8"}),u=this.getWrappedFetch(i?e+"?"+(new Date).getTime():e,{method:"get",mode:"cors",redirect:"follow",headers:s},a,t);return u.promise.then(function(e){var t=null;return 200===e.status||0===e.status?(t="application/json"===o?e.json():o.indexOf("text")!==n.util.NOT_IN_LIST?e.text():"application/xml"===o?e.formData():o.indexOf("image")!==n.util.NOT_IN_LIST?e.blob():e.blob(),Promise.resolve(t)):Promise.reject(e)},function(a){return u.tries++,u.tries<n.MAX_TRIES&&(console.warn("AssetPool::doRequest(): ft.promise .then error, TRYING AGAIN:"+a+" for "+u.url),n.doRequest(e,t,r,i=!0,o,u.tries)),Promise.resolve(a)}).then(function(i){r(i instanceof Error?{pos:t,path:e,data:null,error:i}:{pos:t,path:e,data:i,error:!1})},function(e){return Promise.reject(0)})}}]),e}();t.default=n},function(e,t){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),n=function(){function e(t,i,n,o,a,s,u){r(this,e),console.log("In Shader class"),this.name=s,this.util=i,this.glMatrix=n,this.webgl=o,this.vr=a,this.pMatrix=this.glMatrix.mat4.create(),this.mvMatrix=this.glMatrix.mat4.create(),this.mvMatrixStack=this.glMatrix.mat4.create(),this.floatp="",this.webgl.stats.highp?this.floatp="precision highp float;":this.floatp="precision mediump float;",u?this.lights=u:this.lights=null,this.required={buffer:{vertices:!0,indices:!1,texCoords:!1,normals:!1,colors:!0,tangents:!1},textures:{map_Kd:!1,map_Ks:!1,map_Ka:!1,map_bump:!1,map_refl:!1,map_d:!1,map_disp:!1},lights:{world:!1,internal:!1}},this.MAX_FAIL=100,this.sortByDistance=!1,this.vertexShaderFile=null,this.fragmentShaderFile=null,this.NOT_IN_LIST=i.NOT_IN_LIST,this.createProgram()}return i(e,[{key:"primInList",value:function(e){var t=this.program.renderList,r=t.indexOf(e);return r}},{key:"addPrim",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(e.failCount>this.MAX_FAIL)return e.shader.removePrim(e),void console.error("prim:"+e.name+" could not be added to Shader:"+this.name+", giving up (removing from display list)");if(this.checkPrim(e)){if(this.primInList(e)===this.NOT_IN_LIST){var r=this.program.renderList.indexOf(null);return r!==this.NOT_IN_LIST?this.program.renderList[r]=e:this.program.renderList.push(e),this.sortByDistance&&this.sortPrimsByDistance([0,0,0]),e.shader&&e.shader!==this&&(console.warn("Shader::addPrim(): removing prim:"+e.name+" from old Shader:"+e.shader.name),e.shader.removePrim(e,t)),e.shader=this,e.rendering=!0,t&&this.util.emitter.emit(this.util.emitter.events.PRIM_ADDED_TO_SHADER,e),!0}console.warn("Shader::addPrim():"+e.name+" already added to Shader::"+this.name)}return e.failCount++,!1}},{key:"removePrim",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=this.primInList(e);return console.warn(".....Shader::removePrim(): Shader:"+this.name+" prim: "+e.name+" is at position:"+r),r!==this.NOT_IN_LIST?(console.warn("......Shader::removePrim(): Shader:"+this.name+" removing prim:"+e.name+" from Shader:"+this.name),this.program.renderList.splice(r,1),e.rendering=!1,t&&this.util.emitter.emit(this.util.emitter.events.PRIM_REMOVED_FROM_SHADER,e),!0):(console.warn("......Shader::removePrim(): Shader:"+this.name+" "+e.name+" not found in Shader::"+this.name),!1)}},{key:"movePrim",value:function(e,t){if(e.shader&&t&&e.shader!==t)return t.addPrim(e,!1)}},{key:"checkPrim",value:function(e){return this.checkPrimBuffers(e)?this.checkPrimMaterials(e)?this.checkPrimTextures(e)?(console.log("Shader::checkPrim(): prim:"+e.name+" ready to be added to:"+this.name+" from:"+e.shader.name),!0):(console.warn("Shader::checkPrim():"+e.name+" has bad textures"),!1):(console.warn("Shader::checkPrim():"+e.name+" has bad materials"),!1):(console.warn("Shader::checkPrim():"+e.name+" has bad buffers"),!1)}},{key:"checkPrimBuffers",value:function(e){var t=this.required.buffer,r=e.geometry;if(!r)return!1;for(var i in t)if(t[i]&&(!r[i]||!r[i].buffer))return!1;return!0}},{key:"checkPrimMaterials",value:function(e){if(void 0===e.matStarts||e.matStarts.length<1)return!1;for(var t=0;t<e.matStarts.length;t++)if(void 0===e.materials[e.matStarts[t][0]])return!1;return!0}},{key:"checkPrimTextures",value:function(e){for(var t=this.required.textures,r=e.matStarts,i=0;i<r.length;i++){for(var n in e.materials);var o=r[0][0],a=e.materials[o];if(void 0===a)return!1;for(var s in t)if(a[s]&&(null===a[s]||!(a[s]instanceof WebGLTexture)))return console.warn("Shader::checkTextures(): prim:"+e.name+" OBJ file does not have texture "+s+" defined in material:"+o+" yet"),!1}return!0}},{key:"sortPrimsByDistance",value:function(e){var t=this.glMatrix.vec3;this.program.renderList.sort(function(r,i){if(r&&i)return t.distance(r.position,e)-t.distance(i.position,e)})}},{key:"createProgram",value:function(){var e=null;return e=this.vertexShaderFile&&this.fragmentShaderFile?this.webgl.createProgram(this.webgl.fetchVertexShader(this.vertexShaderFile),this.webgl.fetchFragmentShader(this.fragmentShaderFile)):this.webgl.createProgram(this.vsSrc(),this.fsSrc()),e||console.error("error creating WebGL program using Shader "+this.constructor.name),this.program=e}},{key:"getProgram",value:function(){return this.program}},{key:"setup",value:function(){var e=this.program,t=this.glMatrix,r=t.mat4;this.pMatrix=t.mat4.create(),this.mMatrix=t.mat4.create(),this.vMatrix=t.mat4.create(),this.mvMatrix=t.mat4.create();var i=this.pMatrix,n=(this.mMatrix,this.vMatrix),o=this.mvMatrix,a=this.webgl.getCanvas(),s=this.webgl.getContext(),u=this.webgl.near,l=this.webgl.far,c=void 0;c=this.webgl.stats.uint32?s.UNSIGNED_INT:s.UNSIGNED_SHORT;return e.renderMono=function(t,n,s){r.copy(o,n);var c=t.getOMMatrix();r.multiply(o,o,c),r.perspective(i,.4*Math.PI,a.width/a.height,u,l),e.render(i,s,!0)},e.renderVR=function(t,i,u,l){r.identity(n),s.viewport(0,0,.5*a.width,a.height),t.getStandingViewMatrix(n,i.leftViewMatrix,i.pose),r.multiply(o,n,u),e.render(i.leftProjectionMatrix,l,!0),r.identity(n),s.viewport(.5*a.width,0,.5*a.width,a.height),t.getStandingViewMatrix(n,i.rightViewMatrix,i.pose),r.multiply(o,n,u),e.render(i.rightProjectionMatrix,l,!1)},[s,a,this.glMatrix.mat4,this.glMatrix.mat3,this.glMatrix.vec3,e,{attribute:this.webgl.setAttributeArrays(e.shaderProgram,e.vsVars.attribute),uniform:this.webgl.setUniformLocations(e.shaderProgram,e.vsVars.uniform)},{uniform:this.webgl.setUniformLocations(e.shaderProgram,e.fsVars.uniform)},this.webgl.stats,this.webgl.near,this.webgl.far,this.vr,c]}},{key:"getPMatrix",value:function(){return this.pMatrix}},{key:"getmMVMatrix",value:function(){return this.mvMatrix}},{key:"mvPushMatrix",value:function(e){var t=this.glMatrix.mat4,r=t.clone(e);this.mvMatrixStack.push(r)}},{key:"mvPopMatrix",value:function(){if(0==this.mvMatrixStack.length)throw"Invalid popMatrix!";mvMatrix=this.mvMatrixStack.pop()}}]),e}();t.default=n},function(e,t){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),n=function(){function e(t){r(this,e),this.glMatrix=t,this.lightTypes={LIGHT_0:"light0",LIGHT_1:"light1",LIGHT_2:"light2",LIGHT_3:"light3"},this.lightList=[],this.setLight(this.lightTypes.LIGHT_0)}return i(e,[{key:"getLight",value:function(e){return e||(e=this.lightTypes.LIGHT_0),this.lightList[e]}},{key:"getPos",value:function(e){return e||(e=this.lightTypes.LIGHT_0),this.lightList[e].lightingDirection}},{key:"setLight",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[.3,.3,.3],r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[-1e3,0,1000.1],i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[1,1,1];arguments.length>4&&void 0!==arguments[4]&&arguments[4];this.lightList[e]={ambient:t,lightingDirection:r,directionalColor:i,attenuation:0,radius:1}}},{key:"setPos",value:function(e,t,r,i){e||(e=this.lightTypes.LIGHT_0),this.lightList[e].lightingDirection=[-t,-r,i]}},{key:"setPolar",value:function(e,t,r){e||(e=this.lightTypes.LIGHT_0)}}]),e}();t.default=n},function(e,t,r){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},u=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),l=r(1),c=i(l),h=function(e){function t(e,r,i,a,s){n(this,t),console.log("in ModelPool");var u=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,r));return u.util=r,u.webgl=i,u.texturePool=a,u.materialPool=s,u.modelMimeTypes={obj:"text/plain",mtl:"text/plain",gltf:"text/tgltf",gltfBinary:"bin/gltf",hyg:"text/plain",png:"image/png"},e&&(u.defaultKey=u.addAsset(u.default()).key),u}return a(t,e),u(t,[{key:"default",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[],n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:[],o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:[],a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:[],s=arguments.length>7&&void 0!==arguments[7]?arguments[7]:[],u=arguments.length>8&&void 0!==arguments[8]?arguments[8]:[];return{vertices:e,indices:t,texCoords:r,normals:i,tangents:[],options:{objects:n,groups:o,smoothingGroups:a,materials:s,matStarts:u}}}},{key:"computeObj3d",value:function(e,t){var r=e.match(/^(-?\d+(\.\d+)?)\s*(-?\d+(\.\d+)?)\s*(-?\d+(\.\d+)?)/);return!!r&&(t.push(parseFloat(r[1]),parseFloat(r[3]),parseFloat(r[5])),!0)}},{key:"computeObj2d",value:function(e,t){var r=e.match(/^(-?\d+(\.\d+)?)\s+(-?\d+(\.\d+)?)$/);if(r)return t.push(parseFloat(r[1]),parseFloat(r[3])),!0;var i=[];return!!this.computeObj3d(e,i)&&(t.push(i[0],i[1]),!0)}},{key:"computeFaceIndex",value:function(e){return Number.isFinite(e)?e:(console.warn("WEIRD NUM:"+e),this.NOT_IN_STRING)}},{key:"computeFaceFan",value:function(e){if(e.length){for(var t=[],r=1;r<e.length-1;r++)t.push(e[0],e[r],e[r+1]);return t}return e}},{key:"computeObjFaces",value:function(e,t,r){var i=e.match(/[^\s]+/g),n=this.NOT_IN_LIST,o=void 0,a=[],s=[],u=[];i.map(function(e){e.indexOf("//")!==n?(o=e.split("//"),a.push(parseFloat(o[0])-1),s.push(null),u.push(parseFloat(o[1])-1)):e.indexOf("/")!==n?(o=e.split("/"),a.push(parseFloat(o[0])-1),2==o.length?(s.push(parseFloat(o[1])-1),u.push(null)):3===o.length&&(s.push(parseFloat(o[1])-1),u.push(parseFloat(o[2])-1))):a.push(parseFloat(e)-1)}),a=this.computeFaceFan(a),s=this.computeFaceFan(s),u=this.computeFaceFan(u);for(var l=0;l<a.length;l++)t.push([a[l],s[l],u[l]])}},{key:"computeObjMesh",value:function(e,t,r){var i=this,n=this.default(),o=this.util.isWhitespace,a=(n.vertices,n.indices,n.texCoords,n.normals,this.util.DEFAULT_KEY,n.options.objects),s=n.options.groups,u=n.options.smoothingGroups,l=(n.options.materials,n.options.matStarts),c=[],h=[],d=[],f=[],v=[],m=[],p=this.util.getFilePath(r),g=this.materialPool.createDefaultName(t.name),y=0,A=e.split("\n"),b=this.NOT_IN_STRING;if(A.forEach(function(e){var r=e.split(" ")[0].trim(),n=e.substr(r.length).trim();if(""!==n)switch(r){case"o":t.name||(t.name=n),a.push([n,m.length]),b=r;break;case"g":s.push([n,m.length]),b=r;break;case"s":u.push([n+"s"]),b=r;break;case"v":i.computeObj3d(n,h),b=r;break;case"f":var c=void 0,v=void 0;"s"===b&&(c=u[u.length-1],v=m.length,c.push(v)),i.computeObjFaces(n,m,y),"s"===b&&c.push(m.length-v),b=r;break;case"vn":i.computeObj3d(n,d),b=r;break;case"vt":i.computeObj2d(n,f)||i.computeObj3d(n,f),b=r;break;case"mtllib":for(var A=n.split(" "),E=0;E<A.length;E++){var M=p+i.util.getFileName(A[E]);i.materialPool.getMaterial(t,M,!0,{pos:E})}b=r;break;case"usemtl":g=i.util.getFileName(n),l.push([g,4*m.length,0]),b=r;break;case"#":break;case"maplib":case"usemap":case"vp":case"p":case"l":case"curv":case"surf":case"parm":case"trim":case"hole":case"scrv":case"sp":case"end":case"con":case"mg":case"bevel":case"c_interp":case"d_interp":case"lod":case"shadow_obj":case"trace_obj":case"ctech":case"stech":case"":console.warn("ModelPool::computeObjMesh(): OBJ data type: "+r+" in .obj file not supported");break;default:o(n)||console.error("ModelPool::computeObjMesh(): unknown line data: "+e+" in .obj file at line:"+y)}y++}),!m.length)return console.error("ModelPool::computeObjMesh(): no faces data in file!"),n;for(var E=[],M=[],x=[],w=[],T=0;T<m.length;T++){var P=m[T],D=P[0]+"_"+P[1]+"_"+P[2],R=void 0,C=void 0;if(void 0!==v[D])R=P[0],C=v[D],E.push(v[D]);else{R=P[0],C=parseInt(M.length/3);var S=void 0,O=void 0;E.push(C),v[D]=C,R*=3,M.push(h[R],h[R+1],h[R+2]),null!==P[1]&&void 0!==P[1]&&(S=2*P[1],isFinite(f[S])&&isFinite(f[S+1])?x.push(f[S],f[S+1]):console.error("ModelPool::computeObjMesh(): bad texCoords in file: at"+S+"  face ("+P+")")),null!==P[2]&&void 0!==P[2]&&(O=3*P[2],isFinite(d[O])&&isFinite(d[O+1]&&isFinite(d[O+2]))?w.push(d[O],d[O+1],d[O+2]):console.error("ModelPool::computeObjMesh(): bad normals in file at"+O+" face ("+P+")"))}}M.length>this.webgl.MAX_DRAWELEMENTS&&console.error("ModelPool::computeObjMesh(): size of prim "+t.name+" ("+M.length+") exceeds max buffer:"+this.webgl.MAX_DRAWELEMENTS),w.length>0&&w.length!==M.length&&(console.warn("ModelPool::computeObjMesh(): not enough normals returned, zeroing out!"),w=[]),x.length>0&&x.length!==2*M.length/3&&(console.warn("ModelPool::computeObjMesh(): not enough texCoords returned, zeroing out!"),x=[]),h=M,c=E,f=x,d=w,0===l.length&&n.options.matStarts.push([this.materialPool.createDefaultName(t.name),0,c.length]);for(var I=1;I<n.options.matStarts.length;I++)n.options.matStarts[I-1][2]=(n.options.matStarts[I][1]-n.options.matStarts[I-1][1])/4;return n.options.matStarts[n.options.matStarts.length-1][2]=c.length-n.options.matStarts[n.options.matStarts.length-1][1]/4,n.options.matStarts=l,n.vertices=h,n.indices=c,n.texCoords=f,n.normals=d,n}},{key:"computeGlTFMesh",value:function(e,t,r){var i=this.default();i.data=JSON.parse(e);for(var n in i.data)switch(n){case"scene":break;case"scenes":break;case"nodes":}return i}},{key:"computeGlTFBinaryMesh",value:function(e,t,r){var i=this.default();return i}},{key:"computeHyg",value:function(e,t,r,i){for(var n=this.default(),o=(t.dimensions,JSON.parse(e)),a=[],s=[],u=[],l=[],c=[],h=n.options.objects,d=0,f=!1,v=!0,m=0;m<o.length;m++){var p=o[m];if(i.useXYZ===!0)p.dist<this.webgl.far&&(a.push(parseFloat(p.x),parseFloat(p.y),parseFloat(p.z)),u.push(0,0,0),s.push(d++),l.push(0,1));else{var g=this.util.degToRad(15*parseFloat(p.ra)),y=this.util.degToRad(parseFloat(p.dec));a.push(Math.sin(y),Math.cos(y)*Math.cos(g),Math.cos(y)*Math.sin(g)),u.push(0,0,0),s.push(d++),l.push(0,1)}var A=1-(parseFloat(p.mag)+1.44)/8.5,b=void 0,E=void 0,M=p.spect[0];if(M&&!f){switch(M=M.toLowerCase()){case"o":E="9bb0ff";break;case"b":E="aabfff";break;case"a":E="aabfff";break;case"f":E="fbf8ff";break;case"g":E="fff4e8";break;case"k":E="ffddb4";break;case"m":E="ff806f";break;default:E="#FFFFFF"}b=this.util.hexToRGB(E,255),b.r*=A,b.g*=A,b.b*=A}else E=parseFloat(p.ci)||0,E*=A,b={r:A+E,g:A,b:A-E};"Betelgeuse"===p.proper||"Rigel"===p.proper||"Bellatrix"===p.proper||"Saiph"===p.proper||"Alnitak"===p.proper||"Alnilam"===p.proper||"Mintaka"===p.proper||"Alkaid"===p.proper||"Mizar"===p.proper||"Alioth"===p.proper||"Mergrez"===p.proper||"Phad"===p.proper||"Merak"===p.proper||"Dubhe"===p.proper||"Polaris"===p.proper||"kochab"===p.proper||"75097"===p.hip||"79822"===p.hip||"77055"===p.hip||"82080"===p.hip||"85822"===p.hip||"Caph"===p.proper||"Shedir"===p.proper||"Cih"===p.proper||"Ruchbah"===p.proper||"8867"===p.id?c.push(0,1,0,1):c.push(b.r,b.b,b.b,1),v?p.proper.length>0&&h.push([p,a.length]):h.push([p,a.length])}return t.geolocate=!0,n.options.matStarts.push([this.materialPool.createDefaultName(t.name),0,s.length]),n.vertices=a,n.indices=s,n.texCoords=l,n.normals=u,n.colors=c,n}},{key:"computeHeightMap",value:function(e,t,r,i){var n=this.default();n.options=i;var o=e.width,a=e.height,s=document.createElement("canvas"),u=s.getContext("2d"),l=t.divisions[0]/o,c=t.divisions[2]/a;u.scale(l,c),u.drawImage(e,0,0);for(var h=u.getImageData(0,0,o,a),d=h.data,f=0,v=new Float32Array(o*a),m=0,p=0,g=0,y=0;y<d.length;y+=4)v[f]=(d[y]+d[y+1]+d[y+2])/3,m=Math.max(m,v[f]),p=Math.min(p,v[f]),g+=v[f],f++;s=u=null;var A=Math.max(o,a);return n.options.map={pixels:v,w:o,d:a,squareSize:A,max:A-1,maxHeight:m,minHeight:p,avHeight:g/v.length},n}},{key:"addModel",value:function(e,t,r,i,n){var o=this,a=this.util.getFileExtension(r),s=null;return new Promise(function(i,u){switch(a){case"obj":s=o.computeObjMesh(t,e,r),s?(s.tangents=[],s.colors=[],s.type=e.type,s.path=r,s.emits=o.util.emitter.events.OBJ_GEOMETRY_READY,i(o.addAsset(s))):u(Error("ModelPool::addModel(): Failed to load OBJ format file at path:"+r));break;case"gltf":s=o.computeGlTFMesh(t,e,r),s&&(s.type=e.type,s.path=r,s.emits=o.util.emitter.events.GLTF_GEOMETRY_READY,i(o.addAsset(s))),u(Error("ModelPool::addModel(): GLTF parser not ready yet"));break;case"gltfbinary":s=o.computeGlTFBinaryMesh(t,e,r),s&&(s.type=e.type,s.path=r,s.emits=o.util.emitter.events.GLTF_GEOMETRY_READY,i(o.addAsset(s))),u(Error("ModelPool::addModel(): GLTF Binary parser not ready yet"));break;case"hyg":e.drawTris=!1,e.drawLines=!1,e.drawPoints=!0,s=o.computeHyg(t,e,r,n),s?(s.type=e.type,s.path=r,s.emits=o.util.emitter.events.OBJ_GEOMETRY_READY,s.emits=o.util.emitter.events.HYG_GEOMETRY_READY,i(o.addAsset(s))):u(Error("ModelPool::addModel(): Failed to load HYG format file at path:"+r));break;case"png":var l=new Image;l.src=URL.createObjectURL(t),l.onload=function(){s=o.computeHeightMap(l,e,r,n),s?(s.type=e.type,s.path=r,s.emits=o.util.emitter.events.HEIGHTMAP_GEOMETRY_READY,i(o.addAsset(s))):u(Error("ModelPool::addModel(): invalid image size for path:"+r))},l.onerror=function(){u(Error("ModelPool::addModel(): Bad Heightmap image file at path:"+r))};break;default:u("ModelPool::addModel(): File format not found for path:"+r)}})}},{key:"getModel",value:function(e,t){var r=this,i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{pos:0},o=this.pathInList(t);if(null!==o)return void this.util.emitter.emit(o.emits,e,o.key,n);if(this.util.isWhitespace(t))console.warn("ModelPool::getModel(): no path supplied for prim:"+e.name);else{var a=this.modelMimeTypes[this.util.getFileExtension(t)];a?this.doRequest(t,n.pos,function(i){i.data?r.addModel(e,i.data,i.path,a,n).then(function(t){t!==("undefined"==typeof Error?"undefined":s(Error))?r.util.emitter.emit(t.emits,e,t.key,n):console.error("ModelPool::addModel(): Promise returned "+t+" for Prim:"+e.name)}).catch(function(e){window.err=e}):console.error("ModelPool::getModel(): "+r.util.getFileExtension(t)+" file, no data found for:"+i.path)},i,a,0):console.error('ModelPool::getModel(): file type "'+this.util.getFileExtension(t)+'" in:'+t+" not supported, not loading")}}}]),t}(c.default);t.default=h},function(e,t,r){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var s=r(1),u=i(s),l=function(e){function t(e,r,i){n(this,t);var a=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,r,i));return a}return a(t,e),t}(u.default);t.default=l},function(e,t,r){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),a=r(7),s=(i(a),r(4)),l=(i(s),function(){function e(t,r,i,o,a){n(this,e),console.log("in GeometryPool class"),this.util=r,this.glMatrix=i,this.webgl=o,this.modelPool=a,this.typeList={POINT:"geometryPointCloud",POINTCLOUD:"geometryPointCloud",TEXTURECLOUD:"geometryTextureCloud",STARDOME:"geometryStarDome",STAR3D:"geometryStarSpace",LINE:"geometryLine",PLANE:"geometryOuterPlane",OUTERPLANE:"geometryOuterPlane",INNERPLANE:"geometryInnerPlane",CURVEDPLANE:"geometryCurvedOuterPlane",CURVEDOUTERPLANE:"geometryCurvedOuterPlane",CURVEDINNERPLANE:"geometryCurvedInnerPlane",TERRAIN:"geometryTerrain",TERRAINSPHERE:"geometryTerrainSphere",CIRCLE:"geometryCircle",CUBE:"geometryCube",CUBESPHERE:"geometryCubeSphere",SPHERE:"geometrySphere",DISC:"geometryCap",CAP:"geometryCap",DOME:"geometryDome",TOPDOME:"geometryTopDome",SKYDOME:"geometrySkyDome",BOTTOMDOME:"geometryBottomDome",CONE:"geometryCone",TOPCONE:"geometryTopCone",BOTTOMCONE:"geometryBottomCone",SPINDLE:"geometrySpindle",TEARDROP:"geometryTeardrop",CYLINDER:"geometryCylinder",CAPSULE:"geometryCapsule",PRISM:"geometryPrism",ICOSOHEDRON:"geometryIcosohedron",PYRAMID:"geometryPyramid",REGULARTETRAHEDRON:"geometryRegularTetrahedron",ICOSPHERE:"geometryIcoSphere",TOPICODOME:"geometryTopIcoDome",SKYICODOME:"geometrySkyIcoDome",BOTTOMICODOME:"geometryBottomIcoDome",OCTAHEDRON:"geometryOctahedron",DODECAHEDRON:"geometryDodecahedron",TORUS:"geometryTorus",MESH:"geometryMesh"},this.directions={DEFAULT:"up",FORWARD:"forward",FRONT:"forward",BACK:"back",LEFT:"left",RIGHT:"right",UP:"up",TOP:"top",DOWN:"down",BOTTOM:"down"},this.OUTSIDE=100,this.INSIDE=101,this.INVISIBLE=102,this.TWO_PI=2*Math.PI}return o(e,[{key:"default",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[],n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:[],o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:[];return{vertices:e,indices:t,normals:i,texCoords:r,tangents:n,colors:o}}},{key:"checkType",value:function(e){return this[e]instanceof Function}},{key:"getStdVecs",value:function(e){var t=this.directions;switch(e){case t.BACK:return[0,0,-1];case t.DOWN:return[0,-1,0];case t.FORWARD:return[0,0,1];case t.LEFT:return[-1,0,0];case t.RIGHT:return[1,0,0];case t.UP:return[0,1,0];case t.ONE:return[1,1,1];case t.ZERO:return[0,0,0]}}},{key:"vec5",value:function(e,t,r){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;return[e,t,r,i,n]}},{key:"computePointInTriangle",value:function(e,t,r,i){this.computeBaryCentric(e,t,r,i);return u>=0&&v>=0&&u+v<1}},{key:"computeAngle2d",value:function(e,t,r){var i=void 0,n=void 0;switch(r){case 0:i=t[0]-e[0],n=t[2]-e[2];break;case 1:i=t[0]-e[0],n=t[1]-e[1];break;case 2:i=t[1]-e[1],n=t[2]-e[2];break;default:console.error("invalid 2d angle choice, "+r)}return Math.atan2(n,i)}},{key:"computeAngle3d",value:function(e,t,r){var i=[t[0]-e[0],t[1]-e[1],t[2]-e[2]],n=[r[0]-t[0],r[1]-t[1],r[2]-t[2]],o=Math.sqrt(i[0]*i[0]+i[1]*i[1]+i[2]*i[2]),a=Math.sqrt(n[0]*n[0]+n[1]*n[1]+n[2]*n[2]),s=[i[0]/o,i[1]/o,i[2]/o],u=[n[0]/a,n[1]/a,n[2]/a];return Math.acos(s[0]*u[0]+s[1]*u[1]+s[2]*u[2])}},{key:"computeCentroid",value:function(e){var t=[0,0,0],r=e.length;if(r<1&&(r=1),this.util.isArray(e[0]))for(var i=0;i<r;i++){var n=e[i];t[0]+=n[0],t[1]+=n[1],t[2]+=n[2]}else for(var o=0;o<r;o+=3)t[0]=e[o],t[1]=e[o+1],t[2]=e[o+2];return t[0]/=r,t[1]/=r,t[2]/=r,t}},{key:"computeMassCentroid",value:function(e){for(var t=this.glMatrix.vec3,r=[0,0,0],i=0,n=e[0],o=e[1],a=2;a<e.length;a++){var s=e[a],u=t.subtract([0,0,0],s,n),l=t.subtract([0,0,0],s,o),c=t.cross([0,0,0],u,l),h=t.length(c)/2;r[0]+=h*(n[0]+o[0]+s[0])/3,r[1]+=h*(n[1]+o[1]+s[1])/3,r[2]+=h*(n[2]+o[2]+s[2])/3,i+=h,o=t.copy([0,0,0],s)}return[r[0]/i,r[1]/i,r[2]/i]}},{key:"computeBarycentric",value:function(e,t,r,i){var n=this.glMatrix.vec3,o=void 0,a=void 0,s=void 0,u=void 0,l=void 0,c=void 0,h=void 0,d=void 0;o=n.sub(o,i,t),a=n.sub(a,r,t),s=n.sub(s,e,t),u=n.dot(o,o),l=n.dot(o,a),c=n.dot(o,s),h=n.dot(a,a),d=n.dot(a,s);var f=1/(u*h-l*l),v=(h*c-l*d)*f,m=(u*d-l*c)*f;return[v,m]}},{key:"computeBoundingBox",value:function(e){for(var t=this.glMatrix.vec3,r={},i=0,n=0,o=0,a=0,s=0,u=0,l=0;l<e.length;l+=3){var c=e[l],h=e[l+1],d=e[l+2];i=Math.min(i,c),n=Math.min(n,h),o=Math.min(o,d),a=Math.max(a,c),s=Math.max(s,h),u=Math.max(u,d)}return r.vertices=[i,n,u,a,n,u,a,s,u,i,s,u,i,n,o,i,s,o,a,s,o,a,n,o,i,s,o,i,s,u,a,s,u,a,s,o,i,n,o,a,n,o,a,n,u,i,n,u,a,n,o,a,s,o,a,s,u,a,n,u,i,n,o,i,n,u,i,s,u,i,s,o],r.indices=[0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23],r.topLeft=[i,n,o],r.bottomRight=[a,s,u],r.dimensions=t.subtract([0,0,0],r.bottomRight,r.topLeft),r}},{key:"computeBoundingSphere",value:function(e){var t={},r=e.topLeft,i=e.bottomRight,n=Math.abs(i[0]-r[0]),o=Math.abs(i[1]-r[1]),a=Math.abs(i[2]-r[2]),s=Math.max(n,o,a)/2;t.radius=s;var u=this.computeCentroid(vertices);return t.center=u,t}},{key:"computeSphericalCoords",value:function(e){var t=Math.atan2(e[0],e[2])/this.TWO_PI,r=Math.asin(e[1])/Math.PI+.5;return t<0&&(t+=1),[t,r]}},{key:"computeInflateToSphere",value:function(e,t){for(var r=this.computeSphere(t),i=[],n=[],o=r.center[0],a=r.center[1],s=r.center[2],u=r.radius,l=0;l<e.length;l+=3){var c=e[l],h=e[l+1],d=e[l+2],f=Math.sqrt(o*c+a*h+s*d),v=f/u;i.push(c*v,h*v,d*v);var m=this.computeSphericalCoords([c,h,d]);n.push(m.u,m.v)}return{vertices:e,texCoords:texCoords}}},{key:"computeNormals",value:function(e,t,r){var i=(arguments.length>3&&void 0!==arguments[3]&&arguments[3],0),n=void 0,o=0,a=0,s=0,u=0,l=0,c=0,h=0,d=0,f=0,v=0,m=0,p=0,g=0,y=new Float32Array(e.length);for(n=t.length/3,i=0;i<n;i++)m=t[3*i],p=t[3*i+1],g=t[3*i+2],o=e[3*m]-e[3*p],a=e[3*m+1]-e[3*p+1],s=e[3*m+2]-e[3*p+2],u=e[3*g]-e[3*p],l=e[3*g+1]-e[3*p+1],c=e[3*g+2]-e[3*p+2],h=a*c-s*l,d=s*u-o*c,f=o*l-a*u,v=Math.sqrt(h*h+d*d+f*f),v=0===v?1:v,h/=v,d/=v,f/=v,y[3*m]+=h,y[3*m+1]+=d,y[3*m+2]+=f,y[3*p]+=h,y[3*p+1]+=d,y[3*p+2]+=f,y[3*g]+=h,y[3*g+1]+=d,y[3*g+2]+=f;for(i=0;i<y.length/3;i++)h=y[3*i],d=-y[3*i+1],f=y[3*i+2],v=Math.sqrt(h*h+d*d+f*f),v=0===v?1:v,h/=v,d/=v,f/=v,y[3*i]=-h,y[3*i+1]=d,y[3*i+2]=-f;return r=y}},{key:"computeTangents",value:function(e,t,r,i,n){for(var o=this.glMatrix.vec3,a=new Float32Array(r.length),s=new Float32Array(r.length),u=t.length,l=e.length,c=new Float32Array(4*l/3),h=0;h<u;h+=3){var d=t[h],f=t[h+1],v=t[h+2],m=3*d,p=e[m],g=e[m+1],y=e[m+2];m=3*f;var A=e[m],b=e[m+1],E=e[m+2];m=3*v;var M=e[m],x=e[m+1],w=e[m+2],T=A-p,P=M-p,D=b-g,R=x-g,C=E-y,S=w-y;m=2*d;var O=i[m],I=i[m+1];m=2*f;var k=i[m],_=i[m+1];m=2*v;var L=i[m],N=i[m+1],F=k-O,B=L-O,V=_-I,U=N-I,G=1/(F*U-B*V),W=(U*T-V*P)*G,j=(U*D-V*R)*G,Y=(U*C-V*S)*G,q=(F*P-B*T)*G,H=(F*R-B*D)*G,z=(F*S-B*C)*G;
m=3*d,a[m]+=W,a[m+1]+=j,a[m+2]+=Y,s[m]+=q,s[m+1]+=H,s[m+2]+=z,m=3*f,a[m]+=W,a[m+1]+=j,a[m+2]+=Y,s[m]+=q,s[m+1]+=H,s[m+2]+=z,m=3*v,a[m]+=W,a[m+1]+=j,a[m+2]+=Y,s[m]+=q,s[m+1]+=H,s[m+2]+=z}for(var X=0,Q=0;Q<l;X+=3,Q+=4){var K=[r[X],r[X+1],r[X+2]],J=[a[X],a[X+1],a[X+2]],Z=[s[X],s[X+1],s[X+2]],$=o.sub([0,0,0],J,o.scale([0,0,0],J,o.dot(K,J))),ee=$[0]*$[0]+$[1]*$[1]+$[2]*$[2],te=ee>0?o.scale([0,0,0],$,1/Math.sqrt(ee)):$,re=o.dot(o.cross([0,0,0],K,J),Z)<0?-1:1;c[Q]=te[0],c[Q+1]=te[1],c[Q+2]=te[2],c[Q+3]=re}return n=c}},{key:"computeTexCoords",value:function(e,t){console.log("GeometryPool::()computeTexCoords(): vertices:"+e.length);for(var r=[],i=0;i<e.length;i+=3){var n=this.computeSphericalCoords([e[i],e[i+1],e[i+2]]);r.push(n[0],n[1])}return t=r}},{key:"computeColors",value:function(e,t){var r=[];if(4===t.length)for(var i=0;i<e.length;i+=3)r.push(t[0],t[1],t[2],t[3]);for(var n=0;n<e.length;n+=3)r.push(e[n],e[n+1],e[n+2],1);return r}},{key:"computePerlin",value:function(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.3,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.2,n=1;n<e.length;n+=3){var o=e[n-1],a=e[n],s=e[n+1];e[n]=t*this.perlinNoise(o/5,a,s/5)+r*this.perlinNoise(2*o,a,2*s)+i*this.perlinNoise(4*o,a,2*s)}}},{key:"perlinNoise",value:function(e,t,r){for(var i=new Array(512),n=[151,160,137,91,90,15,131,13,201,95,96,53,194,233,7,225,140,36,103,30,69,142,8,99,37,240,21,10,23,190,6,148,247,120,234,75,0,26,197,62,94,252,219,203,117,35,11,32,57,177,33,88,237,149,56,87,174,20,125,136,171,168,68,175,74,165,71,134,139,48,27,166,77,146,158,231,83,111,229,122,60,211,133,230,220,105,92,41,55,46,245,40,244,102,143,54,65,25,63,161,1,216,80,73,209,76,132,187,208,89,18,169,200,196,135,130,116,188,159,86,164,100,109,198,173,186,3,64,52,217,226,250,124,123,5,202,38,147,118,126,255,82,85,212,207,206,59,227,47,16,58,17,182,189,28,42,223,183,170,213,119,248,152,2,44,154,163,70,221,153,101,155,167,43,172,9,129,22,39,253,19,98,108,110,79,113,224,232,178,185,112,104,218,246,97,228,251,34,242,193,238,210,144,12,191,179,162,241,81,51,145,235,249,14,239,107,49,192,214,31,181,199,106,157,184,84,204,176,115,121,50,45,127,4,150,254,138,236,205,93,222,114,67,29,24,72,243,141,128,195,78,66,215,61,156,180],o=function(e){return e*e*e*(e*(6*e-15)+10)},a=function(e,t,r){return t+e*(r-t)},s=function(e,t,r,i){var n=15&e,o=n<8?t:r,a=n<4?r:12==n||14==n?t:i;return(0==(1&n)?o:-o)+(0==(2&n)?a:-a)},u=function(e){return(1+e)/2},l=0;l<256;l++)i[256+l]=i[l]=n[l];var c=255&Math.floor(e),h=255&Math.floor(t),d=255&Math.floor(r);e-=Math.floor(e),t-=Math.floor(t),r-=Math.floor(r);var f=o(e),v=o(t),m=o(r),p=i[c]+h,g=i[p]+d,y=i[p+1]+d,A=i[c+1]+h,b=i[A]+d,E=i[A+1]+d;return u(a(m,a(v,a(f,s(i[g],e,t,r),s(i[b],e-1,t,r)),a(f,s(i[y],e,t-1,r),s(i[E],e-1,t-1,r))),a(v,a(f,s(i[g+1],e,t,r-1),s(i[b+1],e-1,t,r-1)),a(f,s(i[y+1],e,t-1,r-1),s(i[E+1],e-1,t-1,r-1)))))}},{key:"computeScale",value:function(e,t){for(var r=this.computeCentroid(e),i=0;i<e.length;i++)e[i]*=t;this.computeMove(e,r)}},{key:"computeMove",value:function(e,t){for(var r=this.computeCentroid(e),i=[r[0]-t[0],r[1]-t[1],r[2]-t[2]],n=0;n<e.length;n+=3)e[n]-=i[0],e[n+1]-=i[1],e[n+2]-=i[2]}},{key:"computeFan",value:function(e,t){var r=(this.glMatrix.vec3,[]);console.error("???INDICES LENGTH:"+t.length);for(var i=0;i<t.length;i++)r.push(e[t[i]]);var n=this.computeCentroid(r);r.push(n);for(var o=r.length-1,a=[],s=[],u=[],l=r.length,c=1;c<l;c++){var h=c-1,d=c;c===l-1&&(d=0);r[h],r[d];u.push(h,d,o),s.push(n[0],n[1],n[2]),a.push(Math.cos(this.TWO_PI*d/(l-1))/2+.5,Math.sin(this.TWO_PI*d/(l-1))/2+.5)}return a.push(.5,.5),s.push(n[0],n[1],n[2]),this.default(r,u,a,s,[],[])}},{key:"computeRandomSphere",value:function(e,t,r,i){for(var n=this.util,o=new Float32Array(2*i),a=0;a<i;a+=2)o[a]=2*Math.PI*n.getRand(),o[a+1]=Math.acos(2*n.getRand()-1);return{vertices:n.uvToCartesian(o,e,t,r),uv:o}}},{key:"geometryPointCloud",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=e.dimensions,i=e.divisions;e.drawTris=!1,e.drawPoints=!0;var n=[],o=[],a=[],s=[],u=[],l=this.computeRandomSphere(r[0],r[1],r[2],i[0]*i[1]*i[2]);n=l.vertices;for(var c=0,h=0;h<n.length;h+=3)o.push(c++);if(t)for(var d=l.uv,f=2*Math.PI,v=(Math.PI/2,0);v<d.length;v+=2)s.push(1-d[v]/f),s.push(d[v+1]/Math.PI);return this.default(n,o,s,a,u)}},{key:"geometryTextureCloud",value:function(e){return this.geometryPointCloud(e,!0)}},{key:"geometryStarDome",value:function(e){return console.error("GeometryPool::geometryStarDome(): not procedural, use stellar data, generating randomMap"),this.geometryPointCloud(e)}},{key:"geometryStarSpace",value:function(e){return console.error("GeometryPool::geometryStarSpace(): not procedural, use stellar data, generating randomMap"),this.geometryPointCloud(e)}},{key:"geometryLine",value:function(e){var t=(this.glMatrix.vec3,e.geometry,e.dimensions[0]),r=e.dimensions[1],i=e.dimensions[2],n=parseFloat(e.dimensions[3])||1,o=(parseFloat(e.dimensions[4])||1,e.divisions[0]||1,[]),a=[],s=[],u=[],l=[];return o.push(t-n,r-n,i-n,t+n,r+n,i+n),a.push(0,3),this.default(o,a,s,u,l)}},{key:"geometrySphere",value:function(e){var t=this.typeList,r=this.glMatrix.vec3,i=e.geometry;e.applyTexToFace===!0&&console.warn("GeometryPool::geometrySphere(): cannot apply textures to individual faces of Sphere-derived shapes due to shared indices");var n=[],o=[],a=[],s=[],u=[],l=e.divisions[0],c=e.divisions[1],h=e.dimensions[0],d=e.dimensions[1],f=e.dimensions[2],v=parseFloat(e.dimensions[3])||0,m=parseFloat(e.dimensions[4])||1;v>e.dimensions[1]&&console.error("GeometryPool::geometrySphere(): error - flattening is greater than sphere radius for:"+e.name);var p=0,g=0,y=void 0;y=e.type===t.SPHERE||e.type===t.CYLINDER||e.type===t.SPINDLE||e.type===t.CONE||e.type===t.TEARDROP?c:e.type===t.CAP?1:c/2;var A=void 0,b=void 0;for(A=p;A<=y;A++){var E=A*Math.PI/c,M=Math.sin(E),x=Math.cos(E);for(b=g;b<=l;b++){var w=b*this.TWO_PI/l,T=Math.sin(w),P=Math.cos(w),D=void 0,R=void 0,C=void 0,S=void 0,O=void 0,I=void 0,k=void 0,_=A/y;I=_/2;var L=b/l;switch(S=1-L,O=1-_,D=P*M/2,C=T*M/2,k=(1-_)*v,e.type){case t.CAP:R=0;break;case t.CYLINDER:case t.PRISM:v>0&&_<=v?R=1-v:1!==m&&_>=m?R=1-m:(R=1-_,D=P/2,C=T/2),R-=.5;break;case t.SPHERE:R=x/2,v>0&&(R-=k);break;case t.TOPDOME:case t.DOME:R=x/2,v>0&&(R-=k);break;case t.SKYDOME:R=x/2,v>0&&(R-=k),S=L;break;case t.BOTTOMDOME:R=(1-x)/2-.5,v>0&&(R-=k),S=L,O=_;break;case t.SPINDLE:_<=.4?(D=P*_,C=T*_):(D=P*(1-_+1/y),C=T*(1-_+1/y)),R=1-_-.5;break;case t.TEARDROP:_<.5?R=x/4:(D=2*P*(.5-I),C=2*T*(.5-I),R=x/2);break;case t.CONE:_<=v?(R=1-v,D=P*I,C=T*I):_>m?(R=1-m,D=P*M/2,C=T*M/2):(R=1-_,D=P*I,C=T*I),R-=.5;break;case t.TOPCONE:D=P*I,C=T*I,R=.5-I;break;case t.BOTTOMCONE:D=P*(.5-I),C=T*(.5-I),R=0-I}s.push(S,O);var N=r.normalize([0,0,0],[D,R,C]);if(n.push(D*h,R*d,C*f),e.type===t.BOTTOMDOME||e.type===t.BOTTOMCONE||e.type===t.SKYDOME?(R=-R,a.push(-N[0],-N[1],-N[2])):(e.type===t.CAP&&(N[0]=N[2]=0,N[1]=1),a.push(N[0],N[1],N[2])),A!==y&&b!==l){var F=A*(l+1)+b,B=F+l+1;o.push(F+1,B+1,B),o.push(F,F+1,B)}}}return e.type===t.SKYDOME&&(i.indices.data=o.reverse()),this.default(n,o,s,a,u)}},{key:"geometryCap",value:function(e){return this.geometrySphere(e)}},{key:"geometryDome",value:function(e){return this.geometrySphere(e)}},{key:"geometryTopDome",value:function(e){return this.geometrySphere(e)}},{key:"geometrySkyDome",value:function(e){return e.visibleFrom=this.INSIDE,this.geometrySphere(e)}},{key:"geometryBottomDome",value:function(e){return this.geometrySphere(e)}},{key:"geometryCylinder",value:function(e){return this.geometrySphere(e)}},{key:"geometryCone",value:function(e){return this.geometrySphere(e)}},{key:"geometryTopCone",value:function(e){return this.geometrySphere(e)}},{key:"geometryBottomCone",value:function(e){return this.geometrySphere(e)}},{key:"geometrySpindle",value:function(e){return this.geometrySphere(e)}},{key:"geometryTeardrop",value:function(e){return this.geometrySphere(e)}},{key:"geometryCapsule",value:function(e){function t(e,t,n,s){for(var c=1/(e-1),h=0;h<e;h++){var d=Math.cos(r*h*c)*t,f=Math.sin(r*h*c)*t;i.push(u*d,u*n+l*s,u*f),o.push(d,n,f);var v=1-h*c,m=.5+(u*n+l*s)/(2*u+l);a.push(v,m)}}var r=this.TWO_PI,i=(this.typeList,this.glMatrix.vec3,this.util,e.geometry,[]),n=[],o=[],a=[],s=[];(e.divisions[0]<4||e.divisions[1]<4||e.divisions[2]<4)&&console.error("GeometryPool::geometryCapsule(): invalid number of divisions for "+e.name+" (must be 4+ in each dimension");for(var u=e.dimensions[0]||.5,l=e.dimensions[1]||1,c=e.divisions[0]||12,h=e.divisions[1]||12,d=c+1,f=c+d,v=1/(d-1),m=1/(c-1),p=0;p<c/2;p++)t(h,Math.sin(Math.PI*p*m),Math.sin(Math.PI*(p*m-.5)),-.5);for(var g=0;g<d;g++)t(h,1,0,g*v-.5);for(var y=c/2;y<c;y++)t(h,Math.sin(Math.PI*y*m),Math.sin(Math.PI*(y*m-.5)),.5);for(var A=0;A<f-1;A++)for(var b=0;b<h-1;b++)n.push(A*h+(b+1),A*h+(b+0),(A+1)*h+(b+1)),n.push((A+1)*h+(b+0),(A+1)*h+(b+1),A*h+b);return this.default(i,n,a,o,s)}},{key:"geometryCube",value:function(e){function t(t,r,i,n,o,a,u,c,h,d,f){for(var v=A,m=0;m<=u;m++)for(var p=0;p<=a;p++){var b=g[A]=[0,0,0];b[t]=(-n/2+p*n/a)*h,b[r]=(-o/2+m*o/u)*d,b[i]=c,e.heightMap&&(b[i]=e.heightMap.getPixel(p,m)),l.push(p/a,1-m/u),++A}for(var E=[],M=0;M<u;M++)for(var x=0;x<a;x++){var w=v+M*(a+1)+x;s.push(w,w+a+1,w+a+2),s.push(w,w+a+2,w+1),E.push(w,w+a+1,w+a+2),E.push(w,w+a+2,w+1)}y[f]=E}var r=this.glMatrix.vec3,i=this.util.flatten,n=this.typeList,o=this.directions;e.geometry;e.applyTexToFace===!1&&console.warn("GeometryPool::geometryCube(): textures can only apply to individual faces of Cube-derived shapes");var a=[],s=[],u=[],l=[],c=[],h=e.dimensions[0],d=e.dimensions[1],f=e.dimensions[2],v=e.divisions[0],m=e.divisions[1],p=e.divisions[2],g=[],y=[],A=0;switch(e.type){case n.CUBE:case n.CUBESPHERE:e.divisions[3]=parseFloat(e.divisions[3]),e.divisions[4]=parseFloat(e.divisions[4]),t(0,1,2,h,d,v,m,f/2,1,-1,o.FRONT,o),t(0,1,2,h,d,v,m,-f/2,-1,-1,o.BACK,o),t(2,1,0,f,d,p,m,-h/2,1,-1,o.LEFT,o),t(2,1,0,f,d,p,m,h/2,-1,-1,o.RIGHT,o),t(0,2,1,h,f,v,p,d/2,1,1,o.TOP,o),t(0,2,1,h,f,v,p,-d/2,1,-1,o.BOTTOM,o);break;case n.PLANE:case n.CURVEDOUTERPLANE:case n.CURVEDINNERPLANE:case n.TERRAIN:switch(e.dimensions[3]){case o.FRONT:t(0,1,2,h,d,v,m,f/2,1,-1,o.FRONT);break;case o.BACK:t(0,1,2,h,d,v,m,-f/2,-1,-1,o.BACK);break;case o.LEFT:t(2,1,0,h,d,p,m,-h/2,1,-1,o.LEFT);break;case o.RIGHT:t(2,1,0,h,d,p,m,h/2,-1,-1,o.RIGHT);break;case o.TOP:t(0,2,1,h,d,v,p,d/2,1,1,o.TOP);break;case o.BOTTOM:t(0,2,1,h,-d,v,p,-d/2,1,-1,o.BOTTOM)}}if(e.type!==n.CUBE&&e.type!==n.CUBESPHERE||0===e.divisions[3]){if((e.type===n.CURVEDOUTERPLANE||e.type===n.CURVEDINNERPLANE)&&e.dimensions[4]&&0!==e.dimensions[4]){var b=1;switch(e.dimensions[3]){case o.FRONT:e.type!==n.CURVEDINNERPLANE&&e.type!=n.INNERPLANE||(b=-1);break;case o.BACK:e.type!==n.CURVEDOUTERPLANE&&e.type!==n.OUTERPLANE||(b=-1);break;case o.LEFT:e.type!==n.CURVEDOUTERPLANE&&e.type!==n.OUTERPLANE||(b=-1);break;case o.RIGHT:e.type!==n.CURVEDINNERPLANE&&e.type!==n.INNERPLANE||(b=-1);break;case o.TOP:e.type!==n.CURVEDOUTERPLANE&&e.type!==n.OUTERPLANE||(b=-1);break;case o.BOTTOM:e.type!==n.CURVEDINNERPLANE&&e.type!==n.INNERPLANE||(b=-1)}for(var E=0;E<g.length;E++)switch(e.dimensions[3]){case o.FRONT:g[E][2]=b*Math.cos(g[E][0])*e.dimensions[4];break;case o.BACK:g[E][2]=b*Math.cos(g[E][0])*e.dimensions[4];break;case o.LEFT:g[E][0]=b*Math.cos(g[E][2])*e.dimensions[4];break;case o.RIGHT:g[E][0]=b*Math.cos(g[E][2])*e.dimensions[4];break;case o.TOP:g[E][1]=b*Math.cos(g[E][0])*e.dimensions[4];break;case o.BOTTOM:g[E][1]=-Math.cos(g[E][0])*e.dimensions[4]}}}else for(var M=[0,0,0],x=e.divisions[3],w=h/2,T=d/2,P=f/2,D=0;D<g.length;D++){var R=g[D],C=[R[0],R[1],R[2]];R[0]<-w+x?C[0]=-w+x:R[0]>w-x&&(C[0]=w-x),R[1]<-T+x?C[1]=-T+x:R[1]>T-x&&(C[1]=T-x),R[2]<-P+x?C[2]=-P+x:R[2]>P-x&&(C[2]=P-x);var S=[R[0],R[1],R[2]];r.sub(S,S,C),r.normalize(S,S),u[D]=S,R=[C[0],C[1],C[2]],M=[S[0],S[1],S[2]],r.scale(M,M,x),r.add(R,R,M),g[D]=R}return a=i(g,!1),u.length&&(u=i(u,!1)),this.default(a,s,l,u,c)}},{key:"geometryOuterPlane",value:function(e){return this.geometryCube(e)}},{key:"geometryInnerPlane",value:function(e){return this.geometryCube(e)}},{key:"geometryCurvedOuterPlane",value:function(e){return this.geometryCube(e)}},{key:"geometryCurvedInnerPlane",value:function(e){return this.geometryCube(e)}},{key:"geometryTerrain",value:function(e){var t=e.dimensions[1];e.dimensions[1]=e.dimensions[2],e.dimensions[3]="top";var r=this.geometryOuterPlane(e);return this.computeMove(r.vertices,[0,-e.dimensions[1]/2,0]),e.dimensions[1]=t,!e.models||0===e.models.length,r}},{key:"geometryTerrainSphere",value:function(e){return null}},{key:"geometryHexTerrain",value:function(e){return null}},{key:"geometryOctTerrain",value:function(e){return null}},{key:"geometryCubeSphere",value:function(e){return e.divisions[3]=e.dimensions[0]/2,this.geometryCube(e)}},{key:"geometryIcoSphere",value:function(e,t,r){function i(e,t){var r=1;for(D=0;D<e.length;D++){w=e[D],w[0]==r&&(t[D-1][0]=1),r=w[0];var i=[0,0];i[0]=Math.atan2(w[0],w[2])/-l,i[0]<0&&(i[0]+=1),i[1]=Math.asin(w[1])/Math.PI+.5,t[D]=i}for(t[e.length-4][0]=.125,t[0][0]=.125,t[e.length-3][0]=.375,t[1][0]=.375,t[e.length-2][0]=.625,t[2][0]=.625,t[e.length-1][0]=.875,t[3][0]=.875,D=0;D<E.length;D++)E[D][0]=1-E[D][0]}function n(e,t){for(D=0;D<e.length;D++){var r=e[D],i=c.normalize([0,0,0],[r[0],0,r[2]]),n=[0,0,0,0];n[0]=-i[2],n[1]=0,n[2]=i[0],n[3]=-1,t[D]=n}for(t[e.length-4]=[-1,0,1],t[0]=[-1,0,-1],t[e.length-3]=[1,0,-1],t[1]=[1,0,-1],t[e.length-2]=[1,0,1],t[2]=[1,0,1],t[e.length-1]=[-1,0,1],t[3]=[-1,0,1],D=0;D<4;D++)t[e.length-1-D][3]=t[D][3]=-1}function o(e,t,r,i,n){for(var o=1;o<=r;o++)n[i++]=c.lerp([0,0,0],e,t,o/r);return i}function a(e,t,r,i,n){for(var o=1;o<e;o++)n[i++]=r,n[i++]=t-1,n[i++]=t,n[i++]=r++,n[i++]=t++,n[i++]=r;return n[i++]=r,n[i++]=t-1,n[i++]=t,i}function s(e,t,r,i,n){n[i++]=r,n[i++]=t-1,n[i++]=++r;for(var o=1;o<=e;o++)n[i++]=t-1,n[i++]=t,n[i++]=r,n[i++]=r,n[i++]=t++,n[i++]=++r;return i}function u(e,t,r,i,n){n[i++]=r,n[i++]=++r,n[i++]=t-1;for(var o=1;o<=e;o++)n[i++]=t,n[i++]=t-1,n[i++]=r,n[i++]=r,n[i++]=++r,n[i++]=t++;return i}var l=this.TWO_PI,c=this.glMatrix.vec3,h=this.util.flatten,d=this.typeList,f=this.directions;e.applyTexToFace===!0&&console.warn("GeometryPool::geometryIcoSphere(): cannot apply textures to individual faces of IcoSphere-derived shapes due to shared indices");var v=void 0;v=e.divisions[0],v=e.type===d.REGULARTETRAHEDRON?1:e.type===d.ICOSOHEDRON?2:e.divisions[0];var m=.5*e.dimensions[0],p=v,g=this.getStdVecs.bind(this),y=[f.LEFT,f.BACK,f.RIGHT,f.FORWARD],A=(e.geometry,new Array((p+1)*(p+1)*4-3*(2*p-1))),b=new Array(A.length),E=new Array(A.length),M=new Array(A.length),x=new Array(A.length),w=0,T=0,P=0,D=void 0,R=void 0,C=void 0,S=void 0,O=void 0;for(D=0;D<4;D++)A[w++]=g(f.DOWN);for(D=1;D<=p;D++){for(C=D/p,O=c.lerp([0,0,0],g(f.DOWN),g(f.FORWARD),C),A[w++]=c.copy([0,0,0],O),R=0;R<4;R++)S=c.copy([0,0,0],O),O=c.lerp([0,0,0],g(f.DOWN),g(y[R]),C),t!==this.directions.TOP&&(P=a(D,w,T,P,b)),w=o(S,O,D,w,A),T+=D>1?D-1:1;T=w-1-4*D}for(D=p-1;D>=1;D--){for(C=D/p,O=c.lerp([0,0,0],g(f.UP),g(f.FORWARD),C),A[w++]=c.copy([0,0,0],O),R=0;R<4;R++)S=c.copy([0,0,0],O),O=c.lerp([0,0,0],g(f.UP),g(y[R]),C),t!==this.directions.BOTTOM&&(P=r===this.INSIDE?u(D,w,T,P,b):s(D,w,T,P,b)),w=o(S,O,D,w,A),T+=D+1;T=w-1-4*D}for(D=0;D<4;D++)b[P++]=T,b[P++]=w,b[P++]=++T,A[w++]=g(f.UP);for(D=0;D<A.length;D++)e.type!==d.OCTAHEDRON&&(A[D]=c.normalize([0,0,0],A[D])),M[D]=c.copy([0,0,0],A[D]);if(i(A,E),1!=m)for(D=0;D<A.length;D++)A[D][0]*=m,A[D][1]*=e.dimensions[1]/2,A[D][2]*=e.dimensions[2]/2;return n(A,x),A=h(A,!1),E=h(E,!1),M=h(M,!1),x=h(x,!1),this.default(A,b,E,M,x)}},{key:"geometryRegularTetrahedron",value:function(e){return this.geometryIcoSphere(e)}},{key:"geometryIcosohedron",value:function(e){return this.geometryIcoSphere(e)}},{key:"geometryPrism",value:function(e){var t=null;[e.divisions[0],e.divisions[1],e.divisions[2]];if(e.divisions=[3,2,3],t=this.geometrySphere(e),e.applyTexToFace===!0)for(var r=t.texCoords.length,i=0;i<r;i+=2){var n=3*t.texCoords[i];n>=2&&(n-=2),t.texCoords[i]=n}var o=e.dimensions[1]/2,a=t.vertices.length/3;return a=t.vertices.length/3,t.vertices=this.util.concatArr(t.vertices,[t.vertices[0],-o,t.vertices[2],t.vertices[3],-o,t.vertices[5],t.vertices[6],-o,t.vertices[8]]),t.normals=this.util.concatArr(t.normals,[0,-1,0,0,-1,0,0,-1,0]),t.texCoords=this.util.concatArr(t.texCoords,[0,1,1,1,.5,0]),t.indices=this.util.concatArr(t.indices,[a,a+1,a+2]),a=t.vertices.length/3,t.vertices=this.util.concatArr(t.vertices,[t.vertices[0],o,t.vertices[2],t.vertices[3],o,t.vertices[5],t.vertices[6],o,t.vertices[8]]),t.normals=this.util.concatArr(t.normals,[0,1,0,0,1,0,0,1,0]),t.texCoords=this.util.concatArr(t.texCoords,[0,1,1,1,.5,0]),t.indices=this.util.concatArr(t.indices,[a,a+1,a+2]),t}},{key:"geometryPyramid",value:function(e){for(var t=([e.divisions[0],e.divisions[1],e.divisions[2]],[-0,-.5,0,.5,.5,.5,-.5,.5,.5,-0,-.5,0,-.5,.5,.5,-.5,.5,-.5,-0,-.5,0,-.5,.5,-.5,.5,.5,-.5,-0,-.5,0,.5,.5,-.5,.5,.5,.5,-.5,.5,-.5,-.5,.5,.5,.5,.5,.5,.5,.5,-.5,-.5,.5,-.5,.5,.5,.5]),r=0;r<t.length;r+=3)t[r]*=e.dimensions[0],t[r+1]*=e.dimensions[1],t[r+2]*=e.dimensions[2];var i=[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17],n=[],o=[],a=[];return n=e.applyTexToFace===!0?[.5,1,0,0,1,0,.5,1,0,0,1,0,.5,1,0,0,1,0,.5,1,0,0,1,0,1,1,0,1,0,0,1,0,1,1,0,0]:[.125,1,0,0,.25,0,.375,1,.25,0,.5,0,.625,1,.5,0,.75,0,.875,1,.75,0,1,0,1,1,0,1,0,0,1,0,1,1,0,0],this.default(t,i,n,o,a)}},{key:"geometryIcoDome",value:function(e){return this.geometryTopIcoDome(e)}},{key:"geometryTopIcoDome",value:function(e){return this.geometryIcoSphere(e,this.directions.TOP)}},{key:"geometrySkyIcoDome",value:function(e){return e.visibleFrom=this.INSIDE,this.geometryIcoSphere(e,this.directions.TOP,e.visibleFrom)}},{key:"geometryBottomIcoDome",value:function(e){return this.geometryIcoSphere(e,this.directions.BOTTOM)}},{key:"geometryOctahedron",value:function(e){return this.geometryIcoSphere(e)}},{key:"geometryDodecahedron",value:function(e){var t=this.glMatrix.vec3,r=this.util.flatten,i=(e.geometry,[]),n=[],o=[],a=[],s=[],u=e.dimensions[0],l=e.dimensions[1],c=e.dimensions[2],h=(e.divisions[0]||.5,(1+Math.sqrt(5))/2),d=.5,f=.5/h,v=.5*(2-h),m=[[v,0,d],[-v,0,d],[-f,f,f],[0,d,v],[f,f,f],[f,-f,f],[0,-d,v],[-f,-f,f],[v,0,-d],[-v,0,-d],[-f,-f,-f],[0,-d,-v],[f,-f,-f],[f,f,-f],[0,d,-v],[-f,f,-f],[d,v,0],[-d,v,0],[-d,-v,0],[d,-v,0]],p=[[4,3,2,1,0],[7,6,5,0,1],[12,11,10,9,8],[15,14,13,8,9],[14,3,4,16,13],[3,14,15,17,2],[11,6,7,18,10],[6,11,12,19,5],[4,0,5,19,16],[12,8,13,16,19],[15,9,10,18,17],[7,1,2,17,18]];if(e.applyTexToFace)for(var g=0;g<p.length;g++){var y=i.length,A=this.computeFan(m,p[g]);i=i.concat(A.vertices);for(var b=0;b<A.indices.length;b++)A.indices[b]+=y;n=n.concat(A.indices),a=a.concat(A.texCoords),o=o.concat(A.normals)}else for(var E=0;E<p.length;E++){for(var M=p[E],x=[],w=M.length,T=0;T<M.length;T++)x.push(m[M[T]]);for(var P=this.geometry.computeCentroid(x),D=1;D<=w;D++){var R=D-1,C=D;D===w&&(R=C-1,C=0);var S=x[R],O=x[C];i.push(t.copy([0,0,0],S),t.copy([0,0,0],O),t.copy([0,0,0],P));var I=i.length-1;n.push(I-2,I-1,I),o.push(t.copy([0,0,0],S),t.copy([0,0,0],O),t.copy([0,0,0],P)),a.push(this.computeSphericalCoords(S),this.computeSphericalCoords(O),this.computeSphericalCoords(P))}}for(var k=0;k<i.length;k++){var _=i[k];_[0]*=u,_[1]*=l,_[2]*=c}return i=r(i),a=r(a),o=r(o),this.default(i,n,a,o,s)}},{key:"geometryTorus",value:function(e){for(var t=this.glMatrix.vec3,r=(e.geometry,[]),i=[],n=[],o=[],a=[],s=e.dimensions[0]/2,u=e.dimensions[2]/2,l=e.divisions[0],c=e.divisions[1],h=c+1,d=l+1,f=this.TWO_PI/l,v=this.TWO_PI/c,m=0,p=0,g=void 0,y=void 0,A=void 0,b=0;b<d;b++){m=f*b;for(var E=0;E<h;E++){p=v*E,g=Math.cos(m)*(s+u*Math.cos(p)),y=Math.sin(m)*(s+u*Math.cos(p)),A=u*Math.sin(p),r.push(g,y,A);var M=t.normalize([0,0,0],[g,y,A]);n.push(M[0],M[1],M[2]);var x=E/h,w=b/d;o.push(x,w)}}for(var T=0;T<l;T++)for(var P=0;P<c;P++){var D=P+T*h,R=P+1+T*h,C=P+(T+1)*h,S=P+1+(T+1)*h;i.push(C,S,R,C,R,D)}return this.default(r,i,o,n,a)}},{key:"geometryMesh",value:function(e,t){if(void 0===t||void 0===t.length)return console.error("GeometryPool::geometryMesh(): empty path passed for mesh file, returning"),!1;for(var r=0;r<t.length;r++)this.modelPool.getModel(e,t[r],!0,{pos:r});return!0}},{key:"getGeometry",value:function(e,t){var r=(!(arguments.length>2&&void 0!==arguments[2])||arguments[2],arguments.length>3&&void 0!==arguments[3]?arguments[3]:{pos:0});if(null!==t)!t instanceof String||!this.util.isWhitespace(t)?(console.log("GeometryPool::getGeometry(): getting model for:"+e.name+" at path:"+t),e.type===this.typeList.STARDOME?r.useXYZ=!1:e.type===this.typeList.STAR3D&&(r.useXYZ=!0),this.modelPool.getModel(e,t,!0,r)):console.warn("GeometryPool::getGeometry(): no path supplied for prim "+e.name);else{if(console.log("GeometryPool::getGeometry() new procedural geometry for:"+e.name),e.type===this.typeList.MESH)return void console.error("GeometryPool::getGeometry(): Mesh object for "+e.name+" does not have associated file, giving up");var i=this.modelPool.addAsset(this[e.type](e));i.type=e.type,i.path=i.key,i.material=this.util.DEFAULT_KEY,this.util.emitter.emit(this.util.emitter.events.PROCEDURAL_GEOMETRY_READY,e,i.key,r)}}}]),e}());t.default=l},function(e,t){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),n=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;r(this,e),this.x=t,this.y=i,this.z=n}return i(e,[{key:"isValid",value:function(){return Number.isFinite(this.x)&&Number.isFinite(this.y)&&Number.isFinite(this.z)}},{key:"add",value:function(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this}},{key:"subtract",value:function(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this}},{key:"scale",value:function(e){return this.x*=e,this.y*=e,this.z*=e,this}},{key:"distance",value:function(e,t){var r=this.x-e.x,i=this.y-e.y,n=this.z-e.z;return t?(Math.abs(r)+Math.abs(i)+Math.abs(n))/3:Math.sqrt(r*r+i*i+n*n)}},{key:"clone",value:function(){return new e(this.x,this.y,this.z)}}]),e}(),o=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,u=arguments.length>5&&void 0!==arguments[5]?arguments[5]:-1,l=arguments.length>6&&void 0!==arguments[6]?arguments[6]:[];r(this,e),this.coords=new n(t,i,o),this.texCoords={u:a,v:s},this.idx=u,this.e=[],this.s=[],this.vertexArr=l}return i(e,[{key:"isValid",value:function(){var e=this.texCoords;return this.idx===-1?(console.error("Vertex::isValid(): index never set!"),!1):this.coords.isValid()?!Number.isFinite(parseFloat(e.u))||!Number.isFinite(parseFloat(e.v))||(e.u>=0&&e.v>=0||(console.warn("Vertex.isValid(): negative texture coordinates for:"+this.idx+e),!1)):(console.error("Vertex::isValid(): invalid coordinates for vertex position:"+this.idx+" coords.x:"+Number.isFinite(this.coords.x)+", coords.y:"+Number.isFinite(this.coords.y)+", coords.z:"+Number.isFinite(this.coords.z)),!1)}},{key:"distance",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this.coords.distance(e.coords,t)}},{key:"set",value:function(e,t,r,i,n){return this.coords.x=e,this.coords.y=t,this.coords.z=r,void 0!==i&&(this.texCoords.u=i),void 0!==n&&(this.texCoords.v=n),this}},{key:"add",value:function(e){return this.coords.add(e.coords),this}},{key:"subtract",value:function(e){return this.coords.subtract(e.coords),this}},{key:"scale",value:function(e){return this.coords.scale(e),this}},{key:"clone",value:function(t){for(var r=new e(this.coords.x,this.coords.y,this.coords.z,this.texCoords.u,this.texCoords.v,this.idx,t),i=0;i<this.e.length;i++)r.e.push(this.e[i]);for(var n=0;n<this.s.length;n++)r.s.push(this.s[n]);return r}}]),e}(),a=function(){function e(t,i,n,o){r(this,e),this.v=new Array(2),this.ov=new Array(2),this.f=new Array(2),this.v[0]=t,this.v[1]=i,this.f[0]=o,this.f[1]=4294967295,this.ov[0]=n,this.ov[1]=n}return i(e,[{key:"isValid",value:function(){return!(!this.v[0].isValid()||!this.v[1].isValid)}},{key:"getOpposite",value:function(e){return e.idx===this.v[0]?this.v[1]:e.idx===this.v[1]?this.v[0]:void console.error("Edge::getOpposite(): invalid Vertex:"+e.idx+" supplied, our Edge:"+this.v[0]+", "+this.v[1])}}]),e}(),s=function e(t,i,n){r(this,e),this.e=new Array(3),this.e[0]=t,this.e[1]=i,this.e[2]=n},u=function(){function e(t){r(this,e),this.prim=t,this.util=t.util,this.geo=t.geometry,this.type=this.geo.type,this.vertexArr=[],this.indexArr=[],this.edgeArr=[],this.edgeMap=[],this.faceArr=[],this.valenceArr=[],this.oldVertexArr=[],this.avDistance=0,this.width=0,this.height=0,this.depth=0,this.centroid=null,this.iterations=0,this.epsilon=1e-9,this.fw=3/8,this.ow=1/8,this.f0w=.5,this.badIndex32=4294967294,this.NOT_IN_LIST=-1,this.computeValencyWeights(100),this.geometryToVertex(this.geo.vertices.data,this.geo.indices.data,this.geo.texCoords.data)}return i(e,[{key:"computeValencyWeights",value:function(e){this.valenceArr=new Array(e),this.valenceArr[0]=0,this.valenceArr[1]=0,this.valenceArr[2]=1/8,this.valenceArr[3]=3/16;for(var t=4;t<e;t++)this.valenceArr[t]=1/t*(5/8-Math.pow(3/8+.25*Math.cos(2*Math.PI/t),2))}},{key:"computeCentroid",value:function(){var e=arguments.length,t=0,r=0,i=0,n=0,a=0;for(var s in arguments){var u=arguments[s];t+=u.coords.x,r+=u.coords.y,i+=u.coords.z,n+=u.texCoords.u,a+=u.texCoords.v}return t/=e,r/=e,i/=e,n/=e,a/=e,new o(t,r,i,n,a,0,null)}},{key:"computeVertices",value:function(e,t){var r=0,i=0,a=0,s=new n,u=new n,l=new n,c=e.length/3,h=new Array(c);for(r=0;r<c;r++){h[r]=new o(e[i++],e[i++],e[i++],t[a++],t[a++],r,h);var d=h[r];if(r>0){var f=d.coords;s.x=Math.min(s.x,f.x),u.x=Math.max(u.x,f.x),s.y=Math.min(s.y,f.y),u.y=Math.min(s.y,f.y),s.z=Math.min(s.z,f.z),u.z=Math.min(u.z,f.z),l.add(f)}this.centroid=l.scale(1/c)}return this.width=u.x-s.x,this.height=u.y-s.y,this.depth=u.z-s.z,h}},{key:"computeEdge",value:function(e,t,r,i){var n=this.vertexArr,o=this.edgeArr,s=-1,u=Math.min(e,t),l=Math.max(e,t),c=u+"-"+l;if(c in this.edgeMap){s=this.edgeMap[c];var h=o[s];h.f[1]=i,h.ov[1]=r}else{s=o.length,this.edgeMap[c]=s;var d=new a(u,l,r,i);o.push(d),n[u].e.push(s),n[l].e.push(s)}return s}},{key:"computeFaces",value:function(){for(var e=(this.vertexArr,this.indexArr),t=e.length,r=this.faceArr,i=0;i<t;i+=3){var n=e[i],o=e[i+1],a=e[i+2],u=i/3,l=new s(this.computeEdge(n,o,a,u),this.computeEdge(o,a,n,u),this.computeEdge(a,n,o,u),u);r.push(l)}}},{key:"computeEven",value:function(e,t){var r=this.edgeArr,i=e.e.length;e.e;if(i<6)return!1;for(var n=this.valenceArr[i],o=1-i*n,a=e.coords,s=e.texCoords,u=o*a.x,l=o*a.y,c=o*a.z,h=o*s.u,d=o*s.v,f=0;f<i;f++){var v=t[r[e.e[f]].getOpposite(e)];a=v.coords,s=v.texCoords,u+=n*a.x,l+=n*a.y,c+=n*a.z,h+=n*s.u,d+=n*s.v}return e.set(u,l,c,h,d),!0}},{key:"computeOdd",value:function(e,t,r,i){var n=this.fw,o=this.ow,a=this.f0w,s=this.edgeArr,u=s[this.edgeMap[r]];if(u||(u=s[this.edgeMap[i]]),u){var l=t[u.v[0]],c=t[u.v[1]],h=t[u.ov[0]],d=t[u.ov[1]],f=void 0,v=void 0,m=void 0,p=void 0,g=void 0;return h!==d?(f=n*(l.coords.x+c.coords.x),v=n*(l.coords.y+c.coords.y),m=n*(l.coords.z+c.coords.z),p=n*(l.texCoords.u+c.texCoords.u),g=n*(l.texCoords.v+c.texCoords.v),f+=o*(h.coords.x+d.coords.x),v+=o*(h.coords.y+d.coords.y),m+=o*(h.coords.z+d.coords.z),p+=o*(h.texCoords.u+d.texCoords.u),g+=o*(h.texCoords.v+d.texCoords.v),e.set(f,v,m,p,g),!0):(f=a*(l.coords.x+c.coords.x),v=a*(l.coords.y+c.coords.y),m=a*(l.coords.z+c.coords.z),p=a*(l.texCoords.u+c.texCoords.u),g=a*(l.texCoords.v+c.texCoords.v),e.set(f,v,m,p,g),!0)}return console.error("Mesh::computeEven(): invalid keys:"+r+","+i+" edge is undefined"),!1}},{key:"subdivide",value:function(e){if(this.geo.vertices.data.length/3>this.geo.MAX_DRAWELEMENTS)return console.warn("subdivision of "+geo.type+" would exceed ability of device to render indexed meshes, aborting..."),this;this.geometryToVertex(this.geo.vertices.data,this.geo.indices.data,this.geo.texCoords.data,this.geo.colors.data),this.isValid();var t=this.vertexArr,r=this.indexArr;this.oldVertexArr=this.vertexArr.slice(),this.oldIndexArr=this.indexArr.slice();var i=[],n=[],o=[],a=[];this.edgeMap=[],this.midMap=[],this.faceArr=[],this.edgeArr=[];var s=(this.edgeArr,this.NOT_IN_LIST),u=void 0,l=void 0,c=void 0;this.computeFaces();for(var h=0;h<r.length;h+=3){var d=r[h+0],f=r[h+1],v=r[h+2];u=o[d]?i[o[d]]:t[d].clone(i),l=o[f]?i[o[f]]:t[f].clone(i),c=o[v]?i[o[v]]:t[v].clone(i);var m=i.indexOf(u);m===s&&(i.push(u),m=i.length-1,o[d]=m);var p=i.indexOf(l);p===s&&(i.push(l),p=i.length-1,o[f]=p);var g=i.indexOf(c);g===s&&(i.push(c),g=i.length-1,o[v]=g);var y=void 0,A=void 0,b=void 0,E=void 0,M=void 0,x=void 0;e&&(this.computeEven(u,t),this.computeEven(l,t),this.computeEven(c,t));var w=m+"-"+p,T=p+"-"+m;a[w]?E=a[w]:a[T]?E=midhash[T]:(y=this.computeCentroid(u,l),y.vertexArr=i,y.idx=i.length,e&&this.computeOdd(y,t,d+"-"+f,f+"-"+d),i.push(y),E=i.length-1,a[w]=E,a[T]=E),w=p+"-"+g,T=g+"-"+p,a[w]?M=a[w]:a[T]?M=midhash[T]:(A=this.computeCentroid(l,c),A.vertexArr=i,A.idx=i.length,e&&this.computeOdd(A,t,f+"-"+v,v+"-"+f),i.push(A),M=i.length-1,a[w]=M,a[T]=M),w=g+"-"+m,T=m+"-"+g,a[w]?x=a[w]:a[T]?x=midhash[T]:(b=this.computeCentroid(c,u),b.vertexArr=i,b.idx=i.length,e&&this.computeOdd(b,t,v+"-"+d,d+"-"+v),i.push(b),x=i.length-1,a[w]=x,a[T]=x),n.push(E,p,M,M,x,E,x,M,g,x,m,E)}return this.iterations++,this.vertexArr=i,this.indexArr=n,this.vertexToGeometry(),console.log("Mesh::subdivde(): "+this.prim.name+" subdivided from "+this.oldVertexArr.length+" to:"+this.vertexArr.length+" index length:"+this.indexArr.length),this}},{key:"simplify",value:function(){this.NOT_IN_LIST;console.log("Simplifying mesh... type:"+this.geo.type);var e=this.vertexArr,t=this.indexArr,r=[],i=[];this.oldIndexArr=t,this.oldVertexArr=e,this.vertexArr=r,this.indexArr=i,console.log("Mesh::simplify(): oldVertexArr:"+e.length+", newVertexArr simplified to:"+r.length),this.vertexToGeometry()}},{key:"geometryToVertex",value:function(e,t,r){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[];return this.indexArr=t.slice(),this.vertexArr=this.computeVertices(e,r,i),this.isValid()}},{key:"vertexToGeometry",value:function(){var e=this.prim,t=this.geo;console.log("Mesh::vertexToGeometry()");var r=this.vertexArr,i=r.length,n=(this.indexArr,this.indexArr.slice());t.vertices.data=new Array(3*r.length),t.texCoords.data=new Array(2*r.length);for(var o=t.vertices.data,a=t.texCoords.data,s=0;s<i;s++){var u=3*s,l=2*s,c=r[s];if(!c){console.warn("Mesh::vertexToGeometry(): no vertex in vertexArr at pos:"+s),o=o.slice(s);break}var h=c.coords,d=c.texCoords;o[u]=h.x,o[u+1]=h.y,o[u+2]=h.z,a[l]=d.u,a[l+1]=d.v}console.log("Mesh::vertexToGeometry(): vertices:"+o.length/3+" indices:"+n.length+" texCoords:"+a.length/2),t.setVertices(o),t.setIndices(n),t.setTexCoords(a),e.updateNormals(),e.updateTangents(),e.updateColors()}},{key:"isValid",value:function(){var e=this.vertexArr;if(!(e.length>0))return console.error("Mesh::isValid(): vertex array empty, vertex:"+e.length),!1;var t=this.indexArr;if(!(t.length>0))return console.error("Mesh::isValid(): index array empty, vertex:"+e.length+" index:"+t.length),!1;if(!(e.length>0))return console.error("Mesh::isValid(): no vertex and/or index array defined"),!1;for(var r=0;r<e.length;r++)if(!e[r].isValid())return console.warn("Mesh::isValid(): invalid supplied vertex at:"+r),
!1;return!0}}]),e}();t.default=u},function(e,t,r){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var s=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),u=r(7),l=i(u),c=r(3),h=i(c),d=r(1),f=i(d),v=r(6),m=(i(v),r(9)),p=(i(m),r(4)),g=(i(p),r(5)),y=(i(g),r(13)),A=i(y),b=function(e){function t(e,r){n(this,t);var i=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,r.webgl.util));return i.world=r,i.util=r.util,i.webgl=r.webgl,i.vr=r.vr,i.glMatrix=r.glMatrix,i.texturePool=r.texturePool,i.modelPool=r.modelPool,i.geometryPool=r.geometryPool,i.materialPool=r.materialPool,i.util.emitter.on(i.util.emitter.events.OBJ_GEOMETRY_READY,function(e,t,r){var n=i.modelPool.keyList[t];e.objects=n.options.objects,e.groups=n.options.groups,e.smoothingGroups=n.options.smoothingGroups,e.matStarts=n.options.matStarts,i.initPrimGeometry(e,n,r),e.shader.addPrim(e)}),i.util.emitter.on(i.util.emitter.events.HYG_GEOMETRY_READY,function(e,t,r){console.log("PrimFactory::HYG_GEOMETRY_READY event");var n=i.modelPool.keyList[t];if(e.objects=n.options.objects,e.matStarts=n.options.matStarts,i.initPrimGeometry(e,n,r),e.geolocate===!0){var o=i.world.geoData;o&&i.util.isNumber(o.latitude)&&i.util.isNumber(o.longitude)&&(console.log("PrimFactory::HYG_GEOMETRY_READY event, world.geoData:"+o),i.world.computeSkyRotation(e,o))}e.shader.addPrim(e)}),i.util.emitter.on(i.util.emitter.events.HEIGHTMAP_GEOMETRY_READY,function(e,t,r){console.log("PrimFactory::HEIGHTMAP_GEOMETRY_READY event, key:"+t);for(var n=i.modelPool.keyList[t],o=n.options.map,a=e.geometry,s=a.vertices.data,u=(o.w/e.divisions[0],o.d/e.divisions[2],o.pixels),l=0;l<u.length;l++)s[3*l+1]=(u[l]-o.minHeight)/128;e.geometry.setVertices(s),e.geometry.setNormals(i.geometryPool.computeNormals(s,a.indices.data,a.normals.data))}),i.util.emitter.on(i.util.emitter.events.PROCEDURAL_GEOMETRY_READY,function(e,t,r){var n=i.modelPool.keyList[t];e.matStarts=[[i.materialPool.createDefaultName(e.name),0,n.indices.length]],i.initPrimGeometry(e,n,r),e.shader.addPrim(e)}),i.util.emitter.on(i.util.emitter.events.MATERIAL_READY,function(e,t,r){i.initPrimMaterial(e,i.materialPool.keyList[t],r),e.shader.addPrim(e)}),i.util.emitter.on(i.util.emitter.events.TEXTURE_2D_READY,function(e,t,r){i.initPrimTexture(e,i.texturePool.keyList[t],r),e.shader.addPrim(e)}),i.util.emitter.on(i.util.emitter.events.TEXTURE_3D_READY,function(e,t,r){i.initPrimTexture3d(e,i.texturePool.keyList[t],r),e.shader.addPrim(e)}),i.util.emitter.on(i.util.emitter.events.TEXTURE_CUBE_MAP_READY,function(e,t,r){i.initPrimTextureCubeMap(e,i.texturePool.keyList[t],r),e.shader.addPrim(e)}),i.util.emitter.on(i.util.emitter.events.PRIM_ADDED_TO_SHADER,function(e){var t=0;for(var r in e.materials){var n=e.materials[r];if(n.name.indexOf(i.util.defaultKey)!==i.util.NOT_IN_LIST&&Number.isFinite(n.transparency)){var o=1-n.transparency;o>t&&(t=o)}}t>0&&(e.alpha=t),e.setFade(0,e.alpha,.001,"easeQuad"),e.failCount=0}),i.util.emitter.on(i.util.emitter.events.PRIM_REMOVED_FROM_SHADER,function(e){}),i}return a(t,e),s(t,[{key:"getPrimData",value:function(){var e=[];for(var t in this.keyList){var r=this.keyList[t];e.push({name:r.name,shader:r.shader.name,key:r.key})}return e}},{key:"deletePrim",value:function(e){var t=null;if(e&&e.key)if(t=this.getAsset(e.key),t===e){t===this.removeAsset(e.key)||console.error("PrimFactory::deletePrim(): Prim:"+t.name+" not removed from PrimFactory"),t.shader.removePrim(t),t.defaultShader.removePrim(t);for(var r=this.world.getShaders(),i=0;i<r.length;i++)r[i].removePrim(t)&&console.error("....PrimFactory::deletePrim(): prim:"+t.name+" found in unexpected Shader:"+r[i].name)}else console.warn(".....PrimFactory::deletePrim(): prim:"+t.name+" not found in PrimFactory");else console.warn("....PrimFactory::deletePrim(): invalid prim passed");return t}},{key:"setActivePrims",value:function(e){var t=null;for(var r in this.keyList)t=this.keyList[r],t.shader.removePrim(t,!1);console.log("PrimFactory::setActivePrims(): adding back active world prims to their Shaders");for(var i in e)switch(i){case"scene":case"path":case"key":break;default:t=e[i],console.log("PrimFactory::setActivePrims(): prim is:"+t),t.alpha=1,t.shader.addPrim(t,!0)}}},{key:"initPrimTexture",value:function(e,t,r){var i=e.materials[r.materialName];i?console.log("PrimFactory::initPrimTexture(): adding texture "+r.type+" to material:"+r.materialName):r.materialKey?(console.log("PrimFactory::initPrimTexture(): using material "+r.materialName+" supplied in options"),i=this.materialPool.getAssetByKey(r.materialKey),e.materials[r.materialName]=i):(console.log("PrimFactory::initPrimTexture(): no material for prim:"+e.name+", creating placeholder for material:"+r.materialName+" using it..."),i=this.materialPool.default(r.materialName),e.materials[r.materialName]=i),i[r.type]=t.texture,i[r.type+"_path"]=t.path,i[r.type+"_key"]=t.key,i[r.type+"_options"]=r[r.type+"_options"]}},{key:"initPrimTexture3d",value:function(e,t,r){console.log("Prim::initPrimTexture(): new 3D texture for prim:"+e.name+", options:"+r)}},{key:"initPrimTextureCubeMap",value:function(e,t,r){console.log("Prim::initPrimTexture(): new CubeMap texture for prim:"+e.name+", options:"+r)}},{key:"initPrimMaterial",value:function(e,t,r){console.log("Prim::initMaterial(): new material:"+t.name+" for prim:"+e.name+" key:"+t.key);var i=e.materials[t.name];i&&i.name===r.materialName?(console.log("Prim::initMaterial(): found existing material:"+t.name+" for prim:"+e.name),this.materialPool.mergeTo(i,t)):(console.log("Prim::initMaterial(): adding new material:"+t.name+" for prim:"+e.name),e.materials[t.name]=t)}},{key:"initPrimGeometry",value:function(e,t,r){e.updateVertices(t.vertices),e.computeBoundingBox(e.geometry.vertices.data);var i=e.dimensions[0]/e.boundingBox.dimensions[0];i=Math.max(i,e.dimensions[1]/e.boundingBox.dimensions[1]),i=Math.max(e.dimensions[2]/e.boundingBox.dimensions[2]),e.scale=[i,i,i],e.updateIndices(t.indices),e.updateNormals(t.normals),e.updateTexCoords(t.texCoords),e.updateTangents(),e.updateColors(t.colors);new l.default(e)}},{key:"computePrim",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"unknown",i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[1,1,1,0,0],n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:[1,1,1,0,0],o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:this.glMatrix.vec3.create(),a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:this.glMatrix.vec3.create(),s=arguments.length>7&&void 0!==arguments[7]?arguments[7]:this.glMatrix.vec3.create(),u=arguments.length>8&&void 0!==arguments[8]?arguments[8]:this.glMatrix.vec3.create(),l=arguments.length>9&&void 0!==arguments[9]?arguments[9]:[],c=arguments.length>10&&void 0!==arguments[10]?arguments[10]:[],d=arguments.length>11&&void 0!==arguments[11]&&arguments[11],f=arguments.length>12&&void 0!==arguments[12]&&arguments[12],v=!(arguments.length>13&&void 0!==arguments[13])||arguments[13],m=(arguments.length>14&&void 0!==arguments[14]&&arguments[14],this),p=arguments.length>15&&void 0!==arguments[15]&&arguments[15],g=arguments.length>16&&void 0!==arguments[16]&&arguments[16],y=this.glMatrix.vec3,b=this.glMatrix.mat4;if(!this.geometryPool.checkType(t))return console.error("Prim::computePrim(): unsupported Prim type:"+t+"for:"+E.name),null;if(c&&0===c.length&&t===this.geometryPool.typeList.MESH)return console.error("PrimFactory::computePrim(): type MESH does not have an defining file for Prim:"+E.name),null;var E={},M=E;E.setMV=function(e){return b.translate(e,e,M.position),E.setM(e),e},E.setM=function(e){return b.rotate(e,e,M.rotation[0],[1,0,0]),b.rotate(e,e,M.rotation[1],[0,1,0]),b.rotate(e,e,M.rotation[2],[0,0,1]),b.scale(e,e,M.scale),e},E.updateCoords=function(){y.add(M.position,M.position,M.acceleration),y.add(M.rotation,M.rotation,M.angular)},E.setLight=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[1,1,1],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[255,255,255];M.light.direction=e,M.light.color=t},E.setMaterial=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:m.util.DEFAULT_KEY,t=arguments[1],r=arguments[2],i=arguments[3],n=arguments[4],o=arguments[5],a=arguments[6],s=arguments[7],u=arguments[8],l=arguments[9];return console.log("Prim::setMaterial(): to name:"+e),m.initPrimMaterial(E,m.materialPool.default(e,t,r,i,n,o,a,s,u,l),e)},E.updateVertices=function(e){var t=M.geometry;e&&e.length>0&&t.setVertices(e)},E.updateIndices=function(e){var t=M.geometry;e&&e.length>0&&t.setIndices(e)},E.updateNormals=function(e){var t=M.geometry;e&&e.length>0?t.setNormals(e):(console.log("Prim::updateNormals():"+M.name+" recalculating normal coordinates"),t.setNormals(m.geometryPool.computeNormals(t.vertices.data,t.indices.data,[],M.useFaceNormals)))},E.updateTexCoords=function(e){var t=M.geometry;e&&e.length>0?t.setTexCoords(e):t.numTexCoords()!==t.numVertices()&&(console.log("Prim::updateTexCoords():"+M.name+" recalculating texture coordinates"),t.setTexCoords(m.geometryPool.computeTexCoords(t.vertices.data,e)))},E.updateTangents=function(e){var t=M.geometry;e&&e.length>0?t.setTangents(e):t.setTangents(m.geometryPool.computeTangents(t.vertices.data,t.indices.data,t.normals.data,t.texCoords.data,[]))},E.updateColors=function(e){var t=M.geometry;e&&e.length>0?t.setColors(e):t.setColors(m.geometryPool.computeColors(t.normals.data,[]))},E.computeBoundingBox=function(){E.boundingBox=m.geometryPool.computeBoundingBox(E.geometry.vertices.data)},E.computeBoundingSphere=function(){m.geometryPool.computeBoundingSphere(E.geometry.vertices.data)},E.copyGometry=function(e,t,r){var i=m.util.copyArr(E.geometry.vertices.data),n=m.util.copyArr(E.geometry.indices.data),o=m.util.copyArr(E.geometry.texCoords.data),a=m.util.copyArr(E.geometry.normals.data),s=m.util.copyArr(E.geometry.tangents.data),u=m.util.copyArr(E.geometry.tangents.data);if(m.geometryPool.scale(newVertices,e),m.geometryPool.computeMove(newVertices,t),r){r.vertices=m.util.concatArr(r.vertices,i);for(var l=0;l<n.length;l++)n[l]+=r.vertices.length;r.indices=m.util.contactArr(r.indices,n),r.texCoords=m.util.concatArr(r.texCoords,o),r.normals=m.util.concatArr(r.normals,a),r.tangents=m.util.concatArr(r.tangents,s),r.colors=m.util.concatArr(r.colors,u)}else r=m.geometryPool.default(i,n,o,a,s,u);return r},E.resize=function(e){m.geometryPool.computeScale(E.geometry.vertices.data,e)},E.move=function(e){m.geometryPool.computeMove(E.geometry.vertices.data,e)},E.moveTo=function(e){m.geometryPool.computeMove([m.position[0]-e[0],m.position[1]-e[1],m.position[2]-e[2]])},E.setFade=function(e,t,r,i){E.fade.startAlpha=e,E.fade.endAlpha=t;var n=E.materials[E.matStarts[0][0]];E.alpha=e,Number.isFinite(r)&&(E.fade.incr=r),i?t>e?E.fade.eq=m.util[i+"In"]:E.fade.eq=m.util[i+"Out"]:E.fade.eq=m.util.easeLinearIn,console.log("PRIM NAME:"+E.name+" defaultMaterial transparency:"+n.transparency),E.shader!==m.world.s0&&(E.defaultShader=E.shader,E.shader.movePrim(E,m.world.s0))},E.name=r,E.defaultShader=e,E.shader=this.world.s0,E.rendering=!1,E.type=t,E.key=this.util.computeId(),E.dimensions=i||this.vec5(1,1,1,0,0,0,0),E.divisions=n||this.vec5(1,1,1,0,0,0),E.position=o||y.create(),E.acceleration=a||y.create(),E.rotation=s||y.create(),E.angular=u||y.create(),E.orbitRadius=0,E.orbitAngular=0,E.scale=[1,1,1],E.visibleFrom=this.geometryPool.OUTSIDE,E.useColorArray=d,E.drawTris=!0,E.drawPoints=!1,E.pointSize=2,E.drawLines=!1,E.applyTexToFace=f,E.useFaceNormals=!1,E.useTangents=!1,E.pSystem=p,E.animSystem=g,E.geolocate=!1,E.materials=[];var x=this.materialPool.createDefaultName(E.name);if(E.materials[x]=this.materialPool.setDefaultMaterial(E,this.materialPool.createDefaultName(E.name),l),E.alpha=1-E.materials[x].transparency,E.useLighting=v,E.glow=new h.default(this.glMatrix),E.fade={startAlpha:0,endAlpha:E.alpha,incr:.002},E.audio=[],E.video=[],E.parentNode=null,E.children=[],console.log("PrimFactory::computePrim(): Generating:"+E.name+"("+E.type+")"),E.geometry=new A.default(E.name,this.util,this.webgl),c.length>0){E.type===this.geometryPool.typeList.TERRAIN&&this.geometryPool.getGeometry(E,null,!0,{pos:0,defaultMatStarts:!0});for(var w=0;w<c.length;w++)this.geometryPool.getGeometry(E,c[w],!0,{pos:w,defaultMatStarts:!1})}else this.geometryPool.getGeometry(E,null,!0,{pos:0,defaultMatStarts:!0});return E.failCount=0,this.addAsset(E),E}},{key:"createParticleSystem",value:function(e){e.pSystem||console.error("PrimFactory::createParticleSystem(): no particle system defined");var t=e.pSystem;if(t.coords)for(var r=this.geometryPool.default(),i=1;i<t.coords.length;i++)r=e.copyGeometry(t.coords.scale[i],t.coords.pos[i],r);var n={};this.initPrimGeometry(e,geo,n)}},{key:"createAnimationSystem",value:function(e){e.animSystem||console.error("PrimFactory::createAnimationSystem(): no animation system defined")}}]),t}(f.default);t.default=b},function(e,t,r){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var s=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),u=r(1),l=i(u),c=function(e){function t(e,r,i){n(this,t),console.log("in TexturePool");var a=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,r));if(a.util=r,a.webgl=i,a.textureMimeTypes={png:"image/png",jpg:"image/jpeg",jpeg:"image/jpeg",gif:"image/gif"},a.greyPixel=new Uint8Array([128,128,128,255]),a.transparentPixel=new Uint8Array([0,0,0,0]),e){var s=i.getContext();a.defaultKey=a.addAsset(a.default(null,null,s.TEXTURE_2D,null,a.create2dTexture(),null)).key,a.transparentKey=a.addAsset(a.default(null,null,s.TEXTURE_2D,null,a.create2dTexture(),null)).key}return a}return a(t,e),s(t,[{key:"default",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null;return{image:e,mimeType:t,type:r,path:i,texture:n,emits:o}}},{key:"create2dTexture",value:function(e,t){var r=this.webgl.getContext(),i=r.createTexture();if(r.pixelStorei(r.UNPACK_FLIP_Y_WEBGL,!0),r.bindTexture(r.TEXTURE_2D,i),e instanceof HTMLImageElement)r.texImage2D(r.TEXTURE_2D,0,r.RGBA,r.RGBA,r.UNSIGNED_BYTE,e);else if(e instanceof Uint8Array&&e.length){var n=Math.sqrt(e.length/4);n%1===0&&r.texImage2D(r.TEXTURE_2D,0,r.RGBA,n,n,0,r.RGBA,r.UNSIGNED_BYTE,e)}else console.warn("TexturePool::create2DTexture(): no image ("+e+"), using default pixel texture"),e={width:1,height:1},r.texImage2D(r.TEXTURE_2D,0,r.RGBA,1,1,0,r.RGBA,r.UNSIGNED_BYTE,this.greyPixel);return this.webgl.version>1||this.util.isPowerOfTwo(e.width)&&this.util.isPowerOfTwo(e.height)?(r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,r.LINEAR),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,r.LINEAR_MIPMAP_NEAREST),r.generateMipmap(r.TEXTURE_2D)):(r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,r.LINEAR),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,r.LINEAR)),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,r.CLAMP_TO_EDGE),r.bindTexture(r.TEXTURE_2D,null),i}},{key:"create3dTexture",value:function(e,t,r){console.log("creating 3D texture");var i=this.webgl.getContext(),n=i.createTexture();return i.pixelStorei(i.UNPACK_FLIP_Y_WEBGL,!0),i.bindTexture(i.TEXTURE_3D,n),image?(i.texParameteri(i.TEXTURE_3D,i.TEXTURE_BASE_LEVEL,0),i.texParameteri(i.TEXTURE_3D,i.TEXTURE_MAX_LEVEL,Math.log2(r)),i.texParameteri(i.TEXTURE_3D,i.TEXTURE_MIN_FILTER,i.LINEAR_MIPMAP_LINEAR),i.texParameteri(i.TEXTURE_3D,i.TEXTURE_MAG_FILTER,i.LINEAR),i.texImage3D(i.TEXTURE_3D,0,i.R8,e.width,e.height,e.depth,0,i.RED,i.UNSIGNED_BYTE,e)):console.error("TexturePool::create2DTexture(): no data ("+e+"), for 3d, giving up"),i.generateMipmap(i.TEXTURE_3D),i.bindTexture(i.TEXTURE_3D,null),n}},{key:"createCubeMapTexture",value:function(e,t){console.log("creating cubemap texture");var r=this.webgl.getContext(),i=r.createTexture();return r.pixelStorei(r.UNPACK_FLIP_Y_WEBGL,!0),r.bindTexture(r.TEXTURE_CUBE_MAP,i),e?(r.bindTexture(r.TEXTURE_CUBE_MAP,i),r.texParameteri(r.TEXTURE_CUBE_MAP,r.TEXTURE_WRAP_S,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_CUBE_MAP,r.TEXTURE_WRAP_T,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_CUBE_MAP,r.TEXTURE_MIN_FILTER,r.NEAREST),r.texParameteri(r.TEXTURE_CUBE_MAP,r.TEXTURE_MAG_FILTER,r.NEAREST),r.texImage2D(r.TEXTURE_CUBE_MAP_POSITIVE_X,0,format,format,type,e.pos.x),r.texImage2D(r.TEXTURE_CUBE_MAP_POSITIVE_Y,0,format,format,type,e.pos.y),r.texImage2D(r.TEXTURE_CUBE_MAP_POSITIVE_Z,0,format,format,type,e.pos.z),r.texImage2D(r.TEXTURE_CUBE_MAP_NEGATIVE_X,0,format,format,type,e.neg.x),r.texImage2D(r.TEXTURE_CUBE_MAP_NEGATIVE_Y,0,format,format,type,e.neg.y),r.texImage2D(r.TEXTURE_CUBE_MAP_NEGATIVE_Z,0,format,format,type,e.neg.z)):console.error("TextureObj::create2DTexture(): no data ("+e+"), for cubemap, giving up"),r.bindTexture(r.TEXTURE_CUBE_MAP,null),i}},{key:"addTexture",value:function(e,t,r,i,n){var o=this.webgl.getContext();n||(n=o.TEXTURE_2D);var a=null,s="";switch(n){case o.TEXTURE_2D:a=this.create2dTexture(t),s=this.util.emitter.events.TEXTURE_2D_READY;break;case o.TEXTURE_3D:a=this.create3dTexture(t),s=this.util.emitter.events.TEXTURE_3D_READY;break;case o.TEXTURE_CUBE_MAP:a=this.createCubeMapTexture(t),s=this.util.emitter.events.TEXTURE_CUBE_MAP_MEMBER_READY;break;default:console.warn("TexturePool::addTexture() for prim:"+e.name+" unsupported texture requested")}return a?this.addAsset(this.default(t,i,n,r,a,s)):(console.warn("TexturePool::addTexture(): no texture returned by createXXTexture() function"),null)}},{key:"getTexture",value:function(e,t){var r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],i=arguments.length>3&&void 0!==arguments[3]&&arguments[3],n=this,o=arguments[4],a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:{pos:0};o||(o=this.webgl.gl.TEXTURE_2D);var s=this.pathInList(t);if(null!==s)return console.log("TexturePool::getTexture(): found texture "+t+" in pool, using it..."),void this.util.emitter.emit(this.util.emitter.events.TEXTURE_2D_READY,e,s.key,a);if(this.util.isWhitespace(t))console.warn("TexturePool::getTexture(): empty path supplied for prim "+e.name);else{var u=this.textureMimeTypes[this.util.getFileExtension(t)];u?this.doRequest(t,a.pos,function(r){var s=new Image;s.onload=function(){a.fromObj&&console.warn("TexturePool::getTexture(): adding OBJ texture:"+t+" to "+e.name);var l=n.addTexture(e,s,r.path,u,o);l?(i||(window.URL.revokeObjectURL(s.src),l.image=null),n.util.emitter.emit(l.emits,e,l.key,a)):(console.error("TexturePool::getTexture(): file:"+t+" could not be parsed"),n.util.emitter.emit(n.util.emitter.events.TEXTURE_2D_READY,e,n.defaultKey,a))},r.data?s.src=window.URL.createObjectURL(r.data):(n.util.emitter.emit(n.util.emitter.events.TEXTURE_2D_READY,e,n.defaultKey,a),console.error("TexturePool::getTexture(): invalid image data for prim:"+e.name+"path:"+r.path+" data:"+r.data))},r,u,0):(console.error('TexturePool::getTexture(): file type "'+this.util.getFileExtension(t)+'" in:'+t+" not supported, not loading"),this.util.emitter.emit(this.util.emitter.events.TEXTURE_2D_READY,e,this.defaultKey,a))}}}]),t}(l.default);t.default=c},function(e,t,r){(function(e){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.world=t.webvr=t.webgl=t.util=void 0;var n=r(24),o=i(n),a=r(12),s=i(a),u=r(25),l=i(u),c=r(26),h=i(c),d=r(23),f=i(d),v=r(16),m=i(v),p=r(21),g=i(p),y=r(15),A=i(y),b=r(20),E=i(b),M=r(19),x=i(M),w=r(22),T=i(w),P=r(17),D=i(P),R=r(3),C=i(R),S=r(18),O=i(S),I=r(8),k=(i(I),r(27)),_=i(k);console.log("in es6");var L=(e.env.WEBPACK_ENV,r(28));L?console.log("loaded gl-matrix"):console.error("gl-matrix could'nt be loaded...");var N=new o.default,F=null;console.log("app.es6: in development mode");var B=r(30);t.webgl=F=new l.default(!1,L,N,B),B?console.log("Loading webgl-debug"):console.log("Error loading webgl-debug");var V=void 0,U=void 0,G=void 0,W=void 0,j=void 0,Y=void 0;new Promise(function(e,r){F.init("webvr-mini-canvas")?(t.webvr=V=new h.default(!0,N,L,F),U=new s.default(!0,N),G=new f.default(!1,N,F,V),j=new C.default(L),W=new O.default(!0,N,L,F),W.addAsset(new m.default(!0,N,L,F,V,"shaderFader",j)),W.addAsset(new g.default(!0,N,L,F,V,"shaderTexture",j)),W.addAsset(new A.default(!0,N,L,F,V,"shaderColor",j)),W.addAsset(new E.default(!0,N,L,F,V,"shaderTerrain",j)),W.addAsset(new x.default(!0,N,L,F,V,"shaderSky",j)),W.addAsset(new T.default(!0,N,L,F,V,"shaderWater",j)),W.addAsset(new D.default(!0,N,L,F,V,"shaderMetal",j)),t.world=Y=new _.default(!0,L,F,V,U,W,j,G),G.init(),e("Stuff worked!")):(r(Error("It broke")),G=new f.default(!1,N,F,V),G.initBadGL())}).then(function(e){Y.init()});window.world=Y,t.util=N,t.webgl=F,t.webvr=V,t.world=Y}).call(t,r(29))},function(e,t){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),n=function(){function e(){r(this,e),this.callbacks={},this.events={WORLD_DEFINITION_READY:"wrddefrdy",WORLD_GEOLOCATION_READY:"wrdgeordy",PROCEDURAL_GEOMETRY_READY:"plgrdy",OBJ_GEOMETRY_READY:"ogrdy",HYG_GEOMETRY_READY:"hygrdy",HEIGHTMAP_GEOMETRY_READY:"hmgrdy",GLTF_GEOMETRY_READY:"gltfrdy",MATERIAL_READY:"mrdy",TEXTURE_2D_READY:"trdy",TEXTURE_3D_READY:"t3drdy",TEXTURE_CUBEMAP_MEMBER_READY:"trcmpmbrdy",TEXTURE_CUBEMAP_READY:"tcmprdy",PRIM_ADDED_TO_SHADER:"prash",PRIM_REMOVED_FROM_SHADER:"prmsh",PRIM_FAIL:"prmfl",VR_DISPLAY_READY:"vrdispready",VR_DISPLAY_CHANGE:"virdispchange",VR_DISPLAY_FAIL:"vrdispfail",VR_DISPLAY_EXIT:"vrdispexit"}}return i(e,[{key:"emit",value:function(e){var t=this.callbacks[e];if(t){var r=[].slice.call(arguments);r.shift();for(var i=0;i<t.length;i++)t[i].apply(this,r)}}},{key:"on",value:function(e,t){e in this.callbacks?this.callbacks[e].push(t):this.callbacks[e]=[t]}}]),e}();t.default=n},function(e,t){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),n=function(){function e(t,i,n,o){r(this,e),console.log("in gamepad constructor"),this.util=i,this.stats={},t===!0&&this.init()}return i(e,[{key:"setWorld",value:function(e){this.world=e}},{key:"init",value:function(){var e=this;this.getGamepads(),window.addEventListener("gamepadconnected",function(t){e.gpad=navigator.getGamepads()[t.gamepad.index],console.log("found gamepad: "+e.gpad.id),e.getGamepads}),window.addEventListener("gamepaddisconnected",function(e){console.log("gamepad disconnected")})}},{key:"getGamepadByHMDId",value:function(e){this.gamepads.length||this.getGamepads();for(var t=0;t<this.gamepads.length;t++){var r=this.gamepads[t];if(r&&r.displayId===e)return r}}},{key:"getGamepads",value:function(){var e=navigator.getGamepads();this.gamepads=[],console.log("GamePad::():getGamePads():"+e.length+" controllers"),this.stats.numGamepads=e.length;for(var t=0;t<e.length;t++){var r=e[t];r&&(this.gamepads[t]=r)}}},{key:"hasGamepads",value:function(){return!!("getGamepads"in navigator)}},{key:"reportGamePad",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this.util.isNumber(gamePad)&&(e=this.gamepads[e]||null),e?{id:gp.displayIndex,gamepad:gp.index,hand:gp.hand,actuators:gp.hapticActuators.length,pose:!(!gp.pose||!gp.pose.hasPosition),orientation:!(!gp.pose||!gp.pose.hasOrientation)}:null}}]),e}();t.default=n},function(e,t){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),n=function(){function e(t,i,n,o){r(this,e),this.primName=t,this.webgl=n,this.util=i,this.FLOAT32="float32",this.UINT="uint",this.UINT32="uint32",this.UINT16="uint16",this.makeBuffers=!0,this.vertices={data:[],buffer:null,itemSize:3,numItems:0},this.indices={data:[],buffer:null,itemSize:1,numItems:0},this.sides={data:[],buffer:null,itemSize:3,numItems:0},this.normals={data:[],buffer:null,itemSize:3,numItems:0},this.tangents={data:[],buffer:null,itemSize:4,numItems:0},this.texCoords={data:[],buffer:null,itemSize:2,numItems:0},this.colors={data:[],buffer:null,itemSize:4,numItems:0},this.pointSizes={data:[],buffer:null,itemSize:1,numItems:0},this.valid=!1,this.MAX_DRAWELEMENTS=this.webgl.MAX_DRAWELEMENTS,this.mName=this.primName+" GeometryBuffer::"}return i(e,[{key:"splitBuffers",value:function(){}},{key:"confirmNumericalData",value:function(e,t,r){for(var i=e.length,n=0;n<i;n++){var o=e[n];switch(t){case this.FLOAT32:if(!Number.isFinite(parseFloat(o)))return console.error(this.mName+"confirmNumericalData(): invalid float32 in "+r+" at pos:"+n+" = "+o),!1;break;case this.UINT16:case this.UINT32:case this.UINT:if(!Number.isFinite(parseInt(o)))return console.error(this.mName+"confirmNumericalData(): invalid Uint in "+r+" at pos:"+n+" = "+o),!1;break;default:return console.error(this.mName+" confirmNumericalData(): unknown data type "+t+" for:"+r),!1}}return!0}},{key:"checkVertexData",value:function(e){var t=this.mName+" checkVertexData():",r=this.vertices.data.length,i=this.numVertices();return r<this.vertices.itemSize||0!==this.util.frac(i)?(console.error(t+" invalid vertex size, "+i),!1):r>this.MAX_DRAWELEMENTS?(console.error(t+" vertex size exceeds 64k on hardware not supporting it"),!1):!(e&&!this.confirmNumericalData(this.vertices.data,this.FLOAT32,"vertices"))&&i}},{key:"checkIndexData",value:function(e){var t=this.mName+" checkIndexData():",r=this.numIndices(),i=this.numVertices();if(r<this.indices.itemSize)return console.error(t+" invalid index size, "+r),!1;if(e){if(!this.confirmNumericalData(this.indices.data,this.UINT,"indices"))return!1;for(var n=this.indices.data,o=0;o<r;o++){var a=n[o];if(a<0||a>i)return console.error(t+" index at "+o+" points to invalid postion in vertices "+a+", max:"+i),!1}}return r}},{key:"checkFacesData",value:function(e){var t=this.numFaces();return t?t:(console.error(fnName+" number of sides (triangles) is invalid"),!1)}},{key:"checkNormalsData",value:function(e){var t=this.mName+" checkNormalsData():",r=this.numVertices(),i=this.numNormals();return i<this.normals.itemSize||0!==this.util.frac(i)?(console.error(t+" invalid normals size, "+i),!1):i!==r?(console.error(t+" normals length: "+this.numNormals()+" does not match vertices length: "+this.numVertices()),!1):!(e&&!this.confirmNumericalData(this.normals.data,this.FLOAT32,"normals"))&&i}},{key:"checkTexCoordsData",value:function(e,t){var r=this.mName+" checkTexCoordsData():",i=this.numVertices(),n=t||this.texCoords,o=this.numTexCoords(n);if(o>0){if(o<n.itemSize||0!==this.util.frac(o))return console.error(r+" invalid texCoords size, "+n.data.length),!1;if(o!==i)return console.error(r+" texCoords length: "+this.numTexCoords(n)+" does not match vertices length: "+this.numVertices()),!1}else console.warn(r+" no texCoords data defined.");return!(e&&!this.confirmNumericalData(n.data,this.FLOAT32,"texCoords"))&&o}},{key:"checkTangentsData",value:function(e){var t=this.mName+" checkTangentsData():",r=this.numVertices(),i=this.numTangents();if(i>0){if(i<this.tangents.itemSize||0!==this.util.frac(i))return console.error(t+" invalid tangents size, "+i),!1;if(i!==r)return console.error(t+" tangents length "+this.numTangents()+" does not match vertices length: "+this.numVertices()),!1}else console.warn(t+" no tangents data defined.");return!(e&&!this.confirmNumericalData(this.tangents.data,this.FLOAT32,"tangents"))&&i}},{key:"checkColorsData",value:function(e){var t=this.mName+" checkColorsData():",r=this.numVertices(),i=this.numColors();if(i>0){if(i<this.colors.itemSize||0!==this.util.frac(i))return console.error(t+" invalid colors size, "+this.colors.data.length),!1;if(i!==r)return console.error(t+" colors length: "+this.numColors()+" does not match vertices length:"+this.numVertices()),!1}else console.warn(t+" no colors data defined.");return!(e&&!this.confirmNumericalData(this.colors.data,this.FLOAT32,"colors"))&&i}},{key:"checkBufferData",value:function(e){this.valid=!0,this.vertices.data.length,this.mName+" checkBufferData():";return!!(this.checkVertexData(!0)&&this.checkIndexData(!0)&&this.checkNormalsData(!0)&&this.checkTexCoordsData(!0)&&this.checkTangentsData(!0)&&this.checkColorsData(!0))||(console.warn(this.mName+"checkBufferData() buffers not ok"),!1)}},{key:"numVertices",value:function(){return this.vertices.data.length/this.vertices.itemSize}},{key:"numIndices",value:function(){return this.indices.data.length}},{key:"numNormals",value:function(){return this.normals.data.length/this.normals.itemSize}},{key:"numTexCoords",value:function(e){var t=e||this.texCoords;return t.data.length/t.itemSize}},{key:"numTangents",value:function(){return this.tangents.data.length/this.tangents.itemSize}},{key:"numColors",value:function(){return this.colors.data.length/this.colors.itemSize}},{key:"numFaces",value:function(){var e=this.indices.length/3;return this.util.frac(e/this.tangents.itemSize!==0)&&console.error(this.mName+"numFaces(): fractional number of faces"),e}},{key:"numSides",value:function(){return console.warn(this.mName+"numSides(): sides not implemented yet"),0}},{key:"numCoords",value:function(){return this.numVertices()+this.numIndices()+this.numNormals()+this.numTangents()+this.numColors()}},{key:"setVertices",value:function(e){var t=this.vertices;this.util.isArray(e)?(t.data=new Float32Array(e),t.numItems=e.length/t.itemSize,this.bindGLBuffer(t,this.FLOAT32)):console.warn(this.mName+"setVertices() invalid input, not Array, nothing set");
}},{key:"setIndices",value:function(e){var t=this.indices;this.util.isArray(e)?this.webgl.stats.uint32?(t.data=new Uint32Array(e),this.bindGLBuffer(t,this.UINT32)):(t.data=new Uint16Array(e),this.bindGLBuffer(t,this.UINT16)):console.warn(this.mName+"setIndices() invalid input, not Array, nothing set")}},{key:"setNormals",value:function(e){var t=this.normals;this.util.isArray(e)?(t.data=new Float32Array(e),t.numItems=e.length/t.itemSize,this.bindGLBuffer(t,this.FLOAT32)):console.error(this.mName+"setNormals() invalid input, not Array")}},{key:"setTexCoords",value:function(e){var t=this.texCoords;this.util.isArray(e)?(t.data=new Float32Array(e),t.numItems=e.length/t.itemSize,this.bindGLBuffer(t,this.FLOAT32)):console.error(this.mName+"setTexCoords() invalid input, not Array")}},{key:"setColors",value:function(e){var t=this.colors;this.util.isArray(e)?(t.data=new Float32Array(e),t.numItems=e.length/t.itemSize,this.bindGLBuffer(t,this.FLOAT32)):console.error(this.mName+"setTangents() invalid input, not Array")}},{key:"setTangents",value:function(e){var t=this.tangents;this.util.isArray(e)?(t.data=new Float32Array(e),t.numItems=e.length/t.itemSize,this.bindGLBuffer(t,this.FLOAT32)):console.error(this.mName+"setTangents() invalid input, not Array")}},{key:"setBufferData",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[],n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:[],o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:[];e.length>0&&(this.setVertices(e),console.log("numVertices is now:"+this.numVertices())),t.length>0&&(this.setIndices(t),console.log("numIndices is now:"+this.numIndices())),r.length>0&&(this.setNormals(r),console.log("numNormals is now:"+this.numNormals())),i.length>0&&(this.setTexCoords(i),console.log("numTexCoords is now:"+this.numTexCoords())),n.length>0&&(this.setTangents(n),console.log("numTangents is now:"+this.numTangents())),o.length>0&&(this.setColors(o),console.log("numColors is now:"+this.numColors())),this.vertices.data.length>this.webgl.MAX_DRAWELEMENTS?this.ssz=!0:this.ssz=!1}},{key:"addBufferData",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[],n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:[],o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:[],a=arguments[6],s=this.util.concatArr,u=this.numCoords();return this.vertices.data=s(this.vertices.data,e),this.indices.data=s(this.indices.data,t),this.normals.data=s(this.normals.data,r),this.texCoords.data=s(this.texCoords.data,i),this.tangents.data=s(this.tangents.data,n),this.colors.data=s(this.colors.data,o),this.vertices.data.length>this.webgl.MAX_DRAWELEMENTS?this.ssz=!0:this.ssz=!1,u!==this.numCoords()&&this.createGLBuffers(),!a||this.checkBufferData()}},{key:"clearData",value:function(e){e.data=[]}},{key:"clearBuffer",value:function(e){this.clearData(e),e.buffer=null,e.numItems=0}},{key:"clear",value:function(){this.clearBuffer(this.vertices),this.clearBuffer(this.indices),this.clearBuffer(this.normals),this.clearBuffer(this.texCoords),this.clearBuffer(this.colors)}},{key:"bindGLBuffer",value:function(e,t){var r=this.webgl.getContext();switch(e.buffer=r.createBuffer(),r.bindBuffer(r.ARRAY_BUFFER,e.buffer),t){case this.FLOAT32:e.data instanceof Float32Array?r.bufferData(r.ARRAY_BUFFER,e.data,r.STATIC_DRAW):r.bufferData(r.ARRAY_BUFFER,new Float32Array(e.data),r.STATIC_DRAW),e.numItems=e.data.length/e.itemSize;break;case this.UINT32:e.buffer=r.createBuffer(),r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,e.buffer),r.bufferData(r.ELEMENT_ARRAY_BUFFER,new Uint32Array(e.data),r.STATIC_DRAW),e.numItems=e.data.length/e.itemSize;break;case this.UINT16:e.buffer=r.createBuffer(),r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,e.buffer),r.bufferData(r.ELEMENT_ARRAY_BUFFER,new Uint16Array(e.data),r.STATIC_DRAW),e.numItems=e.data.length/e.itemSize;break;default:console.error(this.mName+"bindGLBuffer(): invalid WebGL buffer type "+t)}}},{key:"createGLBuffers",value:function(){var e=(this.webgl.getContext(),this.mName+"createGLBuffers():",this.vertices);return e.data.length||(e.data=new Float32Array),this.bindGLBuffer(e,this.FLOAT32),e=this.indices,this.webgl.stats.uint32?(e.data.length||(e.data=new Uint32Array),this.bindGLBuffer(e,this.UINT32)):(e.data.length||(e.data=new Uint16Array),this.bindGLBuffer(e,this.UINT16)),e=this.sides,e.data.length||(e.data=new Uint16Array),this.bindGLBuffer(e,this.UINT16),e=this.normals,e.data.length||(e.data=new Float32Array),this.bindGLBuffer(e,this.FLOAT32),e=this.texCoords,e.data.length||(e.data=new Float32Array),this.bindGLBuffer(e,this.FLOAT32),e=this.tangents,e.data.length||(e.data=new Float32Array),this.bindGLBuffer(e,this.FLOAT32),e=this.colors,(!e.data.length||e.data.length<4*this.vertices.length/3)&&(e.data=new Float32Array),this.bindGLBuffer(e,this.FLOAT32),this.makeBuffers=!1,this}}]),e}();t.default=n},function(e,t,r){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var s=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),u=r(1),l=i(u),c=function(e){function t(e,r,i,a){n(this,t),console.log("in MaterialPool");var s=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,r));return s.util=r,s.webgl=i,s.texturePool=a,s.materialMimeTypes={mtl:"text/plain"},s.texturePositions=["map_Kd","map_Ka","map_bump","map_Ks","map_Ns","map_refl","map_d","map_disp"],e&&(s.defaultKey=s.addAsset(s.default()).key),s}return a(t,e),s(t,[{key:"default",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.util.DEFAULT_KEY,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[1,1,1],r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[1,1,1],i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[1,1,1],n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:64,o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:[0,0,0],a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:60,s=arguments.length>7&&void 0!==arguments[7]?arguments[7]:1,u=arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,l=arguments.length>9&&void 0!==arguments[9]?arguments[9]:2,c=arguments.length>10&&void 0!==arguments[10]?arguments[10]:null;return c||(c=this.texturePool.getAssetByKey(this.texturePool.defaultKey).texture),{name:e,key:null,path:null,emissive:o,ambient:t,diffuse:r,specular:i,specularExponent:n,sharpness:a,refraction:s,transparency:u,illum:l,map_Kd:c,map_Ks:null,map_Ka:null,map_Ns:null,map_refl:null,map_d:null,map_bump:null,map_disp:null}}},{key:"mergeTo",value:function(e,t){for(var r in e)switch(console.log("MERGING:"+r),r){case name:case key:case path:case specularExponent:case sharpness:case refraction:case transparency:case illum:e[r]=t[r];break;case emissive:case ambient:case diffuse:case specular:e[r]=JSON.parse(JSON.stringify(t[r]));break;case map_Kd:case map_Ks:case map_Ka:case map_refl:case map_d:case map_bump:case map_disp:console.log("INPUT:"+t[r]+" RECEIVE:"+e[r]),t[r]instanceof WebGLTexture&&(console.log("MaterialPool::mergeTo(): replacing "+r+" with new texture"),e[r]=t[r]);break;default:console.error("MaterialPool::mergeTo(): unknown object member ("+r+")!")}}},{key:"computeTextureMapOptions",value:function(e){var t={};if(e.length<4)return t;for(var r=[],i=0;i<e.length-1;i++)r[i]=e[i];for(var n=r.join(" ").split("-"),o=0;o<n.length;o++){var a=n[o].split(" ");if(a.length>1){var s=a[0],u=a[1];switch(s){case"blenu":case"blenv":case"cc":case"clamp":"off"===u?t[s]=!1:t[s]=!0;break;case"bm":case"mm":Number.isFinite(parseFloat(u))&&(t[s]=parseFloat(u));break;case"boost":Number.isFinite(parseFloat(u))&&u>=0&&(t[s]=parseFloat(u));break;case"imfchan":case"texres":t[s]=u;break;case"o":case"s":case"t":var l=0;t[s]=[];for(var c=1;c<a.length;c++){var h=a[c];Number.isFinite(parseFloat(h))&&(t[s][l++]=parseFloat(h))}3!==t[s].length&&(console.warn("MaterialPool::computeTextureMapOptions(): in valid texture param for:"+s),t[s]=[0,0,0]);break;default:console.error("unknown texture map option: "+e)}}}return t}},{key:"computeObjMaterials",value:function(e,t,r){var i=this,n=0,o=[],a=null,s=this.util.getFilePath(r),u=e.split("\n");return u.forEach(function(e){e=e.trim();var r=e.split(" ")[0].trim(),u=e.substr(r.length).trim().split(" ");if(""!==u)switch(r){case"newmtl":a=u[0].trim(),o[a]=i.addAsset(i.default(a)),o[a].fromObj=!0;break;case"Ka":u.length<3?console.error("MaterialPool::computeObjMaterials(): error in ambient material array at line:"+n):(u[0]=parseFloat(u[0]),u[1]=parseFloat(u[1]),u[2]=parseFloat(u[2]),a&&Number.isFinite(u[0])&&Number.isFinite(u[1])&&Number.isFinite(u[2])?o[a].ambient=[u[0],u[1],u[2]]:console.error("MaterialPool::computerObjMaterials(): invalid ambient data at line:"+n));break;case"Kd":u.length<3?console.error("MaterialPool::computeObjMaterials(): error in diffuse material array at line:"+n):(u[0]=parseFloat(u[0]),u[1]=parseFloat(u[1]),u[2]=parseFloat(u[2]),a&&Number.isFinite(u[0])&&Number.isFinite(u[1])&&Number.isFinite(u[2])?o[a].diffuse=[u[0],u[1],u[2]]:console.error("MaterialPool::computeObjMaterials(): invalid diffuse array at line:"+n));break;case"Ks":u.length<3?console.error("MaterialPool::computeObjMaterials(): error in specular array at line:"+n):(u[0]=parseFloat(u[0]),u[1]=parseFloat(u[1]),u[2]=parseFloat(u[2]),a&&Number.isFinite(u[0])&&Number.isFinite(u[1])&&Number.isFinite(u[2])?o[a].specular=[u[0],u[1],u[2]]:console.error("MaterialPool::computeObjMaterials(): invalid specular array at line:"+n));break;case"Ns":u.length<1?console.error("MaterialPool::computeObjMaterials(): error in specular exponent array at line:"+n):(u[0]=parseFloat(u[0]),a&&Number.isFinite(u[0])&&u[0]>=0&&u[0]<1001?o[a].specularExponent=u[0]:console.error("MaterialPool::computeObjMaterials(): invalid specular exponent array at line:"+n));break;case"Ke":u.length<3?console.error("MaterialPool::computeObjMaterials(): error in specular array at line:"+n):(u[0]=parseFloat(u[0]),u[1]=parseFloat(u[1]),u[2]=parseFloat(u[2]),a&&Number.isFinite(u[0])&&Number.isFinite(u[1])&&Number.isFinite(u[2])?o[a].emissive=[u[0],u[1],u[2]]:console.error("MaterialPool::computeObjMaterials(): invalid specular array at line:"+n));break;case"sharpness":u[0]=parseFloat(u[0]),a&&Number.isFinite(u[0])&&u[0]>=0&&u[0]<1001&&(o[a].sharpness=u[0]);break;case"Ni":u[0]=parseFloat(u[0]),a&&Number.isFinite(u[0])&&u[0]>=0&&u[0]<1001&&(o[a].refraction=u[0]);break;case"d":case"Tr":u.length<1?console.error("MaterialPool::computeObjMaterials(): error in transparency value at line:"+n):(u[0]=parseFloat(u[0]),a&&Number.isFinite(u[0])?("d"===r&&(u[0]=1-u[0]),o[a].transparency=u[0]):console.error("MaterialPool::computeObjMaterials(): invalid transparency value at line:"+n));break;case"illum":u.length<1?console.error("MaterialPool::computeObjMaterials(): error in illumination value at line:"+n):(u[0]=parseInt(u[0]),a&&Number.isFinite(u[0])&&u[0]>0&&u[0]<11&&(o[a].illum=u[0]));break;case"map_Kd":case"map_Ks":case"map_Ka":case"map_d":case"bump":case"map_bump":case"map_refl":case"refl":case"disp":var l=i.util.getFileName(u[u.length-1]);if(a){o[a][r]=l;var c=i.computeTextureMapOptions(u);"bump"!==r&&"map_Km"!==r||(r="map_bump"),"refl"===r&&(r="map_refl"),"disp"===r&&(r="map_disp");var h={fromObj:"OBJ",materialKey:o[a].key,type:r,materialName:a};h[r+"_options"]=c,i.texturePool.getTexture(t,s+l,!0,!1,null,h)}break;case"Tf":case"#":case"":break;default:console.warn("MaterialPool::computeObjMaterials(): unknown property:"+r+" in file")}n++}),o}},{key:"createDefaultName",value:function(e){return e+"_"+this.util.DEFAULT_KEY}},{key:"setDefaultMaterial",value:function(e,t,r){var i=this.createDefaultName(e.name),n=this.addAsset(this.default(i));n.type=e.type,n.path=e.path,n.emits=this.util.emitter.events.MATERIAL_READY;for(var o=0;o<r.length;o++){var a={materialKey:n.key,materialName:i,type:this.texturePositions[o]};this.texturePool.getTexture(e,r[o],!0,!1,this.webgl.getContext().TEXTURE_2D,a)}return n}},{key:"addMaterial",value:function(e,t,r,i){var n=void 0,o=this.util.getFileExtension(r);switch(o){case"mtl":n=this.computeObjMaterials(t,e,r);break;default:console.warn("MaterialPool::addModel(): unknown material file:"+r+" MIME type:"+i)}if(n)for(var a in n){var s=n[a];s.type=e.type,s.path=r,s.emits=this.util.emitter.events.MATERIAL_READY,this.addAsset(s)}return n}},{key:"getMaterial",value:function(e,t){var r=this,i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{pos:0};if(this.util.isWhitespace(t))console.warn("MaterialPool::getMaterials(): empty path supplied for prim "+e.name);else{var o=this.materialMimeTypes[this.util.getFileExtension(t)];o?this.doRequest(t,n.pos,function(t){if(t.data){var i=r.addMaterial(e,t.data,t.path,o);if(i)for(var a in i)console.log("MaterialPool::getMaterial(): emitting new material :"+a+" for prim:"+e.name),r.util.emitter.emit(i[a].emits,e,i[a].key,n)}else console.error("MaterialPool::getMaterials(): no data found for material file:"+t.path)},i,o,0):console.error('MaterialPool::getMaterials(): file type "'+this.util.getFileExtension(t)+" not supported, not loading")}}}]),t}(l.default);t.default=c},function(e,t,r){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var s=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),u=r(2),l=i(u),c=function(e){function t(e,r,i,a,s,u,l){n(this,t);var c=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,r,i,a,s,u,l));return c.required.buffer.indices=!0,c.required.buffer.colors=!0,console.log("In ShaderColor class"),c}return a(t,e),s(t,[{key:"vsSrc",value:function(){var e=[this.floatp,"attribute vec3 "+this.webgl.attributeNames.aVertexPosition[0]+";","attribute vec4 "+this.webgl.attributeNames.aVertexColor[0]+";","attribute vec3 "+this.webgl.attributeNames.aVertexNormal[0]+";","uniform mat4 uMVMatrix;","uniform mat4 uPMatrix;","uniform mat3 uNMatrix;","uniform vec3 uPOV;","uniform float uPointSize;","varying vec3 vPOV;","varying vec4 vPositionW;","varying vec4 vNormalW;","varying vec4 vVertexColor;","void main(void) {","gl_PointSize = uPointSize;","gl_Position = uPMatrix * uMVMatrix * vec4(aVertexPosition, 1.0);","vVertexColor = aVertexColor;","vPOV = -uPOV;","vPositionW = uMVMatrix * vec4(aVertexPosition, 1.0);","vNormalW =  normalize(vec4(uNMatrix*aVertexNormal, 0.0));","}"];return{code:e.join("\n"),varList:this.webgl.createVarList(e)}}},{key:"fsSrc",value:function(){var e=[this.floatp,"uniform bool uUseLighting;","uniform bool uUseColor;","uniform vec3 uAmbientColor;","uniform vec3 uLightingDirection;","uniform vec3 uDirectionalColor;","uniform vec3 uMatEmissive;","uniform vec3 uMatAmbient;","uniform vec3 uMatDiffuse;","uniform vec3 uMatSpecular;","uniform float uMatSpecExp;","uniform float uAlpha;","varying vec3 vPOV;","varying vec4 vPositionW;","varying vec4 vNormalW;","varying lowp vec4 vVertexColor;","void main(void) {","vec4 vColor = vVertexColor;","vec4 Emissive = vec4(uMatEmissive, uAlpha);","vec4 Ambient = vec4(uAmbientColor * uMatAmbient, uAlpha);","vec4 Diffuse = vec4(uDirectionalColor * uMatDiffuse, uAlpha);","vec4 Specular = vec4(0.0, 0.0, 0.0, uAlpha);","if(uUseLighting) {","vec4 N = normalize(vNormalW);","vec4 LL = normalize(vec4(uLightingDirection, 1.0));","float NdotL = max( dot(N, LL), 0.0);","Diffuse = NdotL * Diffuse;","vec4 L = normalize(vec4(uLightingDirection, 1.0) - vPositionW);","vec4 EyePosW = vec4(vPOV, 0.0);","vec4 V = normalize(EyePosW - vPositionW );","vec4 H = normalize(L + V);","vec4 R = reflect(-L, N);","float RdotV = max(dot(R, V), 0.0);","float NdotH = max(dot(N, H), 0.0);","float spec = uMatSpecExp;","Specular = pow(RdotV, spec) * pow(NdotH, spec) * vec4(uDirectionalColor * uMatSpecular, 1.0);","}","gl_FragColor = (Emissive + Ambient + Diffuse + Specular) * vec4(vColor.rgb, vColor.a * uAlpha);","}"];return{code:e.join("\n"),varList:this.webgl.createVarList(e)}}},{key:"init",value:function(e){var t=this.setup(),r=t[0],i=(t[1],t[2]),n=t[3],o=(t[4],t[5]),a=t[6],s=t[7],u=(t[8],t[9],t[10],t[11],t[12]),l=o.shaderProgram;e&&(o.renderList=this.util.concatArr(o.renderList,e));var c=this.mvMatrix,h=(this.vMatrix,this.mMatrix,a.attribute.vec3.aVertexPosition),d=a.attribute.vec4.aVertexColor,f=a.attribute.vec3.aVertexNormal,v=s.uniform.bool.uUseLighting,m=s.uniform.vec3.uAmbientColor,p=s.uniform.vec3.uDirectionalColor,g=s.uniform.vec3.uLightingDirection,y=s.uniform.float.uAlpha,A=s.uniform.vec3.uMatEmissive,b=s.uniform.vec3.uMatAmbient,E=s.uniform.vec3.uMatDiffuse,M=s.uniform.vec3.uMatSpecular,x=s.uniform.float.uMatSpecExp,w=w=a.uniform.mat4.uPMatrix,T=T=a.uniform.mat4.uMVMatrix,P=a.uniform.mat3.uNMatrix,D=this.lights.getLight(this.lights.lightTypes.LIGHT_0),R=D.ambient,C=D.lightingDirection,S=D.directionalColor,O=a.uniform.float.uPointSize,I=a.uniform.vec3.uPOV,k=n.create(),_=C;o.update=function(e,t,r){e.setMV(t),n.normalFromMat4(k,t),r&&e.updateCoords()};var L=i.create();return o.render=function(e,t,n){if(o.renderList.length){r.useProgram(l),i.copy(L,c);for(var a=0,s=o.renderList.length;a<s;a++){var D=o.renderList[a];if(D&&0!==D.alpha){o.update(D,c,n);var C=D.matStarts;r.bindBuffer(r.ARRAY_BUFFER,D.geometry.vertices.buffer),r.enableVertexAttribArray(h),r.vertexAttribPointer(h,3,r.FLOAT,!1,0,0),r.bindBuffer(r.ARRAY_BUFFER,D.geometry.colors.buffer),r.enableVertexAttribArray(d),r.vertexAttribPointer(d,4,r.FLOAT,!1,0,0),r.uniform3fv(m,R),r.uniform3fv(g,_),r.uniform3fv(p,S),r.uniform3fv(I,t.position),r.uniform1f(O,D.pointSize),r.uniform1f(y,D.alpha),D.useLighting?r.uniform1i(v,1):r.uniform1i(v,0),r.bindBuffer(r.ARRAY_BUFFER,D.geometry.normals.buffer),r.enableVertexAttribArray(f),r.vertexAttribPointer(f,3,r.FLOAT,!1,0,0),r.uniformMatrix3fv(P,!1,k),r.uniformMatrix4fv(w,!1,e),r.uniformMatrix4fv(T,!1,c),r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,D.geometry.indices.buffer);for(var N=0;N<C.length;N++){var F=C[N],B=D.materials[F[0]];r.uniform3fv(b,B.ambient),r.uniform3fv(E,B.diffuse),r.uniform3fv(A,B.emissive),r.uniform3fv(M,B.specular),r.uniform1f(x,B.specularExponent),D.drawTris&&r.drawElements(r.TRIANGLES,F[2],u,F[1]),D.drawPoints&&r.drawElements(r.POINTS,F[2],u,F[1]),D.drawLines&&r.drawElements(r.LINES,F[2],u,F[1])}i.copy(c,L)}}}},o}}]),t}(l.default);t.default=c},function(e,t,r){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var s=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),u=r(2),l=i(u),c=function(e){function t(e,r,i,a,s,u,l){n(this,t);var c=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,r,i,a,s,u,l));return c.required.buffer.indices=!0,c.required.buffer.colors=!0,c.required.buffer.texCoords=!0,c.sortByDistance=!0,console.log("In ShaderFader class"),c}return a(t,e),s(t,[{key:"vsSrc",value:function(){var e=[this.floatp,"attribute vec3 "+this.webgl.attributeNames.aVertexPosition[0]+";","attribute vec4 "+this.webgl.attributeNames.aVertexColor[0]+";","attribute vec2 "+this.webgl.attributeNames.aTextureCoord[0]+";","attribute vec3 "+this.webgl.attributeNames.aVertexNormal[0]+";","uniform mat4 uMVMatrix;","uniform mat4 uPMatrix;","uniform mat3 uNMatrix;","uniform vec3 uPOV;","uniform float uPointSize;","varying vec3 vPOV;","varying vec4 vPositionW;","varying vec4 vNormalW;","varying vec2 vTextureCoord;","varying vec4 vVertexColor;","void main(void) {","gl_PointSize = uPointSize;","gl_Position = uPMatrix * uMVMatrix * vec4(aVertexPosition, 1.0);","vTextureCoord = aTextureCoord;","vVertexColor = aVertexColor;","vPOV = -uPOV;","vPositionW = uMVMatrix * vec4(aVertexPosition, 1.0);","vNormalW =  normalize(vec4(uNMatrix*aVertexNormal, 0.0));","}"];return{code:e.join("\n"),varList:this.webgl.createVarList(e)}}},{key:"fsSrc",value:function(){var e=[this.floatp,"uniform bool uUseLighting;","uniform bool uUseTexture;","uniform bool uUseColor;","uniform vec3 uAmbientColor;","uniform vec3 uLightingDirection;","uniform vec3 uDirectionalColor;","uniform vec3 uMatEmissive;","uniform vec3 uMatAmbient;","uniform vec3 uMatDiffuse;","uniform vec3 uMatSpecular;","uniform float uMatSpecExp;","uniform float uAlpha;","varying vec3 vPOV;","varying vec4 vPositionW;","varying vec4 vNormalW;","varying vec2 vTextureCoord;","varying vec4 vVertexColor;","uniform sampler2D uSampler;","void main(void) {","vec4 vColor;","if(uUseTexture) {","vColor = texture2D(uSampler, vec2(vTextureCoord.s, vTextureCoord.t));","} else {","vColor = vVertexColor;","}","vec4 Emissive = vec4(uMatEmissive, uAlpha);","vec4 Ambient = vec4(uAmbientColor * uMatAmbient, uAlpha);","vec4 Diffuse = vec4(uDirectionalColor * uMatDiffuse, uAlpha);","vec4 Specular = vec4(0.0, 0.0, 0.0, uAlpha);","if(uUseLighting) {","vec4 N = normalize(vNormalW);","vec4 LL = normalize(vec4(uLightingDirection, 1.0));","float NdotL = max( dot(N, LL), 0.0);","Diffuse = NdotL * Diffuse;","vec4 L = normalize(vec4(uLightingDirection, uAlpha) - vPositionW);","vec4 EyePosW = vec4(vPOV, 0.0);","vec4 V = normalize(EyePosW - vPositionW );","vec4 H = normalize(L + V);","vec4 R = reflect(-L, N);","float RdotV = max(dot(R, V), 0.0);","float NdotH = max(dot(N, H), 0.0);","float spec = uMatSpecExp;","Specular = pow(RdotV, spec) * pow(NdotH, spec) * vec4(uDirectionalColor * uMatSpecular, uAlpha);","} else {","Ambient.rgb *= uAlpha;","}","gl_FragColor = ((Emissive + Ambient + Diffuse + Specular) * vec4(vColor.rgb, vColor.a));","}"];return{code:e.join("\n"),varList:this.webgl.createVarList(e)}}},{key:"init",value:function(e){var t=this.setup(),r=t[0],i=(t[1],t[2]),n=t[3],o=(t[4],t[5]),a=t[6],s=t[7],u=(t[8],t[9],t[10],t[11],t[12]),l=o.shaderProgram;e&&(o.renderList=this.util.concatArr(o.renderList,e));var c=this.mvMatrix,h=(this.vMatrix,this.mMatrix,a.attribute.vec3.aVertexPosition),d=a.attribute.vec4.aVertexColor,f=a.attribute.vec2.aTextureCoord,v=a.attribute.vec3.aVertexNormal,m=s.uniform.sampler2D.uSampler,p=s.uniform.float.uAlpha,g=s.uniform.bool.uUseLighting,y=s.uniform.bool.uUseTexture,A=s.uniform.bool.uUseColor,b=s.uniform.vec3.uMatEmissive,E=s.uniform.vec3.uMatAmbient,M=s.uniform.vec3.uMatDiffuse,x=s.uniform.vec3.uMatSpecular,w=s.uniform.float.uMatSpecExp,T=s.uniform.vec3.uAmbientColor,P=s.uniform.vec3.uDirectionalColor,D=s.uniform.vec3.uLightingDirection,R=a.uniform.float.uPointSize,C=a.uniform.vec3.uPOV,S=a.uniform.mat4.uPMatrix,O=a.uniform.mat4.uMVMatrix,I=a.uniform.mat3.uNMatrix,k=(this.util.easeQuadIn,this.lights.getLight(this.lights.lightTypes.LIGHT_0)),_=k.ambient,L=k.lightingDirection,N=k.directionalColor,F=n.create(),B=L,V=function(e){var t=e.fade,r=t.endAlpha-t.startAlpha;r>0?(t.incr=t.eq(t.incr),e.alpha+=t.incr,e.alpha>=t.endAlpha&&(e.alpha=t.endAlpha,e.shader.movePrim(e,e.defaultShader))):r<=0&&(t.incr=t.eq(t.incr),e.alpha-=t.incr,e.alpha<=t.endAlpha&&(e.alpha=t.endAlpha,e.shader.movePrim(e,e.defaultShader)))};o.update=function(e,t,r){V(e),e.setMV(t),n.normalFromMat4(F,t),r&&e.updateCoords()};var U=i.create();return o.render=function(e,t,n){if(o.renderList.length){r.useProgram(l),i.copy(U,c);for(var a=0,s=o.renderList.length;a<s;a++){var k=o.renderList[a];if(k){o.update(k,c,n),r.bindBuffer(r.ARRAY_BUFFER,k.geometry.vertices.buffer),r.enableVertexAttribArray(h),r.vertexAttribPointer(h,3,r.FLOAT,!1,0,0),r.bindBuffer(r.ARRAY_BUFFER,k.geometry.colors.buffer),r.enableVertexAttribArray(d),r.vertexAttribPointer(d,4,r.FLOAT,!1,0,0),r.bindBuffer(r.ARRAY_BUFFER,k.geometry.texCoords.buffer),r.enableVertexAttribArray(f),r.vertexAttribPointer(f,2,r.FLOAT,!1,0,0),r.uniform1f(R,k.pointSize),r.uniform1f(p,k.alpha),r.uniform3fv(T,_),r.uniform3fv(D,B),r.uniform3fv(P,N),r.uniform3fv(C,t.position),k.useLighting?r.uniform1i(g,1):r.uniform1i(g,0),r.bindBuffer(r.ARRAY_BUFFER,k.geometry.normals.buffer),r.enableVertexAttribArray(v),r.vertexAttribPointer(v,3,r.FLOAT,!1,0,0),r.uniformMatrix3fv(I,!1,F),r.uniformMatrix4fv(S,!1,e),r.uniformMatrix4fv(O,!1,c),r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,k.geometry.indices.buffer);for(var L=k.matStarts,V=0;V<L.length;V++){var G=L[V],W=k.materials[G[0]];void 0!==W&&(r.uniform3fv(E,W.ambient),r.uniform3fv(M,W.diffuse),r.uniform3fv(b,W.emissive),r.uniform3fv(x,W.specular),r.uniform1f(w,W.specularExponent),W.map_Kd instanceof WebGLTexture&&(r.uniform1i(m,0),r.activeTexture(r.TEXTURE0),r.bindTexture(r.TEXTURE_2D,null),r.bindTexture(r.TEXTURE_2D,W.map_Kd)),k.useColorArray===!0?(r.uniform1i(A,1),r.uniform1i(y,0)):(r.uniform1i(A,0),r.uniform1i(y,1)),k.drawTris&&r.drawElements(r.TRIANGLES,G[2],u,G[1]),k.drawPoints&&r.drawElements(r.POINTS,G[2],u,G[1]),k.drawLines&&r.drawElements(r.LINES,G[2],u,G[1]))}i.copy(c,U)}}}},o}}]),t}(l.default);t.default=c},function(e,t,r){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var s=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),u=r(2),l=i(u),c=function(e){function t(e,r,i,a,s,u,l){n(this,t);var c=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,r,i,a,s,u,l));return console.log("In ShaderMetal class"),c.required.buffer.indices=!0,c.required.buffer.texCoords=!0,c.required.buffer.colors=!0,c.required.buffer.normals=!0,c.required.lights=1,c.required.textures=0,c}return a(t,e),s(t,[{key:"vsSrc",value:function(){var e=[this.floatp,"attribute vec3 "+this.webgl.attributeNames.aVertexPosition[0]+";","attribute vec2 "+this.webgl.attributeNames.aTextureCoord[0]+";","attribute vec3 "+this.webgl.attributeNames.aVertexNormal[0]+";","uniform mat4 uMVMatrix;","uniform mat4 uPMatrix;","uniform mat3 uNMatrix;","uniform vec3 uPOV;","varying vec3 vPOV;","varying vec4 vPositionW;","varying vec4 vNormalW;","varying vec2 vTextureCoord;","void main(void) {","    gl_Position = uPMatrix * uMVMatrix * vec4(aVertexPosition, 1.0);","}"];return{code:e.join("\n"),varList:this.webgl.createVarList(e)}}},{key:"fsSrc",value:function(){var e=[this.floatp,"void main(void) {","gl_FragColor = vec4(0.5, 0.5, 0.5, 1.0);","}"];return{code:e.join("\n"),varList:this.webgl.createVarList(e)}}},{key:"init",value:function(e){var t=this.setup(),r=t[0],i=(t[1],t[2]),n=t[3],o=(t[4],t[5]),a=(t[6],t[7],t[8],t[9],t[10],t[11],t[12],o.shaderProgram);e&&(o.renderList=this.util.concatArr(o.renderList,e));var s=this.mvMatrix;this.vMatrix,this.mMatrix;o.update=function(e,t,r){e.setMV(s),n.normalFromMat4(nMatrix,s),r&&e.updateCoords()};var u=i.create();o.render=function(e,t,n){if(o.renderList.length){r.useProgram(a),i.copy(u,s);for(var l=0,c=o.renderList.length;l<c;l++){var h=o.renderList[l];h&&0!==h.alpha&&(o.update(h,s,n),i.copy(s,u))}}}}}]),t}(l.default);t.default=c},function(e,t,r){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var s=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),u=r(1),l=i(u),c=function(e){function t(e,r,i,a){n(this,t);var s=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,r));return console.log("In ShaderPool class"),s.webgl=a,s.glmatrix=i,s.init,s}return a(t,e),s(t,[{key:"renderMono",value:function(){var e=this.keyList;for(var t in e)e[t].program.render()}},{key:"renderVR",value:function(e,t,r){var i=this.keyList;for(var n in this.keyList)i[n].program.renderVR(e,t,r)}}]),t}(l.default);t.default=c},function(e,t,r){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var s=function(){function e(e,t){for(var r=0;r<t.length;r++){
var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),u=r(2),l=i(u),c=function(e){function t(e,r,i,a,s,u,l){n(this,t);var c=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,r,i,a,s,u,l));return console.log("In ShaderSky class"),c.required.buffer.indices=!0,c.required.buffer.texCoords=!0,c.required.buffer.colors=!0,c.required.buffer.normals=!0,c.required.buffer.tangents=!0,c.required.lights=1,c.required.textures=5,c}return a(t,e),s(t,[{key:"vsSrc",value:function(){var e=[this.floatp,"attribute vec3 "+this.webgl.attributeNames.aVertexPosition[0]+";","attribute vec2 "+this.webgl.attributeNames.aTextureCoord[0]+";","attribute vec3 "+this.webgl.attributeNames.aVertexNormal[0]+";","uniform mat4 uMVMatrix;","uniform mat4 uPMatrix;","uniform mat3 uNMatrix;","uniform vec3 uPOV;","varying vec3 vPOV;","varying vec4 vPositionW;","varying vec4 vNormalW;","varying vec2 vTextureCoord;","void main(void) {","    gl_Position = uPMatrix * uMVMatrix * vec4(aVertexPosition, 1.0);","}"];return{code:e.join("\n"),varList:this.webgl.createVarList(e)}}},{key:"fsSrc",value:function(){var e=[this.floatp,"void main(void) {","gl_FragColor = vec4(0.5, 0.5, 0.5, 1.0);","}"];return{code:e.join("\n"),varList:this.webgl.createVarList(e)}}},{key:"init",value:function(e){var t=this.setup(),r=t[0],i=(t[1],t[2]),n=t[3],o=(t[4],t[5]),a=(t[6],t[7],t[8],t[9],t[10],t[11],t[12],o.shaderProgram);e&&(o.renderList=this.util.concatArr(o.renderList,e));var s=this.mvMatrix;this.vMatrix,this.mMatrix;o.update=function(e,t,r){e.setMV(s),n.normalFromMat4(nMatrix,s),r&&e.updateCoords()};var u=i.create();o.render=function(e,t,n){if(o.renderList.length){r.useProgram(a),i.copy(u,s);for(var l=0,c=o.renderList.length;l<c;l++){var h=o.renderList[l];h&&0!==h.alpha&&(o.update(h,s,n),i.copy(s,u))}}}}}]),t}(l.default);t.default=c},function(e,t,r){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var s=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),u=r(2),l=i(u),c=function(e){function t(e,r,i,a,s,u,l){n(this,t);var c=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,r,i,a,s,u,l));return console.log("In ShaderTerrain class"),c.required.buffer.indices=!0,c.required.buffer.texCoords=!0,c.required.buffer.normals=!0,c.required.lights=1,c.required.textures=1,c}return a(t,e),s(t,[{key:"vsSrc",value:function(){var e=[this.floatp,"attribute vec3 "+this.webgl.attributeNames.aVertexPosition[0]+";","attribute vec2 "+this.webgl.attributeNames.aTextureCoord[0]+";","attribute vec3 "+this.webgl.attributeNames.aVertexNormal[0]+";","uniform mat4 uMVMatrix;","uniform mat4 uPMatrix;","uniform mat3 uNMatrix;","uniform vec3 uPOV;","varying vec3 vPOV;","varying vec4 vPositionW;","varying vec4 vNormalW;","varying vec2 vTextureCoord;","void main(void) {","    gl_Position = uPMatrix * uMVMatrix * vec4(aVertexPosition, 1.0);","}"];return{code:e.join("\n"),varList:this.webgl.createVarList(e)}}},{key:"fsSrc",value:function(){var e=[this.floatp,"void main(void) {","gl_FragColor = vec4(0.5, 0.5, 0.5, 1.0);","}"];return{code:e.join("\n"),varList:this.webgl.createVarList(e)}}},{key:"init",value:function(e){var t=this.setup(),r=t[0],i=(t[1],t[2]),n=t[3],o=(t[4],t[5]),a=(t[6],t[7],t[8],t[9],t[10],t[11],t[12],o.shaderProgram);e&&(o.renderList=this.util.concatArr(o.renderList,e)),mvMatrix=this.mvMatrix,vMatrix=this.vMatrix,mMatrix=this.mMatrix,o.update=function(e,t,r){e.setMV(mvMatrix),n.normalFromMat4(nMatrix,mvMatrix),r&&e.updateCoords()};var s=i.create();o.render=function(e,t,n){if(o.renderList.length){r.useProgram(a),i.copy(s,mvMatrix);for(var u=0,l=o.renderList.length;u<l;u++){var c=o.renderList[u];c&&0!==c.alpha&&(o.update(c,mvMatrix,n),i.copy(mvMatrix,s))}}}}}]),t}(l.default);t.default=c},function(e,t,r){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var s=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),u=r(2),l=i(u),c=function(e){function t(e,r,i,a,s,u,l){n(this,t);var c=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,r,i,a,s,u,l));return c.required.buffer.indices=!0,c.required.buffer.colors=!0,c.required.buffer.normals=!0,c.required.lights=0,c.required.textures.map_Kd=!0,console.log("In ShaderTexture class"),c}return a(t,e),s(t,[{key:"vsSrc",value:function(){var e=[this.floatp,"attribute vec3 "+this.webgl.attributeNames.aVertexPosition[0]+";","attribute vec2 "+this.webgl.attributeNames.aTextureCoord[0]+";","attribute vec3 "+this.webgl.attributeNames.aVertexNormal[0]+";","uniform mat4 uMVMatrix;","uniform mat4 uPMatrix;","uniform mat3 uNMatrix;","uniform vec3 uPOV;","uniform float uPointSize;","varying vec3 vPOV;","varying vec4 vPositionW;","varying vec4 vNormalW;","varying vec2 vTextureCoord;","void main(void) {","gl_PointSize = uPointSize;","gl_Position = uPMatrix * uMVMatrix * vec4(aVertexPosition, 1.0);","vTextureCoord = aTextureCoord;","vPOV = -uPOV;","vPositionW = uMVMatrix * vec4(aVertexPosition, 1.0);","vNormalW =  normalize(vec4(uNMatrix*aVertexNormal, 0.0));","}"];return{code:e.join("\n"),varList:this.webgl.createVarList(e)}}},{key:"fsSrc",value:function(){var e=[this.floatp,"uniform bool uUseLighting;","uniform vec3 uAmbientColor;","uniform vec3 uLightingDirection;","uniform vec3 uDirectionalColor;","uniform vec3 uMatEmissive;","uniform vec3 uMatAmbient;","uniform vec3 uMatDiffuse;","uniform vec3 uMatSpecular;","uniform float uMatSpecExp;","uniform float uAlpha;","varying vec3 vPOV;","varying vec4 vPositionW;","varying vec4 vNormalW;","varying vec2 vTextureCoord;","uniform sampler2D uSampler;","void main(void) {","vec4 vColor = texture2D(uSampler, vec2(vTextureCoord.s, vTextureCoord.t));","vec4 Emissive = vec4(uMatEmissive, uAlpha);","vec4 Ambient = vec4(uAmbientColor * uMatAmbient, uAlpha);","vec4 Diffuse = vec4(uDirectionalColor * uMatDiffuse, uAlpha);","vec4 Specular = vec4(0.0, 0.0, 0.0, uAlpha);","if(uUseLighting) {","vec4 N = normalize(vNormalW);","vec4 LL = normalize(vec4(uLightingDirection, 1.0));","float NdotL = max( dot(N, LL), 0.0);","Diffuse = NdotL * Diffuse;","vec4 L = normalize(vec4(uLightingDirection, uAlpha) - vPositionW);","vec4 EyePosW = vec4(vPOV, 0.0);","vec4 V = normalize(EyePosW - vPositionW );","vec4 H = normalize(L + V);","vec4 R = reflect(-L, N);","float RdotV = max(dot(R, V), 0.0);","float NdotH = max(dot(N, H), 0.0);","float spec = uMatSpecExp;","Specular = pow(RdotV, spec) * pow(NdotH, spec) * vec4(uDirectionalColor * uMatSpecular, uAlpha);","} else {","Ambient.rgb *= uAlpha;","}","gl_FragColor =  (Emissive + Ambient + Diffuse + Specular) * vec4(vColor.rgb, vColor.a);","}"];return{code:e.join("\n"),varList:this.webgl.createVarList(e)}}},{key:"init",value:function(e){var t=this.setup(),r=t[0],i=(t[1],t[2]),n=t[3],o=(t[4],t[5]),a=t[6],s=t[7],u=(t[8],t[9],t[10],t[11],t[12]),l=o.shaderProgram;e&&(o.renderList=this.util.concatArr(o.renderList,e));var c=this.mvMatrix,h=(this.vMatrix,this.mMatrix,a.attribute.vec3.aVertexPosition),d=a.attribute.vec2.aTextureCoord,f=a.attribute.vec3.aVertexNormal,v=s.uniform.sampler2D.uSampler,m=s.uniform.float.uAlpha,p=s.uniform.bool.uUseLighting,g=s.uniform.vec3.uMatEmissive,y=s.uniform.vec3.uMatAmbient,A=s.uniform.vec3.uMatDiffuse,b=s.uniform.vec3.uMatSpecular,E=s.uniform.float.uMatSpecExp,M=s.uniform.vec3.uAmbientColor,x=s.uniform.vec3.uDirectionalColor,w=s.uniform.vec3.uLightingDirection,T=a.uniform.float.uPointSize,P=a.uniform.vec3.uPOV,D=a.uniform.mat4.uPMatrix,R=a.uniform.mat4.uMVMatrix,C=a.uniform.mat3.uNMatrix,S=this.lights.getLight(this.lights.lightTypes.LIGHT_0),O=S.ambient,I=S.lightingDirection,k=S.directionalColor,_=n.create(),L=I;o.update=function(e,t,r){e.setMV(t),n.normalFromMat4(_,t),r&&e.updateCoords()};var N=i.create();return o.render=function(e,t,n){if(o.renderList.length){r.useProgram(l),i.copy(N,c);for(var a=0,s=o.renderList.length;a<s;a++){var S=o.renderList[a];if(S&&0!==S.alpha){o.update(S,c,n),r.bindBuffer(r.ARRAY_BUFFER,S.geometry.vertices.buffer),r.enableVertexAttribArray(h),r.vertexAttribPointer(h,3,r.FLOAT,!1,0,0),r.bindBuffer(r.ARRAY_BUFFER,S.geometry.texCoords.buffer),r.enableVertexAttribArray(d),r.vertexAttribPointer(d,2,r.FLOAT,!1,0,0),r.uniform1i(v,0),r.uniform1f(T,S.pointSize),r.uniform1f(m,S.alpha),r.uniform3fv(M,O),r.uniform3fv(w,L),r.uniform3fv(x,k),r.uniform3fv(P,t.position),S.useLighting?r.uniform1i(p,1):r.uniform1i(p,0),r.uniform3fv(P,t.position),r.bindBuffer(r.ARRAY_BUFFER,S.geometry.normals.buffer),r.enableVertexAttribArray(f),r.vertexAttribPointer(f,3,r.FLOAT,!1,0,0),r.uniformMatrix3fv(C,!1,_),r.uniformMatrix4fv(D,!1,e),r.uniformMatrix4fv(R,!1,c),r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,S.geometry.indices.buffer);for(var I=S.matStarts,F=0;F<I.length;F++){var B=I[F],V=S.materials[B[0]];r.uniform3fv(y,V.ambient),r.uniform3fv(A,V.diffuse),r.uniform3fv(g,V.emissive),r.uniform3fv(b,V.specular),r.uniform1f(E,V.specularExponent),r.activeTexture(r.TEXTURE0),r.bindTexture(r.TEXTURE_2D,null),r.bindTexture(r.TEXTURE_2D,V.map_Kd),S.drawTris&&r.drawElements(r.TRIANGLES,B[2],u,B[1]),S.drawPoints&&r.drawElements(r.POINTS,B[2],u,B[1]),S.drawLines&&r.drawElements(r.LINES,B[2],u,B[1])}i.copy(c,N)}}}},o}}]),t}(l.default);t.default=c},function(e,t,r){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var s=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),u=r(2),l=i(u),c=function(e){function t(e,r,i,a,s,u,l){n(this,t);var c=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,r,i,a,s,u,l));return console.log("In ShaderWater class"),c.required.buffer.indices=!0,c.required.buffer.texCoords=!0,c.required.buffer.colors=!0,c.required.buffer.normals=!0,c.required.buffer.tangents=!0,c.required.lights=1,c.required.textures=5,c}return a(t,e),s(t,[{key:"vsSrc",value:function(){var e=[this.floatp,"attribute vec3 "+this.webgl.attributeNames.aVertexPosition[0]+";","attribute vec2 "+this.webgl.attributeNames.aTextureCoord[0]+";","attribute vec3 "+this.webgl.attributeNames.aVertexNormal[0]+";","uniform mat4 uMVMatrix;","uniform mat4 uPMatrix;","uniform mat3 uNMatrix;","uniform vec3 uPOV;","varying vec3 vPOV;","varying vec4 vPositionW;","varying vec4 vNormalW;","varying vec2 vTextureCoord;","void main(void) {","    gl_Position = uPMatrix * uMVMatrix * vec4(aVertexPosition, 1.0);","}"];return{code:e.join("\n"),varList:this.webgl.createVarList(e)}}},{key:"fsSrc",value:function(){var e=[this.floatp,"void main(void) {","gl_FragColor = vec4(0.5, 0.5, 0.5, 1.0);","}"];return{code:e.join("\n"),varList:this.webgl.createVarList(e)}}},{key:"init",value:function(e){var t=this.setup(),r=t[0],i=(t[1],t[2]),n=t[3],o=(t[4],t[5]),a=(t[6],t[7],t[8],t[9],t[10],t[11],t[12],o.shaderProgram);e&&(o.renderList=this.util.concatArr(o.renderList,e));var s=this.mvMatrix;this.vMatrix,this.mMatrix;o.update=function(e,t,r){e.setMV(s),n.normalFromMat4(nMatrix,s),r&&e.updateCoords()};var u=i.create();o.render=function(e,t,n){if(o.renderList.length){r.useProgram(a),i.copy(u,s);for(var l=0,c=o.renderList.length;l<c;l++){var h=o.renderList[l];h&&0!==h.alpha&&(o.update(h,s,n),i.copy(s,u))}}}}}]),t}(l.default);t.default=c},function(e,t){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),n=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],i=arguments[1],n=this,o=arguments[2],a=arguments[3];r(this,e),console.log("in Ui"),this.UI_DOM="uidom",this.UI_VR="uivr",this.UI_FULLSCREEN="fullscreen",this.mode=this.UI_DOM,this.icons={vr:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAIAAAABkCAMAAAB5NchtAAAAYFBMVEUAAAAAAAD//wCAgAD//wDAwAD//wBAQAD//wDw8AD//wD//wD//wD//wCgoAAgIADg4AD//wBgYAD//wBwcAAwMAD//wDQ0ACQkABQUAD//wD//wD//wCwsAD//wD//wCnD3VfAAAAIHRSTlMAq6urVquBqyuroRULa6urq0Cri6urlqurq0s2IKt2YQWtHu0AAANCSURBVHgB7Zlpl7osAEfxqhW477Z//2/5NNMZjcIy9WnO/A/3bQn3sMAPEH8Ei8VisVgsFsumZ++9Iuv+G0yvMPO8aHVBMRt1KebsZe/IeIrl4TRaYc8Dqd/jvuLo/4BGNLoBIP2qZn3BmU9yKcZ1G6jFSE6QO4sDiJGsYO0sTgMbMQ4gcRbHf0vAWZ4Ydr8q4IInRrGB9LcF/H9RYAurXxVY/x2BHRwdjTxuAOm31Zimbn2AJs6nCnjgahNY0pG+WqPzlA7pLiGQSzT8xBmmatCQ29kCMUB93oRCBFkEII390MuqaB8IEW7OCqCcKRADKhM/BNEzgy3AOewHkwLcWQIlUIRaWFEgB9pfgtL2m6AAul4A3hVI+vo7DmpoljagDkIjLEDOEPChDsUdGea4kGPYb0MF8WSBCuMWfjI3QQpnIUy6yVSB1jxsAmNgqYBQPFJDOVUghUwYKK5l6rQQDayr/lQBIBy3Vl/wB2wDYKLAGorxu5WEgzAxS2A1XgAYzth/T6Cc1AXBcMh/V2Br+OL1INwvPAiddKDM0zvTMJsxDWNzmQFQmbZCFZqGwIyFaI1xakXQmJdizzheSOZsRoXx9sAUzFyTblhP3Yy6JojE2O04hSJ87ACZdJtF/XYgaYEovK9fJkO5m0Jrg3AFlLMi2REoNn2JHn3GMSYCtRMdmxqIlwilq+sV1zVnym4AJG0DpG1ya0DtHcSFYFcAxLNjucuVQvFNWt39ogVPyTd1zTeyXOBgUvkYzxoxPU3vK+mJE2e+wIXEvTqkx9zR6q+zr2lZaAZOfrw6+GUy92imsdaLK2/mRwTEej7rU+t8ATPytrjIMDX+Z4FYX/lXkC53QbEfcT+AngADBe4nr2hKqO9bTX5SoIHdwwko/5xAwkP+OoP/OYESijHHJY12tEDwsj9Tw61rYRyGhtA4/6rWfAzcQfqpy+oWTuKeEFgvJKCgerEKZsaoGL/4KljmwWILyjx2WejFJIL2+TIcCQP106WgMmsb8W4eytyecn0FOAx81qxvKG8e0RqAkxhJwAvqaZ9lYiybSPEMTxg5Pbf2QvEWh82FzOuJVj8Ewsh+pRHdPiULi8VisVgsFotliP8AcnQzhVuzTBwAAAAASUVORK5CYII=",htcvive:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAIAAAABkCAMAAAB5NchtAAAAt1BMVEUAAAAzMzP//wDNzQ0zMzP//wBlZSZAQDH//wBmZiaSkhpOTi/FxQ7//wC8vBCVlRqLix1MTCyxsRL09AT//wD//wClpRZ3dyLc3Ag+PjCAgB+dnRn//wD//wBwcCO0tBT//wBtbSRiYidhYSeurhSAgCGoqBj//wBZWSlXVyr//wByciP//wD//wD4+AKUlBt3dyf//wCBgR/NzQz//wD//wD//wDCwhGkpBf//wBZWSn//wD//wCqAxrVAAAAPXRSTlMAq6vj4+PkrYGr463hC+Grx+bhq4uW0sCr5ePO1lb1q6G9ufbVq6th47ZA48c29Mura8SrICsVq+O4q0t2ZYJ3CQAABbNJREFUeAHsld2umkAUhTtfMg6Kdi6AhDRDz9yIiQeJRoX48/7P1aDi0NT2NHHQG75LY7IWe6+159vAUwwMDAzMVlmWrap3ye/PXAn2b9FfAGmu9RZYvEF/A3UoGsIcNi/XP8FctKyjl89gXxy0cMzhXL1SPijkVnSpKQiWL5JfJmDkXHRZY4Akm/Vf/cwCSKnEbyC5sOl5EyvLBWnEnwYiALvsu/tE+fyxgaNO6fUoVDEQaSXGDwwYGF8KCXHV4/jTsGndXw0IlQJ21Ys+QC4aNLJ4aKAhB+zOv/7OQrQWXxu4rCGZea9fAtFR/I8BcQQC3wZinIDYIg8PDKzdZfbehQ0wF/8yUIAWLR/A0vPbx4doUelXBlTqN4h7oH18Ql3DYwPUOmz/5YLoKYCpcsMFDEfRJaQAOnMaA5kvA2dXgDUNySIgF100wSKh60CD9XeB2vWqCJJT1SwlCoVDRU3mdqfYOVCRrxzOrAtADfa62YBUdTMXu7ao+wgSXwvocjvzlSVtYxCmLvLx/VyEwN6DflYYI++UkhsHKeV08jn6nEyllAdumFJeMaYonr+HVWZll7Kcju78dLgfv5eldJhs9tT2N7S4z56MHK2844csZZfCPmHhZGmo9djF7Ve7VrfcKA9Dx3uYOgWvC24CAS4ypWx+mmmzH+3sZvr+D/alJHhkQjfIuc25DvKxJUtHcnbQefAPGKRdIvi9nB/v7Os125//koJCKhTB99hC0d9Hy8dWqP70Wb+VX79EH09AEnyHRKERDuRDq9F++q3/LsU5UpjgO4SoRR/R3IsBSWk9SIUwGEYBbMQ5Fh4MVj9Ica2aqueE/ZAXEgPEwqJKlU4rq08m3Oxv979RAPQTYRADKIa2r8ivdmiRdVmZVxq/yq89cei9BjLq1hpDSKVDMkySEIisFz4Y2ffw867WNTB5kIc972YKLtztiw2wDQ7YI7YKieGEGQmAGls3vl0AEAMoT4F61312zxGJL4cEIC0BrNsIAyIGAXP8Klhb3gcnTBn1dyF6JxDs0TAIAF1mLLu4YUTB4aefJJrDU46JxxOooAPyVadlVqMl8CO1pfL2lnEISCA/peYNaVZmo3uAv447Q/YJCN06LjckdOXhYP+MvYQPznEizIM1sGEQyIBivdVQJHLfrZy7gIltwqwxGCDlXENR4guakl7abHiZwL0bUjWAnWQREE9lXTfSbR1+rJgELKJ2JywCFLanmfAIZCmAlBQBPgFq4p5JQKa2xvgSoCb4BEqgSIKkAEpPAtQEn8AGNp1j40fAMcEmEFvhFaLxI+Ca4BMorNSJPQlQE2wCGXRwhEbmR8AxwSZgxW8IJf0IuCbYtyADdFiEVg7yCTgm+ATEkwaIIOYToCb4BNrv4zgmy/MJWBOeBFz41wImgRXVA9cToNXwv7GCZCnGoUrf3t7SSowAQw+82qEYRVXWdRmd5foDAWDnlO4mjpshCf8+tjP4003aCGSNFk5I7tBh5/ZMw/plvC6fWU3WQRqocL01UHSrAMw6WBuQpkUC+yJUgJHnemQ2vjf/2x9KqOTYHlWOA0yeJ3luSMXOsG9bMnWmIRfjX7g/SG/aIurGMnvqAw3cJc/Pz8kdoC3VUyOV0CLOHltOaW9G66qhJwAgeP5CQO5iiS3piQgWnMHtC32eIXV1DcgLBLJujFe4QuqT94Qyad8HCIHWsbmhRoddIDXCfEDGzEc3xzYKFs5UaJsHd9otzE4Q0kZKhUm+ddv5BSMCumxI83ENKNroDF1Dy0ChheXk94o2cV7JZAlAxWT//UREIBsDmKy3/pQ/qHSvwoZsss9gd6EI2Dkhm8E8ulSMFNSFYhS9HwzNPnyHxQ9S+IPOir3H5Y/LSHjDc1pu8Xp8iJsvf98LJq5/L7D/WLkSvi8mlsLL9Jrlpy/+yxMOq8mMv/Zsshqz+g033HDDDf8Db7OIUNFvKHcAAAAASUVORK5CYII=",oculusrift:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAIAAAABkCAMAAAB5NchtAAAAYFBMVEUAAAAAAAD//wBAQAD//wDAwACAgAD//wD//wCgoADx8QAgIAD//wDQ0AFgYAD//wDg4AD//wD//wD//wBwcAD//wCQjwD//wAwMAD//wCwsAD//wBQUAD//wD//wD//wALJkCDAAAAIHRSTlMAq6urgaurVqGrq6trq6sLqysgi6uWq0CrNqt2qxVhSxMoBJ0AAANiSURBVHgB7dnbjrJIFMXxXX8OlpwFEcSD7/+WE3cQpycTKbGmnS/hd8WFbZabWgWVltVqtfqTXTIL6lTLF9SWp05+X8sTtpTfdgTORgUJ3OS3bWBrRnvIvhEgNqMAwjXAV9ZAMNp/KcDT9wMkXwlQRaN8bcEaYA2wBlgDrAH+ywDlcXMK/0X782Fkw3/YdBfxoM5YrulK+UyZ8RnbeTj7VNt98L4izrkLPxhCBxAFZqk0TgBbf/L7k735yPAjQb2r52+6xW5KvbSQ9OZDxfPcWDdAu5OXGu6a+2UG9Mb4SBA+ftDsHbk9D9sXQOfvI0E3fnfCzCEyhCrI4aQDiIwXA7QicoLBbCGcCXA2gf6BvV96kSY6ggaC2T070/0dkB1UxpODjhTQc/xp/sxfwU6vPEmBsoZEs2zkhR3ketNuOgtP9BcddU1FcJQXSp1TDFkIgfFlC5sNHIxJoJZX2sdK8Roghs1JWw3ISyEUes+8BiggfJSgkZemQTUeA+hI50ugxqXiP0AzXwI1laX1HmC+BApITQHWc4D2cW8v8pouvh7wHMDCXle3qPnN2H+A+SeBusFgTO49wLTDyWvjQ2jrP8D4tRuZM0b1HmAswU7U7GbsP8C4tC4yZ9yz/QcoXEowbcaV7wCuJZg2Y78BHEugLuNnvQZwLYGy0Juz5wDuJRjfjHu/AVxLoK76Yb8BXEugOh1X4jNA4V6CaTOuYG98id1LMG3GAxx8vhUnziUYz1Ax5D7PBblzCcZXghRIjR/9VILyjf/JJv6ORlstQQ9W5k3nsxwSf0dDAnN2K8F0PjsAg/Eh4lGCq7jR97ctOrjP7QEq7dVN3JyALar3sAmp7QEtgZMjisTDDPZAnqCsuLqiofsELcRy6QAkaY46irPd1UJkNEESp2aZdAuQ9wHQNFkt76h1I0oj7vJDEbxrf8i5G7QGmbwtRB8G+4RPVGfdCNnJ27rHRlTkLBUV40YYygJ2qkBaxEOUQBs6aYA8GuKzUemyAWgVcjM5uK/i0kKVGvXBAOQC9H9fz7YUNxstcfocQCeLnB6bwDl6s8YZGiEYB9DKMkf0tSyuuGuP4q5ruYvOfa4DWKhhEnbvlijkoZWl6hZls4u8bxeibC2LlVcL4a2UZXbXhvZayv/barVa/QWitTau9tPhRAAAAABJRU5ErkJggg==",smartphone:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAIAAAABkCAMAAAB5NchtAAAAYFBMVEUAAAAAAAD//wCAgABAQADw8AD//wD//wDAwAD//wCgoADQ0AAgIABgYAD//wBQUACQkAAwMAD//wDg4AD//wD//wD//wCwsAD//wD//wD//wD//wBwcAD//wD//wD//wBHb2y0AAAAIHRSTlMAq6urq6uBVqsLq6urq4urq6tAq5aha6thNiAVqytLdhOYuoMAAAOISURBVHgB7Zntcqs4DIZXDzYh2HwQyEfSpOf+73KXE0Gy080MBqfdM8PzszONXl7JSBZ/raysrKysROO2/dZo6Zc/bfabb5PwcYCvAqDbfVv4/xYA5e3t4bcbeC0A0o/3xj/v+ZeA3Wb3ENAC7N+ahxNAW4wCSqAcBSQ+Azi9L/slYAuRQcCOnt0oQMRYoPx4o/3OyyhA8755CPgHB+zPb4kPUEvPSwd66l7BJX78yx5sJb95VQPym8pCt41+/Dqwjdx5cQpUgDRAGltACRj5ImBABShF/LNwAAqZKkByLY1ofAK5TBcgLm4h3oBMRuoXApyXAR+3EEtwMlC1L3uBrWTA6AsiCjugeU4v5Vd7t78Ajl6UKxDrjdg9FUAG7D9fvyltIkoLhzjxN2D9o7hed9xtCtB6PYuRLLhsmEWb2QgWfGw6FrFsTtweWMySUfVzT8/xamQGpqodPd15yeO3hSzA1xbgsJ0TX6efpSQWKLfz4mcy0lRJEEYGvJuloHzuPia3BONqL3fyGQpOwFXuVI6ZZOpDETygnB/P7zP9sToJIFfRR+0LoZ2p0+6nYzZ5JcEUGdofNQuXoJc/Xs3TDjcHkzHOUQ7SIAMSjb/sKFZ2UGBCZrQdWOlprE7Cs2kcUGkSyqkCfg0V6DT+Epz2ch9QBUAzJMDIQhqrL7Tj5En9NmSgVSeWUeljFNBNHsGP+p9WIpCpBVMHpHHAz9WApRg91BlMa8wpFJqBSmLg7q/1GjZTBRi1TKJwvec0gVOIAAOtRMGAu9dUGiggkyiol+ZPE7AKWAWsAlYBDbTRBfxAM1IvQwScIInajmvI793wMHUgqRcPJMY91lUtFCHzwFmrr1qQA29BjRSjv5NNvRl8AIPyWuaR02OlJ1Mnp8/lHRTDWN7MH0QBnYcwd0O76Xfzo/S42SexHh1orBqQT1/aXYa7aQO4BTVQ6+1O9GZ0C1iP5OPl1PkFp6CPT6MGdEHLaTMWk61kLsl4P2/CvmCko/WJrlrmULWP273Ty3FAFeRPV3xc4SWM5toCtM3o5C1wQc5V6+k4LJ+TydSZpYd69kesVJPXY47MI/eP+OWcRWUuir9mhHIsRKln7AlVwfMRNFUyHdPIgM+A7jJ3WZz81K54XJfb2v/Atlw5d7r1rcx3fy9Qtpv9j30xUba7kgWUu2XhVcMp7QimS08afWVlZWVl5f/N39MRN8Py5nBMAAAAAElFTkSuQmCC",emulated:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAIAAAABkCAMAAAB5NchtAAAALVBMVEUAAAD/c3P/c3P/c3P/c3P/c3P/c3P/c3P/c3P/c3P/c3P/c3P/c3P/c3P/c3MpA9IiAAAAD3RSTlMAq1aBK0RuoSCWC4thFTZMP6heAAABPklEQVR4AezBgQAAAACAoP2pF6kCAAAAAAAAAAC4ujLakRgEoSiigLU6//+5m2oEzWTfFps9D2YmNuEErupCSw/wEpklDK7a4DiFwwoer3+HHT5f/1UDDt8kOEcKE0aLIpwjzvofAMiy/GmIHCMjQYewxhgrZvhT2p59WlKAc6uXzD6HRCuGNhJpMzAB0g8dBGoY3DCYR2IViNuo0CcCEgdibccwKdoaN4Ev0hDQSH5eFWAAflXgArhOC9AU6KnMefx0EGBL+s4U6CtRX13vgd8u6SSPXm9U8xDI1vOHhpTyLsCWBA8BTZcUe5olRhPQHlUV8JmBUKqXFjOBYk/CrQIeLViRYgJw61mMLgIpfJNsowBqU1TAaQgKLWaa06QC3gZCa2vmkAT8BKCxWPnattnMy4p9BJRE+PDJ8A/4AWJiB8PyU8H6AAAAAElFTkSuQmCC",strikethrough:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAIAAAABkCAMAAAB5NchtAAABEVBMVEUAAAD/AAD/AAD/AAD/AAD/OgD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AQD/AgD/AAD/AAD/AAD/AQD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AQD/AAD/BQD/AQD/AAD/AAD/AAD/AAD/AAD/AAD/AgD/AAD/AAD/AAD/AAD/AgD/AAD+AQD/AAD+AAD/AAD/AAD/PgD/HQD/DAD/AAD/AAD/AQD+AAD/AQD/AQD/7AD/AAD/qwD//wD/xAD+dAD/XQD+ngD+WQD+2AD/EAD/fgD+HwD+cgD+yQD/AgD/gAD/MQD+RQD//wD//wD//wD//wD/hAAqGgnhAAAAW3RSTlMAq620sAOvqBEKoraSgg68sp1ZJQaln3t2cV0wGRWGlYtWTD84HgjAmGxoQzQgG7iPZGFIOy4sKYgju7urmpRpT01KRjIJGQ25srGkoqCNfWpXU0EyHmExKygcO7Wd2wAAA/RJREFUeAHtmmd+4kgUxNVB3aCAkASSyAgYsgkYjPE4h/HkPBv2/gfZsOrW7gVqvvC/QP9e+XW5qJZx5MgRLGE9aBSMn0YxXPu2PE8Xxk+i4VIiCLHGtcHQwFO661bL5B8kOb/bG1jMQ+AwSv6FjvwZehVOaoSq8z2SDMDnV7axpebnNKrtTANK69TlgmSUo/qiYkApBD4V2fy23Z61DCy7JGLZ+ouyPO+b4PEHMbfV9nM5CYvY21e6dwRR62c7wQsDy4t6h7JsfCZXvRL49oXTqqfkpyKeo+UfuFp+uvQnDfTt/+pIpi4/idZNsPzNdDwS2fik3O2DzWe4rxENs5IBeP2KfTc3f+LXzgwshVl7yfL5U/D4ZmFD9fGcur2mgeUx8alaP2q1+2j554nM5xcTtPmaM4cr9xG2E5yA3Wex6UiuxpedtIU9v7i7udLyC687L8KTv5afetZ0Dz6/1OtW1fyMjDcn6OSdrhjV6+/0CiY4e9xIKlTyF/FjycDSb1e1+QsraRhYmr2uzXT0jOrNIdZ8mkEkqFo/1j5FJ/+zms/LmfzMcrfo3mEeU538KZmEFfD/3vvc/PmyUw8NLIf1FdXuI69vi+DoF06rIyU/oTE6eRe3efInbDw9A0ff1u1Kmz+X13Vw9jAXQcfjJMP7cAqW/+nHpxEjGfTyzcfv2PGfP1+8JJqX776B5f/y9oLkXL5+/2AgeXj/+pLkXLz9Av77f3v3X/kvPj9jz//+8c2ljj5s9OnHE/jvf/rB08nL6wQLdPSqX+vkz6qr2xa4dzibjnX0IcLdFsHyN2KqzX9UnYbg4r94ey3V/IxerQ/wJ5/Okiv5uXMPTv6VcJJ3/jaFtX6arWuxbP4yx9c+rdM20+svoqCJlX/YrEdcRx+7C699Gokl1PqxKrz2KT3GQrmvoPIGHb0KPUcnL8pWKfx3/2ZMmDb/LrrzL+6nlke1+7gN+A+/ridIBru62YHfHFrp/1q3zQK8fieBY4vc/Gcm+slpIriWXybzArz2sShVt99PHuG1j0vz+ekG3bqVUovp45ftWQFf+xBt/pbbR5eug8RiRFPbo6Kf+fDL739nn363rDv/0Tht4nqHXx/+MIzmOiJlffucr7jk/+q3V0+G2Zj4S5on/0EJt/7Pf50/nMci/9ykOg0r6M5/JRlVl79Th7/3B47NtfzOfQn85BNOJNfJn8for33M/rksiyz5syjZoZP/rG3bKvhTPwCPX1nUozLJENxFd/7mrhbR3PzjLfpjp0FCvLzzr53A3/v9EdXJ3wkO6Oy1vzsnMlv/aveuZOAZDmpjixBBKDz5aw5pW9r+Ov/YC0+hEaCffI4cOfInY2NXGby88ZgAAAAASUVORK5CYII=",viveControl:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAIAAAABkCAMAAAB5NchtAAAAY1BMVEUAAAAAAAD//wCAgADAwABAQADw8AD//wD//wAwMADQ0ACgoAD//wDg4ABgYACQkAD//wBwcAD//wD//wD//wD//wD//wBQUACwsAD//wAgIAD//wD//wD//wD//wBaVgD//wAiIyFbAAAAIXRSTlMAq6urq6urK1arq6uBq6ura6sLoUB2Fauri6sgYTZLq5YNLwn5AAADR0lEQVR4Ae3aW5OiOheA4aw3B0gwHEDxYGv3//+V3yfVTkMpe99I2FPtczUXqcrLlNRadqne/mJ9ds03uzy/ZGeVXLvdMdLttq1K6H77xO7ap7r+CwbmoMtGV8a4e0OKhOzITay82L2+aaz3VeSmyxe/fgPgKlseIiOhapoA8JWpJX1wU3weeBT1ZwSo1XKuAMbfrw+m0v93MI6B+9TLFmyBYH0ECNrKj1NZOIDiFIB6yftFAmCsPNAOaOQA1Eve3wzXPBXAiRQLFWyBKCIGtMyIYJcqOAPODwHsZYYBK8sUnLvv+6WAIM+VwP0Mx3aZ+8UCwcsTGjAiSxTc7x9UAIe9TJ2ayHBoiYK+A/zkScEdtPUysGUVuIk/hwpgp16kBkr5YQ3POC0jBdCql+gn9w9s4ZgiNDIV4PqyCWTkgW8K4+4zQe9Pzz6TuXqJHAr5puXflK8PyCDKwEdcI/9kH/+8o+ZlAQpw+9vDOYBgZdaB+1kpgOyVa0h1qvh2khn3E5X48MrXUG07GHSXD+aHkQU2w9nggF2rXqY/cnPsh6kY5bkAxz9nydVL5ZuO+vZIbTc3DhvgfDtRA12mllJDNfcf8KEG5yzr1WIuc/MYaFUC7cx74KFTSRyhfP4ObFQSH6BlsNeFKe77uYZaJZF/B2g3mcMa8pQBPvIj+MQBhXgHuKKxTTH8y0sBV5VEBkYcoEc7WhADWboADfjJPl6mDYjTkaQhJA0IgIycgHQBihsjYwz6lAHuSYBKBHDTmVxCTBtQTNYS76BKGLCBz/FXVOvA+bQBtgQo9ic5lQeA0sImZYCUjJWSOGA/+YpqvNwDki4EtjIOZyo/2UfSLQRTDdSrBmjIf03ABcyqAdmzgGrtAAPZrwlogVUD1H8ywEG/agCgkvkCu2rA5h3wGGDhqJKpQc/8eWK1cfgOKGGnktnCYX4dSD8O3wHpA3pwj9P4otIBUq8DU++ADrxMRDirNcchoBJ6B+ygXDPgcRxa+Fo7YPOrAq5QyFgz3UfSj8MK8sQBUcYiXFRCLeCnHwF6lVI93QoD1CqpC1CN7+es0tr9/KpwH4GtSqw9AkSjTQSoVXJtzR9drtaQbR5+z5xcts23mfq7vf0P/dwpM3Idp1kAAAAASUVORK5CYII=",riftControl:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAIAAAABkCAMAAAB5NchtAAAAY1BMVEUAAAAAAAD//wDAwADx8QBAQAAQEADQ0ACAgACgoABwcABgYAAgIAD//wDg4AD//wD//wAwMACQjwD//wD//wD//wD//wD//wCwsAD//wBQUAD//wD//wD//wD//wD//wD//wCz89QSAAAAIXRSTlMAq6urq6urq6urq6urC6tWoaurQIErIGurdquLlhVLNmEagNWoAAAGW0lEQVR4Ae1abZOjOA+cFRjMS3ghZAKEhPz/X/ms4mkisui5ipdh6662P9wdlRvUltot2cnHvxJ/cT2W0/VPBf+8nUd6oD3f9mZxuPUVSVTTrok/z9GDJiCH427hpxbBrfnByI0Niei8U3hX96Lh4DPqmKVw2CH+0a09Q2QgYgaXz33iJ/WPFSQsxe9mUBJRHP1YR8rkvnc/nvX4jCF8bMj2fjztHB+oQwLGvpz2jZ9nTRDTAuP9c6/4URrTKsbyukd8G5KO8/W74+du9bEdYIyZDQSlqjxss/+6Ob4xJloqL7Q5FyLggEWQ/nyo03hDCp9sP1hwU+CJEfFTw3wyseok5/8zLfB8+U0GLVGBgF9hYMYd/jsjiXBw1oBe+XsufSMiA8FxSrkh1S4fRJSCWJjmXJO0EAwNP/ymS18rogYpD4nuh8NIVET8mCI3hiichZExmxwWHToG/gNDj3e7RFcHJ4qOnxsiiw+CpSc2y23iP7IciGjAywqiElWx7nl4zcCSDzql/8gyEcXivXSYjcFwRaCOcGEUhkuz4OOfg7vIZjEv43AhCusIGnTduIBUo+SRgdwGdohmBlw9D1yQZaf5K7yhYv8hDiTyXFjzE5aln31FDa0TC6P0lED+zGS7mI5CEp9aEmCrIgZcK3ikwKMxnEQ1E7EGzIdCbXlCACu05n+5ZPCHvjoshe/GRJOcELkK8BxGPTRN8BNdWnO74MVHUfdF0bE7+dgwAkTYA8Ihko7F+JyMKTCoeOGe4y8CNTH6twmIIhuiy4fESDREIRjA9xs3n0IiBK9yI6OHBMJ58BA1RJOMmJZjwEPBY9FDx02Z+LmACGeCn+8SECILXqzk5vw4YwbZg0D68N244+mBvYDyyBhOIKwKb/Aj8Mq/5YhwmeYRMLD8z+zhCCls8qkg5NCfwLpDmJAjDvG8L+f9CHN2BYwN0bgdgSOaBBpe1xE5QWBOTWWD5EdY6SYEzq5JSBvsmqZLc36OBhtYs4xfRHCSbQhUixLnTuRxupyd5VRiHgZRbkIAG1TCOAoUpMvjM6bTzOm134rAXXg0KMziCxprHNImFmOsIWrfJhCvExjh0RK5dkgLDRp69X43XiVwlZtsyaEL6RVxJN7h2wuWRnTj2mjIB5sEDkmM+JipPt/uhuZ5CLkvbfCfEQWI7xC83ZH7Z6AMPiZtUAdaNLSKRdzeHkgs3iZqMPGgpCI3ZrC2CYIC8QH7thEcRa0T9BLY4CqigiQK6Qo+TiSWOmATwQZXEdALiqaWH07v78P570P8+eerDb4cg9q2LctyKudrXU8RYvATL+9hg916/Gw5+x6OPXzQl8AkFmvQTi9rNojR8/KSw6l9vgJz7TuoRLDYaUi3wZBoPOh26uGEy3RnToY3dIhXxOtXEf4EMPzm4obmKN1pCYMjsEagJhq9jqep2Met2BkSGNw1An7tmIGE44B8Oyo2iMF9awJXueCGqOo1G4RXqwRS7GNvK8A9nVEkUGk93cuJgaOMOBApNqisT/pm4XlP08pt1y073EqvVRtaDR/y2YmpPGMNqwRCSEBr6Q1S5GNGYSTcVrPhSr1j8KwAcKieabdEnS4BxcxrpQI+Ooy1RtRB4lor8K8AdAgrijQJnLSzhVIBHx2mWiNiZv/3nsugAv46zDnR2jyeaTZ7/toEMTqFvw756B9o02CiSWB0f2EJJfLE5L4JUQ8EhfL+1omGt8B9g6+uM9JdgJQCUOqG9cuHP3BBzSi0CvQKa5ZgIzulP4NxMWMD6JLT2hZ0m8YQFOIPfE1AjbIHxvWcFZFvATRJW2UcLX+Nf/m6Re38ruoVTQ+KBK+rP3cZXHqUQ7HXhGqUA1lfHk+HOVW3kRipi88etQ14U69KEGj7cjpd7xXNl/cp+RdA72xLpLSGJN/85y24tltxQWtSG8Q0I7QRiuP/5bU+3i2RPQem3PGIM9zRbBof490rYmVMjdyPvBD/2wiwzeVKeLTgDUsQr81i3UpdHuGrcqvQ+vVc/utJKTJZsdkPSNSjMpAQIw4SmxqT2iTg2N8UHle0igkB24fXL6ldo7nQCy7txuH1a/rENZrD6VSWfdv25e10+vhO3FEDeS23H/CjImDAtdyOuAgGA67ldgPGss7ybTih0e2MMwlIxe3PYOynjz+CW8k4Xj/+Q/iL/wEs0FUtYkz0LgAAAABJRU5ErkJggg==",daydreamControl:"data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0idXRmLTgiPz48c3ZnIHZlcnNpb249IjEuMSIgaWQ9IkxheWVyXzEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgeG1sbnM6eGxpbms9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiIHg9IjBweCIgeT0iMHB4IiB2aWV3Qm94PSIwIDAgMTAwIDEyNSIgc3R5bGU9ImVuYWJsZS1iYWNrZ3JvdW5kOm5ldyAwIDAgMTAwIDEyNTsiIHhtbDpzcGFjZT0icHJlc2VydmUiPjxzdHlsZSB0eXBlPSJ0ZXh0L2NzcyI+LnN0MHtmaWxsOiMyODI4Mjg7fS5zdDF7ZmlsbDojQTBBMEEwO308L3N0eWxlPjxwYXRoIGNsYXNzPSJzdDAiIGQ9Ik01MC42LDExOWgtMC4yYy0xMC4xLDAtMTguNC04LjMtMTguNC0xOC40VjI2LjRDMzIsMTYuMyw0MC4zLDgsNTAuNCw4aDBDNjAuNiw4LDY5LDE2LjQsNjksMjYuNnY3NEM2OSwxMTAuNyw2MC43LDExOSw1MC42LDExOXoiLz48ZWxsaXBzZSBjbGFzcz0ic3QxIiBjeD0iNTAuNyIgY3k9Ijc5LjkiIHJ4PSI4LjQiIHJ5PSI4LjUiLz48ZWxsaXBzZSBjbGFzcz0ic3QxIiBjeD0iNTAuOCIgY3k9IjU4IiByeD0iOC40IiByeT0iOC41Ii8+PGVsbGlwc2UgY2xhc3M9InN0MSIgY3g9IjUwLjQiIGN5PSIyNy41IiByeD0iMTYuMSIgcnk9IjE2Ii8+PC9zdmc+",gamepadControl:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAIAAAABkCAMAAAB5NchtAAAAYFBMVEUAAAAAAAD//wDAwAD//wBAQACAgAD//wDw8AD//wD//wCgoAAwMADQ0AAgIAD//wCQkADg4AD//wBwcAD//wD//wD//wD//wBQUAD//wD//wD//wBgYACwsAD//wD//wCi9gSrAAAAIHRSTlMAq6urK6urVquBoaurq6sLq6uLq0AgFZarazZLq6t2YfI1sDIAAAUFSURBVHgB7ZnJdrM6EIRDScwDiBkP9vu/5ZUs+lpxbEmELP4F3y7nGLro6kGQrwMHBwcHBwcHB7yPJSe++cKRn+WFZz7uCD6eUxBIz7X/ladlAjEtp1+GX/DC4vk0PUUnpn57+PqOB4JFEpZAkcU+prV4wHJ5Yc5WCVs9HCZIyq4KVqpOQNI6kxBDkc8BMedQ3DfF7zMVPgy+cREAshO3skDSBN9pILnVG+JDEgU/aOBDWQSvFCWA1lvBACApgjdcEjjJybRcQOTkYQ5g8a2/7Gd8omAuGrJea01CQ0HsJyCl+HuoKFeJmYPBa4gAuAR7yVW9ymI2KlIAqY+ACbgGRIiVYCMl0OtyZua9uF8Cqv0CAIxrPQdE7pWCG9XxPgEMOMu7nSkDigrA2dkCAApTgBL9CwERgJjHAKJvqlIPB0SwS0CVJ0BJEwPJfAUSPQ86YHKPcirbC5OUJIApfJqzWCOX6xxoQPNAe+AxBC6URAUJeBAGbgRWLp2U3M1YSQKJRx9kQLFHwOVRaGMLlIHiCrT8i2e6Fhhwctfgs4wWLpHTiytaLwFXvXhHuk8C8Oc8aJzjmAMlCXj5ceolgJ6RBKyucy2gA252AWfg+hSQxpJeVqZi8hLQ6BCcBAjd+nd93xBonU0QBXtqIARw43H2CFisS5AvtF8AeDXBji5gVPUdA8DmBJrSmNAWjDyHkSQnAZGiCrwVUP+jERRfwVx9SNbtGcVzzlgXQpJBUnRXdqW05o424IB4FdByvk0ARZqGx+E6f1kRd8cmYAGxaxsK3Y4nSv7KDKR+m+CPzgPjOoOJAsgch4Hu/SE02AjTZsdmSj36kKbdfjoAS7/g9YmEvQ0AOFottAssQrq+NPqfcK6j0WF2yCBhHzXkCQARkYIf8Z3riAPMOudXGutRhILODWvmN9bc7KvIbivaFpLo06tIlpKCD4TWPrzTrd9RrW/nY/u+UnJ95q1juO5ibYLZloCp/pLUE9C97fyehomwDojavYosJ/3/D/vMpAhC0Im3tvZSaetDaxPQIqNahUlomps6nqO3fBdIAteVdMCrYBLRYYcOtrY3lti6iixXUoQUaPSe1CxA8xDESV9i7aWb3yp6pVq/89TLw+MGWL69TTEg4+qvDMh/14cLEDnmUJammZ5EydPLGsr0ApI2bUEJ2NqH9uKZI9XpK/nDkMxUXhofkJIimK/b+9BePAku0j8BiehUIs1aGrSogml5lZrKoU8f+nfhdd2rRRgW69ey9tsI1b5XYRiuW0Fs70P++aoZClbQCziAbDCvbc0PmxEUjX8furuQ3C2jrosYnvGJuoVENNElutKPQ/8+dHXhVQW8wSAdfy4yg2logdK/Dx1dOOs9x1OstO9MHBZQ+Lh+1GXk34f2LkxI89jHyxL3n16u6lN8v8XxQPn80FMA/LuQDKCYG5iAclsfArAYsBlumOB1Lh0AYTFgO3cywfNcSifS3QYQNZngOQgGINlvgMMEyoD/WwkZsN8EdxG2QOdrgL8J4t0cqD+9FYg/M8Bck4Trm3mdvVpW7TKAxtH8OonRW359eXErq/2j+fz/p6BF/pYWZg5CATUy9jFmQNI9PU1okX40AeJC//CkZO1iyACw9Z7Mfk9a6xCMAbvjmwqAkpVQZI6cxhlApJSrfdQLntxG58/PrVa68K+/YrxPUEzL4Jk1zuuvP4bTPf81Dg4ODg4ODg7+AwlERtddq/a6AAAAAElFTkSuQmCC",fullscreen:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAIAAAABkCAMAAAB5NchtAAAAUVBMVEUAAAAAAAD//wCAgADAwABAQAD//wD//wD//wDx8QAQEADQ0AAwMACgoADh4QCwsABwcABgYABQUACQkAAgIAD//wD//wD//wD//wD//wD//wCYxtj5AAAAG3RSTlMAq6urq6tWK4Grq6urq6urq6urq6tAFZZmiyDXexdmAAACxklEQVR4Ae2a3W6cMBCF6wMkMeYf2qR9/wetdiPnDJtEYs6ialX5u9obW9/i8Qwe82NPofDz6Vt+/ZN5XvAtzx4BYZ7HEeirLxgcAto8HNiEL6h9Avo8RaAIPJRAY0h+gakhmyTQn5aIYqctQcJJLGIMbBGnsMpBuOAMkhKEU7hSAZiDTpuA2L7/nF0C6LIxI0igx8cTHSufQPaOQGqDyAygys/SKYA6XGkAjEGjg53GJ0D1CcCkBcAADHyQXgEuHgAlDOzAGopA3D7+SBTCoOKjWyEJINml9GKCZ4EogNUGsw+zfbaoCawAFrudXZgEkoCYBIHrwI4JbQsOLvYz7ZdaEdj4FLvLz3AErnrP9VuDJBAaTrMwIg6w0feiXgdRwNYiRsQB8oqxGikCOYGYUKqOMVJ2vIavLtBGYOBmcr+DTNx+mkDomE4aHKcOZrRXIPOpFi3VYdrbalQj4xLgKiowgnQBxrEX7iGHAHnOy8idLFWj3sg8cXqPAGuRXI10gUyvvJKMrEaygH23aoQInMJJAqHWBJoiUASKQBEoAkXg/xFImsBylsAETWBozxHopD6VHaULmNORB56K3AJvL1d+A3HXapC7lHxDfH1554/vXKB3a+2JQj+Y2Lf7rjkM2xq1S4A3HVmg3XVJjmK7I1UW6Hnz4jgd7/pEDmx/SD6ef+411ccYbrpbusCi9QpveoRJFOBodku1LumqCiS5X3zTJ14kAUaQs2POAYxjRWDe95om4a6AYZAEAWYRoRrddreiIJBXndVIrUWV2q5vbK/JzWhmkASs/3znnWFUBGpbjQRsLWoEgeH+i0OTPSe/gN3FQcRmEq/AZG8+VFqbS30Co7350OlMNfEJMIkN1T30TKetQyCTzv6AwinQ4xxipwnM2PH25OAVltRKAtN5X9N1FChfUhWBIvAAH7WW74of7NPuQuEvZ9lH5JznAfgAAAAASUVORK5CYII=",world:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAIAAAABkCAMAAAB5NchtAAAAzFBMVEUAAAD//wA5OTlMTExGRkZBQUFTU1NiYmJZWVloaGhdXV2cnJvQ0BCqqqr09AOLi4vp6QeenhxLSzpbWzR0dHSurimysrGioqLa2gmUlJSBgYHt7Qvh4Q9iYjl3dyfY2BfCwhFMTD2mpifJyRu0tBRwcDFrayqHh0mIiDGEhCT39wOTkzW7uxmoqBhOTi96elN8fDxra0CRkSBgYFDX10qZmSjBwSDr6ytKSj5JST3ExEyzszOAgCGbm0O7uypNTT1CQkHFxYWoqHdBQUF5xNXLAAAARHRSTlMAq6urq6urq6urq6urq6urq6urq6urq6urq6urq6urq6sLq6urq6urq6urq6urraurq6urq6urq1Z0q6urq6sgRaurkO+wxToAAAiSSURBVHgB7ZgNc9rGFoZ5F4RDortZSVGuXEkgEGC+P7BxndiOm/b//6e7R0cSi+VprzDOnTvjp51px+OZ98l7zi5LGu+8knfesf743+Q+WZZY7YYqdZylPdxPRrHb/3Xpljd17KXjhAASH4DttlqW5tuvSHe7duKMXMvq+hI59u0iHWya2qL1xhPpe8NlLCzLnSRysW1tfTUYDNJw0mzGk4W091uSeMP4qTMWOj5eSDVxW83mVqZNzQDpdVOz0T8fxM03U/ASj+JHNtSk1WrpxAjzZrPdbs8hJ+2MeYR08zYK35Kl0PmxDTng+OYAuM5zAb/NbGzYm+35z0R3Bl2/uwDsOM/fStgc+uGDD/SuPxBaIUIkJ9Z5p/+QAInoSsh9i/KJW2CQpRO3QKQN2GGugH3rnPU/CBtAAKi4zN8C2HA8ER0MrrUNok3rbGOwhBA7aGbRIb89AJAnftSsJRno/7nm+2EGv/XHufKJBTLSScz5bQmEHM/MAUTrxxQZ8+sIkXt3vvwpEIJR6WCyaVNez8i/uLLDUILprbO1UNu7c+UvASxiX+GAVCr64RO9Xi/CgdntWgtpgzkkG7w+f0j5lh7/dp8q/A2zMF1fXFx8PBg8vXL/BeFk+Va+gPFmP0gjiSPCXu/et6HRAprSIO6/6vwX80dQ5PMGtjnrKoMiO8Q6U+k8M3iNgCDGAJR7EGhrrkHQ7hGdgntoflwcGUStVy7ASgKIOb9VFDCBJuL8zoEvM2iujA7aPhYnXwdPrs53AwA7yyiAuIWmZ+R/Ye55CKaBjcmpAt3iANrWQYANwrJrTv+tYAbNfWlAF7OUo9PyV3a+ANKjfLOBLQif83X654LfvoNYGwbtDeRpJ2GohHAVAMcooJ0JzHMBzufsS/4PiFT//DCEBbqn5LvAMLsBlKhM4BbEVZl/eXn56dOnS3K4KSrolBWkCE+pwAOQQDOyKg1ELJDnUzqjHf6sVKBtZ/EpR1ACkIAtrOcNfEDGmvOz+H9rWCE8ruCKZFVUvwK+AIFwxxMwG9gggwoo8v+lYYfvZgVXPCwf8SmXMBtA7bxnKzBABhdA8TqfIYOynrUfIWPeVotTLuEVJJjAH5kr8IO7KQrg+CyfDHgNf9xHYKI1HZu7EwSGwIwVWGKyyRvogeh1OlkBnP/161d2oBlIiYLwkZ6p1zKuP4FsC3fjIQyU7evnEFiAJpAX8DXj58+bm99DGKTz7DZsNxdJPQGrWAFXCHe6kC+8PELV633//v1GZxIv/Ir92CnuovYW/doTSAAkQmNZVrxfBKjBTM5mfA5ygaby6gq40ExZgE+BfgnZEf4B+fvNDTIejwQWk7oCXZ6A5vgiut7cypCIer2QIzP0LH7+/JqtoQSRUn4pMPHr5Lf4DPAEKjdhiox7XkLewRwW4ArCI4EYdXdQAdhVBOgisAuBjnEKmPIgElemQFP1T1gBzxQoK5AoPou+lPeAWcCnP5Hh5/ksYHv1BMbQiIoAVYCDQF6Bpvzza4FLZNweCQxqCjgAbEPA2EIUDRdXIRkUUP7nCER4JLCvcxe6vINLUalAszEEik+jMp7yL/NXCcp8Ehh16z1HbQC7fxAgg/I9kMdTAZ/LLTQF6lwEy5UIAIzFSzOYlwKFAStQOr/LfntExuPHwwSak24dgcCFZlURIIMBmPVHNjh6lF3S0/jLFTJ8owBXjeoIIIBGFLwo8OFjaaAVmM9ZfqeDjJTyWWAbYVpnB4DZzBQwDUqB3IAVGIrX+blAryxgL4E6DVgKgJy9LLAwBD4++25E8ZqLXi7ABcwVgKDWPeBJaJTz0hbYhYDG+Hr6hehkXLAA/8p2oED53ToClnBDZAQ7zxQgCoE2G7DCgQsiF9DpETJSd9eowZ0Qh+egGk4906AUYANW0OThhkAYglHzlrWr+R5QgFQokLYzHbGBIWAqGOi/NEzDkP05vtlsWd2aAhQjvKGsPElHQSHABqzAFuurue/3IhjIW3pLt1rWqKZAQgKa8TJAFaVJB4OBz9z2NBIVlD+hS5AEXK/mq9jhBxnhdpc2aqPCGZWU51vdp5rfC7r8WVASd53kv9SIUt9GRpnPK1AHseI3sYmlGY32gdJU+pZ2r/fD96+urj9oWMDmfCrA8mp/O1eAUxEgbDBNpm1C9x6RCxj5d7W/HQ8Bu4zO/hVVgaqCKbAoB8ATqAUtgRTPOBJoFfkvOEgQgzKfz0At/hIS8ESlA0OgZSocSTSRMSnyrW6/URuawU4851iADdiBLZgtMmKKp3wRN+pjjYFAiGoHS0OAFQwJ/mcCQlI+CYiHmgUwXQWsRAXLMQRYocIARMrxJxTAeDbgVCsQhYBVGFQdUhD7It+pXQDjSCjxDMsQKAwqEi0JIuZ81/Yap/GkZrPpcToxKgQ0h3jTJQYRcLwjh41TcSVCp7IGhYBrmQqmx54nYFmW50gEd42T8SSAZLo66sAFM7JyWs9JQXjeJAGQWI3T6Tv8MAuWXVeUHAtUJdgwCKCxx6LxGu4CDBNkqMQZe4IIqgIm3jJUEhnDsRD9xquwJDx3mkjkBPbSKQSEOModjSaObwfIkcmUWvuj8UpcGQiNt0sUDFimAM+QSj6IjG+NV+NhKBh3vFvaAf4WZfMbcnimfDaYChP3ATOlCWwDx3F2o5FLXUEj3fPkM55kgxIFwhEvMoRmeq585k5NqxmwxUusDgPoN85Gf3lkMH1JwOKb2gYQZANonJXx0NwCENLILtkVC2A1zszdcixKEhCCMSU8yvfEatVvnJ+u44mcMYhxdQEkEKy6D6vGm9DvRsVngl2uuokbAPYi8RpvRj8eyiBxuuMx7/oR44dIyZnD8W+HpS/lAEColHJyEju7IFW0WH1r/AIsPexxcrgLh9qh6wSLMaf/Ep4sMXakLNfQi3nvfz1/3TX+z3nnnXf+A3ZJ6hYGox7HAAAAAElFTkSuQmCC",
gear:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAIAAAABkCAMAAAB5NchtAAAAYFBMVEUAAAAAAAD//wCAgAAwMAD//wD//wDw8ABAQAD//wDAwAD//wD//wD//wD//wD//wDg4ACgoAD//wD//wDQ0AD//wD//wBgYACwsAD//wBwcAAgIAD//wCQkABQUAD//wBkLwXoAAAAIHRSTlMAq6urq1ahq6uBqyBAKxULq6uWdqtri6urS6urNqurYepOiRMAAAQVSURBVHgB7ZrdkqI6F4a/PIEAQeQHAVGx7/8uv90VndG9yMGQNFO7yue42/VWsv7D/z58+PDhv0tZ3VJHVR13t37oeKf42lXEDcltTwEpkFm76G8WawHSPQUUcFevaBj2FDBCrl7Jofhxqy9eBqg3EjA/bH7uKMpnBEKm3gF+xWdPN8c2XxcAPH63AqveaaB6RCgARR036XQ4+tpFoRBgH3FYDzhMGTPsDXDOG6Ar/3GGHlr1zuLElSOQ5S1gDvHSHsBFKXUG+OoBcvXOxaVDcIczZcAhov0sf5pxtOrfnHigXVhIBUH2E+VIGoCTVpJLA9DkL38ZRUFpnvYd03m5qnUSraf3M6EKzz7O/haSDExwjRyd/c0Kxjq87E1qK3fgK+wCgEVtRwNlYAQ0KoRT4BGUQKICyCCsLnVwUtuxwXFQAecgFzhE6P5atY2cGI3aAORqEy4NBDP63OC+WIDM6nU/bSM1BUdASXTGb06TkkQrhwZ5B/eMd07iFBIg2hQkTxcww+07xMpDD2sZu4l0Ar30gRNg5pdbGgC0DMIxsBWuDmk/Anf1Riu73qqTZ5AA45DOG2fnsjc8sDK9DELsKMP1zJOu2hJ9HvvXp32poJGtsmNDQi4BTlZfcumAdPX6fwg3uN61Plu2BOQBrFrj6u30Usi8NSHdUAO0WmPxzsG1ce4qmaDfEHwXX4vhO84vUbcChvfCV4IAX4GpfP1TAl0sATn4fwtQqwAbWqHkj0+zgzyWAODPr7P42wJGyHe8ggAfCHDCK+DNnnsIUJl/JzqD9d9brETUwuC/totfQKxUfAeO3tbp6qsFQ7RipBpPYq877wTRQrqpHNtWa9mPeorrgDyAaz7p1rJpVVLgW0idVxUMgPYtrjD1nzeEg+HBSV4Cs7SPFUqf9OW2kaRKXVM6ydUL/asnViNSpwKKwjWlIXzJ+ThpAIbb0/0L1uxPMEbZ0stO63m6phjSvgCAZe1v5livE5NMBw2v2FwJRMKIvKa5txmOpk3UCpHekeoOrFonyS/6ksvsF3U877fvqTIX/2HMwCVgU1qEO0DAkmoKdwMTtqlsQyPhFrqobGD+q6vac+Ad1ECrtnMBDrsFgSQB+ghp4K62cc3cKiGIOuDJ5ASmjP9otSw+Pcli9fXNfvxns+QE0Kw9nOkGILsL+3EUTM/k6pDZoX1vIZNGvBeFKUD/fp81IJskgGE2j63tXTychiuw11/rrlTmJ+12l8cCyKYFYT+M44ijc14N+FJeisNUcT9gGADoH1EtZxALD4uVARiP8T9dorvJ2VkI+F5dmy794Y9YBrhE7UCDZ+crsKN9+RHJBMWeAiqAxp71N609wc5fUtUGQbXvx4R9xyum39W+o6rm9Ju52t/4hw8fPkTk/7PwOIFSnWjiAAAAAElFTkSuQmCC",backArrow:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAIAAAABkCAMAAAB5NchtAAAAJFBMVEUAAAD//wD//wD//wD//wD//wD//wD//wD//wD//wD//wD//wD1AQnGAAAADHRSTlMAq2uLC6EgdjuBKxXxMof/AAAAfElEQVR42u3ZMRaCMBREUX5IQGH/+8XC0tbMUe7dwJsiqf4CAAC/4NzH+gj2t1EvR7hfe7hfz3C/Qo+gr+9+09fX19fX19fX1/++raZpffmgJmrpAXX7AS3+CPPf0AILLLDAAgsssMACCyYcLAInm8DRKnC2Cx4uAQDgX12bvgZPVbPIBgAAAABJRU5ErkJggg=="},this.util=i,this.webgl=o,this.webvr=a,this.controls=null,this.vrButton=null,this.fullscreenButton=null,this.worldButton=null,this.poseButton=null,this.exitFullscreenButton=null,this.exitVRButton=null,this.bubbleArrow=null,this.styles={controls:{position:"absolute",boxSizing:"border-box",marginLeft:"auto",marginRight:"auto",left:"0",right:"0",width:"332px",height:"84px",zIndex:10,opacity:.5},dialog:{zIndex:50},button:{backgroundSize:"cover",backgroundColor:"transparent",border:"0",userSelect:"none",webkitUserSelect:"none",MozUserSelect:"none",cursor:"pointer",position:"absolute",top:"0px",left:"0px",width:"64px",height:"50px",padding:"12px",margin:"8px",zIndex:100,display:"inline-block",transition:"left 0.3s ease"},emu:{zIndex:101},strikethrough:{zIndex:102},progress:{zIndex:7999},menuContainer:{cursor:"pointer",position:"relative",maxHeight:"180px",overflow:"hidden",padding:"9px",zIndex:8999},menu:{width:"100%",height:"100%",margin:"0",padding:"0",borderRadius:"2px",overflowY:"auto",lineHeight:"18px",paddingLeft:"0px",paddingRight:"18px",opacity:"0",transition:"opacity 0.5s ease"},menuItem:{margin:"0",padding:"0",border:"2px solid #abab00",backgroundColor:"white",borderBottom:"0px",opacity:.75,listStyle:"none",textAlign:"center"},menuActiveItem:{},menuContent:{},spinner:{zIndex:9998},tooltip:{position:"absolute",fontSize:"14px",lineHeight:"16px",fontFamily:"sans-serif",padding:"4px",padingBottom:"0px",borderRadius:"9px",overflow:"hidden",whiteSpace:"nowrap",left:"0px",top:"0px",backgroundColor:"rgba(248,255,164,0.7)",zIndex:"10000",display:"none"},bubbleArrow:{position:"absolute",width:"0px",height:"0px",border:"10px solid",borderColor:"transparent transparent #880 transparent"}},this.util.emitter.on(this.util.emitter.events.VR_DISPLAY_FAIL,function(){n.ui.mode!==n.ui.UI_DOM&&n.setControlsByMode(n.UI_DOM)}),this.util.emitter.on(this.util.emitter.events.VR_DISPLAY_EXIT,function(){n.ui.mode!==n.ui.UI_DOM&&n.setControlsByMode(n.UI_DOM)}),this.vrHandleKeys=this.vrHandleKeys.bind(this),t&&this.init(this.UI_DOM)}return i(e,[{key:"init",value:function(e){e||(console.log("no mode provided, setting default"),e=this.mode),document.addEventListener("webkitfullscreenchange",this.fullscreenChange.bind(this),!1),document.addEventListener("mozfullscreenchange",this.fullscreenChange.bind(this),!1),document.addEventListener("msfullscreenchange",this.fullscreenChange.bind(this),!1),document.addEventListener("click",this.clickChange.bind(this),!1),this.createUi()}},{key:"initNoGL",value:function(){this.dialogMessage("WebGL is not present on your system")}},{key:"initBadGL",value:function(){this.dialogMessage("WebGL is present, but failed to load")}},{key:"setWorld",value:function(e){this.world=e}},{key:"setControlsByMode",value:function(e){switch(this.mode){case this.UI_VR:this.vrButton.hide(),this.fullscreenButton.hide(),this.worldButton.shift(!0),this.gearButton.shift(!0),this.exitVRButton.show();break;case this.UI_FULLSCREEN:this.vrButton.hide(),this.fullscreenButton.hide(),this.worldButton.shift(!0),this.gearButton.shift(!0),this.exitFullscreenButton.show();break;case this.UI_DOM:this.exitVRButton.hide(),this.exitFullscreenButton.hide(),this.worldButton.shift(!1),this.gearButton.shift(!1),this.vrButton.show(),this.fullscreenButton.show()}this.worldMenu.positionMenu(this.worldButton),this.bubbleArrow.shiftCenter(this.worldButton)}},{key:"hasPointerEvents",value:function(){return window.navigator.msPointerEnabled||"PointerEvent"in window}},{key:"hasMouseEnterLeaveEvent",value:function(){return"onmouseenter"in document.documentElement}},{key:"clickChange",value:function(e){e.preventDefault(),e.stopPropagation(),this.worldMenu.contains(e.target)||this.worldMenu.hide()}},{key:"createUi",value:function(){var e=this;console.log("entering DOMUi");var t=this.webgl.getCanvas(),r=t.parentNode;r.style.margin="0",r.style.border="0",r.style.padding="0";var i=t.parentNode.querySelector(".webvr-mini-controls");i?this.controls=i:(this.controls=document.createElement("nav"),r.appendChild(i));for(var n in this.styles.controls)i.style[n]=this.styles.controls[n];if(this.hasMouseEnterLeaveEvent()?(i.style.opacity=.5,this.controls.style.transition="opacity 0.2s ease",i.parentNode.addEventListener("mouseenter",function(e){i.style.opacity=1},!1),i.parentNode.addEventListener("mouseleave",function(e){i.style.opacity=.5},!1)):i.style.opacity=1,this.tooltip=this.createTooltip(),t){var o=this.webvr;console.log("creating DOM Ui");var a=this.createButton("vrButton",this.icons.vr,0,0);a.tooltipActive="go to vr mode",a.tooltipInactive="vr mode not available",a.inactivate(),a.show(),this.util.emitter.on(this.util.emitter.events.VR_DISPLAY_READY,function(t){if(t.displayName){var r=t.displayName.toLowerCase();r.indexOf("vive")!==e.util.NOT_IN_LIST?(a.src=a.src=e.icons.htcvive,r.indexOf("emulat")!==e.util.NOT_IN_LIST&&a.emulated(e.icons.emulated)):r.indexOf("oculus")!==e.util.NOT_IN_LIST&&(a.src=a.src=e.icons.oculusrift)}a.activate()}),this.util.emitter.on(this.util.emitter.events.VR_DISPLAY_FAIL,function(e){a.inactivate()}),this.vrButton=a,a.addEventListener("click",function(t){t.preventDefault(),t.stopPropagation(),e.vrButton.active&&(console.log("clicked vr button..."),e.mode=e.UI_VR,console.log("from dom to vr..."),e.setControlsByMode(e.mode),addEventListener("keydown",e.vrHandleKeys),o.requestPresent())});var s=this.createButton("exitVR",this.icons.backArrow,0,0);s.tooltipActive="exit from VR",s.tooltipInactive="",o.hasWebVR()?s.activate():s.inactivate(),s.hide(),this.exitVRButton=s,this.util.emitter.on(this.util.emitter.events.VR_DISPLAY_READY,s.activate),s.addEventListener("click",function(t){t.preventDefault(),t.stopPropagation(),console.log("clicked exit vr button"),e.mode=e.UI_DOM,e.setControlsByMode(e.mode),o.exitPresent(),removeEventListener("keydown",e.vrHandleKeys)});var u=this.createButton("fullscreen",this.icons.fullscreen,0,72);u.tooltipActive="go to fullscreen mode",u.tooltipInactive="fullscreen mode not available",u.show(),this.hasFullscreen()?u.activate():u.inactivate(),this.fullscreenButton=u,u.addEventListener("click",function(t){if(console.log("IN FULLSCREEN EVENT"),t.preventDefault(),t.stopPropagation(),e.fullscreenButton.active){console.log("clicked fullscreen button...");var i=Math.max(window.devicePixelRatio,1);e.oldWidth=r.clientWidth*i|0,e.oldHeight=r.clientHeight*i|0,r.style.width=e.util.getScreenWidth()+"px",r.style.height=e.util.getScreenHeight()+"px",e.requestFullscreen();var n=new Event("mouseleave");u.dispatchEvent(n)}});var l=this.createButton("exitFullscreen",this.icons.backArrow,0,0);l.tooltipActive="exit from Fullscreen",l.tooltipInactive="",this.hasFullscreen()?l.activate():l.inactivate(),l.hide(),this.exitFullscreenButton=l,l.addEventListener("click",function(t){t.preventDefault(),t.stopPropagation(),e.exitFullscreenButton.active&&(console.log("clicked exit fullscreen button..."),e.exitFullscreen())}),this.exitFullscreenButton=l;var c=this.createButton("worlds",this.icons.world,0,144);c.tooltipActive="Select a World",c.tooltipInactive="No Worlds Available",c.activate(),c.show(),this.worldButton=c,c.addEventListener("click",function(t){if(t.preventDefault(),t.stopPropagation(),e.worldButton.active){console.log("clicked world scenes...");var r=e.worldMenu,i=r.buildList(e.world.getWorldScenes());r.activate(),r.show(i)}});var h=this.createBubbleArrow(c);this.bubbleArrow=h;var d=this.createMenu("worldMenu",null,0,0,null,null,h);d.positionMenu(c),d.addEventListener("click",function(t){console.log("CHANGING WORLD FROM:"+e.world.getActiveWorld().scene.name+" TO:"+t.target.innerHTML),e.world.switchWorld(t.target.id),d.hide()}),d.addEventListener("touchstart",function(e){console.log("start touch")}),d.addEventListener("touchmove",function(e){console.log("touch in menu")}),d.addEventListener("touchend",function(e){console.log("end touch")}),window.worldMenu=d,d.hide(),this.worldMenu=d;var f=this.createButton("gear",this.icons.gear,0,218,null,null);f.tooltipActive="Configure the display any old way that you want",f.tooltipInactive="Cannot configure",f.activate(),f.show(),this.gearButton=f,i.appendChild(a),i.appendChild(s),i.appendChild(u),i.appendChild(l),i.appendChild(c),i.appendChild(d),i.appendChild(f)}else console.error("Ui::createDOMUi(): canvas not defined")}},{key:"createUiElement",value:function(e,t,r,i,n,o,a){e.className="webvr-mini-"+t;var s=e.style,u=this.styles[t];for(var l in u)s[l]=u[l];return this.util.isNumber(i)&&(s.top=parseFloat(i)+"px"),this.util.isNumber(n)&&(s.left=parseFloat(n)+"px"),this.util.isNumber(o)&&(s.zIndex=parseInt(o)),a&&(s.display=a),e.draggable=!1,e.addEventListener("dragstart",function(e){e.preventDefault(),e.stopPropagation()}),e.shift=function(t,r){var i=parseFloat(e.style.left);r=r?parseFloat(r):parseFloat(e.style.width)+2*parseFloat(e.style.margin),t?e.style.left=i-r+"px":e.style.left=i+r+"px"},e.active=!0,e}},{key:"createButton",value:function(e,t,r,i,n,o,a){var s=this,u=this.createUiElement(document.createElement("img"),"button","webvr-mini-button",r,i,n,o);return u.name=e,u.src=t,u.tooltipActive=u.tooltipInactive="",u.hover=!1,u.addEventListener("mouseenter",function(e){var t=e.target;u.hover=!0;var r=t.style;r.filter=r.webkitFilter="drop-shadow(0 0 6px rgba(255,255,255,1))";var i=t.parentNode.querySelector(".webvr-mini-tooltip"),n=i.style;i.status="visible",t.active?i.innerHTML=t.tooltipActive:i.innerHTML=t.tooltipInactive,i.tid=setTimeout(function(){"visible"===i.status&&(n.left=16+parseFloat(r.left)+parseFloat(r.width)+"px",n.top=2+parseFloat(r.top)+"px",n.display="inline-block",i.t2id=setTimeout(function(){var e=new Event("mouseleave");u.dispatchEvent(e)},3e3))},900)}),u.addEventListener("mouseleave",function(e){var t=e.target;u.hover=!1;var r=t.style;r.filter=r.webkitFilter="";var i=t.parentNode.querySelector(".webvr-mini-tooltip");i.status="invisible",i.tid&&(clearTimeout(i.tid),i.tid=null),i.t2id&&(i.t2id=null),i.style.display="none",i.innerHTML=""}),u.emulated=function(e){if(!u.emulatedImg){var t=document.createElement("img");t.style.position="absolute",t.style.top=u.style.top,t.style.left=u.style.left,t.style.width=u.style.width,t.style.height=u.style.height,t.style.padding="0",t.style.paddingTop=1.8*parseFloat(u.style.padding)+"px",t.style.paddingLeft=2*parseFloat(u.style.padding)+"px",t.style.zIndex=s.styles.emu.zIndex,s.hasPointerEvents()?t.style.pointerEvents="none":t.addEventListener("click",function(){var e=new Event("click");u.dispatchEvent(e)},!1),t.style.display="none",t.src=e,t.name="emulated",u.emulatedImg=t,s.controls.appendChild(t)}},u.strikethrough=function(e){if(!u.strikethroughImg){var t=document.createElement("img");t.style.position="absolute",t.style.top=u.style.top,t.style.left=u.style.left,t.style.width=u.style.width,t.style.height=u.style.height,t.style.padding=u.style.padding,t.style.margin=u.style.margin,t.style.zIndex=s.styles.strikethrough.zIndex,t.style.display="none",t.src=e,t.name="strikethrough",u.strikethroughImg=t,s.controls.appendChild(t)}},u.strikethrough(this.icons.strikethrough),u.activate=function(){u.active=!0,u.emulatedImg&&(u.emulatedImg.style.display="inline-block"),u.strikethroughImg&&(u.strikethroughImg.style.display="none")},u.inactivate=function(){u.active=!1,u.strikethroughImg&&(u.strikethroughImg.style.display="inline-block")},u.show=function(){u.style.display="inline-block",u.emulatedImg&&(u.emulatedImg.style.display="inline-block"),u.active?u.strikethroughImg.style.display="none":u.strikethroughImg.style.display="inline-block"},u.hide=function(){u.style.display="none",u.emulatedImg&&(u.emulatedImg.style.display="none"),u.strikethroughImg&&(u.strikethroughImg.style.display="none")},u}},{key:"createDialog",value:function(e,t,r,i,n,o){var a=this.createUiElement(document.createElement("div"),"dialog","webvr-mini-dialog",r,i,n,o);return a.name=e,a.show=function(){a.style.display="inline-block"},a.hide=function(){a.style.display="none"},a}},{key:"dialogMessage",value:function(e){console.error(e)}},{key:"createProgress",value:function(e,t,r,i,n,o){var a=this.createUiElement(document.createElement("img"),"progress","webvr-mini-progress",r,i,n,o);return a.name=e,a.show=function(){a.style.display="inline-block"},a.hide=function(){a.style.display="none"},a}},{key:"createMenu",value:function(e,t,r,i,n,o,a){var s=this,u=this.createUiElement(document.createElement("div"),"menuContainer","webvr-mini-menu",r,i,n,o);u.name=e,a&&(u.arrow=a),console.log("ARROW IS A:"+a);var l=document.createElement("ul");l.className="webvr-mini-menuList";for(var c in this.styles.menu)l.style[c]=this.styles.menu[c];return u.appendChild(l),u.buildItem=function(e,t,r){var i=document.createElement("li"),n=i.style;for(var o in s.styles.menuItem)n[o]=s.styles.menuItem[o];i.innerHTML="<div id="+e+">"+t+"</div>",n=i.childNodes[0].style;for(var a in s.styles.menuContent)n[a]=s.styles.menuContent[a];return i.addEventListener("mouseenter",function(e){e.target.style.opacity=1}),i.addEventListener("mouseleave",function(e){e.target.active||(e.target.style.opacity=s.styles.menuItem.opacity)}),i},u.getList=function(){return u.getElementsByTagName("ul")[0]},u.buildList=function(e){var t=u.getList();t.innerHTML="";var r=0,i=0,n=s.util.numKeys(e)-1;for(var o in e){var a=e[o],l=u.buildItem(o,a.name,a.active),c=l.style,h=l.childNodes[0].style;0===r&&(c.borderTopLeftRadius=c.borderTopRightRadius="8px",h.borderTopLeftRadius=h.borderTopRightRadius="6px"),r===n&&(c.borderBottomLeftRadius=c.borderBottomRightRadius="8px",h.borderBottomLeftRadius=h.borderBottomRightRadius="6px",c.border=s.styles.menuItem.border),a.active&&(c.backgroundColor="#ffffcc",c.opacity=1,l.active=!0,i=r*parseFloat(s.styles.menu.lineHeight)),t.appendChild(l),r++}for(var d=t.childNodes,f=0;f<d.length;f++)d[f].index=f;return i},u.positionMenu=function(e){u.style.top=parseFloat(e.style.top)+parseFloat(e.style.height)+parseFloat(e.style.padding)+10+"px",u.style.left=parseFloat(e.style.left)+parseFloat(e.style.width)/2-parseFloat(e.style.padding)+4+"px"},u.activate=function(){u.style.display="inline-block",u.strikethroughImg&&(u.strikethroughImg.style.display="none")},u.deactivate=function(){u.strikethroughImg&&(u.strikethroughImg.style.display="none")},u.show=function(e){a&&(a.style.opacity="1");var t=u.getList();t.style.opacity="1",t.parentNode.style.height="",t.parentNode.style.padding="9px",t.scrollTop=e||0},u.hide=function(){a&&(a.style.opacity=0);var e=u.getList();e.style.opacity="0",e.parentNode.style.height="0",e.parentNode.style.padding="0"},u.timeout=function(){},u}},{key:"createSpinner",value:function(e,t,r,i,n,o){var a=this.createUiElement(document.createElement("img"),"spinner","webvr-mini-spinner",r,i,n,o);return a.name=e,a.show=function(){a.style.display="inline-block"},a.hide=function(){a.style.display="none"},a}},{key:"createTooltip",value:function(e,t){var r=document.createElement("p");r.className="webvr-mini-tooltip",r.setAttribute("status","invisible");var i=r.style;for(var n in this.styles.tooltip)i[n]=this.styles.tooltip[n];return r.innerHTML="",this.tooltip=r,this.controls.appendChild(r),r}},{key:"createBubbleArrow",value:function(e){var t=document.createElement("div"),r=t.style;for(var i in this.styles.bubbleArrow)r[i]=this.styles.bubbleArrow[i];return r.top=parseFloat(e.style.top)+parseFloat(e.style.height)+parseFloat(e.style.padding)+"px",t.shiftCenter=function(e){var r=t.style;r.left=parseFloat(e.style.left)+parseFloat(e.style.width)/2+parseFloat(e.style.padding)/2+parseFloat(r.borderWidth)/2+"px"},t.shiftCenter(e),r.zIndex=this.styles.menuContainer.zIndex,r.opacity=0,this.controls.appendChild(t),t}},{key:"vrHandleKeys",value:function(e){var t=this.webvr;switch(e.keyCode){case 27:e.preventDefault(),e.stopPropagation(),console.log("clicked exit vr escape key"),this.mode=this.UI_DOM,this.setControlsByMode(this.mode),t.exitPresent(),removeEventListener("keydown",this.vrHandleKeys)}}},{key:"hasFullscreen",value:function(){return!!(document.fullscreenEnabled||document.webkitFullscreenEnabled||document.mozFullScreenEnabled||document.msFullscreenEnabled)}},{key:"requestFullscreen",value:function(e){var t=this.webgl.getCanvas(),r=t.parentNode;r.requestFullscreen?r.requestFullscreen():r.mozRequestFullScreen?r.mozRequestFullScreen():r.webkitRequestFullscreen?r.webkitRequestFullscreen():r.msRequestFullscreen&&r.msRequestFullscreen()}},{key:"exitFullscreen",value:function(e){"function"==typeof document.exitFullscreen?document.exitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitExitFullscreen?document.webkitExitFullscreen():document.msExitFullscreen&&document.msExitFullscreen()}},{key:"fullscreenChange",value:function(e){var t=this.webgl.getCanvas(),r=t.parentNode,i=this.webgl.getContext();switch(this.mode){case this.UI_FULLSCREEN:console.log("from dom to fullscreen..."),r.style.width="",r.style.height="";var n=this.oldWidth,o=this.oldHeight;i.viewportWidth=n,i.viewportHeight=o,i.viewport(0,0,i.viewportWidth,i.viewportHeight),t.width=n,t.height=o,this.mode=this.UI_DOM,this.setControlsByMode(this.mode);break;default:case this.UI_DOM:console.log("from fullscreen to dom..."),this.mode=this.UI_FULLSCREEN,this.setControlsByMode(this.mode)}}}]),e}();t.default=n},function(e,t,r){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),a=r(11),s=i(a),u=function(){function e(t){n(this,e),console.log("in Util"),this.NOT_IN_LIST=-1,this.DEFAULT_KEY="default",this.POSITIVE=1,this.NEGATIVE=-1,this.emitter=new s.default,this.setTrim(),this.setPerformance(),this.setFinite(),this.setSlice()}return o(e,[{key:"setTrim",value:function(){String.trim=String.trim||function(e){return this.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"")}}},{key:"setFinite",value:function(){Number.isFinite=Number.isFinite||function(e){return"number"==typeof e&&isFinite(e)}}},{key:"setPerformance",value:function(){Date.now=Date.now||function(){return(new Date).getTime()},window.performance=window.performance||{},window.performance.now=window.performance.now||function(){var e=Date.now();return Date.now()-e}}},{key:"setSlice",value:function(){Object.defineProperty&&(Uint16Array&&!Uint16Array.prototype.slice&&Object.defineProperty(Uint16Array.prototype,"slice",{value:Array.prototype.slice}),Uint32Array&&!Uint32Array.prototype.slice&&Object.defineProperty(Uint32Array.prototype,"slice",{value:Array.prototype.slice}),Float32Array&&!Float32Array.prototype.slice&&Object.defineProperty(Float32Array.prototype,"slice",{value:Array.prototype.slice}))}},{key:"isString",value:function(e){return"[object String]"===Object.prototype.toString.call(e)}},{key:"isWhitespace",value:function(e){return!/[^\s]/.test(e)}},{key:"isURL",value:function(e){return null!=/^[\w+:\/\/]/.exec(e)}},{key:"reverseString",value:function(e){return e.split?e.split("").reverse().join(""):null}},{key:"computeId",value:function(){var e=(new Date).getTime(),t="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){var r=(e+16*Math.random())%16|0;return e=Math.floor(e/16),("x"==t?r:3&r|8).toString(16)});return t}},{key:"parseJSON",value:function(e){var t=null;try{t=JSON.parse(e)}catch(e){e instanceof SyntaxError?console.error("Util::parseJSON(): JSON syntax error:"+e):console.error("Util::parseJSON(): JSON unknown error:"+e)}return t}},{key:"computeQueryString",value:function(e){var t=[],r=function(r){var i=Array.isArray(e[r])?e[r]:[e[r]];i.forEach(function(e){t.push(encodeURIComponent(r)+"="+encodeURIComponent(e))})};for(var i in e)r(i);return t.join("&")}},{key:"isNumber",value:function(e){return Number.isFinite(parseFloat(e))}},{key:"isPowerOfTwo",value:function(e){return e=parseInt(e),0===(e&e-1)}},{key:"isEven",value:function(e){return parseInt(e)%2==0}},{key:"isOdd",value:function(e){return 1==Math.abs(parseInt(e)%2)}},{key:"degToRad",value:function(e){return parseFloat(e)*Math.PI/180}},{key:"radToDeg",value:function(e){return 180*parseFloat(e)/Math.PI}},{key:"degToHours",value:function(e){return 24*e/360}},{key:"hoursToDeg",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return e=parseFloat(e),t=parseFloat(t),r=parseFloat(r),e&&(e*=15),t&&(t*=.25),r&&(r*=360/86400),e+t+r}},{key:"cartesianToUV",value:function(e){if(!e.length)return console.error("Util::uvToCartesian(): ARRAY not supplied (did you just use separate x, y, z?"),null;for(var t=new Float32Array(2*e.length/3),r=0,i=0;i<e.length;i+=3){var n=e[i],o=e[i+1],a=e[i+2],s=Math.sqrt(n*n+o*o+a*a);t[r++]=Math.acos(a/s),t[r++]=Math.acos(n/Math.sqrt(n*n+o*o))*(o<0?-1:1)}return t}},{key:"uvToCartesian",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;if(!e.length)return console.error("Util::uvToCartesian(): ARRAY not supplied (did you just add latitude and longitude?"),null;for(var n=new Float32Array(3*e.length/2),o=0,a=0;a<e.length;a+=2){var s=e[a],u=e[a+1];n[o++]=Math.cos(s)*Math.sin(u)*t,n[o++]=Math.sin(s)*Math.sin(u)*r,n[o++]=Math.cos(u)*i}return n}},{key:"hexToRGB",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return e=e.replace("#",""),{r:parseInt(e.substring(0,2),16)/t,g:parseInt(e.substring(2,4),16)/t,b:parseInt(e.substring(4,6),16)/t}}},{key:"latLongToCartesian",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1;return this.uvToCartesian([e,t],r,i,n)}},{key:"frac",value:function(e){return parseFloat(e)%1}},{key:"getRand",value:function(e,t){return void 0!==e&&void 0!==t||(t=1,e=0),e+(Math.random()+1/(1+this.getSeed()))%1*(t-e)}},{key:"getRandInt",value:function(e){return Math.floor(Math.random()*e)}},{key:"randomColor",value:function(){return[Math.abs(Math.random()),Math.abs(Math.random()),Math.abs(Math.random())]}},{key:"easeLinearIn",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.002;return e+t}},{key:"easeLinearOut",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.002;return e-t}},{key:"easeQuadIn",value:function(e){return e+e*e}},{key:"easeQuadOut",value:function(e){return e+e*e}},{key:"pulse",value:function(e,t,r,i,n){e>r?this.outfn(e):e<t&&this.infn(e)}},{key:"isObject",value:function(e){return e===Object(e)}},{key:"numKeys",value:function(e){return this.isObject(e)?Object.keys(e).length:this.NOT_IN_LIST}},{key:"getSortedKeys",value:function(e){var t=Object.keys(e);return t.sort(function(t,r){return e[r]-e[t]})}},{key:"isArray",value:function(e){var t=Object.prototype.toString.call(e);return t.indexOf("Array")>this.NOT_IN_LIST}},{key:"containsAll",value:function(e,t){return t.every(function(t){return e.includes(t)})}},{key:"compArr",value:function(e,t){return this.containsAll(e,t)&&this.containsAll(t,e)}},{key:"getArr",value:function(e,t,r){if(!e||t<0||r<1)return console.error("getArr() invalid params, arr:"+e+", index:"+t+" stride:"+r),-1;for(var i=[],n=2;n<r;n++)i.push(e[t*r+n]);return i}},{key:"setArr",value:function(e,t){var r=arguments.length;if(r<3)return console.error("setArr() no value or index specified"),-1;for(var i=r-2,n=2;n<r;n++)e[idx*i+n]-arguments[n];return idx}},{key:"copyArr",value:function(e){if(e.slice)return e.slice();if(e.length){for(var t=new Array(e.length),r=0;r<e.length;r++)t[r]=e[r];return t}return console.error("Util::copyArr(): not a valid array:"+e),null}},{key:"canFlatten",value:function(e){return"undefined"!=typeof e[0][0]&&e[0].constructor===Array}},{key:"flatten",value:function(e,t){t!==!0&&t!==!1&&(t=!1);for(var r=t&&e||e.slice(),i=[],n=r.shift();void 0!==n;n=r.shift())Array.isArray(n)?r.unshift.apply(r,n):i.push(n);return i}},{key:"unFlatten",value:function(e,t){for(var r=0,i=0,n=[],o=(new Array(e.length/t),0);o<e.length;o+=t){for(var a=new Array(t),s=0;s<t;s++)a[s]=e[i++];n[r++]=a}return n}},{key:"concatArr",value:function(e,t){var r=null,i=e.length,n=t.length;if(ArrayBuffer.isView(e))e instanceof Float32Array?(r=new Float32Array(i+n),!t instanceof Float32Array&&(t=Float32Array.from(t))):e instanceof Uint32Array?(r=new Uint32Array(i+n),!t instanceof Uint32Array&&(t=Uint32Array.from(t))):e instanceof Uint16Array&&(r=new Uint16Array(i+n),!t instanceof Uint16Array&&(t=Uint16Array.from(t))),r.set(e),r.set(t,i);else if(ArrayBuffer.isView(t)){for(var o=0;o<n;o++)e.push(t[o]);r=e}else r=e.concat(t);return r}},{key:"concatUniqueArr",value:function(){for(var e=[],t=arguments.length,r=Array(t),i=0;i<t;i++)r[i]=arguments[i];for(var n=0;n<r.length;n++)for(var o=r[n],a=0;a<o.length;a++)!o[a]in e&&e.push(o[a]);return e}},{key:"swap",value:function(e,t,r){var i=e[t];return e[t]=x[r],e[t]=i,e}},{key:"clearFalsy",value:function(e){return e.filter(function(e){return e})}},{key:"sort2DByColNum",value:function(e,t){e.sort(function(e,r){return e[t]-r[t]})}},{key:"getSeed",value:function(){var e=void 0;try{if(Uint32Array&&window.crypto&&window.crypto.getRandomValues){var t=new Uint32Array(1);window.crypto.getRandomValues(t),e=t.length?t[0]+"":null}}catch(e){}finally{e||(e=Math.floor(1e9*Math.random()).toString()+(new Date).getTime())}return e}},{key:"removeObjMember",value:function(e,t){e.hasOwnProperty(t)&&(!isNaN(parseInt(t))&&this instanceof Array?e.splice(t,1):delete e[t])}},{key:"getFilePath",value:function(e){return e?e.substring(0,e.lastIndexOf("/"))+"/":null}},{key:"getFileName",value:function(e){return e?e.replace(/^(.*[\/\\])?/,""):null}},{key:"getBaseName",value:function(e){return e?this.getFileName(e).replace(/(\.[^.]*)$/,""):null}},{key:"getFileExtension",value:function(e){return e?e.slice((e.lastIndexOf(".")-1>>>0)+2).toLowerCase():null}},{key:"isIFrame",value:function(){try{return window.self!==window.top}catch(e){return!0}return!1}},{key:"getMousePosition",value:function(e,t){var r=e.getBoundingClientRect();return{x:t.clientX-r.left,y:t.clientY-r.top}}},{key:"getGeolocation",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=this.emitter;navigator.geolocation.getCurrentPosition(function(e){r.emit(r.events.WORLD_GEOLOCATION_READY,e.coords)},function(i){console.error("Util::getGeolocation():Geolocation data not available, error:"+i),r.emit(r.events.WORLD_GEOLOCATION_READY,{latitude:e,longitude:t,altitude:0,accuracy:1,altitudeAccuracy:1,heading:0,speed:0})},{enableHighAccuracy:!0,timeout:5e3,maximumAge:0})}},{key:"isCompatMobile",value:function(){return this.hasTouch()&&this.hasDeviceOriention()(this.isIOS()||this.isGearVR()||this.isGooglePixel())}},{key:"hasTouch",value:function(){return!!("ontouchstart"in window||navigator.msMaxTouchPoints)}},{key:"hasDeviceOrientation",value:function(){return!!window.DeviceOrientationEvent}},{key:"isStandalone",value:function(){return!!window.matchMedia("(display-mode: standalone)").matches}},{key:"isLandscape",value:function(){return 90===window.orientation||window.orientation===-90}},{key:"isIOS",value:function(){var e=navigator.userAgent.match(/(iPad|iPhone|iphone|iPod).*?(OS |os |OS\_)(\d+((_|\.)\d)?((_|\.)\d)?)/);return null===e&&(e=!1),e}},{key:"isGooglePixel",value:function(){return/android.+;\s(pixel xl|pixel)\s/i.test(navigator.userAgent)}},{key:"isGearVR",value:function(){return/SamsungBrowser.+Mobile VR/i.test(navigator.userAgent)}},{key:"getScreenWidth",value:function(){return window.screen.width}},{key:"getScreenHeight",value:function(){return window.screen.height}},{key:"getWindowWidth",value:function(){return window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth}},{key:"getWindowHeight",value:function(){return window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight}}]),e}();t.default=u},function(e,t){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),o=function(){function e(t,i,n,o){r(this,e),console.log("in webGL class"),this.gl=null,this.contextCount=0,this.version=0,this.glMatrix=i,this.util=n,this.NOT_IN_LIST=n.NOT_IN_LIST,this.attributeNames={aVertexPosition:["aVertexPosition",0],aVertexColor:["aVertexColor",1],aTextureCoord:["aTextureCoord",2],aTextureCoord1:["aTextureCoord1",3],aTextureCoord2:["aTextureCoord2",4],aTextureCoord3:["aTextureCoord3",5],aTextureCoord4:["aTextureCoord4",6],aTextureCoord5:["aTextureCoord5",7],aVertexNormal:["aVertexNormal",8],aVertexTangent:["aVertexTangent",9]},this.near=.1,this.far=100,this.stats={},t===!0&&this.init(document.getElementById("webvr-mini-canvas")),o&&(this.debug=o)}return n(e,[{key:"init",value:function(e,t,r){var i=this;if(e)e=this.util.isString(e)?document.getElementById(e):e;else{e=document.createElement("canvas"),e.width=480,e.height=320;var n=document.createElement("div");n.className="webvr-mini-player";var o=document.createElement("div");o.className="webvr-mini-controls",
n.appendChild(o),n.appendChild(e),document.body.appendChild(n)}if(e){var a=e.getBoundingClientRect();if(e.width=a.width,e.height=a.height,this.oldWidth=this.util.getWindowWidth(),this.oldHeight=this.util.getWindowHeight(),this.gl=this.createContext(e),this.gl){var s=this.gl;if(s.getParameter&&s.getShaderPrecisionFormat){var u=this.stats;u.highp=s.getShaderPrecisionFormat(s.FRAGMENT_SHADER,s.HIGH_FLOAT).precision,u.maxTextureSize=s.getParameter(s.MAX_TEXTURE_SIZE),u.maxCubeSize=s.getParameter(s.MAX_CUBE_MAP_TEXTURE_SIZE),u.maxRenderbufferSize=s.getParameter(s.MAX_RENDERBUFFER_SIZE),u.combinedUnits=s.getParameter(s.MAX_COMBINED_TEXTURE_IMAGE_UNITS),u.maxVSattribs=s.getParameter(s.MAX_VERTEX_ATTRIBS),u.maxVertexShader=s.getParameter(s.MAX_VERTEX_UNIFORM_VECTORS),u.maxFragmentShader=s.getParameter(s.MAX_FRAGMENT_UNIFORM_VECTORS)}else this.stats=!1;return e.addEventListener("webglcontextlost",function(e){console.error("error: webglcontextlost event, context count:"+i.contextCount),t&&(i.gl=null,t(e)),e.preventDefault()},!1),e.addEventListener("webglcontextrestored",function(e){console.error("error: webglcontextrestored event, context count:"+i.contextCount),r&&r(e),e.preventDefault()},!1),this.resizeCanvas(!0),window.addEventListener("resize",function(e){i.resizeCanvas(),e.preventDefault()},!1),this.clearTextures(),this.glDefaults(),this.clear(),this.gl}console.error("no WebGL context")}else console.error(" no WebGL canvas");return null}},{key:"glDefaults",value:function(){var e=this.getContext();e&&(e.enable(e.DEPTH_TEST),e.enable(e.CULL_FACE),e.clearDepth(1),e.depthFunc(e.LEQUAL),e.enable(e.BLEND),e.blendFunc(e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA),e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!0),e.clearColor(0,0,0,1))}},{key:"hasWebGL",value:function(){return!!this.getContext()}},{key:"index32Support",value:function(e){return!!e.getExtension("OES_element_index_uint")}},{key:"derivativeSupport",value:function(e){var t=!!e.FRAGMENT_SHADER_DERIVATIVE_HINT;if(!t){var r=e.getExtension("GL_OES_standard_derivatives");r&&(t=!0,e.FRAGMENT_SHADER_DERIVATIVE_HINT=r.FRAGMENT_SHADER_DERIVATIVE_HINT_OES),e.FRAGMENT_SHADER_DERIVATIVE_HINT&&(this.stats.lodSupport=!!e.getExtension("EXT_shader_texture_lod"))}return t}},{key:"vertexArraySupport",value:function(e){var t=!!e.VERTEX_ARRAY_BINDING;if(!t){var r=e.getExtension("OES_vertex_array_object");r&&(t=!0,e.VERTEX_ARRAY_BINDING=r.VERTEX_ARRAY_BINDING_OES,e.createVertexArray=function(){return r.createVertexArrayOES()},e.deleteVertexArray=function(e){r.deleteVertexArrayOES(e)},e.isVertexArray=function(e){return r.isVertexArrayOES(e)},e.bindVertexArray=function(e){r.bindVertexArrayOES(e)})}return t}},{key:"depthTextureSupport",value:function(e){var t=!(!e.DEPTH_COMPONENT||!e.DEPTH_STENCIL);if(!t){var r=e.getExtension("WEBGL_depth_texture")||e.getExtension("MOZ_WEBGL_depth_texture")||e.getExtension("WEBKIT_WEBGL_depth_texture");r&&(t=!0,e.DEPTH_COMPONENT=r.DEPTH_COMPONENT,e.DEPTH_STENCIL=r.DEPTH_STENCIL)}return t}},{key:"anisotropicSupport",value:function(e){var t=!!e.TEXTURE_MAX_ANISOTROPY_EXT;if(!t){var r=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic");r&&(t=!0,e.TEXTURE_MAX_ANISOTROPY_EXT=r.TEXTURE_MAX_ANISOTROPY_EXT)}return t}},{key:"S3TCTextureSupport",value:function(e){var t=!!e.COMPRESSED_RGB_S3TC_DXT1_EXT;if(!t){var r=e.getExtension("WEBGL_compressed_texture_s3tc")||e.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");r&&(t=!0,e.COMPRESSED_RGB_S3TC_DXT1_EXT=r.COMPRESSED_RGB_S3TC_DXT1_EXT,e.COMPRESSED_RGBA_S3TC_DXT1_EXT=r.COMPRESSED_RGBA_S3TC_DXT1_EXT,e.COMPRESSED_RGBA_S3TC_DXT3_EXT=r.COMPRESSED_RGBA_S3TC_DXT3_EXT,e.COMPRESSED_RGBA_S3TC_DXT5_EXT=r.COMPRESSED_RGBA_S3TC_DXT5_EXT)}return t}},{key:"PVRTCTextureSupport",value:function(e){var t=!!e.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(!t){var r=e.getExtension("WEBGL_compressed_texture_pvrtc ")||e.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");r&&(t=!0,e.COMPRESSED_RGB_PVRTC_4BPPV1_IMG=r.COMPRESSED_RGB_PVRTC_4BPPV1_IMG,e.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG=r.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG,e.COMPRESSED_RGB_PVRTC_2BPPV1_IMG=r.COMPRESSED_RGB_PVRTC_2BPPV1_IMG,e.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG=r.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG)}return t}},{key:"ETC1TextureSupport",value:function(e){var t=!(!e.COMPRESSED_RGB_ETC1_WEBGL&&!e.COMPRESSED_RGB_ETC1);if(!t){var r=e.getExtension("WEBGL_compressed_texture_etc1");r&&(t=!0,e.COMPRESSED_RGB_ETC1_WEBGL=r.COMPRESSED_RGB_ETC1_WEBGL)}return t}},{key:"getError",value:function(){var e="webgl.glError():",t=this.getContext();switch(t.getError()){case t.NO_ERROR:return e+"gl.NO_ERROR";case t.INVALID_ENUM:return e+"gl.INVALID_ENUM";case t.INVALID_VALUE:return e+"gl.INVALID_VALUE";case t.INVALID_OPERATION:return e+"gl.INVALID_OPERATION";case t.INVALID_FRAMEBUFFER_OPERATION:return e+"gl.INVALID_FRAMEBUFFER_OPERATION";case t.OUT_OF_MEMORY:return e+"gl.OUT_OF_MEMORY";case t.CONTEXT_LOST_WEBGL:return e+"gl.CONTEXT_LOST_WEBGL"}}},{key:"checkFramebuffer",value:function(e,t){var r=e.checkFramebufferStatus(e.FRAMEBUFFER);switch(r){case e.FRAMEBUFFER_UNSUPPORTED:return"Framebuffer is unsupported";case e.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:return"Framebuffer incomplete attachment";case e.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:return"Framebuffer incomplete dimensions";case e.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:return"Framebuffer incomplete missing attachment";default:return!0}}},{key:"enableBlending",value:function(e,t,r){var i=this.getContext();r&&i.blendEquation(i[r]),e&&t&&i.blendFunc(i[e],i[t]),i.enable(i.BLEND),i.depthMask(!1)}},{key:"disableBlending",value:function(){var e=this.getContext();e.disable(e.BLEND),e.depthMask(!0)}},{key:"getCanvas",value:function(){return this.gl?this.gl.canvas:null}},{key:"resizeCanvas",value:function(e){if(this.ready()){var t=this.util.getWindowWidth(),r=this.util.getWindowHeight();if(this.webvr){console.warn("WebGL::resizeCanvas(): warning, WebVR presentchange event triggered window.resize event (IGNORING)");var i=this.webvr.getDisplay();if(i&&i.isPresenting)return}if(e||t!==this.oldWidth){console.log("resizeCanvas()::resizing");var n=window.devicePixelRatio||1,o=this.getContext(),a=this.getCanvas(),s=a.clientWidth*n,u=a.clientHeight*n;a.width=Math.floor(s),a.height=Math.floor(u),o.viewportWidth=s,o.viewportHeight=u,o.viewport(0,0,o.viewportWidth,o.viewportHeight)}return this.oldWidth=t,this.oldHeight=r,!0}return!1}},{key:"createContext",value:function(e){if(!window.WebGLRenderingContext)return console.error("this browser does not support webgl"),null;var t=null;t&&this.contextCount>0&&(console.warn("killing context"),this.killContext(),this.contextCount--,this.gl=null);for(var r=["webgl2","experimental-webgl2","webgl","experimental-webgl"],n=0;n<r.length;){try{if(this.debug){if(t=this.debug.makeDebugContext(e.getContext(r[n]))){console.warn("using debug context"),"function"!==t.getParameter&&(t=e.getContext(r[n]),console.warn("unable to use debug context, trying release:"+r[n]," getParameter:"+i(t.getParameter)));break}}else if(t=e.getContext(r[n])){console.warn("using release context mode:"+r[n]);break}}catch(e){console.warn("failed to load context:"+r[n])}n++}if(t&&"function"==typeof t.getParameter){switch(this.contextCount++,this.gl=t,this.version=t.getParameter(t.VERSION).toLowerCase(),1!=n&&3!=n||console.warn("experimental context, .getParameter() may not work"),console.log("version:"+t.getParameter(t.VERSION)),this.stats.uint32=!0,this.stats.supported=t.getSupportedExtensions(),n){case 0:case 1:this.version=2;break;case 2:case 3:default:this.version=1,this.stats.uint32=this.index32Support(t)}this.stats.anisotrophic=this.anisotropicSupport(t),this.stats.vertexArrays=this.vertexArraySupport(t),this.stats.derivatives=this.derivativeSupport(t),this.stats.depthTextures=this.depthTextureSupport(t),this.stats.pvrtcTextures=this.PVRTCTextureSupport(t),this.stats.etc1Textures=this.ETC1TextureSupport(t),this.stats.setcTextures=this.S3TCTextureSupport(t),this.stats.uint32?this.MAX_DRAWELEMENTS=2e9:this.MAX_DRAWELEMENTS=65534}else console.error("WebGL::createContext(): no WebGL available"),this.gl=null;return this.gl}},{key:"getContext",value:function(){return this.gl||console.warn("warning webgl context not initialized"),this.gl}},{key:"killContext",value:function(){console.log("in killcontext, count:"+this.contextCount),this.contextCount&&(console.log("killing WebGL context, count before:"+this.contextCount),this.gl.getExtension("WEBGL_lose_context").loseContext(),this.contextCount--)}},{key:"ready",value:function(){this.gl;return!(!this.gl||!this.glMatrix)}},{key:"clear",value:function(){var e=this.gl;e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT)}},{key:"clearTextures",value:function(){for(var e=this.gl,t=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS),r=0;r<t;r++)e.activeTexture(e.TEXTURE0+r),e.bindTexture(e.TEXTURE_2D,null),e.bindTexture(e.TEXTURE_CUBE_MAP,null);e.bindBuffer(e.ARRAY_BUFFER,null),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,null),e.bindRenderbuffer(e.RENDERBUFFER,null),e.bindFramebuffer(e.FRAMEBUFFER,null)}},{key:"createShader",value:function(e,t){var r=null;if(e&&t){if(this.ready()){var i=this.gl;t.replace(/^[ \t]*\n/,""),e===i.VERTEX_SHADER?r=i.createShader(e):e===i.FRAGMENT_SHADER?r=i.createShader(e):console.error("createShader: type not recognized:"+e),i.shaderSource(r,t),i.compileShader(r),i.getShaderParameter(r,i.COMPILE_STATUS)||(console.error("createShader:"+i.getShaderInfoLog(r)),r=null)}}else console.error("createShader: invalid params, type:"+e+" source:"+t);return r}},{key:"createVertexShader",value:function(e){return this.createShader(this.gl.VERTEX_SHADER,e)}},{key:"createFragmentShader",value:function(e){return this.createShader(this.gl.FRAGMENT_SHADER,e)}},{key:"fetchShader",value:function(e,t){var r=this;return fetch(t,{method:"POST",mode:"cors",redirect:"follow",headers:new Headers({"Content-Type":"text/plain"})}).then(function(e){return console.log(text),!!e.ok&&e.text()}).then(function(t){if(t)return r.createShader(e,t)}),null}},{key:"fetchVertexShader",value:function(e){return this.fetchShader(this.gl.VERTEX_SHADER,e)}},{key:"fetchFragmentShader",value:function(e){return this.fetchShader(this.gl.FRAGMENT_SHADER,e)}},{key:"createShaderFromTag",value:function(e){if(this.util.isString(e)&&(e=document.getElementById(e)),!e)return console.error("createShaderFromTag: not found ("+e+")"),!1;var t=null;if("x-shader/x-vertex"==e.type)t=this.gl.VERTEX_SHADER;else{if("x-shader/x-fragment"!=e.type)return console.error("createShaderFromTag: type not found:("+e.type+")"),null;t=this.gl.FRAGMENT_SHADER}for(var r="",i=e.firstChild;i;)3==i.nodeType&&(r+=i.textContent),i=i.nextSibling;return this.createShader(t,r)}},{key:"createProgram",value:function(e,t){if(!e||!t)return console.error("createProgram: parameter error, vs:"+e+" fs:"+t),null;var r={};if(this.ready()){var i=this.gl,n=this.createVertexShader(e.code),o=this.createFragmentShader(t.code),a=i.createProgram();i.attachShader(a,n),i.attachShader(a,o);for(var s in this.attributeNames)i.bindAttribLocation(a,this.attributeNames[s][1],this.attributeNames[s][0]);i.linkProgram(a),i.getProgramParameter(a,i.LINK_STATUS)?(r.shaderProgram=a,r.vsVars=e.varList,r.fsVars=t.varList,r.renderList=[]):(console.error("WebGL::createProgram():"+i.getProgramInfoLog(a)),this.checkShaders(e,t,a))}return r}},{key:"createVarList",value:function(e){var t=e.length,r=this.NOT_IN_LIST,i=" ",n={},o=["attribute","uniform","varying"];if(t)for(var a=0;a<t;a++){var s=e[a];if(s.indexOf("void main")!==r)break;for(var u=0;u<o.length;u++){var l=o[u];if(n[l]||(n[l]={}),s.indexOf(l)>r){s=s.replace(/;\s*$/,""),s=s.split(i);var c=s.shift();n[c]||(n[c]={});var h=s.shift();n[c][h]||(n[c][h]={});var d=s.shift();n[c][h][d]||(n[c][h][d]="empty")}}}return n}},{key:"setAttributeArrays",value:function(e,t){this.gl;for(var r in t){var i=t[r];for(var n in i)i[n]=this.attributeNames[n][1]}return t}},{key:"setUniformLocations",value:function(e,t){var r=this.gl;for(var i in t){var n=t[i];for(var o in n)n[o]=r.getUniformLocation(e,o)}return t}},{key:"getAttributes",value:function(e){for(var t=this.gl,r={},i=t.getProgramParameter(e,t.ACTIVE_ATTRIBUTES),n=0;n<i;n++){var o=t.getActiveAttrib(e,n);r[o.name]=t.getAttribLocation(e,o.name)}return r.count=i,r}},{key:"getUniforms",value:function(e){for(var t=this.gl,r={},i=t.getProgramParameter(e,t.ACTIVE_UNIFORMS),n="",o=0;o<i;o++){var a=t.getActiveUniform(e,o);n=a.name.replace("[0]",""),r[n]=t.getUniformLocation(e,n)}return r.count=i,r}},{key:"getVarying",value:function(e){}},{key:"checkShaders",value:function(e,t,r){var i=this.gl;return!!i.getProgramParameter(r,i.LINK_STATUS)||(e&&!i.getShaderParameter(e,i.COMPILE_STATUS)?console.error("error creating the vertex shader, "+i.getShaderInfoLog(e)):t&&!i.getShaderParameter(t,i.COMPILE_STATUS)?console.error("error creating the fragment shader, "+i.getShaderInfoLog(t)):console.error("error in gl program linking"),i.deleteProgram(r),!1)}},{key:"checkBufferObjects",value:function(e){return e&&e instanceof ArrayBuffer}},{key:"enumToString",value:function(e,t){for(var r in e)if(e[r]==t)return r;return"0x"+t.toString(16)}}]),e}();t.default=o},function(e,t){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),n=function(){function e(t,i,n,o){r(this,e),console.log("in webVR class"),this.util=i,this.glMatrix=n,this.webgl=o,this.webvr=null,window.displayName="window",this.displays=[window],this.cDisplay=this.displays[0],this.frameData=null,this.PLAYER_HEIGHT=1.75,this.stats={version:0},this.OMData={o:[0,0,0],m:[0,0,0],mvMatrix:this.glMatrix.mat4.create()},t===!0&&this.init()}return i(e,[{key:"setWorld",value:function(e){this.world=e}},{key:"init",value:function(){var e=this,t=this.stats,r=null;this.cDisplay=this.displays[0],navigator.getVRDisplays?navigator.getVRDisplays().then(function(i){if(console.log("WebVR::init(): webvr 1.1 is available"),e.stats.version=1.1,"VRFrameData"in window&&(e.frameData=new VRFrameData),e.frameData)if(console.log("WebVR::init(): VRFrameData is available for "+i.length+" headsets"),i.length>0){console.log("WebVR::init(): "+i.length+" displays are available");for(var n=0;n<i.length;n++)r=i[n],void 0===r.displayName&&(r.displayName="Generic WebVR device"),console.log("WebVR::init(): pushing display ("+r.displayName+")"),e.displays.push(r);r=e.cDisplay=e.displays[1],r&&(console.log("WebVR::init(): valid vr display ("+r.displayName+") present"),r.isPresenting&&(console.warn("WebVR::init(): ("+r.displayName+") was already presenting, exit first"),e.exitPresent(1)),r.depthNear?e.webgl.near=r.depthNear:r.depthNear=e.webgl.near,r.depthFar?e.webgl.far=r.depthFar:r.depthFar=e.webgl.far,t.displayName=r.displayName,e.setStageParameters(r),e.util.emitter.emit(e.util.emitter.events.VR_DISPLAY_READY,r),e.webgl.webvr=e,window.addEventListener("vrdisplaypresentchange",e.presentChange.bind(e),!1),window.addEventListener("vrdisplayconnected",e.displayConnected.bind(e),!1),window.addEventListener("vrdisplaydisconnected",e.displayDisconnected.bind(e),!1),window.addEventListener("vrdisplayactivate",e.displayActivated.bind(e),!1),window.addEventListener("vrdisplaydeactivate",e.displayDeactivated.bind(e),!1),window.addEventListener("vrdisplayblur",e.displayBlur.bind(e),!1),window.addEventListener("vrdisplayfocus",e.displayFocus.bind(e),!1))}else console.warn("WebVR::init(): no VR displays found"),e.util.emitter.emit(e.util.emitter.events.VR_DISPLAY_FAIL,r);else console.warn("WebVR::init(): invalid VRFrameData for "+r),e.util.emitter.emit(e.util.emitter.events.VR_DISPLAY_FAIL,r)},function(t){console.warn("WebVR::init(): reject navigator.getVRDisplays, error is:"+t+", display is:"+r),e.util.emitter.emit(e.util.emitter.events.VR_DISPLAY_FAIL,r)}).catch(function(t){console.warn("WebVR::init(): error navigator.getVRDisplays:"+t+" display is:"+r),e.util.emitter.emit(e.util.emitter.events.VR_DISPLAY_FAIL,r)}):(console.warn("WebVR::init(): WebVR API not present, or obsolete version"),this.util.emitter.emit(this.util.emitter.events.VR_DISPLAY_FAIL,r)),"deviceorientation"in window&&"devicemotion"in window&&(window.addEventListener("deviceorientation",this.setDeviceOrientation.bind(this),!1),window.addEventListener("devicemotion",this.setDevicePosition.bind(this),!1))}},{key:"getFrameData",value:function(){var e=this.cDisplay,t=this.frameData;if(e.getFrameData){var r=e.getFrameData(t);return r?t:(console.error("WebVR::getFrameData(): display ("+e.displayName+"), display.getFrameData returned:"+r),null)}return console.error("WebVR::getFrame(): display ("+e.displayName+") does not have VRFrameData"),null}},{key:"hasWebVR",value:function(){return!!("VRFrameData"in window&&"getVRDisplays"in navigator)}},{key:"hasWebVRDisplay",value:function(){return!!(this.hasWebVR()&&this.cDisplay&&this.cDisplay.getFrameData)}},{key:"hasRoomscale",value:function(){return this.cDisplay&&this.cDisplay.capabilities&&cDisplay.capabilities.hasPosition}},{key:"getDisplay",value:function(){return this.cDisplay}},{key:"setStageParameters",value:function(e){var t=e,r=t.stageParameters;r?(console.log("WebVR::setStageParameters(): vr display stageParameters present"),r.sizeX>0&&r.sizeZ>0?console.log("WebVR::setStageParameters(): device ("+t.displayName+") stageParameters sizeX:"+r.sizeX+" and sizeZ:"+r.sizeZ):console.log("WebVR::setStageParameters(): device ("+t.displayName+") reported stageParameters without a size, using defaults (3000)")):console.error("WebVR::setStageParameters(): device ("+t.displayName+") did not report stage parameters")}},{key:"getStandingViewMatrix",value:function(e,t,r){var i=this.glMatrix.mat4,n=this.cDisplay;return n.stageParameters?(i.invert(e,n.stageParameters.sittingToStandingTransform),i.multiply(e,t,e)):(i.identity(e),i.translate(e,e,[0,this.PLAYER_HEIGHT,0]),i.invert(e,e),i.multiply(e,t,e)),e}},{key:"setDeviceOrientation",value:function(e){var t=this.OMData.o;t[0]=e.gamma+90,t[1]=e.alpha,t[2]=e.beta}},{key:"setDevicePosition",value:function(e){var t=this.OMData.m;t[0]=e.x,t[1]=e.y,t[2]=e.z}},{key:"getOMMatrix",value:function(){var e=this.glMatrix.mat4,t=this.util,r=this.OMData.mvMatrix,i=this.OMData.o;this.OMData.m;return e.identity(r),e.translate(r,r,[0,this.PLAYER_HEIGHT,0]),e.invert(r,r),e.rotate(r,r,t.degToRad(i[0]),[1,0,0]),e.rotate(r,r,t.degToRad(i[2]),[0,0,1]),e.rotate(r,r,t.degToRad(i[1]),[0,1,0]),r}},{key:"setMouseOrientation",value:function(){}},{key:"setMousePosition",value:function(){}},{key:"getMouseMatrix",value:function(){}},{key:"requestPresent",value:function(e){var t=this;if(null===this.world)return console.error("WebVR::requestPresent(): world not available"),!1;void 0===e&&(e=1),console.log("WebVR::requestPresent(): display("+this.cDisplay.displayName+")");var r=this.world,i=this.displays[e];return i&&i.capabilities&&i.capabilities.canPresent?i.requestPresent([{source:this.webgl.getCanvas()}]).then(function(){r.stop(),t.lastCWidth=t.webgl.getCanvas().width,t.lastCHeight=t.webgl.getCanvas().height,t.cDisplay=i,r.start(),console.log("WebVR::requestPresent(): present was successful")},function(e){console.error("WebVR::requestPresent(): reject, error:"+e+" for display:"+i)}).catch(function(e){console.warn("WebVR::requestPresent(): catch, error is:"+e+" for display:"+i)}):console.error("WebVR::requestPresent(): vrdisplay ("+i.displayName+") has invalid configuration"),!1}},{key:"exitPresent",value:function(e){var t=this;if(console.log("WebVR::exitPresent(): event"),null===this.world)return console.error("WebVR::requestPresent(): world not available"),!1;var r=this.cDisplay,i=this.world;void 0!==e&&(r=this.displays[e]),r.exitPresent?r.exitPresent().then(function(){i.stop(),t.cDisplay=t.displays[0],i.start(),console.log("WebVR::exitPresent(): exited display ("+r.displayName+") presentation to ("+t.cDisplay.displayName+")")},function(e){console.error("WebVR::exitPresent(): reject for display("+r.displayName+"), error:"+e),t.util.emitter.emit(t.util.emitter.events.VR_DISPLAY_FAIL,r)}).catch(function(e){console.warn("WebVR::exitPresent(): error for display ("+r.displayName+"), error:"+e),t.util.emitter.emit(t.util.emitter.events.VR_DISPLAY_FAIL,r)}):(console.error("WebVR::exitPresent(): display ("+r.displayName+") is not a vr display"),this.util.emitter.emit(this.util.emitter.events.VR_DISPLAY_FAIL,r))}},{key:"vrResize",value:function(){var e=this.cDisplay,t=this.webgl.getContext(),r=this.webgl.getCanvas(),i=r.parentNode;console.log("WebVR::vrResize(): resize for display ("+e.displayName+")");var n=1;if(this.oldWidth=i.clientWidth,this.oldHeight=i.clientHeight,e&&e.isPresenting){console.log("WebVR::vrResize(): display ("+e.displayName+") currently presenting");var o=e.getEyeParameters("left"),a=e.getEyeParameters("right");console.log("&&&&&viewportWidth:"+t.viewportWidth+" canvas.width:"+r.width+" canvas.clientWidth:"+r.clientWidth+" leftEye:"+o.renderWidth+" rightEye:"+a.renderWidth);var s=Math.floor(2*Math.max(o.renderWidth,a.renderWidth)*n),u=Math.floor(Math.max(o.renderHeight,a.renderHeight)*n);r.width=s,r.height=u,t.viewportWidth=s,t.viewportHeight=u,t.viewport(0,0,t.viewportWidth,t.viewportHeight),console.log("&&&&&viewportWidth:"+t.viewportWidth+" canvas.width:"+r.width+" canvas.clientWidth:"+r.clientWidth+" leftEye:"+o.renderWidth+" rightEye:"+a.renderWidth),console.log("WebVR::vrResize(): new width:"+s+" height:"+u)}else i.style.width="",i.style.height="",console.log("WebVR::vrResize(): calling standard window resize"),this.webgl.resizeCanvas(!0)}},{key:"presentChange",value:function(){var e=this.cDisplay;if(console.log("WebVR::presentChange(): event for "+e.displayName),this.vrResize(),e.isPresenting)console.log("WebVR::presentChange(): is presenting..."),e.capabilities&&e.capabilities.hasExternalDisplay;else{console.log("WebVR::presentChange(): is NOT presenting...");this.webgl.getCanvas();this.webgl.getCanvas().width!==this.lastCWidth&&(this.webgl.getCanvas().width=this.lastCWidth,this.webgl.getContext().viewport(0,0,this.lastCWidth,this.lastCHeight)),this.webgl.getCanvas().height!==this.lastCHeight&&(this.webgl.getCanvas().height=this.lastCHeight,this.webgl.getContext().viewport(0,0,this.lastCWidth,this.lastCHeight)),this.util.emitter.emit(this.util.emitter.events.VR_DISPLAY_EXIT,null),e.capabilities&&e.capabilities.hasExternalDisplay}}},{key:"displayBlur",value:function(){console.warn("WebVR::displayBlur(): display blur event")}},{key:"displayFocus",value:function(){console.warn("WebVR::displayFocus(): display focus event")}},{key:"displayActivated",value:function(){console.warn("WebVR::displayActivated(): display activation event")}},{key:"displayDeactivated",value:function(){console.warn("WebVR::displayDeactivated(): display deactivation event")}},{key:"displayConnected",value:function(){console.warn("WebVR::displayConnected(): display connected event")}},{key:"displayDisconnected",value:function(){console.warn("WebVR::displayDisconnected(): display disconnected event")}},{key:"reportWebVR",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;if(this.util.isNumber(e)&&(e=this.displays[e]||null),e){var t=e.capabilities||{};return{id:e.displayId,name:e.displayName,present:t.canPresent||!1,externalHMD:t.hasExternalDisplay||!1,pose:t.hasPosition||!1,orientation:t.hasOrientation||!1,maxLayers:t.maxLayers||!1}}return null}}]),e}();t.default=n},function(e,t,r){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var s=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),u=r(1),l=i(u),c=r(6),h=i(c),d=r(9),f=i(d),v=r(14),m=i(v),p=r(4),g=i(p),y=r(5),A=(i(y),r(3)),b=(i(A),r(8)),E=i(b),M=function(e){function t(e,r,i,a,s,u,l,c){n(this,t);var d=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,i.util));return console.log("in World class"),d.glMatrix=r,d.webgl=i,d.util=i.util,d.vr=a,d.gamepad=s,d.shaderPool=u,d.texturePool=new f.default(e,d.util,i),d.materialPool=new m.default(e,d.util,i,d.texturePool),d.modelPool=new g.default(e,d.util,i,d.texturePool,d.materialPool),d.geometryPool=new h.default(e,d.util,r,i,d.modelPool),d.primFactory=new E.default(!0,d),d.default(),d.lights=l,d.ui=c,d.worldMimeTypes={json:"text/plain",gltf:"text/tgltf",gltfBinary:"bin/gltf"},d.worldPaths=["world/default-world.json","world/gltf-world.json","world/obj-world.json","world/tangled-world.json","world/celestial-world.json"],d.stats={fps:0},d.canvas=i.getCanvas(),d.glMatrix=i.glMatrix,d.wvMatrix=r.mat4.create(),d.pMatrix=d.glMatrix.mat4.create(),d.mvMatrix=d.glMatrix.mat4.create(),d.last=performance.now(),d.rafId=null,d.counters={fps:0,fps_max:300,geolocate:0,geolocate_max:18e3,housekeep:0},d.render=d.render.bind(d),d.defaultKey=d.addAsset(d.default(),"").key,d.util.emitter.on(d.util.emitter.events.VR_DISPLAY_READY,function(e){null!==d.rafId&&(console.log("VR_DISPLAY_READY, display typeof:"+d.vr.getDisplay()),d.stop(),d.start())}),d.util.emitter.on(d.util.emitter.events.WORLD_GEOLOCATION_READY,function(e){if(console.log("World::WORLD_GEOLOCATION_READY event"),d.util.isNumber(e.latitude)&&d.util.isNumber(e.longitude)){d.geoData=e;for(var t in d.primFactory.keyList){var r=d.primFactory.keyList[t];r.geolocate===!0&&(console.log("World::WORLD_GEOLOCATION_READY event, setting geoData lat:"+e.latitude+" long:"+e.longitude),d.computeSkyRotation(r,e))}}}),d}return a(t,e),s(t,[{key:"default",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[0,0,-5],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[0,0,0],r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[100,100,100],i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"no name",n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"none",o=(arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]?arguments[6]:null),a=arguments.length>7&&void 0!==arguments[7]?arguments[7]:{},s={scene:{active:!1,path:"",name:i,description:n,dimensions:r[0],position:e[0],rotation:t[0],light:o,connections:a}},u=s.scene;return this.position=u.position,this.rotation=u.rotation,this.dimensions=u.dimensions,this.name=u.name,this.description=u.description,this.geolocate=u.geolocate,this.connections=u.connections,o&&this.setLights(u.lights),s}},{key:"init",value:function(){this.glMatrix.vec3,this.glMatrix.vec4,this.primFactory.geometryPool.vec5,this.primFactory.geometryPool.typeList,this.primFactory.geometryPool.directions,this.util;this.s0=this.shaderPool.getAssetByName("shaderFader"),this.s1=this.shaderPool.getAssetByName("shaderTexture"),this.s2=this.shaderPool.getAssetByName("shaderColor");for(var e=0;e<this.worldPaths.length;e++)this.getWorld(this.worldPaths[e]);this.r0=this.s0.init(),this.r1=this.s1.init(),this.r2=this.s2.init(),this.start()}},{key:"getShaders",value:function(){return[this.s0,this.s1,this.s2]}},{key:"getWorldScenes",value:function(){var e={},t=this.getAllAssets();for(var r in t){var i=t[r];e[r]=i.scene}return e}},{key:"getActiveWorld",value:function(){for(var e in this.keyList){var t=this.keyList[e];if(t.scene.active)return t}return null}},{key:"getPrim",value:function(e,t){var r=this.glMatrix.vec3,i=(this.glMatrix.vec4,this.primFactory.geometryPool.vec5),n=this.primFactory.geometryPool.typeList,o=(this.primFactory.geometryPool.directions,this.util);if(!t)return console.error("World::getPrim(): no worldKey supplied, aborting Prim load"),null;var a=this.shaderPool.getAssetByName(e.shader);if(a){a.name&&console.log(".....World::getPrim(): prim:"+e.name+" Shader is:"+a.name),o.isNumber(e.dimensions[3])&&(e.dimensions[3]=parseFloat(e.dimensions[3])),o.isNumber(e.dimensions[4])&&(e.dimensions[4]=parseFloat(e.dimensions[4])),o.isNumber(e.divisions[3])&&(e.divisions[3]=parseFloat(e.divisions[3])),o.isNumber(e.divisions[4])&&(e.divisions[4]=parseFloat(e.divisions[4])),e.useColorArray&&(e.useColorArray=JSON.parse(e.useColorArray)),e.useFaceTextures&&(e.useFaceTextures=JSON.parse(e.useFaceTextures)),e.useLighting&&(e.useLighting=JSON.parse(e.useLighting)),e.useMetaData&&(e.useMetaData=JSON.parse(e.useMetaData));var s=this.primFactory.computePrim(this.shaderPool.getAssetByName(e.shader),n[e.type],e.name,i(parseFloat(e.dimensions[0]),parseFloat(e.dimensions[1]),parseFloat(e.dimensions[2]),e.dimensions[3],e.dimensions[4]),i(parseFloat(e.divisions[0]),parseFloat(e.divisions[1]),parseFloat(e.divisions[2]),e.divisions[3],e.divisions[4]),r.fromValues(parseFloat(e.position[0]),parseFloat(e.position[1]),parseFloat(e.position[2])),r.fromValues(parseFloat(e.acceleration[0]),parseFloat(e.acceleration[1]),parseFloat(e.acceleration[2])),r.fromValues(o.degToRad(e.rotation[0]),o.degToRad(e.rotation[1]),o.degToRad(e.rotation[2])),r.fromValues(o.degToRad(e.angular[0]),o.degToRad(e.angular[1]),o.degToRad(e.angular[2])),e.textures,e.models,e.useColorArray,e.useFaceTextures,e.useLighting,e.useMetaData,e.pSystem,e.animSystem);return s.worldKey=t,s}return console.error("World::getPrim(): no shader for:"+e.name),null}},{key:"computeWorld",value:function(e){var t=this.util;if(console.log(".....World::computeWorld(): in computeWorld, world is:"+e),e&&e.scene){if(e.scene.active=JSON.parse(e.scene.active),e.scene.active===!0){console.log("......World::computeWorld(): world.scene.active === true, computing Prims...");for(var r in e){var i=e[r];switch(r){case"scene":this.position=i.position,this.rotation=i.rotation,this.setLights(i.lights),i.geolocate&&t.getGeolocation();break;case"key":break;case"path":break;default:console.log("......World::computeWorld(): prim "+i.name+" being loaded...");var n=e[r];n.geometry?console.log("....World::computeWorld(): prim:"+i.name+" already exists, no load needed"):(console.log(".......World::computeWorld(): prim "+i.name+" NOT instantated yet, doing so"),e[r]=this.getPrim(i,e.key),console.log(".....World::computeWorld(): GOTTEN prim: "+r+" is:"+e[r]))}}}this.util.emitter.emit(this.emitter.events.WORLD_DEFINITION_READY)}else console.warn("World::getWorld(): Invalid World "+e+" with no scene:");return e}},{key:"getWorld",value:function(e){var t=this,r=this.util,i=this.worldMimeTypes[r.getFileExtension(e)]||this.worldMimeTypes.json;i?this.doRequest(e,0,function(i){if(i.data){var n=r.parseJSON(i.data);if(n){console.log("..........World::getWorld(): World: "+n.scene.name+" found, setting path:"+e),n.path=e;var o=r.computeId();console.log(".........World::getWorld(): adding world:"+n.scene.name+" with asset with key:"+o);var a=t.addAsset(n,o);a!==n&&console.error("...........World::getWorld(): did not add asset for world:"+n.scene.name),t.computeWorld(n)}else console.error("World::getWorld():World file:"+e+" could not be parsed")}else console.error("World::getWorld(): World file, no data found for:"+i.path)},!0,i,0):console.error('World::getWorld(): file type "'+r.getFileExtension(e)+'" in:'+e+" not supported, not loading");
}},{key:"switchWorld",value:function(e){var t=this.getAssetByKey(e);if(console.log("World::switchWorld(): world is a:"+t),t){for(var r in this.keyList)this.keyList[r].scene.active=!1;t.scene.active=!0,this.computeWorld(t),console.log("World::switchWorld(): going to setActivePrims(): with:"+this.keyList[e].scene.name),this.primFactory.setActivePrims(t)}else console.error("World::switchWorld(): invalid worldKey:"+e)}},{key:"addPrimToWorld",value:function(e,t){var r=JSON.stringify(t),i=this.getAsset(e);return i+JSON.parse(r)}},{key:"removePrimFromWorld",value:function(e,t){var r=this.primFactory.getAsset(t);if(r){var i=this.getAsset(prim.worldKey);if(i)for(var n in i){var o=i[n];o.key===prim.worldKey&&(delete i[n],r=this.primFactory.deletePrim(prim))}}return r}},{key:"teleportPrim",value:function(e,t,r){this.removePrimFromWorld(e,r);this.addPrimToWorld(worldKey,r)}},{key:"setLights",value:function(e){for(var t in e){e[t];this.lights.setLight(this.lights.lightTypes[t],t.ambient,t.lightingDirection,t.directionalColor,t.active)}}},{key:"getPOV",value:function(){return{position:this.position,rotation:this.rotation}}},{key:"resize",value:function(e,t,r){console.error("world::resize(): not implemented yet!")}},{key:"saveWorld",value:function(e){console.error("World::saveWorld(): not implemented yet!")}},{key:"computeSkyRotation",value:function(e,t){if(!e.geolocate)return void console.error("World::computeSkyRotation(): prim "+e.name+" does not geolocate");if(this.util.isNumber(t.latitude)&&this.util.isNumber(t.longitude)){e.rotation[0]=this.util.degToRad(-90+t.latitude);var r=new Date,i=this.util.hoursToDeg(r.getUTCHours(),r.getUTCMinutes(),r.getUTCSeconds());e.rotation[1]=-this.util.degToRad(t.longitude-i),e.rotation[2]=this.util.degToRad(90)}else console.warn("World::computeSkyRotation(): invalid geoData")}},{key:"computeSunPosition",value:function(e){}},{key:"computePlanetPositions",value:function(e){}},{key:"start",value:function(){return console.log("World::start(): starting animation"),this.vr.setWorld(this),this.gamepad.setWorld(this),this.ui.setWorld(this),this.rafId=this.vr.getDisplay().requestAnimationFrame(this.render)}},{key:"stop",value:function(){return console.log("World::stop(): stopping animation"),this.vr.getDisplay().cancelAnimationFrame(this.rafId),this.rafId=null}},{key:"housekeep",value:function(){}},{key:"update",value:function(){var e=this.counters;e.fps++;var t=performance.now(),r=t-this.last;e.fps>e.fps_max&&(this.stats.fps=parseInt(1e3/(r/this.counters.fps))+" fps",this.last=t,e.fps=0),e.geolocate++,e.geolocate>e.geolocate_max&&(e.geolocate=0,this.util.getGeolocation());this.lights.getPos()}},{key:"getWorldViewMatrix",value:function(e){var t=this.glMatrix.mat4,r=this.getPOV();t.rotate(e,e,r.rotation[1],[0,1,0]),t.rotate(e,e,r.rotation[0],[1,0,0]),t.translate(e,e,r.position)}},{key:"render",value:function(){var e=this.glMatrix.mat4,t=this.wvMatrix,r=this.vr,i=this.getPOV();this.update(),this.webgl.clear();var n=r.getDisplay();if(e.identity(t),n)if(n.isPresenting){this.rafId=n.requestAnimationFrame(this.render);var o=r.getFrameData();null!==o?(this.getWorldViewMatrix(t),this.r1.renderVR(r,o,t,i),this.r2.renderVR(r,o,t,i),this.r0.renderVR(r,o,t,i),n.submitFrame()):console.error("World::render(): invalid VRFrameData")}else this.rafId=n.requestAnimationFrame(this.render),this.getWorldViewMatrix(t),this.r1.renderMono(r,t,i),this.r2.renderMono(r,t,i),this.r0.renderMono(r,t,i);else console.error("World::render(): no display")}}]),t}(l.default);t.default=M},function(e,t,r){!function(t,r){e.exports=r()}(this,function(){return function(e){function t(i){if(r[i])return r[i].exports;var n=r[i]={i:i,l:!1,exports:{}};return e[i].call(n.exports,n,n.exports,t),n.l=!0,n.exports}var r={};return t.m=e,t.c=r,t.d=function(e,r,i){t.o(e,r)||Object.defineProperty(e,r,{configurable:!1,enumerable:!0,get:i})},t.n=function(e){var r=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(r,"a",r),r},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=4)}([function(e,t,r){"use strict";function i(e){t.ARRAY_TYPE=s=e}function n(e){return e*u}function o(e,t){return Math.abs(e-t)<=a*Math.max(1,Math.abs(e),Math.abs(t))}Object.defineProperty(t,"__esModule",{value:!0}),t.setMatrixArrayType=i,t.toRadian=n,t.equals=o;var a=t.EPSILON=1e-6,s=t.ARRAY_TYPE="undefined"!=typeof Float32Array?Float32Array:Array,u=(t.RANDOM=Math.random,Math.PI/180)},function(e,t,r){"use strict";function i(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}function n(){var e=new L.ARRAY_TYPE(9);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e}function o(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[4],e[4]=t[5],e[5]=t[6],e[6]=t[8],e[7]=t[9],e[8]=t[10],e}function a(e){var t=new L.ARRAY_TYPE(9);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t}function s(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e}function u(e,t,r,i,n,o,a,s,u){var l=new L.ARRAY_TYPE(9);return l[0]=e,l[1]=t,l[2]=r,l[3]=i,l[4]=n,l[5]=o,l[6]=a,l[7]=s,l[8]=u,l}function l(e,t,r,i,n,o,a,s,u,l){return e[0]=t,e[1]=r,e[2]=i,e[3]=n,e[4]=o,e[5]=a,e[6]=s,e[7]=u,e[8]=l,e}function c(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e}function h(e,t){if(e===t){var r=t[1],i=t[2],n=t[5];e[1]=t[3],e[2]=t[6],e[3]=r,e[5]=t[7],e[6]=i,e[7]=n}else e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8];return e}function d(e,t){var r=t[0],i=t[1],n=t[2],o=t[3],a=t[4],s=t[5],u=t[6],l=t[7],c=t[8],h=c*a-s*l,d=-c*o+s*u,f=l*o-a*u,v=r*h+i*d+n*f;return v?(v=1/v,e[0]=h*v,e[1]=(-c*i+n*l)*v,e[2]=(s*i-n*a)*v,e[3]=d*v,e[4]=(c*r-n*u)*v,e[5]=(-s*r+n*o)*v,e[6]=f*v,e[7]=(-l*r+i*u)*v,e[8]=(a*r-i*o)*v,e):null}function f(e,t){var r=t[0],i=t[1],n=t[2],o=t[3],a=t[4],s=t[5],u=t[6],l=t[7],c=t[8];return e[0]=a*c-s*l,e[1]=n*l-i*c,e[2]=i*s-n*a,e[3]=s*u-o*c,e[4]=r*c-n*u,e[5]=n*o-r*s,e[6]=o*l-a*u,e[7]=i*u-r*l,e[8]=r*a-i*o,e}function v(e){var t=e[0],r=e[1],i=e[2],n=e[3],o=e[4],a=e[5],s=e[6],u=e[7],l=e[8];return t*(l*o-a*u)+r*(-l*n+a*s)+i*(u*n-o*s)}function m(e,t,r){var i=t[0],n=t[1],o=t[2],a=t[3],s=t[4],u=t[5],l=t[6],c=t[7],h=t[8],d=r[0],f=r[1],v=r[2],m=r[3],p=r[4],g=r[5],y=r[6],A=r[7],b=r[8];return e[0]=d*i+f*a+v*l,e[1]=d*n+f*s+v*c,e[2]=d*o+f*u+v*h,e[3]=m*i+p*a+g*l,e[4]=m*n+p*s+g*c,e[5]=m*o+p*u+g*h,e[6]=y*i+A*a+b*l,e[7]=y*n+A*s+b*c,e[8]=y*o+A*u+b*h,e}function p(e,t,r){var i=t[0],n=t[1],o=t[2],a=t[3],s=t[4],u=t[5],l=t[6],c=t[7],h=t[8],d=r[0],f=r[1];return e[0]=i,e[1]=n,e[2]=o,e[3]=a,e[4]=s,e[5]=u,e[6]=d*i+f*a+l,e[7]=d*n+f*s+c,e[8]=d*o+f*u+h,e}function g(e,t,r){var i=t[0],n=t[1],o=t[2],a=t[3],s=t[4],u=t[5],l=t[6],c=t[7],h=t[8],d=Math.sin(r),f=Math.cos(r);return e[0]=f*i+d*a,e[1]=f*n+d*s,e[2]=f*o+d*u,e[3]=f*a-d*i,e[4]=f*s-d*n,e[5]=f*u-d*o,e[6]=l,e[7]=c,e[8]=h,e}function y(e,t,r){var i=r[0],n=r[1];return e[0]=i*t[0],e[1]=i*t[1],e[2]=i*t[2],e[3]=n*t[3],e[4]=n*t[4],e[5]=n*t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e}function A(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=t[0],e[7]=t[1],e[8]=1,e}function b(e,t){var r=Math.sin(t),i=Math.cos(t);return e[0]=i,e[1]=r,e[2]=0,e[3]=-r,e[4]=i,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e}function E(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=0,e[4]=t[1],e[5]=0,e[6]=0,e[7]=0,e[8]=1,e}function M(e,t){return e[0]=t[0],e[1]=t[1],e[2]=0,e[3]=t[2],e[4]=t[3],e[5]=0,e[6]=t[4],e[7]=t[5],e[8]=1,e}function x(e,t){var r=t[0],i=t[1],n=t[2],o=t[3],a=r+r,s=i+i,u=n+n,l=r*a,c=i*a,h=i*s,d=n*a,f=n*s,v=n*u,m=o*a,p=o*s,g=o*u;return e[0]=1-h-v,e[3]=c-g,e[6]=d+p,e[1]=c+g,e[4]=1-l-v,e[7]=f-m,e[2]=d-p,e[5]=f+m,e[8]=1-l-h,e}function w(e,t){var r=t[0],i=t[1],n=t[2],o=t[3],a=t[4],s=t[5],u=t[6],l=t[7],c=t[8],h=t[9],d=t[10],f=t[11],v=t[12],m=t[13],p=t[14],g=t[15],y=r*s-i*a,A=r*u-n*a,b=r*l-o*a,E=i*u-n*s,M=i*l-o*s,x=n*l-o*u,w=c*m-h*v,T=c*p-d*v,P=c*g-f*v,D=h*p-d*m,R=h*g-f*m,C=d*g-f*p,S=y*C-A*R+b*D+E*P-M*T+x*w;return S?(S=1/S,e[0]=(s*C-u*R+l*D)*S,e[1]=(u*P-a*C-l*T)*S,e[2]=(a*R-s*P+l*w)*S,e[3]=(n*R-i*C-o*D)*S,e[4]=(r*C-n*P+o*T)*S,e[5]=(i*P-r*R-o*w)*S,e[6]=(m*x-p*M+g*E)*S,e[7]=(p*b-v*x-g*A)*S,e[8]=(v*M-m*b+g*y)*S,e):null}function T(e,t,r){return e[0]=2/t,e[1]=0,e[2]=0,e[3]=0,e[4]=-2/r,e[5]=0,e[6]=-1,e[7]=1,e[8]=1,e}function P(e){return"mat3("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+")"}function D(e){return Math.sqrt(Math.pow(e[0],2)+Math.pow(e[1],2)+Math.pow(e[2],2)+Math.pow(e[3],2)+Math.pow(e[4],2)+Math.pow(e[5],2)+Math.pow(e[6],2)+Math.pow(e[7],2)+Math.pow(e[8],2))}function R(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e[3]=t[3]+r[3],e[4]=t[4]+r[4],e[5]=t[5]+r[5],e[6]=t[6]+r[6],e[7]=t[7]+r[7],e[8]=t[8]+r[8],e}function C(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e[3]=t[3]-r[3],e[4]=t[4]-r[4],e[5]=t[5]-r[5],e[6]=t[6]-r[6],e[7]=t[7]-r[7],e[8]=t[8]-r[8],e}function S(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e[4]=t[4]*r,e[5]=t[5]*r,e[6]=t[6]*r,e[7]=t[7]*r,e[8]=t[8]*r,e}function O(e,t,r,i){return e[0]=t[0]+r[0]*i,e[1]=t[1]+r[1]*i,e[2]=t[2]+r[2]*i,e[3]=t[3]+r[3]*i,e[4]=t[4]+r[4]*i,e[5]=t[5]+r[5]*i,e[6]=t[6]+r[6]*i,e[7]=t[7]+r[7]*i,e[8]=t[8]+r[8]*i,e}function I(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[7]===t[7]&&e[8]===t[8]}function k(e,t){var r=e[0],i=e[1],n=e[2],o=e[3],a=e[4],s=e[5],u=e[6],l=e[7],c=e[8],h=t[0],d=t[1],f=t[2],v=t[3],m=t[4],p=t[5],g=t[6],y=t[7],A=t[8];return Math.abs(r-h)<=L.EPSILON*Math.max(1,Math.abs(r),Math.abs(h))&&Math.abs(i-d)<=L.EPSILON*Math.max(1,Math.abs(i),Math.abs(d))&&Math.abs(n-f)<=L.EPSILON*Math.max(1,Math.abs(n),Math.abs(f))&&Math.abs(o-v)<=L.EPSILON*Math.max(1,Math.abs(o),Math.abs(v))&&Math.abs(a-m)<=L.EPSILON*Math.max(1,Math.abs(a),Math.abs(m))&&Math.abs(s-p)<=L.EPSILON*Math.max(1,Math.abs(s),Math.abs(p))&&Math.abs(u-g)<=L.EPSILON*Math.max(1,Math.abs(u),Math.abs(g))&&Math.abs(l-y)<=L.EPSILON*Math.max(1,Math.abs(l),Math.abs(y))&&Math.abs(c-A)<=L.EPSILON*Math.max(1,Math.abs(c),Math.abs(A))}Object.defineProperty(t,"__esModule",{value:!0}),t.sub=t.mul=void 0,t.create=n,t.fromMat4=o,t.clone=a,t.copy=s,t.fromValues=u,t.set=l,t.identity=c,t.transpose=h,t.invert=d,t.adjoint=f,t.determinant=v,t.multiply=m,t.translate=p,t.rotate=g,t.scale=y,t.fromTranslation=A,t.fromRotation=b,t.fromScaling=E,t.fromMat2d=M,t.fromQuat=x,t.normalFromMat4=w,t.projection=T,t.str=P,t.frob=D,t.add=R,t.subtract=C,t.multiplyScalar=S,t.multiplyScalarAndAdd=O,t.exactEquals=I,t.equals=k;var _=r(0),L=i(_);t.mul=m,t.sub=C},function(e,t,r){"use strict";function i(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}function n(){var e=new Y.ARRAY_TYPE(3);return e[0]=0,e[1]=0,e[2]=0,e}function o(e){var t=new Y.ARRAY_TYPE(3);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t}function a(e){var t=e[0],r=e[1],i=e[2];return Math.sqrt(t*t+r*r+i*i)}function s(e,t,r){var i=new Y.ARRAY_TYPE(3);return i[0]=e,i[1]=t,i[2]=r,i}function u(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e}function l(e,t,r,i){return e[0]=t,e[1]=r,e[2]=i,e}function c(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e}function h(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e}function d(e,t,r){return e[0]=t[0]*r[0],e[1]=t[1]*r[1],e[2]=t[2]*r[2],e}function f(e,t,r){return e[0]=t[0]/r[0],e[1]=t[1]/r[1],e[2]=t[2]/r[2],e}function v(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e[2]=Math.ceil(t[2]),e}function m(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e[2]=Math.floor(t[2]),e}function p(e,t,r){return e[0]=Math.min(t[0],r[0]),e[1]=Math.min(t[1],r[1]),e[2]=Math.min(t[2],r[2]),e}function g(e,t,r){return e[0]=Math.max(t[0],r[0]),e[1]=Math.max(t[1],r[1]),e[2]=Math.max(t[2],r[2]),e}function y(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e[2]=Math.round(t[2]),e}function A(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e}function b(e,t,r,i){return e[0]=t[0]+r[0]*i,e[1]=t[1]+r[1]*i,e[2]=t[2]+r[2]*i,e}function E(e,t){var r=t[0]-e[0],i=t[1]-e[1],n=t[2]-e[2];return Math.sqrt(r*r+i*i+n*n)}function M(e,t){var r=t[0]-e[0],i=t[1]-e[1],n=t[2]-e[2];return r*r+i*i+n*n}function x(e){var t=e[0],r=e[1],i=e[2];return t*t+r*r+i*i}function w(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e}function T(e,t){return e[0]=1/t[0],e[1]=1/t[1],e[2]=1/t[2],e}function P(e,t){var r=t[0],i=t[1],n=t[2],o=r*r+i*i+n*n;return o>0&&(o=1/Math.sqrt(o),e[0]=t[0]*o,e[1]=t[1]*o,e[2]=t[2]*o),e}function D(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function R(e,t,r){var i=t[0],n=t[1],o=t[2],a=r[0],s=r[1],u=r[2];return e[0]=n*u-o*s,e[1]=o*a-i*u,e[2]=i*s-n*a,e}function C(e,t,r,i){var n=t[0],o=t[1],a=t[2];return e[0]=n+i*(r[0]-n),e[1]=o+i*(r[1]-o),e[2]=a+i*(r[2]-a),e}function S(e,t,r,i,n,o){var a=o*o,s=a*(2*o-3)+1,u=a*(o-2)+o,l=a*(o-1),c=a*(3-2*o);return e[0]=t[0]*s+r[0]*u+i[0]*l+n[0]*c,e[1]=t[1]*s+r[1]*u+i[1]*l+n[1]*c,e[2]=t[2]*s+r[2]*u+i[2]*l+n[2]*c,e}function O(e,t,r,i,n,o){var a=1-o,s=a*a,u=o*o,l=s*a,c=3*o*s,h=3*u*a,d=u*o;return e[0]=t[0]*l+r[0]*c+i[0]*h+n[0]*d,e[1]=t[1]*l+r[1]*c+i[1]*h+n[1]*d,e[2]=t[2]*l+r[2]*c+i[2]*h+n[2]*d,e}function I(e,t){t=t||1;var r=2*Y.RANDOM()*Math.PI,i=2*Y.RANDOM()-1,n=Math.sqrt(1-i*i)*t;return e[0]=Math.cos(r)*n,e[1]=Math.sin(r)*n,e[2]=i*t,e}function k(e,t,r){var i=t[0],n=t[1],o=t[2],a=r[3]*i+r[7]*n+r[11]*o+r[15];return a=a||1,e[0]=(r[0]*i+r[4]*n+r[8]*o+r[12])/a,e[1]=(r[1]*i+r[5]*n+r[9]*o+r[13])/a,e[2]=(r[2]*i+r[6]*n+r[10]*o+r[14])/a,e}function _(e,t,r){var i=t[0],n=t[1],o=t[2];return e[0]=i*r[0]+n*r[3]+o*r[6],e[1]=i*r[1]+n*r[4]+o*r[7],e[2]=i*r[2]+n*r[5]+o*r[8],e}function L(e,t,r){var i=t[0],n=t[1],o=t[2],a=r[0],s=r[1],u=r[2],l=r[3],c=l*i+s*o-u*n,h=l*n+u*i-a*o,d=l*o+a*n-s*i,f=-a*i-s*n-u*o;return e[0]=c*l+f*-a+h*-u-d*-s,e[1]=h*l+f*-s+d*-a-c*-u,e[2]=d*l+f*-u+c*-s-h*-a,e}function N(e,t,r,i){var n=[],o=[];return n[0]=t[0]-r[0],n[1]=t[1]-r[1],n[2]=t[2]-r[2],o[0]=n[0],o[1]=n[1]*Math.cos(i)-n[2]*Math.sin(i),o[2]=n[1]*Math.sin(i)+n[2]*Math.cos(i),e[0]=o[0]+r[0],e[1]=o[1]+r[1],e[2]=o[2]+r[2],e}function F(e,t,r,i){var n=[],o=[];return n[0]=t[0]-r[0],n[1]=t[1]-r[1],n[2]=t[2]-r[2],o[0]=n[2]*Math.sin(i)+n[0]*Math.cos(i),o[1]=n[1],o[2]=n[2]*Math.cos(i)-n[0]*Math.sin(i),e[0]=o[0]+r[0],e[1]=o[1]+r[1],e[2]=o[2]+r[2],e}function B(e,t,r,i){var n=[],o=[];return n[0]=t[0]-r[0],n[1]=t[1]-r[1],n[2]=t[2]-r[2],o[0]=n[0]*Math.cos(i)-n[1]*Math.sin(i),o[1]=n[0]*Math.sin(i)+n[1]*Math.cos(i),o[2]=n[2],e[0]=o[0]+r[0],e[1]=o[1]+r[1],e[2]=o[2]+r[2],e}function V(e,t){var r=s(e[0],e[1],e[2]),i=s(t[0],t[1],t[2]);P(r,r),P(i,i);var n=D(r,i);return n>1?0:n<-1?Math.PI:Math.acos(n)}function U(e){return"vec3("+e[0]+", "+e[1]+", "+e[2]+")"}function G(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]}function W(e,t){var r=e[0],i=e[1],n=e[2],o=t[0],a=t[1],s=t[2];return Math.abs(r-o)<=Y.EPSILON*Math.max(1,Math.abs(r),Math.abs(o))&&Math.abs(i-a)<=Y.EPSILON*Math.max(1,Math.abs(i),Math.abs(a))&&Math.abs(n-s)<=Y.EPSILON*Math.max(1,Math.abs(n),Math.abs(s))}Object.defineProperty(t,"__esModule",{value:!0}),t.forEach=t.sqrLen=t.len=t.sqrDist=t.dist=t.div=t.mul=t.sub=void 0,t.create=n,t.clone=o,t.length=a,t.fromValues=s,t.copy=u,t.set=l,t.add=c,t.subtract=h,t.multiply=d,t.divide=f,t.ceil=v,t.floor=m,t.min=p,t.max=g,t.round=y,t.scale=A,t.scaleAndAdd=b,t.distance=E,t.squaredDistance=M,t.squaredLength=x,t.negate=w,t.inverse=T,t.normalize=P,t.dot=D,t.cross=R,t.lerp=C,t.hermite=S,t.bezier=O,t.random=I,t.transformMat4=k,t.transformMat3=_,t.transformQuat=L,t.rotateX=N,t.rotateY=F,t.rotateZ=B,t.angle=V,t.str=U,t.exactEquals=G,t.equals=W;var j=r(0),Y=i(j);t.sub=h,t.mul=d,t.div=f,t.dist=E,t.sqrDist=M,t.len=a,t.sqrLen=x,t.forEach=function(){var e=n();return function(t,r,i,n,o,a){var s=void 0,u=void 0;for(r||(r=3),i||(i=0),u=n?Math.min(n*r+i,t.length):t.length,s=i;s<u;s+=r)e[0]=t[s],e[1]=t[s+1],e[2]=t[s+2],o(e,e,a),t[s]=e[0],t[s+1]=e[1],t[s+2]=e[2];return t}}()},function(e,t,r){"use strict";function i(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}function n(){var e=new N.ARRAY_TYPE(4);return e[0]=0,e[1]=0,e[2]=0,e[3]=0,e}function o(e){var t=new N.ARRAY_TYPE(4);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t}function a(e,t,r,i){var n=new N.ARRAY_TYPE(4);return n[0]=e,n[1]=t,n[2]=r,n[3]=i,n}function s(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e}function u(e,t,r,i,n){return e[0]=t,e[1]=r,e[2]=i,e[3]=n,e}function l(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e[3]=t[3]+r[3],e}function c(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e[3]=t[3]-r[3],e}function h(e,t,r){return e[0]=t[0]*r[0],e[1]=t[1]*r[1],e[2]=t[2]*r[2],e[3]=t[3]*r[3],e}function d(e,t,r){return e[0]=t[0]/r[0],e[1]=t[1]/r[1],e[2]=t[2]/r[2],e[3]=t[3]/r[3],e}function f(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e[2]=Math.ceil(t[2]),e[3]=Math.ceil(t[3]),e}function v(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e[2]=Math.floor(t[2]),e[3]=Math.floor(t[3]),e}function m(e,t,r){return e[0]=Math.min(t[0],r[0]),e[1]=Math.min(t[1],r[1]),e[2]=Math.min(t[2],r[2]),e[3]=Math.min(t[3],r[3]),e}function p(e,t,r){return e[0]=Math.max(t[0],r[0]),e[1]=Math.max(t[1],r[1]),e[2]=Math.max(t[2],r[2]),e[3]=Math.max(t[3],r[3]),e}function g(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e[2]=Math.round(t[2]),e[3]=Math.round(t[3]),e}function y(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e}function A(e,t,r,i){return e[0]=t[0]+r[0]*i,e[1]=t[1]+r[1]*i,e[2]=t[2]+r[2]*i,e[3]=t[3]+r[3]*i,e}function b(e,t){var r=t[0]-e[0],i=t[1]-e[1],n=t[2]-e[2],o=t[3]-e[3];return Math.sqrt(r*r+i*i+n*n+o*o)}function E(e,t){var r=t[0]-e[0],i=t[1]-e[1],n=t[2]-e[2],o=t[3]-e[3];return r*r+i*i+n*n+o*o}function M(e){var t=e[0],r=e[1],i=e[2],n=e[3];return Math.sqrt(t*t+r*r+i*i+n*n)}function x(e){var t=e[0],r=e[1],i=e[2],n=e[3];return t*t+r*r+i*i+n*n}function w(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=-t[3],e}function T(e,t){return e[0]=1/t[0],e[1]=1/t[1],e[2]=1/t[2],e[3]=1/t[3],e}function P(e,t){var r=t[0],i=t[1],n=t[2],o=t[3],a=r*r+i*i+n*n+o*o;return a>0&&(a=1/Math.sqrt(a),e[0]=r*a,e[1]=i*a,e[2]=n*a,e[3]=o*a),e}function D(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]*t[3]}function R(e,t,r,i){var n=t[0],o=t[1],a=t[2],s=t[3];return e[0]=n+i*(r[0]-n),e[1]=o+i*(r[1]-o),e[2]=a+i*(r[2]-a),e[3]=s+i*(r[3]-s),e}function C(e,t){return t=t||1,e[0]=N.RANDOM(),e[1]=N.RANDOM(),e[2]=N.RANDOM(),e[3]=N.RANDOM(),P(e,e),y(e,e,t),e}function S(e,t,r){var i=t[0],n=t[1],o=t[2],a=t[3];return e[0]=r[0]*i+r[4]*n+r[8]*o+r[12]*a,e[1]=r[1]*i+r[5]*n+r[9]*o+r[13]*a,e[2]=r[2]*i+r[6]*n+r[10]*o+r[14]*a,e[3]=r[3]*i+r[7]*n+r[11]*o+r[15]*a,e}function O(e,t,r){var i=t[0],n=t[1],o=t[2],a=r[0],s=r[1],u=r[2],l=r[3],c=l*i+s*o-u*n,h=l*n+u*i-a*o,d=l*o+a*n-s*i,f=-a*i-s*n-u*o;return e[0]=c*l+f*-a+h*-u-d*-s,e[1]=h*l+f*-s+d*-a-c*-u,e[2]=d*l+f*-u+c*-s-h*-a,e[3]=t[3],e}function I(e){return"vec4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"}function k(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]}function _(e,t){var r=e[0],i=e[1],n=e[2],o=e[3],a=t[0],s=t[1],u=t[2],l=t[3];return Math.abs(r-a)<=N.EPSILON*Math.max(1,Math.abs(r),Math.abs(a))&&Math.abs(i-s)<=N.EPSILON*Math.max(1,Math.abs(i),Math.abs(s))&&Math.abs(n-u)<=N.EPSILON*Math.max(1,Math.abs(n),Math.abs(u))&&Math.abs(o-l)<=N.EPSILON*Math.max(1,Math.abs(o),Math.abs(l))}Object.defineProperty(t,"__esModule",{value:!0}),t.forEach=t.sqrLen=t.len=t.sqrDist=t.dist=t.div=t.mul=t.sub=void 0,t.create=n,t.clone=o,t.fromValues=a,t.copy=s,t.set=u,t.add=l,t.subtract=c,t.multiply=h,t.divide=d,t.ceil=f,t.floor=v,t.min=m,t.max=p,t.round=g,t.scale=y,t.scaleAndAdd=A,t.distance=b,t.squaredDistance=E,t.length=M,t.squaredLength=x,t.negate=w,t.inverse=T,t.normalize=P,t.dot=D,t.lerp=R,t.random=C,t.transformMat4=S,t.transformQuat=O,t.str=I,t.exactEquals=k,t.equals=_;var L=r(0),N=i(L);t.sub=c,t.mul=h,t.div=d,t.dist=b,t.sqrDist=E,t.len=M,t.sqrLen=x,t.forEach=function(){var e=n();return function(t,r,i,n,o,a){var s=void 0,u=void 0;for(r||(r=4),i||(i=0),u=n?Math.min(n*r+i,t.length):t.length,s=i;s<u;s+=r)e[0]=t[s],e[1]=t[s+1],e[2]=t[s+2],e[3]=t[s+3],o(e,e,a),t[s]=e[0],t[s+1]=e[1],t[s+2]=e[2],t[s+3]=e[3];return t}}()},function(e,t,r){"use strict";function i(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}Object.defineProperty(t,"__esModule",{value:!0}),t.vec4=t.vec3=t.vec2=t.quat=t.mat4=t.mat3=t.mat2d=t.mat2=t.glMatrix=void 0;var n=r(0),o=i(n),a=r(5),s=i(a),u=r(6),l=i(u),c=r(1),h=i(c),d=r(7),f=i(d),v=r(8),m=i(v),p=r(9),g=i(p),y=r(2),A=i(y),b=r(3),E=i(b);t.glMatrix=o,t.mat2=s,t.mat2d=l,t.mat3=h,t.mat4=f,t.quat=m,t.vec2=g,t.vec3=A,t.vec4=E},function(e,t,r){"use strict";function i(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}function n(){var e=new C.ARRAY_TYPE(4);return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e}function o(e){var t=new C.ARRAY_TYPE(4);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t}function a(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e}function s(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e}function u(e,t,r,i){var n=new C.ARRAY_TYPE(4);return n[0]=e,n[1]=t,n[2]=r,n[3]=i,n}function l(e,t,r,i,n){return e[0]=t,e[1]=r,e[2]=i,e[3]=n,e}function c(e,t){if(e===t){var r=t[1];e[1]=t[2],e[2]=r}else e[0]=t[0],e[1]=t[2],e[2]=t[1],e[3]=t[3];return e}function h(e,t){var r=t[0],i=t[1],n=t[2],o=t[3],a=r*o-n*i;return a?(a=1/a,e[0]=o*a,e[1]=-i*a,e[2]=-n*a,e[3]=r*a,e):null}function d(e,t){var r=t[0];return e[0]=t[3],e[1]=-t[1],e[2]=-t[2],e[3]=r,e}function f(e){return e[0]*e[3]-e[2]*e[1]}function v(e,t,r){var i=t[0],n=t[1],o=t[2],a=t[3],s=r[0],u=r[1],l=r[2],c=r[3];return e[0]=i*s+o*u,e[1]=n*s+a*u,e[2]=i*l+o*c,e[3]=n*l+a*c,e}function m(e,t,r){var i=t[0],n=t[1],o=t[2],a=t[3],s=Math.sin(r),u=Math.cos(r);return e[0]=i*u+o*s,e[1]=n*u+a*s,e[2]=i*-s+o*u,e[3]=n*-s+a*u,e}function p(e,t,r){var i=t[0],n=t[1],o=t[2],a=t[3],s=r[0],u=r[1];return e[0]=i*s,e[1]=n*s,e[2]=o*u,e[3]=a*u,e}function g(e,t){var r=Math.sin(t),i=Math.cos(t);return e[0]=i,e[1]=r,e[2]=-r,e[3]=i,e}function y(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=t[1],e}function A(e){return"mat2("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"}function b(e){return Math.sqrt(Math.pow(e[0],2)+Math.pow(e[1],2)+Math.pow(e[2],2)+Math.pow(e[3],2))}function E(e,t,r,i){return e[2]=i[2]/i[0],r[0]=i[0],r[1]=i[1],r[3]=i[3]-e[2]*r[1],[e,t,r]}function M(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e[3]=t[3]+r[3],e}function x(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e[3]=t[3]-r[3],e}function w(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]}function T(e,t){var r=e[0],i=e[1],n=e[2],o=e[3],a=t[0],s=t[1],u=t[2],l=t[3];return Math.abs(r-a)<=C.EPSILON*Math.max(1,Math.abs(r),Math.abs(a))&&Math.abs(i-s)<=C.EPSILON*Math.max(1,Math.abs(i),Math.abs(s))&&Math.abs(n-u)<=C.EPSILON*Math.max(1,Math.abs(n),Math.abs(u))&&Math.abs(o-l)<=C.EPSILON*Math.max(1,Math.abs(o),Math.abs(l))}function P(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e}function D(e,t,r,i){return e[0]=t[0]+r[0]*i,e[1]=t[1]+r[1]*i,e[2]=t[2]+r[2]*i,e[3]=t[3]+r[3]*i,e}Object.defineProperty(t,"__esModule",{value:!0}),t.sub=t.mul=void 0,t.create=n,t.clone=o,t.copy=a,t.identity=s,t.fromValues=u,t.set=l,t.transpose=c,t.invert=h,t.adjoint=d,t.determinant=f,t.multiply=v,t.rotate=m,t.scale=p,t.fromRotation=g,t.fromScaling=y,t.str=A,t.frob=b,t.LDU=E,t.add=M,t.subtract=x,t.exactEquals=w,t.equals=T,t.multiplyScalar=P,t.multiplyScalarAndAdd=D;var R=r(0),C=i(R);t.mul=v,t.sub=x},function(e,t,r){"use strict";function i(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}function n(){var e=new R.ARRAY_TYPE(6);return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e[4]=0,e[5]=0,e}function o(e){var t=new R.ARRAY_TYPE(6);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t}function a(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e}function s(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e[4]=0,e[5]=0,e}function u(e,t,r,i,n,o){var a=new R.ARRAY_TYPE(6);return a[0]=e,a[1]=t,a[2]=r,a[3]=i,a[4]=n,a[5]=o,a}function l(e,t,r,i,n,o,a){return e[0]=t,e[1]=r,e[2]=i,e[3]=n,e[4]=o,e[5]=a,e}function c(e,t){var r=t[0],i=t[1],n=t[2],o=t[3],a=t[4],s=t[5],u=r*o-i*n;return u?(u=1/u,e[0]=o*u,e[1]=-i*u,e[2]=-n*u,e[3]=r*u,e[4]=(n*s-o*a)*u,e[5]=(i*a-r*s)*u,e):null}function h(e){return e[0]*e[3]-e[1]*e[2]}function d(e,t,r){var i=t[0],n=t[1],o=t[2],a=t[3],s=t[4],u=t[5],l=r[0],c=r[1],h=r[2],d=r[3],f=r[4],v=r[5];return e[0]=i*l+o*c,e[1]=n*l+a*c,e[2]=i*h+o*d,e[3]=n*h+a*d,e[4]=i*f+o*v+s,e[5]=n*f+a*v+u,e}function f(e,t,r){var i=t[0],n=t[1],o=t[2],a=t[3],s=t[4],u=t[5],l=Math.sin(r),c=Math.cos(r);return e[0]=i*c+o*l,e[1]=n*c+a*l,e[2]=i*-l+o*c,e[3]=n*-l+a*c,e[4]=s,e[5]=u,e}function v(e,t,r){var i=t[0],n=t[1],o=t[2],a=t[3],s=t[4],u=t[5],l=r[0],c=r[1];return e[0]=i*l,e[1]=n*l,e[2]=o*c,e[3]=a*c,e[4]=s,e[5]=u,e}function m(e,t,r){var i=t[0],n=t[1],o=t[2],a=t[3],s=t[4],u=t[5],l=r[0],c=r[1];return e[0]=i,e[1]=n,e[2]=o,e[3]=a,e[4]=i*l+o*c+s,e[5]=n*l+a*c+u,e}function p(e,t){var r=Math.sin(t),i=Math.cos(t);return e[0]=i,e[1]=r,e[2]=-r,e[3]=i,e[4]=0,e[5]=0,e}function g(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=t[1],e[4]=0,e[5]=0,e}function y(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e[4]=t[0],e[5]=t[1],e}function A(e){return"mat2d("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+")"}function b(e){return Math.sqrt(Math.pow(e[0],2)+Math.pow(e[1],2)+Math.pow(e[2],2)+Math.pow(e[3],2)+Math.pow(e[4],2)+Math.pow(e[5],2)+1)}function E(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e[3]=t[3]+r[3],e[4]=t[4]+r[4],e[5]=t[5]+r[5],e}function M(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e[3]=t[3]-r[3],e[4]=t[4]-r[4],e[5]=t[5]-r[5],e}function x(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e[4]=t[4]*r,e[5]=t[5]*r,e}function w(e,t,r,i){return e[0]=t[0]+r[0]*i,e[1]=t[1]+r[1]*i,e[2]=t[2]+r[2]*i,e[3]=t[3]+r[3]*i,e[4]=t[4]+r[4]*i,e[5]=t[5]+r[5]*i,e}function T(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]}function P(e,t){var r=e[0],i=e[1],n=e[2],o=e[3],a=e[4],s=e[5],u=t[0],l=t[1],c=t[2],h=t[3],d=t[4],f=t[5];return Math.abs(r-u)<=R.EPSILON*Math.max(1,Math.abs(r),Math.abs(u))&&Math.abs(i-l)<=R.EPSILON*Math.max(1,Math.abs(i),Math.abs(l))&&Math.abs(n-c)<=R.EPSILON*Math.max(1,Math.abs(n),Math.abs(c))&&Math.abs(o-h)<=R.EPSILON*Math.max(1,Math.abs(o),Math.abs(h))&&Math.abs(a-d)<=R.EPSILON*Math.max(1,Math.abs(a),Math.abs(d))&&Math.abs(s-f)<=R.EPSILON*Math.max(1,Math.abs(s),Math.abs(f))}Object.defineProperty(t,"__esModule",{value:!0}),t.sub=t.mul=void 0,t.create=n,t.clone=o,t.copy=a,t.identity=s,t.fromValues=u,t.set=l,t.invert=c,t.determinant=h,t.multiply=d,t.rotate=f,t.scale=v,t.translate=m,t.fromRotation=p,t.fromScaling=g,t.fromTranslation=y,t.str=A,t.frob=b,t.add=E,t.subtract=M,t.multiplyScalar=x,t.multiplyScalarAndAdd=w,t.exactEquals=T,t.equals=P;var D=r(0),R=i(D);t.mul=d,t.sub=M},function(e,t,r){"use strict";function i(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}function n(){var e=new Q.ARRAY_TYPE(16);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function o(e){var t=new Q.ARRAY_TYPE(16);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function a(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function s(e,t,r,i,n,o,a,s,u,l,c,h,d,f,v,m){var p=new Q.ARRAY_TYPE(16);return p[0]=e,p[1]=t,p[2]=r,p[3]=i,p[4]=n,p[5]=o,p[6]=a,p[7]=s,p[8]=u,p[9]=l,p[10]=c,p[11]=h,p[12]=d,p[13]=f,p[14]=v,p[15]=m,p}function u(e,t,r,i,n,o,a,s,u,l,c,h,d,f,v,m,p){return e[0]=t,e[1]=r,e[2]=i,e[3]=n,e[4]=o,e[5]=a,e[6]=s,e[7]=u,e[8]=l,e[9]=c,e[10]=h,e[11]=d,e[12]=f,e[13]=v,e[14]=m,e[15]=p,e}function l(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function c(e,t){if(e===t){var r=t[1],i=t[2],n=t[3],o=t[6],a=t[7],s=t[11];e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=r,e[6]=t[9],e[7]=t[13],e[8]=i,e[9]=o,e[11]=t[14],e[12]=n,e[13]=a,e[14]=s}else e[0]=t[0],e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=t[1],e[5]=t[5],e[6]=t[9],e[7]=t[13],e[8]=t[2],e[9]=t[6],e[10]=t[10],e[11]=t[14],e[12]=t[3],e[13]=t[7],e[14]=t[11],e[15]=t[15];return e}function h(e,t){var r=t[0],i=t[1],n=t[2],o=t[3],a=t[4],s=t[5],u=t[6],l=t[7],c=t[8],h=t[9],d=t[10],f=t[11],v=t[12],m=t[13],p=t[14],g=t[15],y=r*s-i*a,A=r*u-n*a,b=r*l-o*a,E=i*u-n*s,M=i*l-o*s,x=n*l-o*u,w=c*m-h*v,T=c*p-d*v,P=c*g-f*v,D=h*p-d*m,R=h*g-f*m,C=d*g-f*p,S=y*C-A*R+b*D+E*P-M*T+x*w;return S?(S=1/S,e[0]=(s*C-u*R+l*D)*S,e[1]=(n*R-i*C-o*D)*S,e[2]=(m*x-p*M+g*E)*S,e[3]=(d*M-h*x-f*E)*S,e[4]=(u*P-a*C-l*T)*S,e[5]=(r*C-n*P+o*T)*S,e[6]=(p*b-v*x-g*A)*S,e[7]=(c*x-d*b+f*A)*S,e[8]=(a*R-s*P+l*w)*S,e[9]=(i*P-r*R-o*w)*S,e[10]=(v*M-m*b+g*y)*S,e[11]=(h*b-c*M-f*y)*S,e[12]=(s*T-a*D-u*w)*S,e[13]=(r*D-i*T+n*w)*S,e[14]=(m*A-v*E-p*y)*S,e[15]=(c*E-h*A+d*y)*S,e):null}function d(e,t){var r=t[0],i=t[1],n=t[2],o=t[3],a=t[4],s=t[5],u=t[6],l=t[7],c=t[8],h=t[9],d=t[10],f=t[11],v=t[12],m=t[13],p=t[14],g=t[15];return e[0]=s*(d*g-f*p)-h*(u*g-l*p)+m*(u*f-l*d),e[1]=-(i*(d*g-f*p)-h*(n*g-o*p)+m*(n*f-o*d)),e[2]=i*(u*g-l*p)-s*(n*g-o*p)+m*(n*l-o*u),e[3]=-(i*(u*f-l*d)-s*(n*f-o*d)+h*(n*l-o*u)),e[4]=-(a*(d*g-f*p)-c*(u*g-l*p)+v*(u*f-l*d)),e[5]=r*(d*g-f*p)-c*(n*g-o*p)+v*(n*f-o*d),e[6]=-(r*(u*g-l*p)-a*(n*g-o*p)+v*(n*l-o*u)),e[7]=r*(u*f-l*d)-a*(n*f-o*d)+c*(n*l-o*u),e[8]=a*(h*g-f*m)-c*(s*g-l*m)+v*(s*f-l*h),e[9]=-(r*(h*g-f*m)-c*(i*g-o*m)+v*(i*f-o*h)),e[10]=r*(s*g-l*m)-a*(i*g-o*m)+v*(i*l-o*s),e[11]=-(r*(s*f-l*h)-a*(i*f-o*h)+c*(i*l-o*s)),e[12]=-(a*(h*p-d*m)-c*(s*p-u*m)+v*(s*d-u*h)),e[13]=r*(h*p-d*m)-c*(i*p-n*m)+v*(i*d-n*h),e[14]=-(r*(s*p-u*m)-a*(i*p-n*m)+v*(i*u-n*s)),e[15]=r*(s*d-u*h)-a*(i*d-n*h)+c*(i*u-n*s),e}function f(e){var t=e[0],r=e[1],i=e[2],n=e[3],o=e[4],a=e[5],s=e[6],u=e[7],l=e[8],c=e[9],h=e[10],d=e[11],f=e[12],v=e[13],m=e[14],p=e[15],g=t*a-r*o,y=t*s-i*o,A=t*u-n*o,b=r*s-i*a,E=r*u-n*a,M=i*u-n*s,x=l*v-c*f,w=l*m-h*f,T=l*p-d*f,P=c*m-h*v,D=c*p-d*v,R=h*p-d*m;return g*R-y*D+A*P+b*T-E*w+M*x}function v(e,t,r){var i=t[0],n=t[1],o=t[2],a=t[3],s=t[4],u=t[5],l=t[6],c=t[7],h=t[8],d=t[9],f=t[10],v=t[11],m=t[12],p=t[13],g=t[14],y=t[15],A=r[0],b=r[1],E=r[2],M=r[3];return e[0]=A*i+b*s+E*h+M*m,e[1]=A*n+b*u+E*d+M*p,e[2]=A*o+b*l+E*f+M*g,e[3]=A*a+b*c+E*v+M*y,A=r[4],b=r[5],E=r[6],M=r[7],e[4]=A*i+b*s+E*h+M*m,e[5]=A*n+b*u+E*d+M*p,e[6]=A*o+b*l+E*f+M*g,e[7]=A*a+b*c+E*v+M*y,A=r[8],b=r[9],E=r[10],M=r[11],e[8]=A*i+b*s+E*h+M*m,e[9]=A*n+b*u+E*d+M*p,e[10]=A*o+b*l+E*f+M*g,e[11]=A*a+b*c+E*v+M*y,A=r[12],b=r[13],E=r[14],M=r[15],e[12]=A*i+b*s+E*h+M*m,e[13]=A*n+b*u+E*d+M*p,e[14]=A*o+b*l+E*f+M*g,e[15]=A*a+b*c+E*v+M*y,e}function m(e,t,r){var i=r[0],n=r[1],o=r[2],a=void 0,s=void 0,u=void 0,l=void 0,c=void 0,h=void 0,d=void 0,f=void 0,v=void 0,m=void 0,p=void 0,g=void 0;return t===e?(e[12]=t[0]*i+t[4]*n+t[8]*o+t[12],e[13]=t[1]*i+t[5]*n+t[9]*o+t[13],e[14]=t[2]*i+t[6]*n+t[10]*o+t[14],e[15]=t[3]*i+t[7]*n+t[11]*o+t[15]):(a=t[0],s=t[1],u=t[2],l=t[3],c=t[4],h=t[5],d=t[6],f=t[7],v=t[8],m=t[9],p=t[10],g=t[11],e[0]=a,e[1]=s,e[2]=u,e[3]=l,e[4]=c,e[5]=h,e[6]=d,e[7]=f,e[8]=v,e[9]=m,e[10]=p,e[11]=g,e[12]=a*i+c*n+v*o+t[12],e[13]=s*i+h*n+m*o+t[13],e[14]=u*i+d*n+p*o+t[14],e[15]=l*i+f*n+g*o+t[15]),e}function p(e,t,r){var i=r[0],n=r[1],o=r[2];return e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i,e[3]=t[3]*i,e[4]=t[4]*n,e[5]=t[5]*n,e[6]=t[6]*n,e[7]=t[7]*n,e[8]=t[8]*o,e[9]=t[9]*o,e[10]=t[10]*o,e[11]=t[11]*o,
e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function g(e,t,r,i){var n=i[0],o=i[1],a=i[2],s=Math.sqrt(n*n+o*o+a*a),u=void 0,l=void 0,c=void 0,h=void 0,d=void 0,f=void 0,v=void 0,m=void 0,p=void 0,g=void 0,y=void 0,A=void 0,b=void 0,E=void 0,M=void 0,x=void 0,w=void 0,T=void 0,P=void 0,D=void 0,R=void 0,C=void 0,S=void 0,O=void 0;return Math.abs(s)<Q.EPSILON?null:(s=1/s,n*=s,o*=s,a*=s,u=Math.sin(r),l=Math.cos(r),c=1-l,h=t[0],d=t[1],f=t[2],v=t[3],m=t[4],p=t[5],g=t[6],y=t[7],A=t[8],b=t[9],E=t[10],M=t[11],x=n*n*c+l,w=o*n*c+a*u,T=a*n*c-o*u,P=n*o*c-a*u,D=o*o*c+l,R=a*o*c+n*u,C=n*a*c+o*u,S=o*a*c-n*u,O=a*a*c+l,e[0]=h*x+m*w+A*T,e[1]=d*x+p*w+b*T,e[2]=f*x+g*w+E*T,e[3]=v*x+y*w+M*T,e[4]=h*P+m*D+A*R,e[5]=d*P+p*D+b*R,e[6]=f*P+g*D+E*R,e[7]=v*P+y*D+M*R,e[8]=h*C+m*S+A*O,e[9]=d*C+p*S+b*O,e[10]=f*C+g*S+E*O,e[11]=v*C+y*S+M*O,t!==e&&(e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e)}function y(e,t,r){var i=Math.sin(r),n=Math.cos(r),o=t[4],a=t[5],s=t[6],u=t[7],l=t[8],c=t[9],h=t[10],d=t[11];return t!==e&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[4]=o*n+l*i,e[5]=a*n+c*i,e[6]=s*n+h*i,e[7]=u*n+d*i,e[8]=l*n-o*i,e[9]=c*n-a*i,e[10]=h*n-s*i,e[11]=d*n-u*i,e}function A(e,t,r){var i=Math.sin(r),n=Math.cos(r),o=t[0],a=t[1],s=t[2],u=t[3],l=t[8],c=t[9],h=t[10],d=t[11];return t!==e&&(e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=o*n-l*i,e[1]=a*n-c*i,e[2]=s*n-h*i,e[3]=u*n-d*i,e[8]=o*i+l*n,e[9]=a*i+c*n,e[10]=s*i+h*n,e[11]=u*i+d*n,e}function b(e,t,r){var i=Math.sin(r),n=Math.cos(r),o=t[0],a=t[1],s=t[2],u=t[3],l=t[4],c=t[5],h=t[6],d=t[7];return t!==e&&(e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=o*n+l*i,e[1]=a*n+c*i,e[2]=s*n+h*i,e[3]=u*n+d*i,e[4]=l*n-o*i,e[5]=c*n-a*i,e[6]=h*n-s*i,e[7]=d*n-u*i,e}function E(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=t[0],e[13]=t[1],e[14]=t[2],e[15]=1,e}function M(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=t[1],e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=t[2],e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function x(e,t,r){var i=r[0],n=r[1],o=r[2],a=Math.sqrt(i*i+n*n+o*o),s=void 0,u=void 0,l=void 0;return Math.abs(a)<Q.EPSILON?null:(a=1/a,i*=a,n*=a,o*=a,s=Math.sin(t),u=Math.cos(t),l=1-u,e[0]=i*i*l+u,e[1]=n*i*l+o*s,e[2]=o*i*l-n*s,e[3]=0,e[4]=i*n*l-o*s,e[5]=n*n*l+u,e[6]=o*n*l+i*s,e[7]=0,e[8]=i*o*l+n*s,e[9]=n*o*l-i*s,e[10]=o*o*l+u,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e)}function w(e,t){var r=Math.sin(t),i=Math.cos(t);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=i,e[6]=r,e[7]=0,e[8]=0,e[9]=-r,e[10]=i,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function T(e,t){var r=Math.sin(t),i=Math.cos(t);return e[0]=i,e[1]=0,e[2]=-r,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=r,e[9]=0,e[10]=i,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function P(e,t){var r=Math.sin(t),i=Math.cos(t);return e[0]=i,e[1]=r,e[2]=0,e[3]=0,e[4]=-r,e[5]=i,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function D(e,t,r){var i=t[0],n=t[1],o=t[2],a=t[3],s=i+i,u=n+n,l=o+o,c=i*s,h=i*u,d=i*l,f=n*u,v=n*l,m=o*l,p=a*s,g=a*u,y=a*l;return e[0]=1-(f+m),e[1]=h+y,e[2]=d-g,e[3]=0,e[4]=h-y,e[5]=1-(c+m),e[6]=v+p,e[7]=0,e[8]=d+g,e[9]=v-p,e[10]=1-(c+f),e[11]=0,e[12]=r[0],e[13]=r[1],e[14]=r[2],e[15]=1,e}function R(e,t){return e[0]=t[12],e[1]=t[13],e[2]=t[14],e}function C(e,t){var r=t[0],i=t[1],n=t[2],o=t[4],a=t[5],s=t[6],u=t[8],l=t[9],c=t[10];return e[0]=Math.sqrt(r*r+i*i+n*n),e[1]=Math.sqrt(o*o+a*a+s*s),e[2]=Math.sqrt(u*u+l*l+c*c),e}function S(e,t){var r=t[0]+t[5]+t[10],i=0;return r>0?(i=2*Math.sqrt(r+1),e[3]=.25*i,e[0]=(t[6]-t[9])/i,e[1]=(t[8]-t[2])/i,e[2]=(t[1]-t[4])/i):t[0]>t[5]&t[0]>t[10]?(i=2*Math.sqrt(1+t[0]-t[5]-t[10]),e[3]=(t[6]-t[9])/i,e[0]=.25*i,e[1]=(t[1]+t[4])/i,e[2]=(t[8]+t[2])/i):t[5]>t[10]?(i=2*Math.sqrt(1+t[5]-t[0]-t[10]),e[3]=(t[8]-t[2])/i,e[0]=(t[1]+t[4])/i,e[1]=.25*i,e[2]=(t[6]+t[9])/i):(i=2*Math.sqrt(1+t[10]-t[0]-t[5]),e[3]=(t[1]-t[4])/i,e[0]=(t[8]+t[2])/i,e[1]=(t[6]+t[9])/i,e[2]=.25*i),e}function O(e,t,r,i){var n=t[0],o=t[1],a=t[2],s=t[3],u=n+n,l=o+o,c=a+a,h=n*u,d=n*l,f=n*c,v=o*l,m=o*c,p=a*c,g=s*u,y=s*l,A=s*c,b=i[0],E=i[1],M=i[2];return e[0]=(1-(v+p))*b,e[1]=(d+A)*b,e[2]=(f-y)*b,e[3]=0,e[4]=(d-A)*E,e[5]=(1-(h+p))*E,e[6]=(m+g)*E,e[7]=0,e[8]=(f+y)*M,e[9]=(m-g)*M,e[10]=(1-(h+v))*M,e[11]=0,e[12]=r[0],e[13]=r[1],e[14]=r[2],e[15]=1,e}function I(e,t,r,i,n){var o=t[0],a=t[1],s=t[2],u=t[3],l=o+o,c=a+a,h=s+s,d=o*l,f=o*c,v=o*h,m=a*c,p=a*h,g=s*h,y=u*l,A=u*c,b=u*h,E=i[0],M=i[1],x=i[2],w=n[0],T=n[1],P=n[2];return e[0]=(1-(m+g))*E,e[1]=(f+b)*E,e[2]=(v-A)*E,e[3]=0,e[4]=(f-b)*M,e[5]=(1-(d+g))*M,e[6]=(p+y)*M,e[7]=0,e[8]=(v+A)*x,e[9]=(p-y)*x,e[10]=(1-(d+m))*x,e[11]=0,e[12]=r[0]+w-(e[0]*w+e[4]*T+e[8]*P),e[13]=r[1]+T-(e[1]*w+e[5]*T+e[9]*P),e[14]=r[2]+P-(e[2]*w+e[6]*T+e[10]*P),e[15]=1,e}function k(e,t){var r=t[0],i=t[1],n=t[2],o=t[3],a=r+r,s=i+i,u=n+n,l=r*a,c=i*a,h=i*s,d=n*a,f=n*s,v=n*u,m=o*a,p=o*s,g=o*u;return e[0]=1-h-v,e[1]=c+g,e[2]=d-p,e[3]=0,e[4]=c-g,e[5]=1-l-v,e[6]=f+m,e[7]=0,e[8]=d+p,e[9]=f-m,e[10]=1-l-h,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function _(e,t,r,i,n,o,a){var s=1/(r-t),u=1/(n-i),l=1/(o-a);return e[0]=2*o*s,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=2*o*u,e[6]=0,e[7]=0,e[8]=(r+t)*s,e[9]=(n+i)*u,e[10]=(a+o)*l,e[11]=-1,e[12]=0,e[13]=0,e[14]=a*o*2*l,e[15]=0,e}function L(e,t,r,i,n){var o=1/Math.tan(t/2),a=1/(i-n);return e[0]=o/r,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=o,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=(n+i)*a,e[11]=-1,e[12]=0,e[13]=0,e[14]=2*n*i*a,e[15]=0,e}function N(e,t,r,i){var n=Math.tan(t.upDegrees*Math.PI/180),o=Math.tan(t.downDegrees*Math.PI/180),a=Math.tan(t.leftDegrees*Math.PI/180),s=Math.tan(t.rightDegrees*Math.PI/180),u=2/(a+s),l=2/(n+o);return e[0]=u,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=l,e[6]=0,e[7]=0,e[8]=-((a-s)*u*.5),e[9]=(n-o)*l*.5,e[10]=i/(r-i),e[11]=-1,e[12]=0,e[13]=0,e[14]=i*r/(r-i),e[15]=0,e}function F(e,t,r,i,n,o,a){var s=1/(t-r),u=1/(i-n),l=1/(o-a);return e[0]=-2*s,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*u,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=2*l,e[11]=0,e[12]=(t+r)*s,e[13]=(n+i)*u,e[14]=(a+o)*l,e[15]=1,e}function B(e,t,r,i){var n=void 0,o=void 0,a=void 0,s=void 0,u=void 0,l=void 0,c=void 0,h=void 0,d=void 0,f=void 0,v=t[0],m=t[1],p=t[2],g=i[0],y=i[1],A=i[2],b=r[0],E=r[1],M=r[2];return Math.abs(v-b)<Q.EPSILON&&Math.abs(m-E)<Q.EPSILON&&Math.abs(p-M)<Q.EPSILON?mat4.identity(e):(c=v-b,h=m-E,d=p-M,f=1/Math.sqrt(c*c+h*h+d*d),c*=f,h*=f,d*=f,n=y*d-A*h,o=A*c-g*d,a=g*h-y*c,f=Math.sqrt(n*n+o*o+a*a),f?(f=1/f,n*=f,o*=f,a*=f):(n=0,o=0,a=0),s=h*a-d*o,u=d*n-c*a,l=c*o-h*n,f=Math.sqrt(s*s+u*u+l*l),f?(f=1/f,s*=f,u*=f,l*=f):(s=0,u=0,l=0),e[0]=n,e[1]=s,e[2]=c,e[3]=0,e[4]=o,e[5]=u,e[6]=h,e[7]=0,e[8]=a,e[9]=l,e[10]=d,e[11]=0,e[12]=-(n*v+o*m+a*p),e[13]=-(s*v+u*m+l*p),e[14]=-(c*v+h*m+d*p),e[15]=1,e)}function V(e,t,r,i){var n=t[0],o=t[1],a=t[2],s=i[0],u=i[1],l=i[2],c=n-r[0],h=o-r[1],d=a-r[2],f=c*c+h*h+d*d;f>0&&(f=1/Math.sqrt(f),c*=f,h*=f,d*=f);var v=u*d-l*h,m=l*c-s*d,p=s*h-u*c;return e[0]=v,e[1]=m,e[2]=p,e[3]=0,e[4]=h*p-d*m,e[5]=d*v-c*p,e[6]=c*m-h*v,e[7]=0,e[8]=c,e[9]=h,e[10]=d,e[11]=0,e[12]=n,e[13]=o,e[14]=a,e[15]=1,e}function U(e){return"mat4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+", "+e[9]+", "+e[10]+", "+e[11]+", "+e[12]+", "+e[13]+", "+e[14]+", "+e[15]+")"}function G(e){return Math.sqrt(Math.pow(e[0],2)+Math.pow(e[1],2)+Math.pow(e[2],2)+Math.pow(e[3],2)+Math.pow(e[4],2)+Math.pow(e[5],2)+Math.pow(e[6],2)+Math.pow(e[7],2)+Math.pow(e[8],2)+Math.pow(e[9],2)+Math.pow(e[10],2)+Math.pow(e[11],2)+Math.pow(e[12],2)+Math.pow(e[13],2)+Math.pow(e[14],2)+Math.pow(e[15],2))}function W(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e[3]=t[3]+r[3],e[4]=t[4]+r[4],e[5]=t[5]+r[5],e[6]=t[6]+r[6],e[7]=t[7]+r[7],e[8]=t[8]+r[8],e[9]=t[9]+r[9],e[10]=t[10]+r[10],e[11]=t[11]+r[11],e[12]=t[12]+r[12],e[13]=t[13]+r[13],e[14]=t[14]+r[14],e[15]=t[15]+r[15],e}function j(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e[3]=t[3]-r[3],e[4]=t[4]-r[4],e[5]=t[5]-r[5],e[6]=t[6]-r[6],e[7]=t[7]-r[7],e[8]=t[8]-r[8],e[9]=t[9]-r[9],e[10]=t[10]-r[10],e[11]=t[11]-r[11],e[12]=t[12]-r[12],e[13]=t[13]-r[13],e[14]=t[14]-r[14],e[15]=t[15]-r[15],e}function Y(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e[4]=t[4]*r,e[5]=t[5]*r,e[6]=t[6]*r,e[7]=t[7]*r,e[8]=t[8]*r,e[9]=t[9]*r,e[10]=t[10]*r,e[11]=t[11]*r,e[12]=t[12]*r,e[13]=t[13]*r,e[14]=t[14]*r,e[15]=t[15]*r,e}function q(e,t,r,i){return e[0]=t[0]+r[0]*i,e[1]=t[1]+r[1]*i,e[2]=t[2]+r[2]*i,e[3]=t[3]+r[3]*i,e[4]=t[4]+r[4]*i,e[5]=t[5]+r[5]*i,e[6]=t[6]+r[6]*i,e[7]=t[7]+r[7]*i,e[8]=t[8]+r[8]*i,e[9]=t[9]+r[9]*i,e[10]=t[10]+r[10]*i,e[11]=t[11]+r[11]*i,e[12]=t[12]+r[12]*i,e[13]=t[13]+r[13]*i,e[14]=t[14]+r[14]*i,e[15]=t[15]+r[15]*i,e}function H(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[7]===t[7]&&e[8]===t[8]&&e[9]===t[9]&&e[10]===t[10]&&e[11]===t[11]&&e[12]===t[12]&&e[13]===t[13]&&e[14]===t[14]&&e[15]===t[15]}function z(e,t){var r=e[0],i=e[1],n=e[2],o=e[3],a=e[4],s=e[5],u=e[6],l=e[7],c=e[8],h=e[9],d=e[10],f=e[11],v=e[12],m=e[13],p=e[14],g=e[15],y=t[0],A=t[1],b=t[2],E=t[3],M=t[4],x=t[5],w=t[6],T=t[7],P=t[8],D=t[9],R=t[10],C=t[11],S=t[12],O=t[13],I=t[14],k=t[15];return Math.abs(r-y)<=Q.EPSILON*Math.max(1,Math.abs(r),Math.abs(y))&&Math.abs(i-A)<=Q.EPSILON*Math.max(1,Math.abs(i),Math.abs(A))&&Math.abs(n-b)<=Q.EPSILON*Math.max(1,Math.abs(n),Math.abs(b))&&Math.abs(o-E)<=Q.EPSILON*Math.max(1,Math.abs(o),Math.abs(E))&&Math.abs(a-M)<=Q.EPSILON*Math.max(1,Math.abs(a),Math.abs(M))&&Math.abs(s-x)<=Q.EPSILON*Math.max(1,Math.abs(s),Math.abs(x))&&Math.abs(u-w)<=Q.EPSILON*Math.max(1,Math.abs(u),Math.abs(w))&&Math.abs(l-T)<=Q.EPSILON*Math.max(1,Math.abs(l),Math.abs(T))&&Math.abs(c-P)<=Q.EPSILON*Math.max(1,Math.abs(c),Math.abs(P))&&Math.abs(h-D)<=Q.EPSILON*Math.max(1,Math.abs(h),Math.abs(D))&&Math.abs(d-R)<=Q.EPSILON*Math.max(1,Math.abs(d),Math.abs(R))&&Math.abs(f-C)<=Q.EPSILON*Math.max(1,Math.abs(f),Math.abs(C))&&Math.abs(v-S)<=Q.EPSILON*Math.max(1,Math.abs(v),Math.abs(S))&&Math.abs(m-O)<=Q.EPSILON*Math.max(1,Math.abs(m),Math.abs(O))&&Math.abs(p-I)<=Q.EPSILON*Math.max(1,Math.abs(p),Math.abs(I))&&Math.abs(g-k)<=Q.EPSILON*Math.max(1,Math.abs(g),Math.abs(k))}Object.defineProperty(t,"__esModule",{value:!0}),t.sub=t.mul=void 0,t.create=n,t.clone=o,t.copy=a,t.fromValues=s,t.set=u,t.identity=l,t.transpose=c,t.invert=h,t.adjoint=d,t.determinant=f,t.multiply=v,t.translate=m,t.scale=p,t.rotate=g,t.rotateX=y,t.rotateY=A,t.rotateZ=b,t.fromTranslation=E,t.fromScaling=M,t.fromRotation=x,t.fromXRotation=w,t.fromYRotation=T,t.fromZRotation=P,t.fromRotationTranslation=D,t.getTranslation=R,t.getScaling=C,t.getRotation=S,t.fromRotationTranslationScale=O,t.fromRotationTranslationScaleOrigin=I,t.fromQuat=k,t.frustum=_,t.perspective=L,t.perspectiveFromFieldOfView=N,t.ortho=F,t.lookAt=B,t.targetTo=V,t.str=U,t.frob=G,t.add=W,t.subtract=j,t.multiplyScalar=Y,t.multiplyScalarAndAdd=q,t.exactEquals=H,t.equals=z;var X=r(0),Q=i(X);t.mul=v,t.sub=j},function(e,t,r){"use strict";function i(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}function n(){var e=new b.ARRAY_TYPE(4);return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e}function o(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e}function a(e,t,r){r*=.5;var i=Math.sin(r);return e[0]=i*t[0],e[1]=i*t[1],e[2]=i*t[2],e[3]=Math.cos(r),e}function s(e,t){var r=2*Math.acos(t[3]),i=Math.sin(r/2);return 0!=i?(e[0]=t[0]/i,e[1]=t[1]/i,e[2]=t[2]/i):(e[0]=1,e[1]=0,e[2]=0),r}function u(e,t,r){var i=t[0],n=t[1],o=t[2],a=t[3],s=r[0],u=r[1],l=r[2],c=r[3];return e[0]=i*c+a*s+n*l-o*u,e[1]=n*c+a*u+o*s-i*l,e[2]=o*c+a*l+i*u-n*s,e[3]=a*c-i*s-n*u-o*l,e}function l(e,t,r){r*=.5;var i=t[0],n=t[1],o=t[2],a=t[3],s=Math.sin(r),u=Math.cos(r);return e[0]=i*u+a*s,e[1]=n*u+o*s,e[2]=o*u-n*s,e[3]=a*u-i*s,e}function c(e,t,r){r*=.5;var i=t[0],n=t[1],o=t[2],a=t[3],s=Math.sin(r),u=Math.cos(r);return e[0]=i*u-o*s,e[1]=n*u+a*s,e[2]=o*u+i*s,e[3]=a*u-n*s,e}function h(e,t,r){r*=.5;var i=t[0],n=t[1],o=t[2],a=t[3],s=Math.sin(r),u=Math.cos(r);return e[0]=i*u+n*s,e[1]=n*u-i*s,e[2]=o*u+a*s,e[3]=a*u-o*s,e}function d(e,t){var r=t[0],i=t[1],n=t[2];return e[0]=r,e[1]=i,e[2]=n,e[3]=Math.sqrt(Math.abs(1-r*r-i*i-n*n)),e}function f(e,t,r,i){var n=t[0],o=t[1],a=t[2],s=t[3],u=r[0],l=r[1],c=r[2],h=r[3],d=void 0,f=void 0,v=void 0,m=void 0,p=void 0;return f=n*u+o*l+a*c+s*h,f<0&&(f=-f,u=-u,l=-l,c=-c,h=-h),1-f>1e-6?(d=Math.acos(f),v=Math.sin(d),m=Math.sin((1-i)*d)/v,p=Math.sin(i*d)/v):(m=1-i,p=i),e[0]=m*n+p*u,e[1]=m*o+p*l,e[2]=m*a+p*c,e[3]=m*s+p*h,e}function v(e,t){var r=t[0],i=t[1],n=t[2],o=t[3],a=r*r+i*i+n*n+o*o,s=a?1/a:0;return e[0]=-r*s,e[1]=-i*s,e[2]=-n*s,e[3]=o*s,e}function m(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=t[3],e}function p(e,t){var r=t[0]+t[4]+t[8],i=void 0;if(r>0)i=Math.sqrt(r+1),e[3]=.5*i,i=.5/i,e[0]=(t[5]-t[7])*i,e[1]=(t[6]-t[2])*i,e[2]=(t[1]-t[3])*i;else{var n=0;t[4]>t[0]&&(n=1),t[8]>t[3*n+n]&&(n=2);var o=(n+1)%3,a=(n+2)%3;i=Math.sqrt(t[3*n+n]-t[3*o+o]-t[3*a+a]+1),e[n]=.5*i,i=.5/i,e[3]=(t[3*o+a]-t[3*a+o])*i,e[o]=(t[3*o+n]+t[3*n+o])*i,e[a]=(t[3*a+n]+t[3*n+a])*i}return e}function g(e,t,r,i){var n=.5*Math.PI/180;t*=n,r*=n,i*=n;var o=Math.sin(t),a=Math.cos(t),s=Math.sin(r),u=Math.cos(r),l=Math.sin(i),c=Math.cos(i);return e[0]=o*u*c-a*s*l,e[1]=a*s*c+o*u*l,e[2]=a*u*l-o*s*c,e[3]=a*u*c+o*s*l,e}function y(e){return"quat("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"}Object.defineProperty(t,"__esModule",{value:!0}),t.setAxes=t.sqlerp=t.rotationTo=t.equals=t.exactEquals=t.normalize=t.sqrLen=t.squaredLength=t.len=t.length=t.lerp=t.dot=t.scale=t.mul=t.add=t.set=t.copy=t.fromValues=t.clone=void 0,t.create=n,t.identity=o,t.setAxisAngle=a,t.getAxisAngle=s,t.multiply=u,t.rotateX=l,t.rotateY=c,t.rotateZ=h,t.calculateW=d,t.slerp=f,t.invert=v,t.conjugate=m,t.fromMat3=p,t.fromEuler=g,t.str=y;var A=r(0),b=i(A),E=r(1),M=i(E),x=r(2),w=i(x),T=r(3),P=i(T),D=(t.clone=P.clone,t.fromValues=P.fromValues,t.copy=P.copy,t.set=P.set,t.add=P.add,t.mul=u,t.scale=P.scale,t.dot=P.dot,t.lerp=P.lerp,t.length=P.length),R=(t.len=D,t.squaredLength=P.squaredLength),C=(t.sqrLen=R,t.normalize=P.normalize);t.exactEquals=P.exactEquals,t.equals=P.equals,t.rotationTo=function(){var e=w.create(),t=w.fromValues(1,0,0),r=w.fromValues(0,1,0);return function(i,n,o){var s=w.dot(n,o);return s<-.999999?(w.cross(e,t,n),w.len(e)<1e-6&&w.cross(e,r,n),w.normalize(e,e),a(i,e,Math.PI),i):s>.999999?(i[0]=0,i[1]=0,i[2]=0,i[3]=1,i):(w.cross(e,n,o),i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=1+s,C(i,i))}}(),t.sqlerp=function(){var e=n(),t=n();return function(r,i,n,o,a,s){return f(e,i,a,s),f(t,n,o,s),f(r,e,t,2*s*(1-s)),r}}(),t.setAxes=function(){var e=M.create();return function(t,r,i,n){return e[0]=i[0],e[3]=i[1],e[6]=i[2],e[1]=n[0],e[4]=n[1],e[7]=n[2],e[2]=-r[0],e[5]=-r[1],e[8]=-r[2],C(t,p(t,e))}}()},function(e,t,r){"use strict";function i(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}function n(){var e=new V.ARRAY_TYPE(2);return e[0]=0,e[1]=0,e}function o(e){var t=new V.ARRAY_TYPE(2);return t[0]=e[0],t[1]=e[1],t}function a(e,t){var r=new V.ARRAY_TYPE(2);return r[0]=e,r[1]=t,r}function s(e,t){return e[0]=t[0],e[1]=t[1],e}function u(e,t,r){return e[0]=t,e[1]=r,e}function l(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e}function c(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e}function h(e,t,r){return e[0]=t[0]*r[0],e[1]=t[1]*r[1],e}function d(e,t,r){return e[0]=t[0]/r[0],e[1]=t[1]/r[1],e}function f(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e}function v(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e}function m(e,t,r){return e[0]=Math.min(t[0],r[0]),e[1]=Math.min(t[1],r[1]),e}function p(e,t,r){return e[0]=Math.max(t[0],r[0]),e[1]=Math.max(t[1],r[1]),e}function g(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e}function y(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e}function A(e,t,r,i){return e[0]=t[0]+r[0]*i,e[1]=t[1]+r[1]*i,e}function b(e,t){var r=t[0]-e[0],i=t[1]-e[1];return Math.sqrt(r*r+i*i)}function E(e,t){var r=t[0]-e[0],i=t[1]-e[1];return r*r+i*i}function M(e){var t=e[0],r=e[1];return Math.sqrt(t*t+r*r)}function x(e){var t=e[0],r=e[1];return t*t+r*r}function w(e,t){return e[0]=-t[0],e[1]=-t[1],e}function T(e,t){return e[0]=1/t[0],e[1]=1/t[1],e}function P(e,t){var r=t[0],i=t[1],n=r*r+i*i;return n>0&&(n=1/Math.sqrt(n),e[0]=t[0]*n,e[1]=t[1]*n),e}function D(e,t){return e[0]*t[0]+e[1]*t[1]}function R(e,t,r){var i=t[0]*r[1]-t[1]*r[0];return e[0]=e[1]=0,e[2]=i,e}function C(e,t,r,i){var n=t[0],o=t[1];return e[0]=n+i*(r[0]-n),e[1]=o+i*(r[1]-o),e}function S(e,t){t=t||1;var r=2*V.RANDOM()*Math.PI;return e[0]=Math.cos(r)*t,e[1]=Math.sin(r)*t,e}function O(e,t,r){var i=t[0],n=t[1];return e[0]=r[0]*i+r[2]*n,e[1]=r[1]*i+r[3]*n,e}function I(e,t,r){var i=t[0],n=t[1];return e[0]=r[0]*i+r[2]*n+r[4],e[1]=r[1]*i+r[3]*n+r[5],e}function k(e,t,r){var i=t[0],n=t[1];return e[0]=r[0]*i+r[3]*n+r[6],e[1]=r[1]*i+r[4]*n+r[7],e}function _(e,t,r){var i=t[0],n=t[1];return e[0]=r[0]*i+r[4]*n+r[12],e[1]=r[1]*i+r[5]*n+r[13],e}function L(e){return"vec2("+e[0]+", "+e[1]+")"}function N(e,t){return e[0]===t[0]&&e[1]===t[1]}function F(e,t){var r=e[0],i=e[1],n=t[0],o=t[1];return Math.abs(r-n)<=V.EPSILON*Math.max(1,Math.abs(r),Math.abs(n))&&Math.abs(i-o)<=V.EPSILON*Math.max(1,Math.abs(i),Math.abs(o))}Object.defineProperty(t,"__esModule",{value:!0}),t.forEach=t.sqrLen=t.sqrDist=t.dist=t.div=t.mul=t.sub=t.len=void 0,t.create=n,t.clone=o,t.fromValues=a,t.copy=s,t.set=u,t.add=l,t.subtract=c,t.multiply=h,t.divide=d,t.ceil=f,t.floor=v,t.min=m,t.max=p,t.round=g,t.scale=y,t.scaleAndAdd=A,t.distance=b,t.squaredDistance=E,t.length=M,t.squaredLength=x,t.negate=w,t.inverse=T,t.normalize=P,t.dot=D,t.cross=R,t.lerp=C,t.random=S,t.transformMat2=O,t.transformMat2d=I,t.transformMat3=k,t.transformMat4=_,t.str=L,t.exactEquals=N,t.equals=F;var B=r(0),V=i(B);t.len=M,t.sub=c,t.mul=h,t.div=d,t.dist=b,t.sqrDist=E,t.sqrLen=x,t.forEach=function(){var e=n();return function(t,r,i,n,o,a){var s=void 0,u=void 0;for(r||(r=2),i||(i=0),u=n?Math.min(n*r+i,t.length):t.length,s=i;s<u;s+=r)e[0]=t[s],e[1]=t[s+1],o(e,e,a),t[s]=e[0],t[s+1]=e[1];return t}}()}])})},function(e,t){function r(){throw new Error("setTimeout has not been defined")}function i(){throw new Error("clearTimeout has not been defined")}function n(e){if(c===setTimeout)return setTimeout(e,0);if((c===r||!c)&&setTimeout)return c=setTimeout,setTimeout(e,0);try{return c(e,0)}catch(t){try{return c.call(null,e,0)}catch(t){return c.call(this,e,0)}}}function o(e){if(h===clearTimeout)return clearTimeout(e);if((h===i||!h)&&clearTimeout)return h=clearTimeout,clearTimeout(e);try{return h(e)}catch(t){try{return h.call(null,e)}catch(t){return h.call(this,e)}}}function a(){m&&f&&(m=!1,f.length?v=f.concat(v):p=-1,v.length&&s())}function s(){if(!m){var e=n(a);m=!0;for(var t=v.length;t;){for(f=v,v=[];++p<t;)f&&f[p].run();p=-1,t=v.length}f=null,m=!1,o(e)}}function u(e,t){this.fun=e,this.array=t}function l(){}var c,h,d=e.exports={};!function(){try{c="function"==typeof setTimeout?setTimeout:r}catch(e){c=r}try{h="function"==typeof clearTimeout?clearTimeout:i}catch(e){h=i}}();var f,v=[],m=!1,p=-1;d.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)t[r-1]=arguments[r];v.push(new u(e,t)),1!==v.length||m||n(s)},u.prototype.run=function(){this.fun.apply(null,this.array)},d.title="browser",d.browser=!0,d.env={},d.argv=[],d.version="",d.versions={},d.on=l,d.addListener=l,d.once=l,d.off=l,d.removeListener=l,d.removeAllListeners=l,d.emit=l,d.prependListener=l,d.prependOnceListener=l,d.listeners=function(e){return[]},d.binding=function(e){throw new Error("process.binding is not supported")},d.cwd=function(){return"/"},d.chdir=function(e){throw new Error("process.chdir is not supported")},d.umask=function(){return 0}},function(e,t){(function(t){WebGLDebugUtils=function(){function e(e){if(null==v){v={},m={};for(var t in e)"number"==typeof e[t]&&(v[e[t]]=t,m[t]=e[t])}}function r(){if(null==v)throw"WebGLDebugUtils.init(ctx) not called"}function i(e){return r(),void 0!==v[e]}function n(e){r();var t=v[e];return void 0!==t?"gl."+t:"/*UNKNOWN WebGL ENUM*/ 0x"+e.toString(16)}function o(e,t,r,i){var o=f[e];if(void 0!==o){var o=o[t];if(void 0!==o&&o[r]){if("object"==typeof o[r]&&void 0!==o[r].enumBitwiseOr){for(var a=o[r].enumBitwiseOr,s=0,u=[],l=0;l<a.length;++l){var c=m[a[l]];0!==(i&c)&&(s|=c,u.push(n(c)))}return s===i?u.join(" | "):n(i)}return n(i)}}return null===i?"null":void 0===i?"undefined":i.toString()}function a(e,t){for(var r="",i=t.length,n=0;n<i;++n)r+=(0==n?"":", ")+o(e,i,n,t[n]);return r}function s(e,t,r){e.__defineGetter__(r,function(){return t[r]}),e.__defineSetter__(r,function(e){t[r]=e})}function u(t,r,i,a){function l(e,t){return function(){i&&i(t,arguments);var n=e[t].apply(e,arguments),o=a.getError();return 0!=o&&(c[o]=!0,r(o,t,arguments)),n}}a=a||t,e(t),r=r||function(e,t,r){for(var i="",a=r.length,s=0;s<a;++s)i+=(0==s?"":", ")+o(t,a,s,r[s]);d("WebGL error "+n(e)+" in "+t+"("+i+")")};var c={},h={};for(var f in t)if("function"==typeof t[f])if("getExtension"!=f)h[f]=l(t,f);else{var v=l(t,f);h[f]=function(){var e=v.apply(t,arguments);return u(e,r,i,a)}}else s(h,t,f);return h.getError=function(){for(var e in c)if(c.hasOwnProperty(e)&&c[e])return c[e]=!1,e;return t.NO_ERROR},h}function l(e){var t=e.getParameter(e.MAX_VERTEX_ATTRIBS),r=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,r);for(var i=0;i<t;++i)e.disableVertexAttribArray(i),e.vertexAttribPointer(i,4,e.FLOAT,!1,0,0),e.vertexAttrib1f(i,0);e.deleteBuffer(r);for(var n=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS),i=0;i<n;++i)e.activeTexture(e.TEXTURE0+i),e.bindTexture(e.TEXTURE_CUBE_MAP,null),e.bindTexture(e.TEXTURE_2D,null);for(e.activeTexture(e.TEXTURE0),e.useProgram(null),e.bindBuffer(e.ARRAY_BUFFER,null),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,null),e.bindFramebuffer(e.FRAMEBUFFER,null),e.bindRenderbuffer(e.RENDERBUFFER,null),e.disable(e.BLEND),e.disable(e.CULL_FACE),e.disable(e.DEPTH_TEST),e.disable(e.DITHER),e.disable(e.SCISSOR_TEST),e.blendColor(0,0,0,0),e.blendEquation(e.FUNC_ADD),e.blendFunc(e.ONE,e.ZERO),e.clearColor(0,0,0,0),e.clearDepth(1),e.clearStencil(-1),e.colorMask(!0,!0,!0,!0),e.cullFace(e.BACK),e.depthFunc(e.LESS),e.depthMask(!0),e.depthRange(0,1),e.frontFace(e.CCW),e.hint(e.GENERATE_MIPMAP_HINT,e.DONT_CARE),e.lineWidth(1),e.pixelStorei(e.PACK_ALIGNMENT,4),e.pixelStorei(e.UNPACK_ALIGNMENT,4),e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,!1),e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),e.UNPACK_COLORSPACE_CONVERSION_WEBGL&&e.pixelStorei(e.UNPACK_COLORSPACE_CONVERSION_WEBGL,e.BROWSER_DEFAULT_WEBGL),e.polygonOffset(0,0),e.sampleCoverage(1,!1),e.scissor(0,0,e.canvas.width,e.canvas.height),e.stencilFunc(e.ALWAYS,0,4294967295),e.stencilMask(4294967295),e.stencilOp(e.KEEP,e.KEEP,e.KEEP),e.viewport(0,0,e.canvas.width,e.canvas.height),e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT|e.STENCIL_BUFFER_BIT);e.getError(););}function c(e){function t(e){return"function"==typeof e?e:function(t){e.handleEvent(t)}}function r(e){var t=e.addEventListener;e.addEventListener=function(r,i,n){switch(r){case"webglcontextlost":x(i);break;case"webglcontextrestored":w(i);break;default:t.apply(e,arguments)}}}function i(){for(var e=Object.keys(M),t=0;t<e.length;++t)delete M[e]}function n(){++A,p||y==A&&e.loseContext()}function o(e,t){var r=e[t];return function(){if(n(),!p){var t=r.apply(e,arguments);return t}}}function a(){for(var e=0;e<g.length;++e){var t=g[e];t instanceof WebGLBuffer?h.deleteBuffer(t):t instanceof WebGLFramebuffer?h.deleteFramebuffer(t):t instanceof WebGLProgram?h.deleteProgram(t):t instanceof WebGLRenderbuffer?h.deleteRenderbuffer(t):t instanceof WebGLShader?h.deleteShader(t):t instanceof WebGLTexture&&h.deleteTexture(t)}}function u(e){return{statusMessage:e,preventDefault:function(){b=!0}}}function c(e){for(var t in e)"function"==typeof e[t]?d[t]=o(e,t):s(d,e,t);d.getError=function(){if(n(),!p)for(var e;e=h.getError();)M[e]=!0;for(var e in M)if(M[e])return delete M[e],e;return d.NO_ERROR};for(var r=["createBuffer","createFramebuffer","createProgram","createRenderbuffer","createShader","createTexture"],i=0;i<r.length;++i){var a=r[i];d[a]=function(t){return function(){if(n(),p)return null;var r=t.apply(e,arguments);return r.__webglDebugContextLostId__=m,g.push(r),r}}(e[a])}for(var u=["getActiveAttrib","getActiveUniform","getBufferParameter","getContextAttributes","getAttachedShaders","getFramebufferAttachmentParameter","getParameter","getProgramParameter","getProgramInfoLog","getRenderbufferParameter","getShaderParameter","getShaderInfoLog","getShaderSource","getTexParameter","getUniform","getUniformLocation","getVertexAttrib"],i=0;i<u.length;++i){var a=u[i];d[a]=function(t){return function(){return n(),p?null:t.apply(e,arguments)}}(d[a])}for(var l=["isBuffer","isEnabled","isFramebuffer","isProgram","isRenderbuffer","isShader","isTexture"],i=0;i<l.length;++i){var a=l[i];d[a]=function(t){return function(){return n(),!p&&t.apply(e,arguments)}}(d[a])}return d.checkFramebufferStatus=function(t){return function(){return n(),p?d.FRAMEBUFFER_UNSUPPORTED:t.apply(e,arguments)}}(d.checkFramebufferStatus),d.getAttribLocation=function(t){return function(){return n(),p?-1:t.apply(e,arguments)}}(d.getAttribLocation),d.getVertexAttribOffset=function(t){return function(){return n(),p?0:t.apply(e,arguments)}}(d.getVertexAttribOffset),d.isContextLost=function(){return p},d}var h,d,f=[],v=[],d={},m=1,p=!1,g=[],y=0,A=0,b=!1,E=0,M={};e.getContext=function(t){return function(){var r=t.apply(e,arguments);if(r instanceof WebGLRenderingContext){if(r!=h){if(h)throw"got different context";h=r,d=c(h)}return d}return r}}(e.getContext);var x=function(e){f.push(t(e))},w=function(e){v.push(t(e))};return r(e),e.loseContext=function(){if(!p){for(p=!0,y=0,++m;h.getError(););i(),M[h.CONTEXT_LOST_WEBGL]=!0;var t=u("context lost"),r=f.slice();setTimeout(function(){for(var i=0;i<r.length;++i)r[i](t);E>=0&&setTimeout(function(){e.restoreContext()},E)},0)}},e.restoreContext=function(){p&&v.length&&setTimeout(function(){if(!b)throw"can not restore. webglcontestlost listener did not call event.preventDefault";a(),l(h),p=!1,A=0,b=!1;for(var e=v.slice(),t=u("context restored"),r=0;r<e.length;++r)e[r](t)},0)},e.loseContextInNCalls=function(e){if(p)throw"You can not ask a lost contet to be lost";y=A+e},e.getNumCalls=function(){return A},e.setRestoreTimeout=function(e){E=e},e}"undefined"==typeof window&&(window=t);var h=function(e){window.console&&window.console.log&&window.console.log(e)},d=function(e){window.console&&window.console.error?window.console.error(e):h(e)},f={enable:{1:{0:!0}},disable:{1:{0:!0}},getParameter:{1:{0:!0}},drawArrays:{3:{0:!0}},drawElements:{4:{0:!0,2:!0}},createShader:{1:{0:!0}},getShaderParameter:{2:{1:!0}},getProgramParameter:{2:{1:!0}},getShaderPrecisionFormat:{2:{0:!0,1:!0}},getVertexAttrib:{2:{1:!0}},vertexAttribPointer:{6:{2:!0}},bindTexture:{2:{0:!0}},activeTexture:{1:{0:!0}},getTexParameter:{2:{0:!0,1:!0}},texParameterf:{3:{0:!0,1:!0}},texParameteri:{3:{0:!0,1:!0,2:!0}},texImage2D:{9:{0:!0,2:!0,6:!0,7:!0},6:{0:!0,2:!0,3:!0,4:!0}},texSubImage2D:{9:{0:!0,6:!0,7:!0},7:{0:!0,4:!0,5:!0}},copyTexImage2D:{8:{0:!0,2:!0}},copyTexSubImage2D:{8:{0:!0}},generateMipmap:{1:{0:!0}},compressedTexImage2D:{7:{0:!0,2:!0}},compressedTexSubImage2D:{8:{0:!0,6:!0}},bindBuffer:{2:{0:!0}},bufferData:{3:{0:!0,2:!0}},bufferSubData:{3:{0:!0}},getBufferParameter:{2:{0:!0,1:!0}},pixelStorei:{2:{0:!0,1:!0}},readPixels:{7:{4:!0,5:!0}},bindRenderbuffer:{2:{0:!0}},bindFramebuffer:{2:{0:!0}},checkFramebufferStatus:{1:{0:!0}},framebufferRenderbuffer:{4:{0:!0,1:!0,2:!0}},framebufferTexture2D:{5:{0:!0,1:!0,2:!0}},getFramebufferAttachmentParameter:{3:{0:!0,1:!0,2:!0}},getRenderbufferParameter:{2:{0:!0,1:!0}},renderbufferStorage:{4:{0:!0,1:!0}},clear:{1:{0:{enumBitwiseOr:["COLOR_BUFFER_BIT","DEPTH_BUFFER_BIT","STENCIL_BUFFER_BIT"]}}},depthFunc:{1:{0:!0}},blendFunc:{2:{0:!0,1:!0}},blendFuncSeparate:{4:{0:!0,1:!0,2:!0,3:!0}},blendEquation:{1:{0:!0}},blendEquationSeparate:{2:{0:!0,1:!0}},stencilFunc:{3:{0:!0}},stencilFuncSeparate:{4:{0:!0,1:!0}},stencilMaskSeparate:{2:{0:!0}},stencilOp:{3:{0:!0,1:!0,2:!0}},stencilOpSeparate:{4:{0:!0,1:!0,2:!0,3:!0}},cullFace:{1:{0:!0}},frontFace:{1:{0:!0}},drawArraysInstancedANGLE:{4:{0:!0}},drawElementsInstancedANGLE:{5:{0:!0,2:!0}},blendEquationEXT:{1:{0:!0}}},v=null,m=null;return{init:e,mightBeEnum:i,glEnumToString:n,glFunctionArgToString:o,glFunctionArgsToString:a,makeDebugContext:u,makeLostContextSimulatingCanvas:c,resetToInitialState:l}}(),e.exports=WebGLDebugUtils}).call(t,function(){return this}())}]);