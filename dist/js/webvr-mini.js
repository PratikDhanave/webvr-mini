!function(e){function t(i){if(r[i])return r[i].exports;var n=r[i]={exports:{},id:i,loaded:!1};return e[i].call(n.exports,n,n.exports,t),n.loaded=!0,n.exports}var r={};return t.m=e,t.c=r,t.p="",t(0)}([function(e,t,r){e.exports=r(17)},function(e,t){var r={};r.EPSILON=1e-6,r.ARRAY_TYPE="undefined"!=typeof Float32Array?Float32Array:Array,r.RANDOM=Math.random,r.ENABLE_SIMD=!1,r.SIMD_AVAILABLE=r.ARRAY_TYPE===Float32Array&&"SIMD"in this,r.USE_SIMD=r.ENABLE_SIMD&&r.SIMD_AVAILABLE,r.setMatrixArrayType=function(e){r.ARRAY_TYPE=e};var i=Math.PI/180;r.toRadian=function(e){return e*i},r.equals=function(e,t){return Math.abs(e-t)<=r.EPSILON*Math.max(1,Math.abs(e),Math.abs(t))},e.exports=r},function(e,t){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),n=function(){function e(t){r(this,e),this.util=t,this.emitter=t.emitter,this.MIN_WAIT_TIME=100,this.MAX_TRIES=6,this.NOT_IN_LIST=this.util.NOT_IN_LIST,this.keyList=[],this.defaultKey=null}return i(e,[{key:"getPlaceholder",value:function(){return this.defaultKey?this.keyList[this.defaultKey]:null}},{key:"getAssetByKey",value:function(e){if(e){if(this.keyList[e])return this.keyList[e]}else console.error("AssetPool::getAssetByKey(): undefined key");return null}},{key:"getAssetByName",value:function(e){if(e)for(var t in this.keyList){var r=this.keyList[t];if(r.name&&r.name===e)return r}return null}},{key:"getAllAssets",value:function(){return this.keyList}},{key:"pathInList",value:function(e){if(e)for(var t in this.keyList){var r=this.keyList[t];if(r.path&&r.path===e)return r}return null}},{key:"assetInList",value:function(e){if(e)for(var t in this.keyList){var r=this.keyList[t];if(r===e)return r}return null}},{key:"addAsset",value:function(e,t){if(e)if(t){if(this.keyList[t]){if(this.keyList[t]===e)return console.warn("AssetPool::addAsset(): asset "+t+" already added to pool"),e;console.warn("AssetPool::addAsset(): replacing old asset at same key:"+t)}else this.keyList[t]=e;e.key=t}else e.key=this.util.computeId(),this.keyList[e.key]=e;return e}},{key:"removeAsset",value:function(e){var t=null;return this.keyList[e]?(t=this.keyList[e],t&&delete this.keyList[e],t):(console.warn("AssetPool::removeAsset(): key not found in assetList"),null)}},{key:"getWrappedPromise",value:function(){var e={},t=new Promise(function(t,r){e.resolve=t,e.reject=r});return e.then=t.then.bind(t),e.catch=t.catch.bind(t),e.promise=t,e}},{key:"getWrappedFetch",value:function(e,t,r,i){var n=this,a=this.getWrappedPromise(),o=new Request(e,t);return a.url=e,a.params=t,a.tries=r,a.pos=i,a.timeoutId=setTimeout(function(){console.warn("AssetPool::getWrappedFetch(): TIMEOUT for "+(n.MIN_WAIT_TIME*a.tries+1)+"msec "+a.url),a.catch(0)},this.MIN_WAIT_TIME*a.tries),fetch(o).then(function(e){if(e.ok)return e;throw new Error("Network response was not ok for "+a.url)}).then(function(e){return clearTimeout(a.timeoutId),a.resolve(e)},function(e){return console.warn("AssetPool::getWrappedFetch(): NOT OK, REJECT "+a.url),clearTimeout(a.timeoutId),a.reject(e)}).catch(function(e){return console.warn("AssetPool::getWrappedFetch(): NOT OK, CATCH "+a.url),clearTimeout(a.timeoutId),a.catch(e)}),a}},{key:"doRequest",value:function(e,t,r){var i=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],n=this,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"text/plain",o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,s=new Headers({"Content-Type":a+"; charset: UTF-8"}),l=this.getWrappedFetch(i?e+"?"+(new Date).getTime():e,{method:"get",mode:"cors",redirect:"follow",headers:s},o,t);return l.promise.then(function(e){var t=null;return 200===e.status||0===e.status?(t="application/json"===a?e.json():a.indexOf("text")!==n.util.NOT_IN_LIST?e.text():"application/xml"===a?e.formData():a.indexOf("image")!==n.util.NOT_IN_LIST?e.blob():e.blob(),Promise.resolve(t)):Promise.reject(e)},function(o){return l.tries++,l.tries<n.MAX_TRIES&&(console.warn("AssetPool::doRequest(): ft.promise .then error, TRYING AGAIN:"+o+" for "+l.url),n.doRequest(e,t,r,i=!0,a,l.tries)),Promise.resolve(o)}).then(function(i){r(i instanceof Error?{pos:t,path:e,data:null,error:i}:{pos:t,path:e,data:i,error:!1})},function(e){return Promise.reject(0)})}}]),e}();t.default=n},function(e,t){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),n=function(){function e(t,i,n,a,o,s,l){r(this,e),console.log("In Shader class"),this.name=s,this.util=i,this.glMatrix=n,this.webgl=a,this.vr=o,this.pMatrix=this.glMatrix.mat4.create(),this.mvMatrix=this.glMatrix.mat4.create(),this.mvMatrixStack=this.glMatrix.mat4.create(),this.floatp="",this.webgl.stats.highp?this.floatp="precision highp float;":this.floatp="precision mediump float;",l?this.lights=l:this.lights=null,this.required={buffer:{vertices:!0,indices:!1,texCoords:!1,normals:!1,colors:!0,tangents:!1},textures:{map_Kd:!1,map_Ks:!1,map_Ka:!1,map_bump:!1,map_refl:!1,map_d:!1,map_disp:!1},lights:{world:!1,internal:!1}},this.MAX_FAIL=100,this.sortByDistance=!1,this.vertexShaderFile=null,this.fragmentShaderFile=null,this.NOT_IN_LIST=i.NOT_IN_LIST,this.createProgram()}return i(e,[{key:"primInList",value:function(e){var t=this.program.renderList,r=t.indexOf(e);return r}},{key:"addPrim",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(e.failCount>this.MAX_FAIL)return e.shader.removePrim(e),void console.error("prim:"+e.name+" could not be added to Shader:"+this.name+", giving up (removing from display list)");if(this.checkPrim(e)){if(this.primInList(e)===this.NOT_IN_LIST){var r=this.program.renderList.indexOf(null);return r!==this.NOT_IN_LIST?this.program.renderList[r]=e:this.program.renderList.push(e),this.sortByDistance&&this.sortPrimsByDistance([0,0,0]),e.shader&&e.shader!==this&&e.shader.removePrim(e,t),e.shader=this,e.rendering=!0,t&&this.util.emitter.emit(this.util.emitter.events.PRIM_ADDED_TO_SHADER,e),!0}console.warn("Shader::addPrim():"+e.name+" already added to Shader::"+this.name)}return e.failCount++,!1}},{key:"removePrim",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=this.primInList(e);return r!==this.NOT_IN_LIST?(console.warn("Shader::removePrim():removing prim:"+e.name+" from Shader:"+this.name),this.program.renderList[r]=null,e.rendering=!1,t&&this.util.emitter.emit(this.util.emitter.events.PRIM_REMOVED_FROM_SHADER,e),!0):(console.warn("Shader::removePrim():"+e.name+" not found in Shader::"+this.name),!1)}},{key:"movePrim",value:function(e,t){if(e.shader&&t&&e.shader!==t)return t.addPrim(e,!1)}},{key:"checkPrim",value:function(e){return this.checkPrimBuffers(e)?this.checkPrimMaterials(e)?this.checkPrimTextures(e)?(console.log("Shader::checkPrim(): prim:"+e.name+" ready to be added to:"+this.name+" from:"+e.shader.name),!0):(console.warn("Shader::checkPrim():"+e.name+" has bad textures"),!1):(console.warn("Shader::checkPrim():"+e.name+" has bad materials"),!1):(console.warn("Shader::checkPrim():"+e.name+" has bad buffers"),!1)}},{key:"checkPrimBuffers",value:function(e){var t=this.required.buffer,r=e.geometry;for(var i in t)if(t[i]&&(!r[i]||!r[i].buffer))return!1;return!0}},{key:"checkPrimMaterials",value:function(e){if(void 0===e.matStarts||e.matStarts.length<1)return!1;for(var t=0;t<e.matStarts.length;t++)if(void 0===e.materials[e.matStarts[t][0]])return!1;return!0}},{key:"checkPrimTextures",value:function(e){for(var t=this.required.textures,r=e.matStarts,i=0;i<r.length;i++){for(var n in e.materials);var a=r[0][0],o=e.materials[a];if(void 0===o)return!1;for(var s in t)if(o[s]&&(null===o[s]||!(o[s]instanceof WebGLTexture)))return console.warn("Shader::checkTextures(): prim:"+e.name+" OBJ file does not have texture "+s+" defined in material:"+a+" yet"),!1}return!0}},{key:"sortPrimsByDistance",value:function(e){var t=this.glMatrix.vec3;this.program.renderList.sort(function(r,i){if(r&&i)return t.distance(r.position,e)-t.distance(i.position,e)})}},{key:"createProgram",value:function(){var e=null;return e=this.vertexShaderFile&&this.fragmentShaderFile?this.webgl.createProgram(this.webgl.fetchVertexShader(this.vertexShaderFile),this.webgl.fetchFragmentShader(this.fragmentShaderFile)):this.webgl.createProgram(this.vsSrc(),this.fsSrc()),e||console.error("error creating WebGL program using Shader "+this.constructor.name),this.program=e}},{key:"getProgram",value:function(){return this.program}},{key:"setup",value:function(){var e=this.program,t=this.glMatrix,r=t.mat4;this.pMatrix=t.mat4.create(),this.mMatrix=t.mat4.create(),this.vMatrix=t.mat4.create(),this.mvMatrix=t.mat4.create();var i=this.pMatrix,n=(this.mMatrix,this.vMatrix),a=this.mvMatrix,o=this.webgl.getCanvas(),s=this.webgl.getContext(),l=this.webgl.near,u=this.webgl.far,c=void 0;c=this.webgl.stats.uint32?s.UNSIGNED_INT:s.UNSIGNED_SHORT;return e.renderMono=function(t,n){r.copy(a,t),r.perspective(i,.4*Math.PI,o.width/o.height,l,u),e.render(i,n,!0)},e.renderVR=function(t,i,l,u){r.identity(n),s.viewport(0,0,.5*o.width,o.height),t.getStandingViewMatrix(n,i.leftViewMatrix,i.pose),r.multiply(a,n,l),e.render(i.leftProjectionMatrix,u,!0),r.identity(n),s.viewport(.5*o.width,0,.5*o.width,o.height),t.getStandingViewMatrix(n,i.rightViewMatrix,i.pose),r.multiply(a,n,l),e.render(i.rightProjectionMatrix,u,!1)},[s,o,this.glMatrix.mat4,this.glMatrix.mat3,this.glMatrix.vec3,e,{attribute:this.webgl.setAttributeArrays(e.shaderProgram,e.vsVars.attribute),uniform:this.webgl.setUniformLocations(e.shaderProgram,e.vsVars.uniform)},{uniform:this.webgl.setUniformLocations(e.shaderProgram,e.fsVars.uniform)},this.webgl.stats,this.webgl.near,this.webgl.far,this.vr,c]}},{key:"getPMatrix",value:function(){return this.pMatrix}},{key:"getmMVMatrix",value:function(){return this.mvMatrix}},{key:"mvPushMatrix",value:function(e){var t=this.glMatrix.mat4,r=t.clone(e);this.mvMatrixStack.push(r)}},{key:"mvPopMatrix",value:function(){if(0==this.mvMatrixStack.length)throw"Invalid popMatrix!";mvMatrix=this.mvMatrixStack.pop()}}]),e}();t.default=n},function(e,t){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),n=function(){function e(t){r(this,e),this.glMatrix=t,this.lightTypes={LIGHT_0:"light0",LIGHT_1:"light1",LIGHT_2:"light2",LIGHT_3:"light3"},this.lightList=[],this.setLight(this.lightTypes.LIGHT_0)}return i(e,[{key:"getLight",value:function(e){return e||(e=this.lightTypes.LIGHT_0),this.lightList[e]}},{key:"getPos",value:function(e){return e||(e=this.lightTypes.LIGHT_0),this.lightList[e].lightingDirection}},{key:"setLight",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[.3,.3,.3],r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[-1e3,0,1000.1],i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[1,1,1];arguments.length>4&&void 0!==arguments[4]&&arguments[4];this.lightList[e]={ambient:t,lightingDirection:r,directionalColor:i,attenuation:0,radius:1}}},{key:"setPos",value:function(e,t,r,i){e||(e=this.lightTypes.LIGHT_0),this.lightList[e].lightingDirection=[-t,-r,i]}},{key:"setPolar",value:function(e,t,r){e||(e=this.lightTypes.LIGHT_0)}}]),e}();t.default=n},function(e,t,r){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var s=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),l=r(2),u=i(l),c=function(e){function t(e,r,i,o,s){n(this,t),console.log("in ModelPool");var l=a(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,r));return l.util=r,l.webgl=i,l.texturePool=o,l.materialPool=s,l.modelMimeTypes={obj:"text/plain",mtl:"text/plain",gltf:"text/tgltf",gltfBinary:"bin/gltf",hyg:"text/plain"},e&&(l.defaultKey=l.addAsset(l.default()).key),l}return o(t,e),s(t,[{key:"default",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[],n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:[],a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:[],o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:[],s=arguments.length>7&&void 0!==arguments[7]?arguments[7]:[],l=arguments.length>8&&void 0!==arguments[8]?arguments[8]:[];return{vertices:e,indices:t,texCoords:r,normals:i,tangents:[],options:{objects:n,groups:a,smoothingGroups:o,materials:s,matStarts:l}}}},{key:"computeObj3d",value:function(e,t){var r=e.match(/^(-?\d+(\.\d+)?)\s*(-?\d+(\.\d+)?)\s*(-?\d+(\.\d+)?)/);return!!r&&(t.push(parseFloat(r[1]),parseFloat(r[3]),parseFloat(r[5])),!0)}},{key:"computeObj2d",value:function(e,t){var r=e.match(/^(-?\d+(\.\d+)?)\s+(-?\d+(\.\d+)?)$/);if(r)return t.push(parseFloat(r[1]),parseFloat(r[3])),!0;var i=[];return!!this.computeObj3d(e,i)&&(t.push(i[0],i[1]),!0)}},{key:"computeFaceIndex",value:function(e){return Number.isFinite(e)?e:(console.warn("WEIRD NUM:"+e),this.NOT_IN_STRING)}},{key:"computeFaceFan",value:function(e){if(e.length){for(var t=[],r=1;r<e.length-1;r++)t.push(e[0],e[r],e[r+1]);return t}return e}},{key:"computeObjFaces",value:function(e,t,r){var i=e.match(/[^\s]+/g),n=this.NOT_IN_LIST,a=void 0,o=[],s=[],l=[];i.map(function(e){e.indexOf("//")!==n?(a=e.split("//"),o.push(parseFloat(a[0])-1),s.push(null),l.push(parseFloat(a[1])-1)):e.indexOf("/")!==n?(a=e.split("/"),o.push(parseFloat(a[0])-1),2==a.length?(s.push(parseFloat(a[1])-1),l.push(null)):3===a.length&&(s.push(parseFloat(a[1])-1),l.push(parseFloat(a[2])-1))):o.push(parseFloat(e)-1)}),o=this.computeFaceFan(o),s=this.computeFaceFan(s),l=this.computeFaceFan(l);for(var u=0;u<o.length;u++)t.push([o[u],s[u],l[u]])}},{key:"computeObjMesh",value:function(e,t,r){var i=this,n=this.default(),a=this.util.isWhitespace,o=(n.vertices,n.indices,n.texCoords,n.normals,this.util.DEFAULT_KEY,n.options.objects),s=n.options.groups,l=n.options.smoothingGroups,u=(n.options.materials,n.options.matStarts),c=[],h=[],d=[],f=[],m=[],v=[],p=this.util.getFilePath(r),g=this.materialPool.createDefaultName(t.name),A=0,y=e.split("\n"),M=this.NOT_IN_STRING;if(y.forEach(function(e){var r=e.split(" ")[0].trim(),n=e.substr(r.length).trim();if(""!==n)switch(r){case"o":t.name||(t.name=n),o.push([n,v.length]),M=r;break;case"g":s.push([n,v.length]),M=r;break;case"s":l.push([n+"s"]),M=r;break;case"v":i.computeObj3d(n,h),M=r;break;case"f":var c=void 0,m=void 0;"s"===M&&(c=l[l.length-1],m=v.length,c.push(m)),i.computeObjFaces(n,v,A),"s"===M&&c.push(v.length-m),M=r;break;case"vn":i.computeObj3d(n,d),M=r;break;case"vt":i.computeObj2d(n,f)||i.computeObj3d(n,f),M=r;break;case"mtllib":for(var y=n.split(" "),x=0;x<y.length;x++){var b=p+i.util.getFileName(y[x]);i.materialPool.getMaterial(t,b,!0,{pos:x})}M=r;break;case"usemtl":g=i.util.getFileName(n),u.push([g,4*v.length,0]),M=r;break;case"#":break;case"maplib":case"usemap":case"vp":case"p":case"l":case"curv":case"surf":case"parm":case"trim":case"hole":case"scrv":case"sp":case"end":case"con":case"mg":case"bevel":case"c_interp":case"d_interp":case"lod":case"shadow_obj":case"trace_obj":case"ctech":case"stech":case"":console.warn("ModelPool::computeObjMesh(): OBJ data type: "+r+" in .obj file not supported");break;default:a(n)||console.error("ModelPool::computeObjMesh(): unknown line data: "+e+" in .obj file at line:"+A)}A++}),!v.length)return console.error("ModelPool::computeObjMesh(): no faces data in file!"),n;for(var x=[],b=[],E=[],D=[],w=0;w<v.length;w++){var S=v[w],P=S[0]+"_"+S[1]+"_"+S[2],I=void 0,T=void 0;if(void 0!==m[P])I=S[0],T=m[P],x.push(m[P]);else{I=S[0],T=parseInt(b.length/3);var R=void 0,F=void 0;x.push(T),m[P]=T,I*=3,b.push(h[I],h[I+1],h[I+2]),null!==S[1]&&void 0!==S[1]&&(R=2*S[1],isFinite(f[R])&&isFinite(f[R+1])?E.push(f[R],f[R+1]):console.error("ModelPool::computeObjMesh(): bad texCoords in file: at"+R+"  face ("+S+")")),null!==S[2]&&void 0!==S[2]&&(F=3*S[2],isFinite(d[F])&&isFinite(d[F+1]&&isFinite(d[F+2]))?D.push(d[F],d[F+1],d[F+2]):console.error("ModelPool::computeObjMesh(): bad normals in file at"+F+" face ("+S+")"))}}b.length>this.webgl.MAX_DRAWELEMENTS&&console.error("ModelPool::computeObjMesh(): size of prim "+t.name+" ("+b.length+") exceeds max buffer:"+this.webgl.MAX_DRAWELEMENTS),D.length>0&&D.length!==b.length&&(console.warn("ModelPool::computeObjMesh(): not enough normals returned, zeroing out!"),D=[]),E.length>0&&E.length!==2*b.length/3&&(console.warn("ModelPool::computeObjMesh(): not enough texCoords returned, zeroing out!"),E=[]),h=b,c=x,f=E,d=D,0===u.length&&n.options.matStarts.push([this.materialPool.createDefaultName(t.name),0,c.length]);for(var C=1;C<n.options.matStarts.length;C++)n.options.matStarts[C-1][2]=(n.options.matStarts[C][1]-n.options.matStarts[C-1][1])/4;return n.options.matStarts[n.options.matStarts.length-1][2]=c.length-n.options.matStarts[n.options.matStarts.length-1][1]/4,n.options.matStarts=u,n.vertices=h,n.indices=c,n.texCoords=f,n.normals=d,n}},{key:"computeGlTFMesh",value:function(e,t,r){var i=this.default();i.data=JSON.parse(e);for(var n in i.data)switch(n){case"scene":break;case"scenes":break;case"nodes":}return i}},{key:"computeGlTFBinaryMesh",value:function(e,t,r){var i=this.default();return i}},{key:"computeHyg",value:function(e,t,r,i){for(var n=this.default(),a=(t.dimensions,JSON.parse(e)),o=[],s=[],l=[],u=[],c=[],h=n.options.objects,d=0,f=!1,m=!0,v=0;v<a.length;v++){var p=a[v];if(i.useXYZ===!0)p.dist<this.webgl.far&&(o.push(parseFloat(p.x),parseFloat(p.y),parseFloat(p.z)),l.push(0,0,0),s.push(d++),u.push(0,1));else{var g=this.util.degToRad(15*parseFloat(p.ra)),A=this.util.degToRad(parseFloat(p.dec));o.push(Math.sin(A),Math.cos(A)*Math.cos(g),Math.cos(A)*Math.sin(g)),l.push(0,0,0),s.push(d++),u.push(0,1)}var y=1-(parseFloat(p.mag)+1.44)/8.5,M=void 0,x=void 0,b=p.spect[0];if(b&&!f){switch(b=b.toLowerCase()){case"o":x="9bb0ff";break;case"b":x="aabfff";break;case"a":x="aabfff";break;case"f":x="fbf8ff";break;case"g":x="fff4e8";break;case"k":x="ffddb4";break;case"m":x="ff806f";break;default:x="#FFFFFF"}M=this.util.hexToRGB(x,255),M.r*=y,M.g*=y,M.b*=y}else x=parseFloat(p.ci)||0,x*=y,M={r:y+x,g:y,b:y-x};"Betelgeuse"===p.proper||"Rigel"===p.proper||"Bellatrix"===p.proper||"Saiph"===p.proper||"Alnitak"===p.proper||"Alnilam"===p.proper||"Mintaka"===p.proper||"Alkaid"===p.proper||"Mizar"===p.proper||"Alioth"===p.proper||"Mergrez"===p.proper||"Phad"===p.proper||"Merak"===p.proper||"Dubhe"===p.proper||"Polaris"===p.proper||"kochab"===p.proper||"75097"===p.hip||"79822"===p.hip||"77055"===p.hip||"82080"===p.hip||"85822"===p.hip||"Caph"===p.proper||"Shedir"===p.proper||"Cih"===p.proper||"Ruchbah"===p.proper||"8867"===p.id?c.push(0,1,0,1):c.push(M.r,M.b,M.b,1),m?p.proper.length>0&&h.push([p,o.length]):h.push([p,o.length])}return t.geolocate=!0,n.options.matStarts.push([this.materialPool.createDefaultName(t.name),0,s.length]),n.vertices=o,n.indices=s,n.texCoords=u,n.normals=l,n.colors=c,n}},{key:"addModel",value:function(e,t,r,i,n){var a=this.util.getFileExtension(r),o=null,s="";switch(a){case"obj":o=this.computeObjMesh(t,e,r),o.tangents=[],o.colors=[],s=this.util.emitter.events.OBJ_GEOMETRY_READY;break;case"gltf":o=this.computeGlTFMesh(t,e,r),s=this.util.emitter.events.GLTF_GEOMETRY_READY;break;case"gltfbinary":o=this.computeGlTFBinaryMesh(t,e,r),s=this.util.emitter.events.GLTF_GEOMETRY_READY;break;case"hyg":e.drawTris=!1,e.drawLines=!1,e.drawPoints=!0,o=this.computeHyg(t,e,r,n),s=this.util.emitter.events.HYG_GEOMETRY_READY;break;default:console.warn("ModelPool::addModel(): unknown model file:"+r+" MIME type:"+i)}return o?(o.type=e.type,o.path=r,o.emits=s):console.warn("ModelPool::addModel(): no model returned by addModel() + "+i+" function"),this.addAsset(o)}},{key:"getModel",value:function(e,t){var r=this,i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{pos:0},a=this.pathInList(t);if(null!==a)return void this.util.emitter.emit(a.emits,e,a.key,n);if(this.util.isWhitespace(t))console.warn("ModelPool::getModel(): no path supplied for prim:"+e.name);else{var o=this.modelMimeTypes[this.util.getFileExtension(t)];o?this.doRequest(t,n.pos,function(i){if(i.data){var a=r.addModel(e,i.data,i.path,o,n);a?r.util.emitter.emit(a.emits,e,a.key,n):console.error("ModelPool::getModel():"+ +r.util.getFileExtension(t)+" file path:"+t+" could not be parsed")}else console.error("ModelPool::getModel(): "+r.util.getFileExtension(t)+" file, no data found for:"+i.path)},i,o,0):console.error('ModelPool::getModel(): file type "'+this.util.getFileExtension(t)+'" in:'+t+" not supported, not loading")}}}]),t}(u.default);t.default=c},function(e,t,r){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var s=r(2),l=i(s),u=function(e){function t(e,r,i){n(this,t);var o=a(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,r,i));return o}return o(t,e),t}(l.default);t.default=u},function(e,t,r){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),o=r(8),s=i(o),l=r(9),c=i(l),h=r(11),d=(i(h),r(5)),f=(i(d),function(){function e(t,r,i,a,o){n(this,e),console.log("in GeometryPool class"),this.util=r,this.glMatrix=i,this.webgl=a,this.modelPool=o,this.typeList={POINT:"geometryPointCloud",POINTCLOUD:"geometryPointCloud",TEXTURECLOUD:"geometryTextureCloud",STARDOME:"geometryStarDome",STAR3D:"geometryStarSpace",LINE:"geometryLine",PLANE:"geometryOuterPlane",OUTERPLANE:"geometryOuterPlane",INNERPLANE:"geometryInnerPlane",CURVEDPLANE:"geometryCurvedOuterPlane",CURVEDOUTERPLANE:"geometryCurvedOuterPlane",CURVEDINNERPLANE:"geometryCurvedInnerPlane",TERRAIN:"geometryTerrain",CIRCLE:"geometryCircle",CUBE:"geometryCube",CUBESPHERE:"geometryCubeSphere",SPHERE:"geometrySphere",DISC:"geometryCap",CAP:"geometryCap",DOME:"geometryDome",TOPDOME:"geometryTopDome",SKYDOME:"geometrySkyDome",BOTTOMDOME:"geometryBottomDome",CONE:"geometryCone",TOPCONE:"geometryTopCone",BOTTOMCONE:"geometryBottomCone",SPINDLE:"geometrySpindle",TEARDROP:"geometryTeardrop",CYLINDER:"geometryCylinder",CAPSULE:"geometryCapsule",PRISM:"geometryPrism",ICOSOHEDRON:"geometryIcosohedron",PYRAMID:"geometryPyramid",REGULARTETRAHEDRON:"geometryRegularTetrahedron",ICOSPHERE:"geometryIcoSphere",TOPICODOME:"geometryTopIcoDome",SKYICODOME:"geometrySkyIcoDome",BOTTOMICODOME:"geometryBottomIcoDome",OCTAHEDRON:"geometryOctahedron",DODECAHEDRON:"geometryDodecahedron",TORUS:"geometryTorus",MESH:"geometryMesh"},this.directions={DEFAULT:"up",FORWARD:"forward",FRONT:"forward",BACK:"back",LEFT:"left",RIGHT:"right",UP:"up",TOP:"top",DOWN:"down",BOTTOM:"down"},this.OUTSIDE=100,this.INSIDE=101,this.INVISIBLE=102,this.TWO_PI=2*Math.PI}return a(e,[{key:"default",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[],n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:[],a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:[];return{vertices:e,indices:t,normals:i,texCoords:r,tangents:n,colors:a}}},{key:"checkType",value:function(e){return this[e]instanceof Function}},{key:"getStdVecs",value:function(e){var t=this.directions;switch(e){case t.BACK:return[0,0,-1];case t.DOWN:return[0,-1,0];case t.FORWARD:return[0,0,1];case t.LEFT:return[-1,0,0];case t.RIGHT:return[1,0,0];case t.UP:return[0,1,0];case t.ONE:return[1,1,1];case t.ZERO:return[0,0,0]}}},{key:"vec5",value:function(e,t,r){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;return[e,t,r,i,n]}},{key:"computePointInTriangle",value:function(e,t,r,i){this.computeBaryCentric(e,t,r,i);return u>=0&&v>=0&&u+v<1}},{key:"computeAngle2d",value:function(e,t,r){var i=void 0,n=void 0;switch(r){case 0:i=t[0]-e[0],n=t[2]-e[2];break;case 1:i=t[0]-e[0],n=t[1]-e[1];break;case 2:i=t[1]-e[1],n=t[2]-e[2];break;default:console.error("invalid 2d angle choice, "+r)}return Math.atan2(n,i)}},{key:"computeAngle3d",value:function(e,t,r){var i=[t[0]-e[0],t[1]-e[1],t[2]-e[2]],n=[r[0]-t[0],r[1]-t[1],r[2]-t[2]],a=Math.sqrt(i[0]*i[0]+i[1]*i[1]+i[2]*i[2]),o=Math.sqrt(n[0]*n[0]+n[1]*n[1]+n[2]*n[2]),s=[i[0]/a,i[1]/a,i[2]/a],l=[n[0]/o,n[1]/o,n[2]/o];return Math.acos(s[0]*l[0]+s[1]*l[1]+s[2]*l[2])}},{key:"computeCentroid",value:function(e){for(var t=[0,0,0],r=e.length,i=0;i<r;i++){var n=e[i];t[0]+=n[0],t[1]+=n[1],t[2]+=n[2]}return t[0]/=r,t[1]/=r,t[2]/=r,t}},{key:"computeMassCentroid",value:function(e){for(var t=this.glMatrix.vec3,r=[0,0,0],i=0,n=e[0],a=e[1],o=2;o<e.length;o++){var s=e[o],l=t.subtract([0,0,0],s,n),u=t.subtract([0,0,0],s,a),c=t.cross([0,0,0],l,u),h=t.length(c)/2;r[0]+=h*(n[0]+a[0]+s[0])/3,r[1]+=h*(n[1]+a[1]+s[1])/3,r[2]+=h*(n[2]+a[2]+s[2])/3,i+=h,a=t.copy([0,0,0],s)}return[r[0]/i,r[1]/i,r[2]/i]}},{key:"computeBarycentric",value:function(e,t,r,i){var n=this.glMatrix.vec3,a=void 0,o=void 0,s=void 0,l=void 0,u=void 0,c=void 0,h=void 0,d=void 0;a=n.sub(a,i,t),o=n.sub(o,r,t),s=n.sub(s,e,t),l=n.dot(a,a),u=n.dot(a,o),c=n.dot(a,s),h=n.dot(o,o),d=n.dot(o,s);var f=1/(l*h-u*u),m=(h*c-u*d)*f,v=(l*d-u*c)*f;return[m,v]}},{key:"computeBoundingBox",value:function(e){for(var t=this.glMatrix.vec3,r={},i=0,n=0,a=0,o=0,s=0,l=0,u=0;u<e.length;u+=3){var c=e[u],h=e[u+1],d=e[u+2];i=Math.min(i,c),n=Math.min(n,h),a=Math.min(a,d),o=Math.max(o,c),s=Math.max(s,h),l=Math.max(l,d)}return r.vertices=[i,n,l,o,n,l,o,s,l,i,s,l,i,n,a,i,s,a,o,s,a,o,n,a,i,s,a,i,s,l,o,s,l,o,s,a,i,n,a,o,n,a,o,n,l,i,n,l,o,n,a,o,s,a,o,s,l,o,n,l,i,n,a,i,n,l,i,s,l,i,s,a],r.indices=[0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23],r.topLeft=[i,n,a],r.bottomRight=[o,s,l],r.dimensions=t.subtract([0,0,0],r.bottomRight,r.topLeft),r}},{key:"computeBoundingSphere",value:function(e){var t={},r=e.topLeft,i=e.bottomRight,n=Math.abs(i[0]-r[0]),a=Math.abs(i[1]-r[1]),o=Math.abs(i[2]-r[2]),s=Math.max(n,a,o)/2;t.radius=s;var l=this.computeCentroid(vertices);return t.center=l,t}},{key:"computeSphericalCoords",value:function(e){var t=Math.atan2(e[0],e[2])/this.TWO_PI,r=Math.asin(e[1])/Math.PI+.5;return t<0&&(t+=1),[t,r]}},{key:"computeInflateToSphere",value:function(e,t){for(var r=this.computeSphere(t),i=[],n=[],a=r.center[0],o=r.center[1],s=r.center[2],l=r.radius,u=0;u<e.length;u+=3){var c=e[u],h=e[u+1],d=e[u+2],f=Math.sqrt(a*c+o*h+s*d),m=f/l;i.push(c*m,h*m,d*m);var v=this.computeSphericalCoords([c,h,d]);n.push(v.u,v.v)}return{vertices:e,texCoords:texCoords}}},{key:"computeNormals",value:function(e,t,r){var i=(arguments.length>3&&void 0!==arguments[3]&&arguments[3],0),n=void 0,a=0,o=0,s=0,l=0,u=0,c=0,h=0,d=0,f=0,m=0,v=0,p=0,g=0,A=new Float32Array(e.length);for(n=t.length/3,i=0;i<n;i++)v=t[3*i],p=t[3*i+1],g=t[3*i+2],a=e[3*v]-e[3*p],o=e[3*v+1]-e[3*p+1],s=e[3*v+2]-e[3*p+2],l=e[3*g]-e[3*p],u=e[3*g+1]-e[3*p+1],c=e[3*g+2]-e[3*p+2],h=o*c-s*u,d=s*l-a*c,f=a*u-o*l,m=Math.sqrt(h*h+d*d+f*f),m=0===m?1:m,h/=m,d/=m,f/=m,A[3*v]+=h,A[3*v+1]+=d,A[3*v+2]+=f,A[3*p]+=h,A[3*p+1]+=d,A[3*p+2]+=f,A[3*g]+=h,A[3*g+1]+=d,A[3*g+2]+=f;for(i=0;i<A.length/3;i++)h=A[3*i],d=-A[3*i+1],f=A[3*i+2],m=Math.sqrt(h*h+d*d+f*f),m=0===m?1:m,h/=m,d/=m,f/=m,A[3*i]=-h,A[3*i+1]=d,A[3*i+2]=-f;return r=A}},{key:"computeTangents",value:function(e,t,r,i,n){for(var a=this.glMatrix.vec3,o=new Float32Array(r.length),s=new Float32Array(r.length),l=t.length,u=e.length,c=new Float32Array(4*u/3),h=0;h<l;h+=3){var d=t[h],f=t[h+1],m=t[h+2],v=3*d,p=e[v],g=e[v+1],A=e[v+2];v=3*f;var y=e[v],M=e[v+1],x=e[v+2];v=3*m;var b=e[v],E=e[v+1],D=e[v+2],w=y-p,S=b-p,P=M-g,I=E-g,T=x-A,R=D-A;v=2*d;var F=i[v],C=i[v+1];v=2*f;var O=i[v],k=i[v+1];v=2*m;var L=i[v],_=i[v+1],N=O-F,B=L-F,V=k-C,U=_-C,G=1/(N*U-B*V),z=(U*w-V*S)*G,W=(U*P-V*I)*G,j=(U*T-V*R)*G,Y=(N*S-B*w)*G,q=(N*I-B*P)*G,X=(N*R-B*T)*G;v=3*d,o[v]+=z,o[v+1]+=W,o[v+2]+=j,s[v]+=Y,s[v+1]+=q,s[v+2]+=X,v=3*f,o[v]+=z,o[v+1]+=W,o[v+2]+=j,s[v]+=Y,s[v+1]+=q,s[v+2]+=X,v=3*m,o[v]+=z,o[v+1]+=W,o[v+2]+=j,s[v]+=Y,s[v+1]+=q,s[v+2]+=X}for(var H=0,Q=0;Q<u;H+=3,Q+=4){var K=[r[H],r[H+1],r[H+2]],J=[o[H],o[H+1],o[H+2]],Z=[s[H],s[H+1],s[H+2]],$=a.sub([0,0,0],J,a.scale([0,0,0],J,a.dot(K,J))),ee=$[0]*$[0]+$[1]*$[1]+$[2]*$[2],te=ee>0?a.scale([0,0,0],$,1/Math.sqrt(ee)):$,re=a.dot(a.cross([0,0,0],K,J),Z)<0?-1:1;c[Q]=te[0],c[Q+1]=te[1],c[Q+2]=te[2],c[Q+3]=re}return n=c}},{key:"computeTexCoords",value:function(e,t){console.log("GeometryPool::()computeTexCoords(): vertices:"+e.length);for(var r=[],i=0;i<e.length;i+=3){var n=this.computeSphericalCoords([e[i],e[i+1],e[i+2]]);r.push(n[0],n[1])}return t=r}},{key:"computeColors",value:function(e,t){var r=[];if(4===t.length)for(var i=0;i<e.length;i+=3)r.push(t[0],t[1],t[2],t[3]);for(var n=0;n<e.length;n+=3)r.push(e[n],e[n+1],e[n+2],1);return r}},{key:"computeScale",value:function(e,t){for(var r=this.getCenter(e),i=0;i<e.length;i++)e[i]*=t;this.moveTo(r)}},{key:"computeMove",value:function(e,t){for(var r=this.computeCentroid(e),i=[r[0]-t[0],r[1]-t[1],r[2]-t[2]],n=0;n<e.length;n+=3)e[n]=i[0],e[n+1]=i[1],e[n+2]=i[2]}},{key:"computeFan",value:function(e,t){for(var r=(this.glMatrix.vec3,[]),i=0;i<t.length;i++)r.push(e[t[i]]);var n=this.computeCentroid(r);r.push(n);for(var a=r.length-1,o=[],s=[],l=[],u=r.length,c=1;c<u;c++){var h=c-1,d=c;c===u-1&&(d=0);r[h],r[d];l.push(h,d,a),s.push(n[0],n[1],n[2]),o.push(Math.cos(this.TWO_PI*d/(u-1))/2+.5,Math.sin(this.TWO_PI*d/(u-1))/2+.5);
}return o.push(.5,.5),s.push(n[0],n[1],n[2]),this.default(r,l,o,s,[],[])}},{key:"geometryPointCloud",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=e.dimensions,i=e.divisions;e.drawTris=!1,e.drawPoints=!0;var n=[],a=[],o=[],s=[],l=[],u=new c.default(this.util);u[u.typeList.SPHERE](r[0],r[1],r[2],i[0]*i[1]*i[2]),n=u.map;for(var h=0,d=0;d<u.map.length;d+=3)a.push(h++);if(t)for(var f=2*Math.PI,m=(Math.PI/2,0);m<u.mapUV.length;m+=2)s.push(1-u.mapUV[m]/f),s.push(u.mapUV[m+1]/Math.PI);return this.default(n,a,s,o,l)}},{key:"geometryTextureCloud",value:function(e){return this.geometryPointCloud(e,!0)}},{key:"geometryStarDome",value:function(e){return console.error("GeometryPool::geometryStarDome(): not procedural, use stellar data, generating randomMap"),this.geometryPointCloud(e)}},{key:"geometryStarSpace",value:function(e){return console.error("GeometryPool::geometryStarSpace(): not procedural, use stellar data, generating randomMap"),this.geometryPointCloud(e)}},{key:"geometryLine",value:function(e){var t=(this.glMatrix.vec3,e.geometry,e.dimensions[0]),r=e.dimensions[1],i=e.dimensions[2],n=parseFloat(e.dimensions[3])||1,a=(parseFloat(e.dimensions[4])||1,e.divisions[0]||1,[]),o=[],s=[],l=[],u=[];return a.push(t-n,r-n,i-n,t+n,r+n,i+n),o.push(0,3),this.default(a,o,s,l,u)}},{key:"geometrySphere",value:function(e){var t=this.typeList,r=this.glMatrix.vec3,i=e.geometry;e.applyTexToFace===!0&&console.warn("GeometryPool::geometrySphere(): cannot apply textures to individual faces of Sphere-derived shapes due to shared indices");var n=[],a=[],o=[],s=[],l=[],u=e.divisions[0],c=e.divisions[1],h=e.dimensions[0],d=e.dimensions[1],f=e.dimensions[2],m=parseFloat(e.dimensions[3])||0,v=parseFloat(e.dimensions[4])||1;m>e.dimensions[1]&&console.error("GeometryPool::geometrySphere(): error - flattening is greater than sphere radius for:"+e.name);var p=0,g=0,A=void 0;A=e.type===t.SPHERE||e.type===t.CYLINDER||e.type===t.SPINDLE||e.type===t.CONE||e.type===t.TEARDROP?c:e.type===t.CAP?1:c/2;var y=void 0,M=void 0;for(y=p;y<=A;y++){var x=y*Math.PI/c,b=Math.sin(x),E=Math.cos(x);for(M=g;M<=u;M++){var D=M*this.TWO_PI/u,w=Math.sin(D),S=Math.cos(D),P=void 0,I=void 0,T=void 0,R=void 0,F=void 0,C=void 0,O=void 0,k=y/A;C=k/2;var L=M/u;switch(R=1-L,F=1-k,P=S*b/2,T=w*b/2,O=(1-k)*m,e.type){case t.CAP:I=0;break;case t.CYLINDER:case t.PRISM:m>0&&k<=m?I=1-m:1!==v&&k>=v?I=1-v:(I=1-k,P=S/2,T=w/2),I-=.5;break;case t.SPHERE:I=E/2,m>0&&(I-=O);break;case t.TOPDOME:case t.DOME:I=E/2,m>0&&(I-=O);break;case t.SKYDOME:I=E/2,m>0&&(I-=O),R=L;break;case t.BOTTOMDOME:I=(1-E)/2-.5,m>0&&(I-=O),R=L,F=k;break;case t.SPINDLE:k<=.4?(P=S*k,T=w*k):(P=S*(1-k+1/A),T=w*(1-k+1/A)),I=1-k-.5;break;case t.TEARDROP:k<.5?I=E/4:(P=2*S*(.5-C),T=2*w*(.5-C),I=E/2);break;case t.CONE:k<=m?(I=1-m,P=S*C,T=w*C):k>v?(I=1-v,P=S*b/2,T=w*b/2):(I=1-k,P=S*C,T=w*C),I-=.5;break;case t.TOPCONE:P=S*C,T=w*C,I=.5-C;break;case t.BOTTOMCONE:P=S*(.5-C),T=w*(.5-C),I=0-C}s.push(R,F);var _=r.normalize([0,0,0],[P,I,T]);if(n.push(P*h,I*d,T*f),e.type===t.BOTTOMDOME||e.type===t.BOTTOMCONE||e.type===t.SKYDOME?(I=-I,o.push(-_[0],-_[1],-_[2])):(e.type===t.CAP&&(_[0]=_[2]=0,_[1]=1),o.push(_[0],_[1],_[2])),y!==A&&M!==u){var N=y*(u+1)+M,B=N+u+1;a.push(N+1,B+1,B),a.push(N,N+1,B)}}}return e.type===t.SKYDOME&&(i.indices.data=a.reverse()),this.default(n,a,s,o,l)}},{key:"geometryCap",value:function(e){return this.geometrySphere(e)}},{key:"geometryDome",value:function(e){return this.geometrySphere(e)}},{key:"geometryTopDome",value:function(e){return this.geometrySphere(e)}},{key:"geometrySkyDome",value:function(e){return e.visibleFrom=this.INSIDE,this.geometrySphere(e)}},{key:"geometryBottomDome",value:function(e){return this.geometrySphere(e)}},{key:"geometryCylinder",value:function(e){return this.geometrySphere(e)}},{key:"geometryCone",value:function(e){return this.geometrySphere(e)}},{key:"geometryTopCone",value:function(e){return this.geometrySphere(e)}},{key:"geometryBottomCone",value:function(e){return this.geometrySphere(e)}},{key:"geometrySpindle",value:function(e){return this.geometrySphere(e)}},{key:"geometryTeardrop",value:function(e){return this.geometrySphere(e)}},{key:"geometryCapsule",value:function(e){function t(e,t,n,s){for(var c=1/(e-1),h=0;h<e;h++){var d=Math.cos(r*h*c)*t,f=Math.sin(r*h*c)*t;i.push(l*d,l*n+u*s,l*f),a.push(d,n,f);var m=1-h*c,v=.5+(l*n+u*s)/(2*l+u);o.push(m,v)}}var r=this.TWO_PI,i=(this.typeList,this.glMatrix.vec3,this.util,e.geometry,[]),n=[],a=[],o=[],s=[];(e.divisions[0]<4||e.divisions[1]<4||e.divisions[2]<4)&&console.error("GeometryPool::geometryCapsule(): invalid number of divisions for "+e.name+" (must be 4+ in each dimension");for(var l=e.dimensions[0]||.5,u=e.dimensions[1]||1,c=e.divisions[0]||12,h=e.divisions[1]||12,d=c+1,f=c+d,m=1/(d-1),v=1/(c-1),p=0;p<c/2;p++)t(h,Math.sin(Math.PI*p*v),Math.sin(Math.PI*(p*v-.5)),-.5);for(var g=0;g<d;g++)t(h,1,0,g*m-.5);for(var A=c/2;A<c;A++)t(h,Math.sin(Math.PI*A*v),Math.sin(Math.PI*(A*v-.5)),.5);for(var y=0;y<f-1;y++)for(var M=0;M<h-1;M++)n.push(y*h+(M+1),y*h+(M+0),(y+1)*h+(M+1)),n.push((y+1)*h+(M+0),(y+1)*h+(M+1),y*h+M);return this.default(i,n,o,a,s)}},{key:"geometryCube",value:function(e){function t(t,r,i,n,a,o,l,c,h,d,f){for(var m=y,v=0;v<=l;v++)for(var p=0;p<=o;p++){var M=g[y]=[0,0,0];M[t]=(-n/2+p*n/o)*h,M[r]=(-a/2+v*a/l)*d,M[i]=c,e.heightMap&&(M[i]=e.heightMap.getPixel(p,v)),u.push(p/o,1-v/l),++y}for(var x=[],b=0;b<l;b++)for(var E=0;E<o;E++){var D=m+b*(o+1)+E;s.push(D,D+o+1,D+o+2),s.push(D,D+o+2,D+1),x.push(D,D+o+1,D+o+2),x.push(D,D+o+2,D+1)}A[f]=x}var r=this.glMatrix.vec3,i=this.util.flatten,n=this.typeList,a=this.directions;e.geometry;e.applyTexToFace===!1&&console.warn("GeometryPool::geometryCube(): textures can only apply to individual faces of Cube-derived shapes");var o=[],s=[],l=[],u=[],c=[],h=e.dimensions[0],d=e.dimensions[1],f=e.dimensions[2],m=e.divisions[0],v=e.divisions[1],p=e.divisions[2],g=[],A=[],y=0;switch(e.type){case n.CUBE:case n.CUBESPHERE:e.divisions[3]=parseFloat(e.divisions[3]),e.divisions[4]=parseFloat(e.divisions[4]),t(0,1,2,h,d,m,v,f/2,1,-1,a.FRONT,a),t(0,1,2,h,d,m,v,-f/2,-1,-1,a.BACK,a),t(2,1,0,f,d,p,v,-h/2,1,-1,a.LEFT,a),t(2,1,0,f,d,p,v,h/2,-1,-1,a.RIGHT,a),t(0,2,1,h,f,m,p,d/2,1,1,a.TOP,a),t(0,2,1,h,f,m,p,-d/2,1,-1,a.BOTTOM,a);break;case n.PLANE:case n.CURVEDOUTERPLANE:case n.CURVEDINNERPLANE:case n.TERRAIN:switch(e.dimensions[3]){case a.FRONT:t(0,1,2,h,d,m,v,f/2,1,-1,a.FRONT);break;case a.BACK:t(0,1,2,h,d,m,v,-f/2,-1,-1,a.BACK);break;case a.LEFT:t(2,1,0,h,d,p,v,-h/2,1,-1,a.LEFT);break;case a.RIGHT:t(2,1,0,h,d,p,v,h/2,-1,-1,a.RIGHT);break;case a.TOP:t(0,2,1,h,d,m,p,d/2,1,1,a.TOP);break;case a.BOTTOM:t(0,2,1,h,-d,m,p,-d/2,1,-1,a.BOTTOM)}}if(e.type!==n.CUBE&&e.type!==n.CUBESPHERE||0===e.divisions[3]){if((e.type===n.CURVEDOUTERPLANE||e.type===n.CURVEDINNERPLANE)&&e.dimensions[4]&&0!==e.dimensions[4]){var M=1;switch(e.dimensions[3]){case a.FRONT:e.type!==n.CURVEDINNERPLANE&&e.type!=n.INNERPLANE||(M=-1);break;case a.BACK:e.type!==n.CURVEDOUTERPLANE&&e.type!==n.OUTERPLANE||(M=-1);break;case a.LEFT:e.type!==n.CURVEDOUTERPLANE&&e.type!==n.OUTERPLANE||(M=-1);break;case a.RIGHT:e.type!==n.CURVEDINNERPLANE&&e.type!==n.INNERPLANE||(M=-1);break;case a.TOP:e.type!==n.CURVEDOUTERPLANE&&e.type!==n.OUTERPLANE||(M=-1);break;case a.BOTTOM:e.type!==n.CURVEDINNERPLANE&&e.type!==n.INNERPLANE||(M=-1)}for(var x=0;x<g.length;x++)switch(e.dimensions[3]){case a.FRONT:g[x][2]=M*Math.cos(g[x][0])*e.dimensions[4];break;case a.BACK:g[x][2]=M*Math.cos(g[x][0])*e.dimensions[4];break;case a.LEFT:g[x][0]=M*Math.cos(g[x][2])*e.dimensions[4];break;case a.RIGHT:g[x][0]=M*Math.cos(g[x][2])*e.dimensions[4];break;case a.TOP:g[x][1]=M*Math.cos(g[x][0])*e.dimensions[4];break;case a.BOTTOM:g[x][1]=-Math.cos(g[x][0])*e.dimensions[4]}}}else for(var b=[0,0,0],E=e.divisions[3],D=h/2,w=d/2,S=f/2,P=0;P<g.length;P++){var I=g[P],T=[I[0],I[1],I[2]];I[0]<-D+E?T[0]=-D+E:I[0]>D-E&&(T[0]=D-E),I[1]<-w+E?T[1]=-w+E:I[1]>w-E&&(T[1]=w-E),I[2]<-S+E?T[2]=-S+E:I[2]>S-E&&(T[2]=S-E);var R=[I[0],I[1],I[2]];r.sub(R,R,T),r.normalize(R,R),l[P]=R,I=[T[0],T[1],T[2]],b=[R[0],R[1],R[2]],r.scale(b,b,E),r.add(I,I,b),g[P]=I}return o=i(g,!1),l.length&&(l=i(l,!1)),this.default(o,s,u,l,c)}},{key:"geometryOuterPlane",value:function(e){return this.geometryCube(e)}},{key:"geometryInnerPlane",value:function(e){return this.geometryCube(e)}},{key:"geometryCurvedOuterPlane",value:function(e){return this.geometryCube(e)}},{key:"geometryCurvedInnerPlane",value:function(e){return this.geometryCube(e)}},{key:"geometryTerrain",value:function(e){return e.map||(console.log("Prim::geometryTerrain(): adding heightmap for:"+e.name),e.heightMap=new s.default(this.util),e.heightMap[e.heightMap.typeList.DIAMOND](e.divisions[0],e.divisions[2],.6,1)),this.geometryOuterPlane(e)}},{key:"geometryHexTerrain",value:function(e){}},{key:"geometryOctTerrain",value:function(e){}},{key:"geometryCubeSphere",value:function(e){return e.divisions[3]=e.dimensions[0]/2,this.geometryCube(e)}},{key:"geometryIcoSphere",value:function(e,t,r){function i(e,t){var r=1;for(P=0;P<e.length;P++){D=e[P],D[0]==r&&(t[P-1][0]=1),r=D[0];var i=[0,0];i[0]=Math.atan2(D[0],D[2])/-u,i[0]<0&&(i[0]+=1),i[1]=Math.asin(D[1])/Math.PI+.5,t[P]=i}for(t[e.length-4][0]=.125,t[0][0]=.125,t[e.length-3][0]=.375,t[1][0]=.375,t[e.length-2][0]=.625,t[2][0]=.625,t[e.length-1][0]=.875,t[3][0]=.875,P=0;P<x.length;P++)x[P][0]=1-x[P][0]}function n(e,t){for(P=0;P<e.length;P++){var r=e[P],i=c.normalize([0,0,0],[r[0],0,r[2]]),n=[0,0,0,0];n[0]=-i[2],n[1]=0,n[2]=i[0],n[3]=-1,t[P]=n}for(t[e.length-4]=[-1,0,1],t[0]=[-1,0,-1],t[e.length-3]=[1,0,-1],t[1]=[1,0,-1],t[e.length-2]=[1,0,1],t[2]=[1,0,1],t[e.length-1]=[-1,0,1],t[3]=[-1,0,1],P=0;P<4;P++)t[e.length-1-P][3]=t[P][3]=-1}function a(e,t,r,i,n){for(var a=1;a<=r;a++)n[i++]=c.lerp([0,0,0],e,t,a/r);return i}function o(e,t,r,i,n){for(var a=1;a<e;a++)n[i++]=r,n[i++]=t-1,n[i++]=t,n[i++]=r++,n[i++]=t++,n[i++]=r;return n[i++]=r,n[i++]=t-1,n[i++]=t,i}function s(e,t,r,i,n){n[i++]=r,n[i++]=t-1,n[i++]=++r;for(var a=1;a<=e;a++)n[i++]=t-1,n[i++]=t,n[i++]=r,n[i++]=r,n[i++]=t++,n[i++]=++r;return i}function l(e,t,r,i,n){n[i++]=r,n[i++]=++r,n[i++]=t-1;for(var a=1;a<=e;a++)n[i++]=t,n[i++]=t-1,n[i++]=r,n[i++]=r,n[i++]=++r,n[i++]=t++;return i}var u=this.TWO_PI,c=this.glMatrix.vec3,h=this.util.flatten,d=this.typeList,f=this.directions;e.applyTexToFace===!0&&console.warn("GeometryPool::geometryIcoSphere(): cannot apply textures to individual faces of IcoSphere-derived shapes due to shared indices");var m=void 0;m=e.divisions[0],m=e.type===d.REGULARTETRAHEDRON?1:e.type===d.ICOSOHEDRON?2:e.divisions[0];var v=.5*e.dimensions[0],p=m,g=this.getStdVecs.bind(this),A=[f.LEFT,f.BACK,f.RIGHT,f.FORWARD],y=(e.geometry,new Array((p+1)*(p+1)*4-3*(2*p-1))),M=new Array(y.length),x=new Array(y.length),b=new Array(y.length),E=new Array(y.length),D=0,w=0,S=0,P=void 0,I=void 0,T=void 0,R=void 0,F=void 0;for(P=0;P<4;P++)y[D++]=g(f.DOWN);for(P=1;P<=p;P++){for(T=P/p,F=c.lerp([0,0,0],g(f.DOWN),g(f.FORWARD),T),y[D++]=c.copy([0,0,0],F),I=0;I<4;I++)R=c.copy([0,0,0],F),F=c.lerp([0,0,0],g(f.DOWN),g(A[I]),T),t!==this.directions.TOP&&(S=o(P,D,w,S,M)),D=a(R,F,P,D,y),w+=P>1?P-1:1;w=D-1-4*P}for(P=p-1;P>=1;P--){for(T=P/p,F=c.lerp([0,0,0],g(f.UP),g(f.FORWARD),T),y[D++]=c.copy([0,0,0],F),I=0;I<4;I++)R=c.copy([0,0,0],F),F=c.lerp([0,0,0],g(f.UP),g(A[I]),T),t!==this.directions.BOTTOM&&(S=r===this.INSIDE?l(P,D,w,S,M):s(P,D,w,S,M)),D=a(R,F,P,D,y),w+=P+1;w=D-1-4*P}for(P=0;P<4;P++)M[S++]=w,M[S++]=D,M[S++]=++w,y[D++]=g(f.UP);for(P=0;P<y.length;P++)e.type!==d.OCTAHEDRON&&(y[P]=c.normalize([0,0,0],y[P])),b[P]=c.copy([0,0,0],y[P]);if(i(y,x),1!=v)for(P=0;P<y.length;P++)y[P][0]*=v,y[P][1]*=e.dimensions[1]/2,y[P][2]*=e.dimensions[2]/2;return n(y,E),y=h(y,!1),x=h(x,!1),b=h(b,!1),E=h(E,!1),this.default(y,M,x,b,E)}},{key:"geometryRegularTetrahedron",value:function(e){return this.geometryIcoSphere(e)}},{key:"geometryIcosohedron",value:function(e){return this.geometryIcoSphere(e)}},{key:"geometryPrism",value:function(e){var t=null;[e.divisions[0],e.divisions[1],e.divisions[2]];if(e.divisions=[3,2,3],t=this.geometrySphere(e),e.applyTexToFace===!0)for(var r=t.texCoords.length,i=0;i<r;i+=2){var n=3*t.texCoords[i];n>=2&&(n-=2),t.texCoords[i]=n}var a=e.dimensions[1]/2,o=t.vertices.length/3;return o=t.vertices.length/3,t.vertices=this.util.concatArr(t.vertices,[t.vertices[0],-a,t.vertices[2],t.vertices[3],-a,t.vertices[5],t.vertices[6],-a,t.vertices[8]]),t.normals=this.util.concatArr(t.normals,[0,-1,0,0,-1,0,0,-1,0]),t.texCoords=this.util.concatArr(t.texCoords,[0,1,1,1,.5,0]),t.indices=this.util.concatArr(t.indices,[o,o+1,o+2]),o=t.vertices.length/3,t.vertices=this.util.concatArr(t.vertices,[t.vertices[0],a,t.vertices[2],t.vertices[3],a,t.vertices[5],t.vertices[6],a,t.vertices[8]]),t.normals=this.util.concatArr(t.normals,[0,1,0,0,1,0,0,1,0]),t.texCoords=this.util.concatArr(t.texCoords,[0,1,1,1,.5,0]),t.indices=this.util.concatArr(t.indices,[o,o+1,o+2]),t}},{key:"geometryPyramid",value:function(e){for(var t=([e.divisions[0],e.divisions[1],e.divisions[2]],[-0,-.5,0,.5,.5,.5,-.5,.5,.5,-0,-.5,0,-.5,.5,.5,-.5,.5,-.5,-0,-.5,0,-.5,.5,-.5,.5,.5,-.5,-0,-.5,0,.5,.5,-.5,.5,.5,.5,-.5,.5,-.5,-.5,.5,.5,.5,.5,.5,.5,.5,-.5,-.5,.5,-.5,.5,.5,.5]),r=0;r<t.length;r+=3)t[r]*=e.dimensions[0],t[r+1]*=e.dimensions[1],t[r+2]*=e.dimensions[2];var i=[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17],n=[],a=[],o=[];return n=e.applyTexToFace===!0?[.5,1,0,0,1,0,.5,1,0,0,1,0,.5,1,0,0,1,0,.5,1,0,0,1,0,1,1,0,1,0,0,1,0,1,1,0,0]:[.125,1,0,0,.25,0,.375,1,.25,0,.5,0,.625,1,.5,0,.75,0,.875,1,.75,0,1,0,1,1,0,1,0,0,1,0,1,1,0,0],this.default(t,i,n,a,o)}},{key:"geometryIcoDome",value:function(e){return this.geometryTopIcoDome(e)}},{key:"geometryTopIcoDome",value:function(e){return this.geometryIcoSphere(e,this.directions.TOP)}},{key:"geometrySkyIcoDome",value:function(e){return e.visibleFrom=this.INSIDE,this.geometryIcoSphere(e,this.directions.TOP,e.visibleFrom)}},{key:"geometryBottomIcoDome",value:function(e){return this.geometryIcoSphere(e,this.directions.BOTTOM)}},{key:"geometryOctahedron",value:function(e){return this.geometryIcoSphere(e)}},{key:"geometryDodecahedron",value:function(e){var t=this.glMatrix.vec3,r=this.util.flatten,i=(e.geometry,[]),n=[],a=[],o=[],s=[],l=e.dimensions[0],u=e.dimensions[1],c=e.dimensions[2],h=(e.divisions[0]||.5,(1+Math.sqrt(5))/2),d=.5,f=.5/h,m=.5*(2-h),v=[[m,0,d],[-m,0,d],[-f,f,f],[0,d,m],[f,f,f],[f,-f,f],[0,-d,m],[-f,-f,f],[m,0,-d],[-m,0,-d],[-f,-f,-f],[0,-d,-m],[f,-f,-f],[f,f,-f],[0,d,-m],[-f,f,-f],[d,m,0],[-d,m,0],[-d,-m,0],[d,-m,0]],p=[[4,3,2,1,0],[7,6,5,0,1],[12,11,10,9,8],[15,14,13,8,9],[14,3,4,16,13],[3,14,15,17,2],[11,6,7,18,10],[6,11,12,19,5],[4,0,5,19,16],[12,8,13,16,19],[15,9,10,18,17],[7,1,2,17,18]];if(e.applyTexToFace)for(var g=0;g<p.length;g++){var A=i.length,y=this.computeFan(v,p[g]);i=i.concat(y.vertices);for(var M=0;M<y.indices.length;M++)y.indices[M]+=A;n=n.concat(y.indices),o=o.concat(y.texCoords),a=a.concat(y.normals)}else for(var x=0;x<p.length;x++){for(var b=p[x],E=[],D=b.length,w=0;w<b.length;w++)E.push(v[b[w]]);for(var S=this.geometry.computeCentroid(E),P=1;P<=D;P++){var I=P-1,T=P;P===D&&(I=T-1,T=0);var R=E[I],F=E[T];i.push(t.copy([0,0,0],R),t.copy([0,0,0],F),t.copy([0,0,0],S));var C=i.length-1;n.push(C-2,C-1,C),a.push(t.copy([0,0,0],R),t.copy([0,0,0],F),t.copy([0,0,0],S)),o.push(this.computeSphericalCoords(R),this.computeSphericalCoords(F),this.computeSphericalCoords(S))}}for(var O=0;O<i.length;O++){var k=i[O];k[0]*=l,k[1]*=u,k[2]*=c}return i=r(i),o=r(o),a=r(a),this.default(i,n,o,a,s)}},{key:"geometryTorus",value:function(e){for(var t=this.glMatrix.vec3,r=(e.geometry,[]),i=[],n=[],a=[],o=[],s=e.dimensions[0]/2,l=e.dimensions[2]/2,u=e.divisions[0],c=e.divisions[1],h=c+1,d=u+1,f=this.TWO_PI/u,m=this.TWO_PI/c,v=0,p=0,g=void 0,A=void 0,y=void 0,M=0;M<d;M++){v=f*M;for(var x=0;x<h;x++){p=m*x,g=Math.cos(v)*(s+l*Math.cos(p)),A=Math.sin(v)*(s+l*Math.cos(p)),y=l*Math.sin(p),r.push(g,A,y);var b=t.normalize([0,0,0],[g,A,y]);n.push(b[0],b[1],b[2]);var E=x/h,D=M/d;a.push(E,D)}}for(var w=0;w<u;w++)for(var S=0;S<c;S++){var P=S+w*h,I=S+1+w*h,T=S+(w+1)*h,R=S+1+(w+1)*h;i.push(T,R,I,T,I,P)}return this.default(r,i,a,n,o)}},{key:"geometryMesh",value:function(e,t){if(void 0===t||void 0===t.length)return console.error("GeometryPool::geometryMesh(): empty path passed for mesh file, returning"),!1;for(var r=0;r<t.length;r++)this.modelPool.getModel(e,t[r],!0,{pos:r});return!0}},{key:"getGeometry",value:function(e,t){var r=(!(arguments.length>2&&void 0!==arguments[2])||arguments[2],arguments.length>3&&void 0!==arguments[3]?arguments[3]:{pos:0});if(null!==t)!t instanceof String||!this.util.isWhitespace(t)?(console.log("GeometryPool::getGeometry(): getting model for:"+e.name+" at path:"+t),e.type===this.typeList.STARDOME?r.useXYZ=!1:e.type===this.typeList.STAR3D&&(r.useXYZ=!0),this.modelPool.getModel(e,t,!0,r)):console.warn("GeometryPool::getGeometry(): no path supplied for prim "+e.name);else{if(console.log("GeometryPool::getGeometry() new procedural geometry for:"+e.name),e.type===this.typeList.MESH)return void console.error("GeometryPool::getGeometry(): Mesh object for "+e.name+" does not have associated file, giving up");var i=this.modelPool.addAsset(this[e.type](e));i.type=e.type,i.path=i.key,i.material=this.util.DEFAULT_KEY,this.util.emitter.emit(this.util.emitter.events.PROCEDURAL_GEOMETRY_READY,e,i.key,r)}}}]),e}());t.default=f},function(e,t,r){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var s=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),l=r(10),u=i(l),c=function(e){function t(e){n(this,t),console.log("in Map2d");var r=a(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return r.typeList={PLANE:"initPlane",RANDOM:"initRandom",DIAMOND:"initDiamond",IMAGE:"initImage"},r.edgeType={NONE:0,WRAP:1,TOZERO:2},r.width=0,r.depth=0,r.low=0,r.high=0,r.map=null,r.squareSize=0,r.max=0,r.canvas=r.ctx=r.imgData=null,r}return o(t,e),s(t,[{key:"checkParams",value:function(e,t,r,i){return e<1||t<1?(console.error("invalid map width or height, was:"+e+", "+t),!1):r<0||r>1?(console.error("invalid Map roughness (0-1), was:"+r),!1):!(i<0||i>1)||(console.error("invalid Map flatten (0-1.0), was:"+i),!1)}},{key:"getPixel",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;if(e<0||e>this.width||t<0||t>this.depth)switch(r){case this.edgeType.WRAP:e<0&&(e=this.width-e),e>this.width-1&&(e-=this.width),t<0&&(t=this.depth-t),t>this.depth-1&&(t-=this.depth);break;case this.edgeType.TOZERO:var i=e,n=t;return e<0&&(e=0),e>this.width-1&&(e=this.width-1),t<0&&(t=0),t>this.depth-1&&(t=this.depth-1),this.map[e+this.squareSize*t]/(Math.abs(i-e)+Math.abs(n-t));default:return console.error("getPixel out of range x:"+e+" z:"+t+" width:"+w+" height:"+h+" max:"+this.max),-1}return this.map[e+this.width*t]}},{key:"setPixel",value:function(e,t,r){return e<0||e>this.max||t<0||t>this.max?(console.error("setPixel out of range x:"+e+" z:"+t+" max:"+this.max),-1):(this.low>r&&(this.low=r),this.high<r&&(this.high=r),void(this.map[e+this.width*t]=r))}},{key:"initPlane",value:function(e,t){this.checkParams(e,t,0,0)?(this.img=this.map=null,this.map=new Float32Array(e*t),this.width=e,this.depth=t,this.squareSize=Math.min(e*t),this.type=this.typeList.PLANE):console.error("error creating Map2d using "+this.typeList.PLANE)}},{key:"initRandom",value:function(e,t,r){if(this.checkParams(e,t,r,0)){this.map=new Float32Array(e*t),this.width=e,this.depth=t,this.squareSize=Math.min(e,t),this.max=this.squareSize-1;for(var i=this.util,n=0,a=this.map.length;n<a;n++)this.map[n]=i.getRand()*r;this.type=this.typeList.RANDOM}else console.error("error creating Map using "+this.typeList.RANDOM)}},{key:"initDiamond",value:function(e,t,r,i){if(this.checkParams(e,t,r,i)){this.img=this.map=null,console.log("starting width:"+e+" height:"+t+" roughness:"+r);var n=Math.pow(2,Math.ceil(Math.log((e+t)/2)/Math.log(2)));console.warn("random map, selecting nearest power of 2 ("+n+" x "+n+")"),this.squareSize=n+1,this.width=this.depth=n,this.map=new Float32Array(this.squareSize*this.squareSize),this.max=this.squareSize-1,this.setPixel(0,0,this.max),this.setPixel(this.max,0,this.max/2),this.setPixel(this.max,this.max,0),this.setPixel(0,this.max,this.max/2),this.divide(this.max,r),this.setPixel(0,0,(this.getPixel(0,1)+this.getPixel(1,0))/2),this.flatten(i/this.squareSize),this.type=this.typeList.DIAMOND}else console.error("error creating Map using "+this.typeList.DIAMOND)}},{key:"initImage",value:function(e,t,r,i){var n=this;this.checkParams(e,t,roughness,flatten),this.canvas||(this.canvas=document.createElement("canvas")),this.ctx||(this.ctx=this.canvas.getContext("2d"));var a=new Image;a.style.display="none",a.onload=function(){n.ctx.drawImage(a,0,0),n.imgData=n.ctx.getImageData(0,0,a.width,a.height),n.width=a.width,n.depth=a.height,n.squareSize=Math.min(e,h),n.max=n.squareSize-1,n.map=new Float32Array(n.squareSize);for(var t=0,r=n.imgData,i=0,o=n.data.length;i<o;i++)n.map[t++]=r[i]+r[i+1]+r[i+2]/3},a.onerror=function(){console.error("image could not be loaded:"+r)},a.src=r,i(this.data)}},{key:"divide",value:function(e,t){var r=void 0,i=void 0,n=e/2,a=t*e,o=this.util;if(!(n<1)){for(i=n;i<this.max;i+=e)for(r=n;r<this.max;r+=e)this.square(r,i,n,o.getRand()*a*2-a);for(i=0;i<=this.max;i+=n)for(r=(i+n)%e;r<=this.max;r+=e)this.diamond(r,i,n,o.getRand()*a*2-a);this.divide(e/2,t)}}},{key:"average",value:function(e){var t=e.filter(function(e){return e!==-1}),r=t.reduce(function(e,t){return e+t},0);return r/t.length}},{key:"square",value:function(e,t,r,i){var n=this.average([this.getPixel(e-r,t-r),this.getPixel(e+r,t-r),this.getPixel(e+r,t+r),this.getPixel(e-r,t+r)]);this.setPixel(e,t,n+i)}},{key:"diamond",value:function(e,t,r,i){var n=this.average([this.getPixel(e,t-r),this.getPixel(e+r,t),this.getPixel(e,t+r),this.getPixel(e-r,t)]);this.setPixel(e,t,n+i)}},{key:"flatten",value:function(e){var t=void 0;if(this.map&&this.map.length)for(var r=this.map,i=0,n=r.length;i<n;i++)r[i]*=e,t=r[i],this.high<t&&(this.high=t),this.low>t&&(this.low=t)}},{key:"roughen",value:function(e){this.map&&this.map.length}},{key:"scale",value:function(e,t){if(this.checkParams(e,t,0,0)){var r=new Float32Array(e*t),i=this.width/e,n=this.depth/t;console.log("original width:"+this.width+" new:"+e+"original height:"+this.depth+" new:"+t),console.log("xScale:"+i+" zScale:"+n);for(var a=0;a<t;a++)for(var o=0;o<e;o++)r[e*a+o]=this.biCubic(o*i,a*n);console.log("WIDTH:"+e+" HEIGHT:"+t),this.map=r,this.width=e,this.depth=t,this.squareSize=Math.min(e,t),this.max=this.squareSize-1}}},{key:"biLinear",value:function(e,t){if(e<0||e>1||t<0||t>1)return console.error("heightmap x index out of range, x:"+e+" z:"+t),null;e*=this.width,t*=this.depth;var r=Math.min(e),i=Math.max(e),n=Math.min(t),a=Math.max(t),o=this.getPixel(r,n)*(e-r)+this.getPixel(r,a)*(1-e-r),s=this.getPixel(n,a)*(e-r)+this.getPixel(i,a)*(1-e-r),l=o*(t-n)+s*(1-t-n);return l}},{key:"biCubicPoint",value:function(e,t,r,i,n,a,o,s,l,u,c,h,d,f,m,v,p,g){var A=t*t,y=e*e,M=e*y,x=a-n-r+i,b=r-i-x,E=n-r,D=x*M+b*y+E*e+i,w=u-l-o+s,S=o-s-w,P=l-o,I=w*M+S*y+P*e+s,T=f-d-c+h,R=c-h-T,F=d-c,C=T*M+R*y+F*e+h,O=g-p-m+v,k=m-v-O,L=p-m,_=O*M+k*y+L*e+v,N=_-C-D+I,B=D-I-N,V=C-D;return N*t*A+B*A+V*t+I}},{key:"biCubic",value:function(e,t){var r=Math.floor(e),i=Math.floor(t),n=r+1,a=i+1,o=this.getPixel(r-1,i-1),s=this.getPixel(r-1,i),l=this.getPixel(r-1,a),u=this.getPixel(r-1,a+1),c=this.getPixel(r,i-1),h=this.getPixel(r,i),d=this.getPixel(r,a),f=this.getPixel(r,a+1),m=this.getPixel(n,i-1),v=this.getPixel(n,i),p=this.getPixel(n,a),g=this.getPixel(n,a+1),A=this.getPixel(n+1,i-1),y=this.getPixel(n+1,i),M=this.getPixel(n+1,a),x=this.getPixel(n+1,a+1);return this.biCubicPoint(e-r,t-i,o,c,m,A,s,h,v,y,l,d,p,M,u,f,g,x)}}]),t}(u.default);t.default=c},function(e,t,r){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var s=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),l=r(10),u=i(l),c=function(e){function t(e){n(this,t),console.log("in Map3d");var r=a(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return r.typeList={CLOUD:"initRandom",SPHERE:"initRandomSphere"},r.width=0,r.depth=0,r.low=0,r.high=0,r.map=null,r}return o(t,e),s(t,[{key:"checkParams",value:function(e,t,r,i){return!!(e&&t&&r&&e+t+r>0)}},{key:"getPoint",value:function(e,t,r){}},{key:"setPoint",value:function(e,t,r,i){}},{key:"initRandom",value:function(e,t,r,i){if(this.checkParams(e,t,r,0)){this.type=this.CLOUD,this.map=new Float32Array(3*i),this.width=e,this.height=t,this.depth=r;for(var n=this.util,a=0;a<this.map.length;a+=3)this.map[a]=n.getRand()*e,this.map[a+1]=n.getRand()*t,this.map[a+2]=this.util.getRand()*r;this.type=this.typeList.CLOUD}else console.error("error creating Map3d using "+this.type.CLOUD)}},{key:"initRandomSphere",value:function(e,t,r,i){for(var n=this.util,a=new Float32Array(2*i),o=0;o<i;o+=2)a[o]=2*Math.PI*n.getRand(),a[o+1]=Math.acos(2*n.getRand()-1);this.map=n.uvToCartesian(a,e,t,r),this.mapUV=a,this.type=this.typeList.SPHERE}},{key:"initFromData",value:function(e){}}]),t}(u.default);t.default=c},function(e,t){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var i=function e(t){r(this,e),this.util=t};t.default=i},function(e,t){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),n=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;r(this,e),this.x=t,this.y=i,this.z=n}return i(e,[{key:"isValid",value:function(){return Number.isFinite(this.x)&&Number.isFinite(this.y)&&Number.isFinite(this.z)}},{key:"add",value:function(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this}},{key:"subtract",value:function(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this}},{key:"scale",value:function(e){return this.x*=e,this.y*=e,this.z*=e,this}},{key:"distance",value:function(e,t){var r=this.x-e.x,i=this.y-e.y,n=this.z-e.z;return t?(Math.abs(r)+Math.abs(i)+Math.abs(n))/3:Math.sqrt(r*r+i*i+n*n)}},{key:"clone",value:function(){return new e(this.x,this.y,this.z)}}]),e}(),a=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,l=arguments.length>5&&void 0!==arguments[5]?arguments[5]:-1,u=arguments.length>6&&void 0!==arguments[6]?arguments[6]:[];r(this,e),this.coords=new n(t,i,a),this.texCoords={u:o,v:s},this.idx=l,this.e=[],this.s=[],this.vertexArr=u}return i(e,[{key:"isValid",value:function(){var e=this.texCoords;return this.idx===-1?(console.error("Vertex::isValid(): index never set!"),!1):this.coords.isValid()?!Number.isFinite(parseFloat(e.u))||!Number.isFinite(parseFloat(e.v))||(e.u>=0&&e.v>=0||(console.warn("Vertex.isValid(): negative texture coordinates for:"+this.idx+e),!1)):(console.error("Vertex::isValid(): invalid coordinates for vertex position:"+this.idx+" coords.x:"+Number.isFinite(this.coords.x)+", coords.y:"+Number.isFinite(this.coords.y)+", coords.z:"+Number.isFinite(this.coords.z)),!1)}},{key:"distance",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this.coords.distance(e.coords,t)}},{key:"set",value:function(e,t,r,i,n){return this.coords.x=e,this.coords.y=t,this.coords.z=r,void 0!==i&&(this.texCoords.u=i),void 0!==n&&(this.texCoords.v=n),this}},{key:"add",value:function(e){return this.coords.add(e.coords),this}},{key:"subtract",value:function(e){return this.coords.subtract(e.coords),this}},{key:"scale",value:function(e){return this.coords.scale(e),this}},{key:"clone",value:function(t){for(var r=new e(this.coords.x,this.coords.y,this.coords.z,this.texCoords.u,this.texCoords.v,this.idx,t),i=0;i<this.e.length;i++)r.e.push(this.e[i]);for(var n=0;n<this.s.length;n++)r.s.push(this.s[n]);return r}}]),e}(),o=function(){function e(t,i,n,a){r(this,e),this.v=new Array(2),this.ov=new Array(2),this.f=new Array(2),this.v[0]=t,this.v[1]=i,this.f[0]=a,this.f[1]=4294967295,this.ov[0]=n,this.ov[1]=n}return i(e,[{key:"isValid",value:function(){return!(!this.v[0].isValid()||!this.v[1].isValid)}},{key:"getOpposite",value:function(e){return e.idx===this.v[0]?this.v[1]:e.idx===this.v[1]?this.v[0]:void console.error("Edge::getOpposite(): invalid Vertex:"+e.idx+" supplied, our Edge:"+this.v[0]+", "+this.v[1])}}]),e}(),s=function e(t,i,n){r(this,e),this.e=new Array(3),this.e[0]=t,this.e[1]=i,this.e[2]=n},l=function(){function e(t){r(this,e),this.prim=t,this.util=t.util,this.geo=t.geometry,this.type=this.geo.type,this.vertexArr=[],this.indexArr=[],this.edgeArr=[],this.edgeMap=[],this.faceArr=[],this.valenceArr=[],this.oldVertexArr=[],this.avDistance=0,this.width=0,this.height=0,this.depth=0,this.centroid=null,this.iterations=0,this.epsilon=1e-9,this.fw=3/8,this.ow=1/8,this.f0w=.5,this.badIndex32=4294967294,this.NOT_IN_LIST=-1,this.computeValencyWeights(100),this.geometryToVertex(this.geo.vertices.data,this.geo.indices.data,this.geo.texCoords.data)}return i(e,[{key:"computeValencyWeights",value:function(e){this.valenceArr=new Array(e),this.valenceArr[0]=0,this.valenceArr[1]=0,this.valenceArr[2]=1/8,this.valenceArr[3]=3/16;for(var t=4;t<e;t++)this.valenceArr[t]=1/t*(5/8-Math.pow(3/8+.25*Math.cos(2*Math.PI/t),2))}},{key:"computeCentroid",value:function(){var e=arguments.length,t=0,r=0,i=0,n=0,o=0;for(var s in arguments){var l=arguments[s];t+=l.coords.x,r+=l.coords.y,i+=l.coords.z,n+=l.texCoords.u,o+=l.texCoords.v}return t/=e,r/=e,i/=e,n/=e,o/=e,new a(t,r,i,n,o,0,null)}},{key:"computeVertices",value:function(e,t){var r=0,i=0,o=0,s=new n,l=new n,u=new n,c=e.length/3,h=new Array(c);for(r=0;r<c;r++){h[r]=new a(e[i++],e[i++],e[i++],t[o++],t[o++],r,h);var d=h[r];if(r>0){var f=d.coords;s.x=Math.min(s.x,f.x),l.x=Math.max(l.x,f.x),s.y=Math.min(s.y,f.y),
l.y=Math.min(s.y,f.y),s.z=Math.min(s.z,f.z),l.z=Math.min(l.z,f.z),u.add(f)}this.centroid=u.scale(1/c)}return this.width=l.x-s.x,this.height=l.y-s.y,this.depth=l.z-s.z,h}},{key:"computeEdge",value:function(e,t,r,i){var n=this.vertexArr,a=this.edgeArr,s=-1,l=Math.min(e,t),u=Math.max(e,t),c=l+"-"+u;if(c in this.edgeMap){s=this.edgeMap[c];var h=a[s];h.f[1]=i,h.ov[1]=r}else{s=a.length,this.edgeMap[c]=s;var d=new o(l,u,r,i);a.push(d),n[l].e.push(s),n[u].e.push(s)}return s}},{key:"computeFaces",value:function(){for(var e=(this.vertexArr,this.indexArr),t=e.length,r=this.faceArr,i=0;i<t;i+=3){var n=e[i],a=e[i+1],o=e[i+2],l=i/3,u=new s(this.computeEdge(n,a,o,l),this.computeEdge(a,o,n,l),this.computeEdge(o,n,a,l),l);r.push(u)}}},{key:"computeEven",value:function(e,t){var r=this.edgeArr,i=e.e.length;e.e;if(i<6)return!1;for(var n=this.valenceArr[i],a=1-i*n,o=e.coords,s=e.texCoords,l=a*o.x,u=a*o.y,c=a*o.z,h=a*s.u,d=a*s.v,f=0;f<i;f++){var m=t[r[e.e[f]].getOpposite(e)];o=m.coords,s=m.texCoords,l+=n*o.x,u+=n*o.y,c+=n*o.z,h+=n*s.u,d+=n*s.v}return e.set(l,u,c,h,d),!0}},{key:"computeOdd",value:function(e,t,r,i){var n=this.fw,a=this.ow,o=this.f0w,s=this.edgeArr,l=s[this.edgeMap[r]];if(l||(l=s[this.edgeMap[i]]),l){var u=t[l.v[0]],c=t[l.v[1]],h=t[l.ov[0]],d=t[l.ov[1]],f=void 0,m=void 0,v=void 0,p=void 0,g=void 0;return h!==d?(f=n*(u.coords.x+c.coords.x),m=n*(u.coords.y+c.coords.y),v=n*(u.coords.z+c.coords.z),p=n*(u.texCoords.u+c.texCoords.u),g=n*(u.texCoords.v+c.texCoords.v),f+=a*(h.coords.x+d.coords.x),m+=a*(h.coords.y+d.coords.y),v+=a*(h.coords.z+d.coords.z),p+=a*(h.texCoords.u+d.texCoords.u),g+=a*(h.texCoords.v+d.texCoords.v),e.set(f,m,v,p,g),!0):(f=o*(u.coords.x+c.coords.x),m=o*(u.coords.y+c.coords.y),v=o*(u.coords.z+c.coords.z),p=o*(u.texCoords.u+c.texCoords.u),g=o*(u.texCoords.v+c.texCoords.v),e.set(f,m,v,p,g),!0)}return console.error("Mesh::computeEven(): invalid keys:"+r+","+i+" edge is undefined"),!1}},{key:"subdivide",value:function(e){if(this.geo.vertices.data.length/3>this.geo.MAX_DRAWELEMENTS)return console.warn("subdivision of "+geo.type+" would exceed ability of device to render indexed meshes, aborting..."),this;this.geometryToVertex(this.geo.vertices.data,this.geo.indices.data,this.geo.texCoords.data,this.geo.colors.data),this.isValid();var t=this.vertexArr,r=this.indexArr;this.oldVertexArr=this.vertexArr.slice(),this.oldIndexArr=this.indexArr.slice();var i=[],n=[],a=[],o=[];this.edgeMap=[],this.midMap=[],this.faceArr=[],this.edgeArr=[];var s=(this.edgeArr,this.NOT_IN_LIST),l=void 0,u=void 0,c=void 0;this.computeFaces();for(var h=0;h<r.length;h+=3){var d=r[h+0],f=r[h+1],m=r[h+2];l=a[d]?i[a[d]]:t[d].clone(i),u=a[f]?i[a[f]]:t[f].clone(i),c=a[m]?i[a[m]]:t[m].clone(i);var v=i.indexOf(l);v===s&&(i.push(l),v=i.length-1,a[d]=v);var p=i.indexOf(u);p===s&&(i.push(u),p=i.length-1,a[f]=p);var g=i.indexOf(c);g===s&&(i.push(c),g=i.length-1,a[m]=g);var A=void 0,y=void 0,M=void 0,x=void 0,b=void 0,E=void 0;e&&(this.computeEven(l,t),this.computeEven(u,t),this.computeEven(c,t));var D=v+"-"+p,w=p+"-"+v;o[D]?x=o[D]:o[w]?x=midhash[w]:(A=this.computeCentroid(l,u),A.vertexArr=i,A.idx=i.length,e&&this.computeOdd(A,t,d+"-"+f,f+"-"+d),i.push(A),x=i.length-1,o[D]=x,o[w]=x),D=p+"-"+g,w=g+"-"+p,o[D]?b=o[D]:o[w]?b=midhash[w]:(y=this.computeCentroid(u,c),y.vertexArr=i,y.idx=i.length,e&&this.computeOdd(y,t,f+"-"+m,m+"-"+f),i.push(y),b=i.length-1,o[D]=b,o[w]=b),D=g+"-"+v,w=v+"-"+g,o[D]?E=o[D]:o[w]?E=midhash[w]:(M=this.computeCentroid(c,l),M.vertexArr=i,M.idx=i.length,e&&this.computeOdd(M,t,m+"-"+d,d+"-"+m),i.push(M),E=i.length-1,o[D]=E,o[w]=E),n.push(x,p,b,b,E,x,E,b,g,E,v,x)}return this.iterations++,this.vertexArr=i,this.indexArr=n,this.vertexToGeometry(),console.log("Mesh::subdivde(): "+this.prim.name+" subdivided from "+this.oldVertexArr.length+" to:"+this.vertexArr.length+" index length:"+this.indexArr.length),this}},{key:"simplify",value:function(){this.NOT_IN_LIST;console.log("Simplifying mesh... type:"+this.geo.type);var e=this.vertexArr,t=this.indexArr,r=[],i=[];this.oldIndexArr=t,this.oldVertexArr=e,this.vertexArr=r,this.indexArr=i,console.log("Mesh::simplify(): oldVertexArr:"+e.length+", newVertexArr simplified to:"+r.length),this.vertexToGeometry()}},{key:"geometryToVertex",value:function(e,t,r){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[];return this.indexArr=t.slice(),this.vertexArr=this.computeVertices(e,r,i),this.isValid()}},{key:"vertexToGeometry",value:function(){var e=this.prim,t=this.geo;console.log("Mesh::vertexToGeometry()");var r=this.vertexArr,i=r.length,n=(this.indexArr,this.indexArr.slice());t.vertices.data=new Array(3*r.length),t.texCoords.data=new Array(2*r.length);for(var a=t.vertices.data,o=t.texCoords.data,s=0;s<i;s++){var l=3*s,u=2*s,c=r[s];if(!c){console.warn("Mesh::vertexToGeometry(): no vertex in vertexArr at pos:"+s),a=a.slice(s);break}var h=c.coords,d=c.texCoords;a[l]=h.x,a[l+1]=h.y,a[l+2]=h.z,o[u]=d.u,o[u+1]=d.v}console.log("Mesh::vertexToGeometry(): vertices:"+a.length/3+" indices:"+n.length+" texCoords:"+o.length/2),t.setVertices(a),t.setIndices(n),t.setTexCoords(o),e.updateNormals(),e.updateTangents(),e.updateColors()}},{key:"isValid",value:function(){var e=this.vertexArr;if(!(e.length>0))return console.error("Mesh::isValid(): vertex array empty, vertex:"+e.length),!1;var t=this.indexArr;if(!(t.length>0))return console.error("Mesh::isValid(): index array empty, vertex:"+e.length+" index:"+t.length),!1;if(!(e.length>0))return console.error("Mesh::isValid(): no vertex and/or index array defined"),!1;for(var r=0;r<e.length;r++)if(!e[r].isValid())return console.warn("Mesh::isValid(): invalid supplied vertex at:"+r),!1;return!0}}]),e}();t.default=l},function(e,t,r){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var s=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),l=r(8),u=(i(l),r(9)),c=(i(u),r(11)),h=i(c),d=r(4),f=i(d),m=r(2),v=i(m),p=r(7),g=(i(p),r(13)),A=(i(g),r(5)),y=(i(A),r(6)),M=(i(y),r(20)),x=i(M),b=function(e){function t(e,r){n(this,t),console.log("in PrimFactory class");var i=a(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,r.webgl.util));return i.world=r,i.util=r.util,i.webgl=r.webgl,i.glMatrix=r.glMatrix,i.texturePool=r.texturePool,i.modelPool=r.modelPool,i.geometryPool=r.geometryPool,i.materialPool=r.materialPool,i.prims=[],i.util.emitter.on(i.util.emitter.events.OBJ_GEOMETRY_READY,function(e,t,r){var n=i.modelPool.keyList[t];e.objects=n.options.objects,e.groups=n.options.groups,e.smoothingGroups=n.options.smoothingGroups,e.matStarts=n.options.matStarts,i.initPrimGeometry(e,n,r),e.shader.addPrim(e)}),i.util.emitter.on(i.util.emitter.events.HYG_GEOMETRY_READY,function(e,t,r){console.log("PrimFactory::HYG_GEOMETRY_READY event");var n=i.modelPool.keyList[t];if(e.objects=n.options.objects,e.matStarts=n.options.matStarts,i.initPrimGeometry(e,n,r),e.geolocate===!0){var a=i.world.geoData;a&&i.util.isNumber(a.latitude)&&i.util.isNumber(a.longitude)&&(console.log("PrimFactory::HYG_GEOMETRY_READY event, world.geoData:"+a),i.world.computeSkyRotation(e,a))}e.shader.addPrim(e)}),i.util.emitter.on(i.util.emitter.events.PROCEDURAL_GEOMETRY_READY,function(e,t,r){var n=i.modelPool.keyList[t];e.matStarts=[[i.materialPool.createDefaultName(e.name),0,n.indices.length]],i.initPrimGeometry(e,n,r),e.shader.addPrim(e)}),i.util.emitter.on(i.util.emitter.events.MATERIAL_READY,function(e,t,r){i.initPrimMaterial(e,i.materialPool.keyList[t],r),e.shader.addPrim(e)}),i.util.emitter.on(i.util.emitter.events.TEXTURE_2D_READY,function(e,t,r){i.initPrimTexture(e,i.texturePool.keyList[t],r),e.shader.addPrim(e)}),i.util.emitter.on(i.util.emitter.events.TEXTURE_3D_READY,function(e,t,r){i.initPrimTexture3d(e,i.texturePool.keyList[t],r),e.shader.addPrim(e)}),i.util.emitter.on(i.util.emitter.events.TEXTURE_CUBE_MAP_READY,function(e,t,r){i.initPrimTextureCubeMap(e,i.texturePool.keyList[t],r),e.shader.addPrim(e)}),i.util.emitter.on(i.util.emitter.events.PRIM_ADDED_TO_SHADER,function(e){var t=0;for(var r in e.materials){var n=e.materials[r];if(n.name.indexOf(i.util.defaultKey)!==i.util.NOT_IN_LIST&&Number.isFinite(n.transparency)){var a=1-n.transparency;a>t&&(t=a)}}t>0&&(e.alpha=t),e.setFade(0,e.alpha,.001,"easeQuad"),e.failCount=0}),i.util.emitter.on(i.util.emitter.events.PRIM_REMOVED_FROM_SHADER,function(e){}),i}return o(t,e),s(t,[{key:"deletePrim",value:function(e){var t=null,r=array.indexOf(e);return r!==-1&&(t=array.splice(r,1)[0]),t?t=this.removeAsset(e.key):console.warn("PrimFactory::deletePrim(): asset not found in prim array"),t}},{key:"setActivePrims",value:function(e){this.world.keyList[e]||console.error("Primfactory::setPrimWorld(): invalid key passed");var t=[];for(var r in this.keyList){var i=this.keyList[r];i.worldKey===e&&t.push(i)}this.prims.splice(0,this.prims.length),Array.prototype.push.apply(this.prims,t)}},{key:"switchPrimWorld",value:function(e,t){var r=this.assetInList(e),i=this.world.getActiveWorld();if(r&&i){if(i!==t){var n=this.prims.indexOf(r);n!==this.util.NOT_IN_LIST&&(this.prims[n]=null)}return r.worldKey=t,!0}return!1}},{key:"setVertexData",value:function(e){e=[];for(var t in this.prims)e=e.concat(this.prims[t].geometry.vertices.data);return e}},{key:"setIndexData",value:function(e){e=[];for(var t in this.prims)e=e.concat(this.prims[t].geometry.indices.data);return e}},{key:"initPrimTexture",value:function(e,t,r){var i=e.materials[r.materialName];i?(console.log("PrimFactory::initPrimTexture(): adding texture "+r.type+" to material:"+r.materialName),i[r.type]=t.texture,i[r.type+"_path"]=t.path,i[r.type+"_key"]=t.key,i[r.type+"_options"]=r[r.type+"_options"]):(console.log("PrimFactory::initPrimTexture(): no material, creating placeholder for material:"+r.materialName),e.materials[r.materialName]=this.materialPool.default(r.materialName))}},{key:"initPrimTexture3d",value:function(e,t,r){console.log("Prim::initPrimTexture(): new 3D texture for prim:"+e.name+", options:"+r)}},{key:"initPrimTextureCubeMap",value:function(e,t,r){console.log("Prim::initPrimTexture(): new CubeMap texture for prim:"+e.name+", options:"+r)}},{key:"initPrimMaterial",value:function(e,t,r){var i=e.materials[t.name];i&&i.name===r.materialName?(console.log("Prim::initMaterial(): found existing material:"+t.name+" for prim:"+e.name),this.materialPool.mergeTo(i,t)):(console.log("Prim::initMaterial(): adding new material:"+t.name+" for prim:"+e.name),e.materials[t.name]=t)}},{key:"initPrimGeometry",value:function(e,t,r){e.updateVertices(t.vertices),e.computeBoundingBox(e.geometry.vertices.data);var i=e.dimensions[0]/e.boundingBox.dimensions[0];i=Math.max(i,e.dimensions[1]/e.boundingBox.dimensions[1]),i=Math.max(e.dimensions[2]/e.boundingBox.dimensions[2]),e.scale=[i,i,i],e.updateIndices(t.indices),e.updateNormals(t.normals),e.updateTexCoords(t.texCoords),e.updateTangents(),e.updateColors(t.colors);new h.default(e)}},{key:"createPrim",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"unknown",i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[1,1,1,0,0],n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:[1,1,1,0,0],a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:this.glMatrix.vec3.create(),o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:this.glMatrix.vec3.create(),s=arguments.length>7&&void 0!==arguments[7]?arguments[7]:this.glMatrix.vec3.create(),l=arguments.length>8&&void 0!==arguments[8]?arguments[8]:this.glMatrix.vec3.create(),u=arguments.length>9&&void 0!==arguments[9]?arguments[9]:[],c=arguments.length>10&&void 0!==arguments[10]?arguments[10]:[],h=arguments.length>11&&void 0!==arguments[11]&&arguments[11],d=arguments.length>12&&void 0!==arguments[12]&&arguments[12],m=!(arguments.length>13&&void 0!==arguments[13])||arguments[13],v=(arguments.length>14&&void 0!==arguments[14]&&arguments[14],this),p=arguments.length>15&&void 0!==arguments[15]&&arguments[15],g=arguments.length>16&&void 0!==arguments[16]&&arguments[16],A=this.glMatrix.vec3,y=this.glMatrix.mat4;if(!this.geometryPool.checkType(t))return console.error("Prim::createPrim(): unsupported Prim type:"+t+"for:"+M.name),null;if(c&&0===c.length&&t===this.geometryPool.typeList.MESH)return console.error("PrimFactory::createPrim(): type MESH does not have an defining file for Prim:"+M.name),null;var M={},b=M;M.setMV=function(e){return y.translate(e,e,b.position),M.setM(e),e},M.setM=function(e){return y.rotate(e,e,b.rotation[0],[1,0,0]),y.rotate(e,e,b.rotation[1],[0,1,0]),y.rotate(e,e,b.rotation[2],[0,0,1]),y.scale(e,e,b.scale),e},M.updateCoords=function(){A.add(b.position,b.position,b.acceleration),A.add(b.rotation,b.rotation,b.angular)},M.setLight=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[1,1,1],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[255,255,255];b.light.direction=e,b.light.color=t},M.setMaterial=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:v.util.DEFAULT_KEY,t=arguments[1],r=arguments[2],i=arguments[3],n=arguments[4],a=arguments[5],o=arguments[6],s=arguments[7],l=arguments[8],u=arguments[9];return console.log("Prim::setMaterial(): to name:"+e),v.initPrimMaterial(M,v.materialPool.default(e,t,r,i,n,a,o,s,l,u),e)},M.updateVertices=function(e){var t=b.geometry;e&&e.length>0&&t.setVertices(e)},M.updateIndices=function(e){var t=b.geometry;e&&e.length>0&&t.setIndices(e)},M.updateNormals=function(e){var t=b.geometry;e&&e.length>0?t.setNormals(e):(console.log("Prim::updateNormals():"+b.name+" recalculating normal coordinates"),t.setNormals(v.geometryPool.computeNormals(t.vertices.data,t.indices.data,[],b.useFaceNormals)))},M.updateTexCoords=function(e){var t=b.geometry;e&&e.length>0?t.setTexCoords(e):t.numTexCoords()!==t.numVertices()&&(console.log("Prim::updateTexCoords():"+b.name+" recalculating texture coordinates"),t.setTexCoords(v.geometryPool.computeTexCoords(t.vertices.data,e)))},M.updateTangents=function(e){var t=b.geometry;e&&e.length>0?t.setTangents(e):t.setTangents(v.geometryPool.computeTangents(t.vertices.data,t.indices.data,t.normals.data,t.texCoords.data,[]))},M.updateColors=function(e){var t=b.geometry;e&&e.length>0?t.setColors(e):t.setColors(v.geometryPool.computeColors(t.normals.data,[]))},M.computeBoundingBox=function(){M.boundingBox=v.geometryPool.computeBoundingBox(M.geometry.vertices.data)},M.computeBoundingSphere=function(){v.geometryPool.computeBoundingSphere(M.geometry.vertices.data)},M.copyGometry=function(e,t,r){var i=v.util.copyArr(M.geometry.vertices.data),n=v.util.copyArr(M.geometry.indices.data),a=v.util.copyArr(M.geometry.texCoords.data),o=v.util.copyArr(M.geometry.normals.data),s=v.util.copyArr(M.geometry.tangents.data),l=v.util.copyArr(M.geometry.tangents.data);if(v.geometryPool.scale(newVertices,e),v.geometryPool.computeMove(newVertices,t),r){r.vertices=v.util.concatArr(r.vertices,i);for(var u=0;u<n.length;u++)n[u]+=r.vertices.length;r.indices=v.util.contactArr(r.indices,n),r.texCoords=v.util.concatArr(r.texCoords,a),r.normals=v.util.concatArr(r.normals,o),r.tangents=v.util.concatArr(r.tangents,s),r.colors=v.util.concatArr(r.colors,l)}else r=v.geometryPool.default(i,n,a,o,s,l);return r},M.resize=function(e){v.geometryPool.computeScale(M.geometry.vertices.data,e)},M.move=function(e){v.geometryPool.computeMove(M.geometry.vertices.data,e)},M.moveTo=function(e){v.geometryPool.computeMove([v.position[0]-e[0],v.position[1]-e[1],v.position[2]-e[2]])},M.setFade=function(e,t,r,i){M.fade.startAlpha=e,M.fade.endAlpha=t;var n=M.materials[M.matStarts[0][0]];M.alpha=e,Number.isFinite(r)&&(M.fade.incr=r),i?t>e?M.fade.eq=v.util[i+"In"]:M.fade.eq=v.util[i+"Out"]:M.fade.eq=v.util.easeLinearIn,console.log("PRIM NAME:"+M.name+" defaultMaterial transparency:"+n.transparency),M.shader!==v.world.s0&&(M.defaultShader=M.shader,M.shader.movePrim(M,v.world.s0))},M.name=r,M.defaultShader=e,M.shader=this.world.s0,M.rendering=!1,M.type=t,M.key=this.util.computeId(),M.dimensions=i||this.vec5(1,1,1,0,0,0,0),M.divisions=n||this.vec5(1,1,1,0,0,0),M.position=a||A.create(),M.acceleration=o||A.create(),M.rotation=s||A.create(),M.angular=l||A.create(),M.orbitRadius=0,M.orbitAngular=0,M.scale=[1,1,1],M.visibleFrom=this.geometryPool.OUTSIDE,M.useColorArray=h,M.drawTris=!0,M.drawPoints=!1,M.pointSize=2,M.drawLines=!1,M.applyTexToFace=d,M.useFaceNormals=!1,M.useTangents=!1,M.pSystem=p,M.animSystem=g,M.geolocate=!1,M.materials=[];var E=this.materialPool.createDefaultName(M.name);if(M.materials[E]=this.materialPool.setDefaultMaterial(M,this.materialPool.createDefaultName(M.name),u),M.alpha=1-M.materials[E].transparency,M.useLighting=m,M.glow=new f.default(this.glMatrix),M.fade={startAlpha:0,endAlpha:M.alpha,incr:.002},M.audio=[],M.video=[],M.parentNode=null,M.children=[],console.log("PrimFactory::createPrim(): Generating:"+M.name+"("+M.type+")"),M.geometry=new x.default(M.name,this.util,this.webgl),c.length>0)for(var D=0;D<c.length;D++)this.geometryPool.getGeometry(M,c[D],!0,{pos:D,defaultMatStarts:!1});else this.geometryPool.getGeometry(M,null,!0,{pos:0,defaultMatStarts:!0});return M.failCount=0,this.prims.push(M),this.addAsset(M),M}},{key:"createParticleSystem",value:function(e){e.pSystem||console.error("PrimFactory::createParticleSystem(): no particle system defined");var t=e.pSystem;if(t.coords)for(var r=this.geometryPool.default(),i=1;i<t.coords.length;i++)r=e.copyGeometry(t.coords.scale[i],t.coords.pos[i],r);var n={};this.initPrimGeometry(e,geo,n)}},{key:"createAnimationSystem",value:function(e){e.animSystem||console.error("PrimFactory::createAnimationSystem(): no animation system defined")}}]),t}(v.default);t.default=b},function(e,t,r){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var s=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),l=r(2),u=i(l),c=function(e){function t(e,r,i){n(this,t),console.log("in TexturePool");var o=a(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,r));if(o.util=r,o.webgl=i,o.textureMimeTypes={png:"image/png",jpg:"image/jpeg",jpeg:"image/jpeg",gif:"image/gif"},o.greyPixel=new Uint8Array([128,128,128,255]),o.transparentPixel=new Uint8Array([0,0,0,0]),e){var s=i.getContext();o.defaultKey=o.addAsset(o.default(null,null,s.TEXTURE_2D,null,o.create2dTexture(),null)).key,o.transparentKey=o.addAsset(o.default(null,null,s.TEXTURE_2D,null,o.create2dTexture(),null)).key}return o}return o(t,e),s(t,[{key:"default",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null;return{image:e,mimeType:t,type:r,path:i,texture:n,emits:a}}},{key:"create2dTexture",value:function(e,t){var r=this.webgl.getContext(),i=r.createTexture();if(r.pixelStorei(r.UNPACK_FLIP_Y_WEBGL,!0),r.bindTexture(r.TEXTURE_2D,i),e instanceof HTMLImageElement)r.texImage2D(r.TEXTURE_2D,0,r.RGBA,r.RGBA,r.UNSIGNED_BYTE,e);else if(e instanceof Uint8Array&&e.length){var n=Math.sqrt(e.length/4);n%1===0&&r.texImage2D(r.TEXTURE_2D,0,r.RGBA,n,n,0,r.RGBA,r.UNSIGNED_BYTE,e)}else console.warn("TexturePool::create2DTexture(): no image ("+e+"), using default pixel texture"),e={width:1,height:1},r.texImage2D(r.TEXTURE_2D,0,r.RGBA,1,1,0,r.RGBA,r.UNSIGNED_BYTE,this.greyPixel);return this.util.isPowerOfTwo(e.width)&&this.util.isPowerOfTwo(e.height)?(r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,r.LINEAR),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,r.LINEAR_MIPMAP_NEAREST),r.generateMipmap(r.TEXTURE_2D)):(r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,r.LINEAR),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,r.LINEAR)),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,r.CLAMP_TO_EDGE),r.bindTexture(r.TEXTURE_2D,null),i}},{key:"create3dTexture",value:function(e,t,r){console.log("creating 3D texture");var i=this.webgl.getContext(),n=i.createTexture();return i.pixelStorei(i.UNPACK_FLIP_Y_WEBGL,!0),i.bindTexture(i.TEXTURE_3D,n),image?(i.texParameteri(i.TEXTURE_3D,i.TEXTURE_BASE_LEVEL,0),i.texParameteri(i.TEXTURE_3D,i.TEXTURE_MAX_LEVEL,Math.log2(r)),i.texParameteri(i.TEXTURE_3D,i.TEXTURE_MIN_FILTER,i.LINEAR_MIPMAP_LINEAR),i.texParameteri(i.TEXTURE_3D,i.TEXTURE_MAG_FILTER,i.LINEAR),i.texImage3D(i.TEXTURE_3D,0,i.R8,e.width,e.height,e.depth,0,i.RED,i.UNSIGNED_BYTE,e)):console.error("TexturePool::create2DTexture(): no data ("+e+"), for 3d, giving up"),i.generateMipmap(i.TEXTURE_3D),i.bindTexture(i.TEXTURE_3D,null),n}},{key:"createCubeMapTexture",value:function(e,t){console.log("creating cubemap texture");var r=this.webgl.getContext(),i=r.createTexture();return r.pixelStorei(r.UNPACK_FLIP_Y_WEBGL,!0),r.bindTexture(r.TEXTURE_CUBE_MAP,i),e?(r.bindTexture(r.TEXTURE_CUBE_MAP,i),r.texParameteri(r.TEXTURE_CUBE_MAP,r.TEXTURE_WRAP_S,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_CUBE_MAP,r.TEXTURE_WRAP_T,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_CUBE_MAP,r.TEXTURE_MIN_FILTER,r.NEAREST),r.texParameteri(r.TEXTURE_CUBE_MAP,r.TEXTURE_MAG_FILTER,r.NEAREST),r.texImage2D(r.TEXTURE_CUBE_MAP_POSITIVE_X,0,format,format,type,e.pos.x),r.texImage2D(r.TEXTURE_CUBE_MAP_POSITIVE_Y,0,format,format,type,e.pos.y),r.texImage2D(r.TEXTURE_CUBE_MAP_POSITIVE_Z,0,format,format,type,e.pos.z),r.texImage2D(r.TEXTURE_CUBE_MAP_NEGATIVE_X,0,format,format,type,e.neg.x),r.texImage2D(r.TEXTURE_CUBE_MAP_NEGATIVE_Y,0,format,format,type,e.neg.y),r.texImage2D(r.TEXTURE_CUBE_MAP_NEGATIVE_Z,0,format,format,type,e.neg.z)):console.error("TextureObj::create2DTexture(): no data ("+e+"), for cubemap, giving up"),r.bindTexture(r.TEXTURE_CUBE_MAP,null),i}},{key:"addTexture",value:function(e,t,r,i,n){var a=this.webgl.getContext();n||(n=a.TEXTURE_2D);var o=null,s="";switch(n){case a.TEXTURE_2D:o=this.create2dTexture(t),s=this.util.emitter.events.TEXTURE_2D_READY;break;case a.TEXTURE_3D:o=this.create3dTexture(t),s=this.util.emitter.events.TEXTURE_3D_READY;break;case a.TEXTURE_CUBE_MAP:o=this.createCubeMapTexture(t),s=this.util.emitter.events.TEXTURE_CUBE_MAP_MEMBER_READY;break;default:console.warn("TexturePool::addTexture() for prim:"+e.name+" unsupported texture requested")}return o?this.addAsset(this.default(t,i,n,r,o,s)):(console.warn("TexturePool::addTexture(): no texture returned by createXXTexture() function"),null)}},{key:"getTexture",value:function(e,t){var r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],i=arguments.length>3&&void 0!==arguments[3]&&arguments[3],n=this,a=arguments[4],o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:{pos:0};a||(a=this.webgl.gl.TEXTURE_2D);var s=this.pathInList(t);if(null!==s)return console.log("TexturePool::getTexture(): found texture "+t+" in pool, using it..."),void this.util.emitter.emit(this.util.emitter.events.TEXTURE_2D_READY,e,this.defaultKey,o);if(this.util.isWhitespace(t))console.warn("TexturePool::getTexture(): empty path supplied for prim "+e.name);else{var l=this.textureMimeTypes[this.util.getFileExtension(t)];l?this.doRequest(t,o.pos,function(r){var s=new Image;s.onload=function(){o.fromObj&&console.warn("TexturePool::getTexture(): adding OBJ texture:"+t+" to "+e.name);var u=n.addTexture(e,s,r.path,l,a);u?(i||(window.URL.revokeObjectURL(s.src),u.image=null),n.util.emitter.emit(u.emits,e,u.key,o)):(console.error("TexturePool::getTexture(): file:"+t+" could not be parsed"),n.util.emitter.emit(n.util.emitter.events.TEXTURE_2D_READY,e,n.defaultKey,o))},r.data?s.src=window.URL.createObjectURL(r.data):(n.util.emitter.emit(n.util.emitter.events.TEXTURE_2D_READY,e,n.defaultKey,o),console.error("TexturePool::getTexture(): invalid image data for prim:"+e.name+"path:"+r.path+" data:"+r.data))},r,l,0):(console.error('TexturePool::getTexture(): file type "'+this.util.getFileExtension(t)+'" in:'+t+" not supported, not loading"),this.util.emitter.emit(this.util.emitter.events.TEXTURE_2D_READY,e,this.defaultKey,o))}}}]),t}(u.default);t.default=c},function(e,t,r){var i=r(1),n={};n.create=function(){var e=new i.ARRAY_TYPE(9);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e},n.fromMat4=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[4],e[4]=t[5],e[5]=t[6],e[6]=t[8],e[7]=t[9],e[8]=t[10],e},n.clone=function(e){var t=new i.ARRAY_TYPE(9);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t},n.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e},n.fromValues=function(e,t,r,n,a,o,s,l,u){var c=new i.ARRAY_TYPE(9);return c[0]=e,c[1]=t,c[2]=r,c[3]=n,c[4]=a,c[5]=o,c[6]=s,c[7]=l,c[8]=u,c},n.set=function(e,t,r,i,n,a,o,s,l,u){return e[0]=t,e[1]=r,e[2]=i,e[3]=n,e[4]=a,e[5]=o,e[6]=s,e[7]=l,e[8]=u,e},n.identity=function(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e},n.transpose=function(e,t){if(e===t){var r=t[1],i=t[2],n=t[5];e[1]=t[3],e[2]=t[6],e[3]=r,e[5]=t[7],e[6]=i,e[7]=n}else e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8];return e},n.invert=function(e,t){var r=t[0],i=t[1],n=t[2],a=t[3],o=t[4],s=t[5],l=t[6],u=t[7],c=t[8],h=c*o-s*u,d=-c*a+s*l,f=u*a-o*l,m=r*h+i*d+n*f;return m?(m=1/m,e[0]=h*m,e[1]=(-c*i+n*u)*m,e[2]=(s*i-n*o)*m,e[3]=d*m,e[4]=(c*r-n*l)*m,e[5]=(-s*r+n*a)*m,e[6]=f*m,e[7]=(-u*r+i*l)*m,e[8]=(o*r-i*a)*m,e):null},n.adjoint=function(e,t){var r=t[0],i=t[1],n=t[2],a=t[3],o=t[4],s=t[5],l=t[6],u=t[7],c=t[8];return e[0]=o*c-s*u,e[1]=n*u-i*c,e[2]=i*s-n*o,e[3]=s*l-a*c,e[4]=r*c-n*l,e[5]=n*a-r*s,e[6]=a*u-o*l,e[7]=i*l-r*u,e[8]=r*o-i*a,e},n.determinant=function(e){var t=e[0],r=e[1],i=e[2],n=e[3],a=e[4],o=e[5],s=e[6],l=e[7],u=e[8];return t*(u*a-o*l)+r*(-u*n+o*s)+i*(l*n-a*s)},n.multiply=function(e,t,r){var i=t[0],n=t[1],a=t[2],o=t[3],s=t[4],l=t[5],u=t[6],c=t[7],h=t[8],d=r[0],f=r[1],m=r[2],v=r[3],p=r[4],g=r[5],A=r[6],y=r[7],M=r[8];return e[0]=d*i+f*o+m*u,e[1]=d*n+f*s+m*c,e[2]=d*a+f*l+m*h,e[3]=v*i+p*o+g*u,e[4]=v*n+p*s+g*c,e[5]=v*a+p*l+g*h,e[6]=A*i+y*o+M*u,e[7]=A*n+y*s+M*c,e[8]=A*a+y*l+M*h,e},n.mul=n.multiply,n.translate=function(e,t,r){var i=t[0],n=t[1],a=t[2],o=t[3],s=t[4],l=t[5],u=t[6],c=t[7],h=t[8],d=r[0],f=r[1];return e[0]=i,e[1]=n,e[2]=a,e[3]=o,e[4]=s,e[5]=l,e[6]=d*i+f*o+u,e[7]=d*n+f*s+c,e[8]=d*a+f*l+h,e},n.rotate=function(e,t,r){var i=t[0],n=t[1],a=t[2],o=t[3],s=t[4],l=t[5],u=t[6],c=t[7],h=t[8],d=Math.sin(r),f=Math.cos(r);return e[0]=f*i+d*o,e[1]=f*n+d*s,e[2]=f*a+d*l,e[3]=f*o-d*i,e[4]=f*s-d*n,e[5]=f*l-d*a,e[6]=u,e[7]=c,e[8]=h,e},n.scale=function(e,t,r){var i=r[0],n=r[1];return e[0]=i*t[0],e[1]=i*t[1],e[2]=i*t[2],e[3]=n*t[3],e[4]=n*t[4],e[5]=n*t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e},n.fromTranslation=function(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=t[0],e[7]=t[1],e[8]=1,e},n.fromRotation=function(e,t){var r=Math.sin(t),i=Math.cos(t);return e[0]=i,e[1]=r,e[2]=0,e[3]=-r,e[4]=i,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e},n.fromScaling=function(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=0,e[4]=t[1],e[5]=0,e[6]=0,e[7]=0,e[8]=1,e},n.fromMat2d=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=0,e[3]=t[2],e[4]=t[3],e[5]=0,e[6]=t[4],e[7]=t[5],e[8]=1,e},n.fromQuat=function(e,t){var r=t[0],i=t[1],n=t[2],a=t[3],o=r+r,s=i+i,l=n+n,u=r*o,c=i*o,h=i*s,d=n*o,f=n*s,m=n*l,v=a*o,p=a*s,g=a*l;return e[0]=1-h-m,e[3]=c-g,e[6]=d+p,e[1]=c+g,e[4]=1-u-m,e[7]=f-v,e[2]=d-p,e[5]=f+v,e[8]=1-u-h,e},n.normalFromMat4=function(e,t){var r=t[0],i=t[1],n=t[2],a=t[3],o=t[4],s=t[5],l=t[6],u=t[7],c=t[8],h=t[9],d=t[10],f=t[11],m=t[12],v=t[13],p=t[14],g=t[15],A=r*s-i*o,y=r*l-n*o,M=r*u-a*o,x=i*l-n*s,b=i*u-a*s,E=n*u-a*l,D=c*v-h*m,w=c*p-d*m,S=c*g-f*m,P=h*p-d*v,I=h*g-f*v,T=d*g-f*p,R=A*T-y*I+M*P+x*S-b*w+E*D;return R?(R=1/R,e[0]=(s*T-l*I+u*P)*R,e[1]=(l*S-o*T-u*w)*R,e[2]=(o*I-s*S+u*D)*R,e[3]=(n*I-i*T-a*P)*R,e[4]=(r*T-n*S+a*w)*R,e[5]=(i*S-r*I-a*D)*R,e[6]=(v*E-p*b+g*x)*R,e[7]=(p*M-m*E-g*y)*R,e[8]=(m*b-v*M+g*A)*R,e):null},n.str=function(e){return"mat3("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+")"},n.frob=function(e){return Math.sqrt(Math.pow(e[0],2)+Math.pow(e[1],2)+Math.pow(e[2],2)+Math.pow(e[3],2)+Math.pow(e[4],2)+Math.pow(e[5],2)+Math.pow(e[6],2)+Math.pow(e[7],2)+Math.pow(e[8],2))},n.add=function(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e[3]=t[3]+r[3],e[4]=t[4]+r[4],e[5]=t[5]+r[5],e[6]=t[6]+r[6],e[7]=t[7]+r[7],e[8]=t[8]+r[8],e},n.subtract=function(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e[3]=t[3]-r[3],e[4]=t[4]-r[4],e[5]=t[5]-r[5],e[6]=t[6]-r[6],e[7]=t[7]-r[7],e[8]=t[8]-r[8],e},n.sub=n.subtract,n.multiplyScalar=function(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e[4]=t[4]*r,e[5]=t[5]*r,e[6]=t[6]*r,e[7]=t[7]*r,e[8]=t[8]*r,e},n.multiplyScalarAndAdd=function(e,t,r,i){return e[0]=t[0]+r[0]*i,e[1]=t[1]+r[1]*i,e[2]=t[2]+r[2]*i,e[3]=t[3]+r[3]*i,e[4]=t[4]+r[4]*i,e[5]=t[5]+r[5]*i,e[6]=t[6]+r[6]*i,e[7]=t[7]+r[7]*i,e[8]=t[8]+r[8]*i,e},n.exactEquals=function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[7]===t[7]&&e[8]===t[8]},n.equals=function(e,t){var r=e[0],n=e[1],a=e[2],o=e[3],s=e[4],l=e[5],u=e[6],c=e[7],h=e[8],d=t[0],f=t[1],m=t[2],v=t[3],p=t[4],g=t[5],A=e[6],y=t[7],M=t[8];return Math.abs(r-d)<=i.EPSILON*Math.max(1,Math.abs(r),Math.abs(d))&&Math.abs(n-f)<=i.EPSILON*Math.max(1,Math.abs(n),Math.abs(f))&&Math.abs(a-m)<=i.EPSILON*Math.max(1,Math.abs(a),Math.abs(m))&&Math.abs(o-v)<=i.EPSILON*Math.max(1,Math.abs(o),Math.abs(v))&&Math.abs(s-p)<=i.EPSILON*Math.max(1,Math.abs(s),Math.abs(p))&&Math.abs(l-g)<=i.EPSILON*Math.max(1,Math.abs(l),Math.abs(g))&&Math.abs(u-A)<=i.EPSILON*Math.max(1,Math.abs(u),Math.abs(A))&&Math.abs(c-y)<=i.EPSILON*Math.max(1,Math.abs(c),Math.abs(y))&&Math.abs(h-M)<=i.EPSILON*Math.max(1,Math.abs(h),Math.abs(M))},e.exports=n},function(e,t,r){var i=r(1),n={};n.create=function(){var e=new i.ARRAY_TYPE(3);return e[0]=0,e[1]=0,e[2]=0,e},n.clone=function(e){var t=new i.ARRAY_TYPE(3);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t},n.fromValues=function(e,t,r){var n=new i.ARRAY_TYPE(3);return n[0]=e,n[1]=t,n[2]=r,n},n.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e},n.set=function(e,t,r,i){return e[0]=t,e[1]=r,e[2]=i,e},n.add=function(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e},n.subtract=function(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e},n.sub=n.subtract,n.multiply=function(e,t,r){return e[0]=t[0]*r[0],
e[1]=t[1]*r[1],e[2]=t[2]*r[2],e},n.mul=n.multiply,n.divide=function(e,t,r){return e[0]=t[0]/r[0],e[1]=t[1]/r[1],e[2]=t[2]/r[2],e},n.div=n.divide,n.ceil=function(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e[2]=Math.ceil(t[2]),e},n.floor=function(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e[2]=Math.floor(t[2]),e},n.min=function(e,t,r){return e[0]=Math.min(t[0],r[0]),e[1]=Math.min(t[1],r[1]),e[2]=Math.min(t[2],r[2]),e},n.max=function(e,t,r){return e[0]=Math.max(t[0],r[0]),e[1]=Math.max(t[1],r[1]),e[2]=Math.max(t[2],r[2]),e},n.round=function(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e[2]=Math.round(t[2]),e},n.scale=function(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e},n.scaleAndAdd=function(e,t,r,i){return e[0]=t[0]+r[0]*i,e[1]=t[1]+r[1]*i,e[2]=t[2]+r[2]*i,e},n.distance=function(e,t){var r=t[0]-e[0],i=t[1]-e[1],n=t[2]-e[2];return Math.sqrt(r*r+i*i+n*n)},n.dist=n.distance,n.squaredDistance=function(e,t){var r=t[0]-e[0],i=t[1]-e[1],n=t[2]-e[2];return r*r+i*i+n*n},n.sqrDist=n.squaredDistance,n.length=function(e){var t=e[0],r=e[1],i=e[2];return Math.sqrt(t*t+r*r+i*i)},n.len=n.length,n.squaredLength=function(e){var t=e[0],r=e[1],i=e[2];return t*t+r*r+i*i},n.sqrLen=n.squaredLength,n.negate=function(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e},n.inverse=function(e,t){return e[0]=1/t[0],e[1]=1/t[1],e[2]=1/t[2],e},n.normalize=function(e,t){var r=t[0],i=t[1],n=t[2],a=r*r+i*i+n*n;return a>0&&(a=1/Math.sqrt(a),e[0]=t[0]*a,e[1]=t[1]*a,e[2]=t[2]*a),e},n.dot=function(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]},n.cross=function(e,t,r){var i=t[0],n=t[1],a=t[2],o=r[0],s=r[1],l=r[2];return e[0]=n*l-a*s,e[1]=a*o-i*l,e[2]=i*s-n*o,e},n.lerp=function(e,t,r,i){var n=t[0],a=t[1],o=t[2];return e[0]=n+i*(r[0]-n),e[1]=a+i*(r[1]-a),e[2]=o+i*(r[2]-o),e},n.hermite=function(e,t,r,i,n,a){var o=a*a,s=o*(2*a-3)+1,l=o*(a-2)+a,u=o*(a-1),c=o*(3-2*a);return e[0]=t[0]*s+r[0]*l+i[0]*u+n[0]*c,e[1]=t[1]*s+r[1]*l+i[1]*u+n[1]*c,e[2]=t[2]*s+r[2]*l+i[2]*u+n[2]*c,e},n.bezier=function(e,t,r,i,n,a){var o=1-a,s=o*o,l=a*a,u=s*o,c=3*a*s,h=3*l*o,d=l*a;return e[0]=t[0]*u+r[0]*c+i[0]*h+n[0]*d,e[1]=t[1]*u+r[1]*c+i[1]*h+n[1]*d,e[2]=t[2]*u+r[2]*c+i[2]*h+n[2]*d,e},n.random=function(e,t){t=t||1;var r=2*i.RANDOM()*Math.PI,n=2*i.RANDOM()-1,a=Math.sqrt(1-n*n)*t;return e[0]=Math.cos(r)*a,e[1]=Math.sin(r)*a,e[2]=n*t,e},n.transformMat4=function(e,t,r){var i=t[0],n=t[1],a=t[2],o=r[3]*i+r[7]*n+r[11]*a+r[15];return o=o||1,e[0]=(r[0]*i+r[4]*n+r[8]*a+r[12])/o,e[1]=(r[1]*i+r[5]*n+r[9]*a+r[13])/o,e[2]=(r[2]*i+r[6]*n+r[10]*a+r[14])/o,e},n.transformMat3=function(e,t,r){var i=t[0],n=t[1],a=t[2];return e[0]=i*r[0]+n*r[3]+a*r[6],e[1]=i*r[1]+n*r[4]+a*r[7],e[2]=i*r[2]+n*r[5]+a*r[8],e},n.transformQuat=function(e,t,r){var i=t[0],n=t[1],a=t[2],o=r[0],s=r[1],l=r[2],u=r[3],c=u*i+s*a-l*n,h=u*n+l*i-o*a,d=u*a+o*n-s*i,f=-o*i-s*n-l*a;return e[0]=c*u+f*-o+h*-l-d*-s,e[1]=h*u+f*-s+d*-o-c*-l,e[2]=d*u+f*-l+c*-s-h*-o,e},n.rotateX=function(e,t,r,i){var n=[],a=[];return n[0]=t[0]-r[0],n[1]=t[1]-r[1],n[2]=t[2]-r[2],a[0]=n[0],a[1]=n[1]*Math.cos(i)-n[2]*Math.sin(i),a[2]=n[1]*Math.sin(i)+n[2]*Math.cos(i),e[0]=a[0]+r[0],e[1]=a[1]+r[1],e[2]=a[2]+r[2],e},n.rotateY=function(e,t,r,i){var n=[],a=[];return n[0]=t[0]-r[0],n[1]=t[1]-r[1],n[2]=t[2]-r[2],a[0]=n[2]*Math.sin(i)+n[0]*Math.cos(i),a[1]=n[1],a[2]=n[2]*Math.cos(i)-n[0]*Math.sin(i),e[0]=a[0]+r[0],e[1]=a[1]+r[1],e[2]=a[2]+r[2],e},n.rotateZ=function(e,t,r,i){var n=[],a=[];return n[0]=t[0]-r[0],n[1]=t[1]-r[1],n[2]=t[2]-r[2],a[0]=n[0]*Math.cos(i)-n[1]*Math.sin(i),a[1]=n[0]*Math.sin(i)+n[1]*Math.cos(i),a[2]=n[2],e[0]=a[0]+r[0],e[1]=a[1]+r[1],e[2]=a[2]+r[2],e},n.forEach=function(){var e=n.create();return function(t,r,i,n,a,o){var s,l;for(r||(r=3),i||(i=0),l=n?Math.min(n*r+i,t.length):t.length,s=i;s<l;s+=r)e[0]=t[s],e[1]=t[s+1],e[2]=t[s+2],a(e,e,o),t[s]=e[0],t[s+1]=e[1],t[s+2]=e[2];return t}}(),n.angle=function(e,t){var r=n.fromValues(e[0],e[1],e[2]),i=n.fromValues(t[0],t[1],t[2]);n.normalize(r,r),n.normalize(i,i);var a=n.dot(r,i);return a>1?0:Math.acos(a)},n.str=function(e){return"vec3("+e[0]+", "+e[1]+", "+e[2]+")"},n.exactEquals=function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]},n.equals=function(e,t){var r=e[0],n=e[1],a=e[2],o=t[0],s=t[1],l=t[2];return Math.abs(r-o)<=i.EPSILON*Math.max(1,Math.abs(r),Math.abs(o))&&Math.abs(n-s)<=i.EPSILON*Math.max(1,Math.abs(n),Math.abs(s))&&Math.abs(a-l)<=i.EPSILON*Math.max(1,Math.abs(a),Math.abs(l))},e.exports=n},function(e,t,r){var i=r(1),n={};n.create=function(){var e=new i.ARRAY_TYPE(4);return e[0]=0,e[1]=0,e[2]=0,e[3]=0,e},n.clone=function(e){var t=new i.ARRAY_TYPE(4);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},n.fromValues=function(e,t,r,n){var a=new i.ARRAY_TYPE(4);return a[0]=e,a[1]=t,a[2]=r,a[3]=n,a},n.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},n.set=function(e,t,r,i,n){return e[0]=t,e[1]=r,e[2]=i,e[3]=n,e},n.add=function(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e[3]=t[3]+r[3],e},n.subtract=function(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e[3]=t[3]-r[3],e},n.sub=n.subtract,n.multiply=function(e,t,r){return e[0]=t[0]*r[0],e[1]=t[1]*r[1],e[2]=t[2]*r[2],e[3]=t[3]*r[3],e},n.mul=n.multiply,n.divide=function(e,t,r){return e[0]=t[0]/r[0],e[1]=t[1]/r[1],e[2]=t[2]/r[2],e[3]=t[3]/r[3],e},n.div=n.divide,n.ceil=function(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e[2]=Math.ceil(t[2]),e[3]=Math.ceil(t[3]),e},n.floor=function(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e[2]=Math.floor(t[2]),e[3]=Math.floor(t[3]),e},n.min=function(e,t,r){return e[0]=Math.min(t[0],r[0]),e[1]=Math.min(t[1],r[1]),e[2]=Math.min(t[2],r[2]),e[3]=Math.min(t[3],r[3]),e},n.max=function(e,t,r){return e[0]=Math.max(t[0],r[0]),e[1]=Math.max(t[1],r[1]),e[2]=Math.max(t[2],r[2]),e[3]=Math.max(t[3],r[3]),e},n.round=function(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e[2]=Math.round(t[2]),e[3]=Math.round(t[3]),e},n.scale=function(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e},n.scaleAndAdd=function(e,t,r,i){return e[0]=t[0]+r[0]*i,e[1]=t[1]+r[1]*i,e[2]=t[2]+r[2]*i,e[3]=t[3]+r[3]*i,e},n.distance=function(e,t){var r=t[0]-e[0],i=t[1]-e[1],n=t[2]-e[2],a=t[3]-e[3];return Math.sqrt(r*r+i*i+n*n+a*a)},n.dist=n.distance,n.squaredDistance=function(e,t){var r=t[0]-e[0],i=t[1]-e[1],n=t[2]-e[2],a=t[3]-e[3];return r*r+i*i+n*n+a*a},n.sqrDist=n.squaredDistance,n.length=function(e){var t=e[0],r=e[1],i=e[2],n=e[3];return Math.sqrt(t*t+r*r+i*i+n*n)},n.len=n.length,n.squaredLength=function(e){var t=e[0],r=e[1],i=e[2],n=e[3];return t*t+r*r+i*i+n*n},n.sqrLen=n.squaredLength,n.negate=function(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=-t[3],e},n.inverse=function(e,t){return e[0]=1/t[0],e[1]=1/t[1],e[2]=1/t[2],e[3]=1/t[3],e},n.normalize=function(e,t){var r=t[0],i=t[1],n=t[2],a=t[3],o=r*r+i*i+n*n+a*a;return o>0&&(o=1/Math.sqrt(o),e[0]=r*o,e[1]=i*o,e[2]=n*o,e[3]=a*o),e},n.dot=function(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]*t[3]},n.lerp=function(e,t,r,i){var n=t[0],a=t[1],o=t[2],s=t[3];return e[0]=n+i*(r[0]-n),e[1]=a+i*(r[1]-a),e[2]=o+i*(r[2]-o),e[3]=s+i*(r[3]-s),e},n.random=function(e,t){return t=t||1,e[0]=i.RANDOM(),e[1]=i.RANDOM(),e[2]=i.RANDOM(),e[3]=i.RANDOM(),n.normalize(e,e),n.scale(e,e,t),e},n.transformMat4=function(e,t,r){var i=t[0],n=t[1],a=t[2],o=t[3];return e[0]=r[0]*i+r[4]*n+r[8]*a+r[12]*o,e[1]=r[1]*i+r[5]*n+r[9]*a+r[13]*o,e[2]=r[2]*i+r[6]*n+r[10]*a+r[14]*o,e[3]=r[3]*i+r[7]*n+r[11]*a+r[15]*o,e},n.transformQuat=function(e,t,r){var i=t[0],n=t[1],a=t[2],o=r[0],s=r[1],l=r[2],u=r[3],c=u*i+s*a-l*n,h=u*n+l*i-o*a,d=u*a+o*n-s*i,f=-o*i-s*n-l*a;return e[0]=c*u+f*-o+h*-l-d*-s,e[1]=h*u+f*-s+d*-o-c*-l,e[2]=d*u+f*-l+c*-s-h*-o,e[3]=t[3],e},n.forEach=function(){var e=n.create();return function(t,r,i,n,a,o){var s,l;for(r||(r=4),i||(i=0),l=n?Math.min(n*r+i,t.length):t.length,s=i;s<l;s+=r)e[0]=t[s],e[1]=t[s+1],e[2]=t[s+2],e[3]=t[s+3],a(e,e,o),t[s]=e[0],t[s+1]=e[1],t[s+2]=e[2],t[s+3]=e[3];return t}}(),n.str=function(e){return"vec4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"},n.exactEquals=function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]},n.equals=function(e,t){var r=e[0],n=e[1],a=e[2],o=e[3],s=t[0],l=t[1],u=t[2],c=t[3];return Math.abs(r-s)<=i.EPSILON*Math.max(1,Math.abs(r),Math.abs(s))&&Math.abs(n-l)<=i.EPSILON*Math.max(1,Math.abs(n),Math.abs(l))&&Math.abs(a-u)<=i.EPSILON*Math.max(1,Math.abs(a),Math.abs(u))&&Math.abs(o-c)<=i.EPSILON*Math.max(1,Math.abs(o),Math.abs(c))},e.exports=n},function(e,t,r){(function(e){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.world=t.webvr=t.webgl=t.util=void 0;var n=r(31),a=i(n),o=r(19),s=i(o),l=r(32),u=i(l),c=r(33),h=i(c),d=r(30),f=i(d),m=r(23),v=i(m),p=r(28),g=i(p),A=r(22),y=i(A),M=r(27),x=i(M),b=r(26),E=i(b),D=r(29),w=i(D),S=r(24),P=i(S),I=r(4),T=i(I),R=r(25),F=i(R),C=r(12),O=(i(C),r(34)),k=i(O);console.log("in es6");var L=(e.env.WEBPACK_ENV,r(35));L?console.log("loaded gl-matrix"):console.error("gl-matrix could'nt be loaded...");var _=new a.default,N=null;console.log("app.es6: in development mode");var B=r(42);t.webgl=N=new u.default(!1,L,_,B),B?console.log("Loading webgl-debug"):console.log("Error loading webgl-debug");var V=void 0,U=void 0,G=void 0,z=void 0,W=void 0,j=void 0;new Promise(function(e,r){N.init("webvr-mini-canvas")?(t.webvr=V=new h.default(!0,_,L,N),U=new s.default(!0,_),G=new f.default(!1,_,N,V),W=new T.default(L),z=new F.default(!0,_,L,N),z.addAsset(new v.default(!0,_,L,N,V,"shaderFader",W)),z.addAsset(new g.default(!0,_,L,N,V,"shaderTexture",W)),z.addAsset(new y.default(!0,_,L,N,V,"shaderColor",W)),z.addAsset(new x.default(!0,_,L,N,V,"shaderTerrain",W)),z.addAsset(new E.default(!0,_,L,N,V,"shaderSky",W)),z.addAsset(new w.default(!0,_,L,N,V,"shaderWater",W)),z.addAsset(new P.default(!0,_,L,N,V,"shaderMetal",W)),t.world=j=new k.default(!0,L,N,V,U,z,W,G),G.init(),e("Stuff worked!")):(r(Error("It broke")),G=new f.default(!1,_,N,V),G.initBadGL())}).then(function(e){j.init()});window.world=j,t.util=_,t.webgl=N,t.webvr=V,t.world=j}).call(t,r(41))},function(e,t){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),n=function(){function e(){r(this,e),this.callbacks={},this.events={WORLD_DEFINITION_READY:"wrddefrdy",WORLD_GEOLOCATION_READY:"wrdgeordy",PROCEDURAL_GEOMETRY_READY:"plgrdy",OBJ_GEOMETRY_READY:"ogrdy",HYG_GEOMETRY_READY:"hygrdy",GLTF_GEOMETRY_READY:"gltfrdy",MATERIAL_READY:"mrdy",TEXTURE_2D_READY:"trdy",TEXTURE_3D_READY:"t3drdy",TEXTURE_CUBEMAP_MEMBER_READY:"trcmpmbrdy",TEXTURE_CUBEMAP_READY:"tcmprdy",PRIM_ADDED_TO_SHADER:"prash",PRIM_REMOVED_FROM_SHADER:"prmsh",PRIM_FAIL:"prmfl",VR_DISPLAY_READY:"vrdispready",VR_DISPLAY_CHANGE:"virdispchange",VR_DISPLAY_FAIL:"vrdispfail"}}return i(e,[{key:"emit",value:function(e){var t=this.callbacks[e];if(t){var r=[].slice.call(arguments);r.shift();for(var i=0;i<t.length;i++)t[i].apply(this,r)}}},{key:"on",value:function(e,t){e in this.callbacks?this.callbacks[e].push(t):this.callbacks[e]=[t]}}]),e}();t.default=n},function(e,t){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),n=function(){function e(t,i,n,a){r(this,e),console.log("in gamepad constructor"),this.util=i,this.stats={},t===!0&&this.init()}return i(e,[{key:"setWorld",value:function(e){this.world=e}},{key:"init",value:function(){var e=this;this.getGamepads(),window.addEventListener("gamepadconnected",function(t){e.gpad=navigator.getGamepads()[t.gamepad.index],console.log("found gamepad: "+e.gpad.id),e.getGamepads}),window.addEventListener("gamepaddisconnected",function(e){console.log("gamepad disconnected")})}},{key:"getGamepadByHMDId",value:function(e){this.gamepads.length||this.getGamepads();for(var t=0;t<this.gamepads.length;t++){var r=this.gamepads[t];if(r&&r.displayId===e)return r}}},{key:"getGamepads",value:function(){var e=navigator.getGamepads();this.gamepads=[],console.log("GamePad::():getGamePads():"+e.length+" controllers"),this.stats.numGamepads=e.length;for(var t=0;t<e.length;t++){var r=e[t];r&&(this.gamepads[t]=r)}}},{key:"hasGamepads",value:function(){return!!("getGamepads"in navigator)}},{key:"reportGamePad",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this.util.isNumber(gamePad)&&(e=this.gamepads[e]||null),e?{id:gp.displayIndex,gamepad:gp.index,hand:gp.hand,actuators:gp.hapticActuators.length,pose:!(!gp.pose||!gp.pose.hasPosition),orientation:!(!gp.pose||!gp.pose.hasOrientation)}:null}}]),e}();t.default=n},function(e,t){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),n=function(){function e(t,i,n,a){r(this,e),this.primName=t,this.webgl=n,this.util=i,this.FLOAT32="float32",this.UINT="uint",this.UINT32="uint32",this.UINT16="uint16",this.makeBuffers=!0,this.vertices={data:[],buffer:null,itemSize:3,numItems:0},this.indices={data:[],buffer:null,itemSize:1,numItems:0},this.sides={data:[],buffer:null,itemSize:3,numItems:0},this.normals={data:[],buffer:null,itemSize:3,numItems:0},this.tangents={data:[],buffer:null,itemSize:4,numItems:0},this.texCoords={data:[],buffer:null,itemSize:2,numItems:0},this.colors={data:[],buffer:null,itemSize:4,numItems:0},this.pointSizes={data:[],buffer:null,itemSize:1,numItems:0},this.valid=!1,this.MAX_DRAWELEMENTS=this.webgl.MAX_DRAWELEMENTS,this.mName=this.primName+" GeometryBuffer::"}return i(e,[{key:"splitBuffers",value:function(){}},{key:"confirmNumericalData",value:function(e,t,r){for(var i=e.length,n=0;n<i;n++){var a=e[n];switch(t){case this.FLOAT32:if(!Number.isFinite(parseFloat(a)))return console.error(this.mName+"confirmNumericalData(): invalid float32 in "+r+" at pos:"+n+" = "+a),!1;break;case this.UINT16:case this.UINT32:case this.UINT:if(!Number.isFinite(parseInt(a)))return console.error(this.mName+"confirmNumericalData(): invalid Uint in "+r+" at pos:"+n+" = "+a),!1;break;default:return console.error(this.mName+" confirmNumericalData(): unknown data type "+t+" for:"+r),!1}}return!0}},{key:"checkVertexData",value:function(e){var t=this.mName+" checkVertexData():",r=this.vertices.data.length,i=this.numVertices();return r<this.vertices.itemSize||0!==this.util.frac(i)?(console.error(t+" invalid vertex size, "+i),!1):r>this.MAX_DRAWELEMENTS?(console.error(t+" vertex size exceeds 64k on hardware not supporting it"),!1):!(e&&!this.confirmNumericalData(this.vertices.data,this.FLOAT32,"vertices"))&&i}},{key:"checkIndexData",value:function(e){var t=this.mName+" checkIndexData():",r=this.numIndices(),i=this.numVertices();if(r<this.indices.itemSize)return console.error(t+" invalid index size, "+r),!1;if(e){if(!this.confirmNumericalData(this.indices.data,this.UINT,"indices"))return!1;for(var n=this.indices.data,a=0;a<r;a++){var o=n[a];if(o<0||o>i)return console.error(t+" index at "+a+" points to invalid postion in vertices "+o+", max:"+i),!1}}return r}},{key:"checkFacesData",value:function(e){var t=this.numFaces();return t?t:(console.error(fnName+" number of sides (triangles) is invalid"),!1)}},{key:"checkNormalsData",value:function(e){var t=this.mName+" checkNormalsData():",r=this.numVertices(),i=this.numNormals();return i<this.normals.itemSize||0!==this.util.frac(i)?(console.error(t+" invalid normals size, "+i),!1):i!==r?(console.error(t+" normals length: "+this.numNormals()+" does not match vertices length: "+this.numVertices()),!1):!(e&&!this.confirmNumericalData(this.normals.data,this.FLOAT32,"normals"))&&i}},{key:"checkTexCoordsData",value:function(e,t){var r=this.mName+" checkTexCoordsData():",i=this.numVertices(),n=t||this.texCoords,a=this.numTexCoords(n);if(a>0){if(a<n.itemSize||0!==this.util.frac(a))return console.error(r+" invalid texCoords size, "+n.data.length),!1;if(a!==i)return console.error(r+" texCoords length: "+this.numTexCoords(n)+" does not match vertices length: "+this.numVertices()),!1}else console.warn(r+" no texCoords data defined.");return!(e&&!this.confirmNumericalData(n.data,this.FLOAT32,"texCoords"))&&a}},{key:"checkTangentsData",value:function(e){var t=this.mName+" checkTangentsData():",r=this.numVertices(),i=this.numTangents();if(i>0){if(i<this.tangents.itemSize||0!==this.util.frac(i))return console.error(t+" invalid tangents size, "+i),!1;if(i!==r)return console.error(t+" tangents length "+this.numTangents()+" does not match vertices length: "+this.numVertices()),!1}else console.warn(t+" no tangents data defined.");return!(e&&!this.confirmNumericalData(this.tangents.data,this.FLOAT32,"tangents"))&&i}},{key:"checkColorsData",value:function(e){var t=this.mName+" checkColorsData():",r=this.numVertices(),i=this.numColors();if(i>0){if(i<this.colors.itemSize||0!==this.util.frac(i))return console.error(t+" invalid colors size, "+this.colors.data.length),!1;if(i!==r)return console.error(t+" colors length: "+this.numColors()+" does not match vertices length:"+this.numVertices()),!1}else console.warn(t+" no colors data defined.");return!(e&&!this.confirmNumericalData(this.colors.data,this.FLOAT32,"colors"))&&i}},{key:"checkBufferData",value:function(e){this.valid=!0,this.vertices.data.length,this.mName+" checkBufferData():";return!!(this.checkVertexData(!0)&&this.checkIndexData(!0)&&this.checkNormalsData(!0)&&this.checkTexCoordsData(!0)&&this.checkTangentsData(!0)&&this.checkColorsData(!0))||(console.warn(this.mName+"checkBufferData() buffers not ok"),!1)}},{key:"numVertices",value:function(){return this.vertices.data.length/this.vertices.itemSize}},{key:"numIndices",value:function(){return this.indices.data.length}},{key:"numNormals",value:function(){return this.normals.data.length/this.normals.itemSize}},{key:"numTexCoords",value:function(e){var t=e||this.texCoords;return t.data.length/t.itemSize}},{key:"numTangents",value:function(){return this.tangents.data.length/this.tangents.itemSize}},{key:"numColors",value:function(){return this.colors.data.length/this.colors.itemSize}},{key:"numFaces",value:function(){var e=this.indices.length/3;return this.util.frac(e/this.tangents.itemSize!==0)&&console.error(this.mName+"numFaces(): fractional number of faces"),e}},{key:"numSides",value:function(){return console.warn(this.mName+"numSides(): sides not implemented yet"),0}},{key:"numCoords",value:function(){return this.numVertices()+this.numIndices()+this.numNormals()+this.numTangents()+this.numColors()}},{key:"setVertices",value:function(e){var t=this.vertices;this.util.isArray(e)?(t.data=new Float32Array(e),t.numItems=e.length/t.itemSize,this.bindGLBuffer(t,this.FLOAT32)):console.warn(this.mName+"setVertices() invalid input, not Array, nothing set")}},{key:"setIndices",value:function(e){var t=this.indices;this.util.isArray(e)?this.webgl.stats.uint32?(t.data=new Uint32Array(e),this.bindGLBuffer(t,this.UINT32)):(t.data=new Uint16Array(e),this.bindGLBuffer(t,this.UINT16)):console.warn(this.mName+"setIndices() invalid input, not Array, nothing set")}},{key:"setNormals",value:function(e){var t=this.normals;this.util.isArray(e)?(t.data=new Float32Array(e),t.numItems=e.length/t.itemSize,this.bindGLBuffer(t,this.FLOAT32)):console.error(this.mName+"setNormals() invalid input, not Array")}},{key:"setTexCoords",value:function(e){var t=this.texCoords;this.util.isArray(e)?(t.data=new Float32Array(e),t.numItems=e.length/t.itemSize,this.bindGLBuffer(t,this.FLOAT32)):console.error(this.mName+"setTexCoords() invalid input, not Array")}},{key:"setColors",value:function(e){var t=this.colors;this.util.isArray(e)?(t.data=new Float32Array(e),t.numItems=e.length/t.itemSize,this.bindGLBuffer(t,this.FLOAT32)):console.error(this.mName+"setTangents() invalid input, not Array")}},{key:"setTangents",value:function(e){var t=this.tangents;this.util.isArray(e)?(t.data=new Float32Array(e),t.numItems=e.length/t.itemSize,this.bindGLBuffer(t,this.FLOAT32)):console.error(this.mName+"setTangents() invalid input, not Array")}},{key:"setBufferData",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[],n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:[],a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:[];e.length>0&&(this.setVertices(e),console.log("numVertices is now:"+this.numVertices())),t.length>0&&(this.setIndices(t),console.log("numIndices is now:"+this.numIndices())),r.length>0&&(this.setNormals(r),console.log("numNormals is now:"+this.numNormals())),i.length>0&&(this.setTexCoords(i),console.log("numTexCoords is now:"+this.numTexCoords())),n.length>0&&(this.setTangents(n),console.log("numTangents is now:"+this.numTangents())),a.length>0&&(this.setColors(a),console.log("numColors is now:"+this.numColors())),this.vertices.data.length>this.webgl.MAX_DRAWELEMENTS?this.ssz=!0:this.ssz=!1}},{key:"addBufferData",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[],n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:[],a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:[],o=arguments[6],s=this.util.concatArr,l=this.numCoords();return this.vertices.data=s(this.vertices.data,e),this.indices.data=s(this.indices.data,t),this.normals.data=s(this.normals.data,r),this.texCoords.data=s(this.texCoords.data,i),this.tangents.data=s(this.tangents.data,n),this.colors.data=s(this.colors.data,a),this.vertices.data.length>this.webgl.MAX_DRAWELEMENTS?this.ssz=!0:this.ssz=!1,l!==this.numCoords()&&this.createGLBuffers(),!o||this.checkBufferData()}},{key:"clearData",value:function(e){e.data=[]}},{key:"clearBuffer",value:function(e){this.clearData(e),e.buffer=null,e.numItems=0}},{key:"clear",value:function(){this.clearBuffer(this.vertices),this.clearBuffer(this.indices),this.clearBuffer(this.normals),this.clearBuffer(this.texCoords),this.clearBuffer(this.colors)}},{key:"bindGLBuffer",value:function(e,t){var r=this.webgl.getContext();switch(e.buffer=r.createBuffer(),r.bindBuffer(r.ARRAY_BUFFER,e.buffer),t){case this.FLOAT32:e.data instanceof Float32Array?r.bufferData(r.ARRAY_BUFFER,e.data,r.STATIC_DRAW):r.bufferData(r.ARRAY_BUFFER,new Float32Array(e.data),r.STATIC_DRAW),e.numItems=e.data.length/e.itemSize;break;case this.UINT32:e.buffer=r.createBuffer(),r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,e.buffer),r.bufferData(r.ELEMENT_ARRAY_BUFFER,new Uint32Array(e.data),r.STATIC_DRAW),e.numItems=e.data.length/e.itemSize;break;case this.UINT16:e.buffer=r.createBuffer(),r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,e.buffer),r.bufferData(r.ELEMENT_ARRAY_BUFFER,new Uint16Array(e.data),r.STATIC_DRAW),e.numItems=e.data.length/e.itemSize;break;default:console.error(this.mName+"bindGLBuffer(): invalid WebGL buffer type "+t)}}},{key:"createGLBuffers",value:function(){var e=(this.webgl.getContext(),this.mName+"createGLBuffers():",this.vertices);return e.data.length||(e.data=new Float32Array),this.bindGLBuffer(e,this.FLOAT32),e=this.indices,this.webgl.stats.uint32?(e.data.length||(e.data=new Uint32Array),this.bindGLBuffer(e,this.UINT32)):(e.data.length||(e.data=new Uint16Array),this.bindGLBuffer(e,this.UINT16)),e=this.sides,e.data.length||(e.data=new Uint16Array),this.bindGLBuffer(e,this.UINT16),e=this.normals,e.data.length||(e.data=new Float32Array),this.bindGLBuffer(e,this.FLOAT32),e=this.texCoords,e.data.length||(e.data=new Float32Array),this.bindGLBuffer(e,this.FLOAT32),e=this.tangents,e.data.length||(e.data=new Float32Array),this.bindGLBuffer(e,this.FLOAT32),e=this.colors,(!e.data.length||e.data.length<4*this.vertices.length/3)&&(e.data=new Float32Array),this.bindGLBuffer(e,this.FLOAT32),this.makeBuffers=!1,this}}]),e}();t.default=n},function(e,t,r){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var s=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),l=r(2),u=i(l),c=function(e){function t(e,r,i,o){n(this,t),console.log("in MaterialPool");var s=a(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,r));return s.util=r,s.webgl=i,s.texturePool=o,s.materialMimeTypes={mtl:"text/plain"},s.texturePositions=["map_Kd","map_Ka","map_bump","map_Ks","map_Ns","map_refl","map_d","map_disp"],e&&(s.defaultKey=s.addAsset(s.default()).key),s}return o(t,e),s(t,[{key:"default",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.util.DEFAULT_KEY,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[1,1,1],r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[1,1,1],i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[1,1,1],n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:64,a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:[0,0,0],o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:60,s=arguments.length>7&&void 0!==arguments[7]?arguments[7]:1,l=arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,u=arguments.length>9&&void 0!==arguments[9]?arguments[9]:2,c=arguments.length>10&&void 0!==arguments[10]?arguments[10]:null;return c||(c=this.texturePool.getAssetByKey(this.texturePool.defaultKey).texture),{name:e,key:null,path:null,emissive:a,ambient:t,diffuse:r,specular:i,specularExponent:n,sharpness:o,refraction:s,transparency:l,illum:u,map_Kd:c,map_Ks:null,map_Ka:null,map_Ns:null,map_refl:null,map_d:null,map_bump:null,map_disp:null}}},{key:"mergeTo",value:function(e,t){for(var r in e)switch(console.log("MERGING:"+r),r){case name:case key:case path:case specularExponent:case sharpness:case refraction:case transparency:case illum:e[r]=t[r];break;case emissive:case ambient:case diffuse:case specular:e[r]=JSON.parse(JSON.stringify(t[r]));break;case map_Kd:case map_Ks:case map_Ka:case map_refl:case map_d:case map_bump:case map_disp:console.log("INPUT:"+t[r]+" RECEIVE:"+e[r]),t[r]instanceof WebGLTexture&&(console.log("MaterialPool::mergeTo(): replacing "+r+" with new texture"),e[r]=t[r]);break;default:console.error("MaterialPool::mergeTo(): unknown object member ("+r+")!")}}},{key:"computeTextureMapOptions",value:function(e){var t={};if(e.length<4)return t;for(var r=[],i=0;i<e.length-1;i++)r[i]=e[i];for(var n=r.join(" ").split("-"),a=0;a<n.length;a++){var o=n[a].split(" ");if(o.length>1){var s=o[0],l=o[1];switch(s){case"blenu":case"blenv":case"cc":case"clamp":"off"===l?t[s]=!1:t[s]=!0;break;case"bm":case"mm":Number.isFinite(parseFloat(l))&&(t[s]=parseFloat(l));break;case"boost":Number.isFinite(parseFloat(l))&&l>=0&&(t[s]=parseFloat(l));break;case"imfchan":case"texres":t[s]=l;break;case"o":case"s":case"t":var u=0;t[s]=[];for(var c=1;c<o.length;c++){var h=o[c];Number.isFinite(parseFloat(h))&&(t[s][u++]=parseFloat(h))}3!==t[s].length&&(console.warn("MaterialPool::computeTextureMapOptions(): in valid texture param for:"+s),t[s]=[0,0,0]);break;default:console.error("unknown texture map option: "+e)}}}return t}},{key:"computeObjMaterials",value:function(e,t,r){var i=this,n=0,a=[],o=null,s=this.util.getFilePath(r),l=e.split("\n");return l.forEach(function(e){e=e.trim();var r=e.split(" ")[0].trim(),l=e.substr(r.length).trim().split(" ");if(""!==l)switch(r){case"newmtl":o=l[0].trim(),a[o]=i.addAsset(i.default(o)),a[o].fromObj=!0;break;case"Ka":l.length<3?console.error("MaterialPool::computeObjMaterials(): error in ambient material array at line:"+n):(l[0]=parseFloat(l[0]),l[1]=parseFloat(l[1]),l[2]=parseFloat(l[2]),o&&Number.isFinite(l[0])&&Number.isFinite(l[1])&&Number.isFinite(l[2])?a[o].ambient=[l[0],l[1],l[2]]:console.error("MaterialPool::computerObjMaterials(): invalid ambient data at line:"+n));break;case"Kd":l.length<3?console.error("MaterialPool::computeObjMaterials(): error in diffuse material array at line:"+n):(l[0]=parseFloat(l[0]),l[1]=parseFloat(l[1]),l[2]=parseFloat(l[2]),o&&Number.isFinite(l[0])&&Number.isFinite(l[1])&&Number.isFinite(l[2])?a[o].diffuse=[l[0],l[1],l[2]]:console.error("MaterialPool::computeObjMaterials(): invalid diffuse array at line:"+n));break;case"Ks":l.length<3?console.error("MaterialPool::computeObjMaterials(): error in specular array at line:"+n):(l[0]=parseFloat(l[0]),l[1]=parseFloat(l[1]),l[2]=parseFloat(l[2]),o&&Number.isFinite(l[0])&&Number.isFinite(l[1])&&Number.isFinite(l[2])?a[o].specular=[l[0],l[1],l[2]]:console.error("MaterialPool::computeObjMaterials(): invalid specular array at line:"+n));break;case"Ns":l.length<1?console.error("MaterialPool::computeObjMaterials(): error in specular exponent array at line:"+n):(l[0]=parseFloat(l[0]),o&&Number.isFinite(l[0])&&l[0]>=0&&l[0]<1001?a[o].specularExponent=l[0]:console.error("MaterialPool::computeObjMaterials(): invalid specular exponent array at line:"+n));break;case"Ke":l.length<3?console.error("MaterialPool::computeObjMaterials(): error in specular array at line:"+n):(l[0]=parseFloat(l[0]),l[1]=parseFloat(l[1]),l[2]=parseFloat(l[2]),o&&Number.isFinite(l[0])&&Number.isFinite(l[1])&&Number.isFinite(l[2])?a[o].emissive=[l[0],l[1],l[2]]:console.error("MaterialPool::computeObjMaterials(): invalid specular array at line:"+n));break;case"sharpness":l[0]=parseFloat(l[0]),o&&Number.isFinite(l[0])&&l[0]>=0&&l[0]<1001&&(a[o].sharpness=l[0]);break;case"Ni":l[0]=parseFloat(l[0]),o&&Number.isFinite(l[0])&&l[0]>=0&&l[0]<1001&&(a[o].refraction=l[0]);break;case"d":case"Tr":l.length<1?console.error("MaterialPool::computeObjMaterials(): error in transparency value at line:"+n):(l[0]=parseFloat(l[0]),o&&Number.isFinite(l[0])?("d"===r&&(l[0]=1-l[0]),a[o].transparency=l[0]):console.error("MaterialPool::computeObjMaterials(): invalid transparency value at line:"+n));break;case"illum":l.length<1?console.error("MaterialPool::computeObjMaterials(): error in illumination value at line:"+n):(l[0]=parseInt(l[0]),o&&Number.isFinite(l[0])&&l[0]>0&&l[0]<11&&(a[o].illum=l[0]));break;case"map_Kd":case"map_Ks":case"map_Ka":case"map_d":case"bump":case"map_bump":case"map_refl":case"refl":case"disp":var u=i.util.getFileName(l[l.length-1]);if(o){a[o][r]=u;var c=i.computeTextureMapOptions(l);"bump"!==r&&"map_Km"!==r||(r="map_bump"),"refl"===r&&(r="map_refl"),"disp"===r&&(r="map_disp");var h={fromObj:"OBJ",materialKey:a[o].key,type:r,materialName:o};h[r+"_options"]=c,i.texturePool.getTexture(t,s+u,!0,!1,null,h)}break;case"Tf":case"#":case"":break;default:console.warn("MaterialPool::computeObjMaterials(): unknown property:"+r+" in file");
}n++}),a}},{key:"createDefaultName",value:function(e){return e+"_"+this.util.DEFAULT_KEY}},{key:"setDefaultMaterial",value:function(e,t,r){var i=this.createDefaultName(e.name),n=this.addAsset(this.default(i));n.type=e.type,n.path=e.path,n.emits=this.util.emitter.events.MATERIAL_READY;for(var a=0;a<r.length;a++){var o={materialKey:n.key,materialName:i,type:this.texturePositions[a]};this.texturePool.getTexture(e,r[a],!0,!1,this.webgl.getContext().TEXTURE_2D,o)}return n}},{key:"addMaterial",value:function(e,t,r,i){var n=void 0,a=this.util.getFileExtension(r);switch(a){case"mtl":n=this.computeObjMaterials(t,e,r);break;default:console.warn("MaterialPool::addModel(): unknown material file:"+r+" MIME type:"+i)}if(n)for(var o in n){var s=n[o];s.type=e.type,s.path=r,s.emits=this.util.emitter.events.MATERIAL_READY,this.addAsset(s)}return n}},{key:"getMaterial",value:function(e,t){var r=this,i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{pos:0};if(this.util.isWhitespace(t))console.warn("MaterialPool::getMaterials(): empty path supplied for prim "+e.name);else{var a=this.materialMimeTypes[this.util.getFileExtension(t)];a?this.doRequest(t,n.pos,function(t){if(t.data){var i=r.addMaterial(e,t.data,t.path,a);if(i)for(var o in i)console.log("MaterialPool::getMaterial(): emitting new material :"+o+" for prim:"+e.name),r.util.emitter.emit(i[o].emits,e,i[o].key,n)}else console.error("MaterialPool::getMaterials(): no data found for material file:"+t.path)},i,a,0):console.error('MaterialPool::getMaterials(): file type "'+this.util.getFileExtension(t)+" not supported, not loading")}}}]),t}(u.default);t.default=c},function(e,t,r){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var s=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),l=r(3),u=i(l),c=function(e){function t(e,r,i,o,s,l,u){n(this,t);var c=a(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,r,i,o,s,l,u));return c.required.buffer.indices=!0,c.required.buffer.colors=!0,console.log("In ShaderColor class"),c}return o(t,e),s(t,[{key:"vsSrc",value:function(){var e=[this.floatp,"attribute vec3 "+this.webgl.attributeNames.aVertexPosition[0]+";","attribute vec4 "+this.webgl.attributeNames.aVertexColor[0]+";","attribute vec3 "+this.webgl.attributeNames.aVertexNormal[0]+";","uniform mat4 uMVMatrix;","uniform mat4 uPMatrix;","uniform mat3 uNMatrix;","uniform vec3 uPOV;","uniform float uPointSize;","varying vec3 vPOV;","varying vec4 vPositionW;","varying vec4 vNormalW;","varying vec4 vVertexColor;","void main(void) {","gl_PointSize = uPointSize;","gl_Position = uPMatrix * uMVMatrix * vec4(aVertexPosition, 1.0);","vVertexColor = aVertexColor;","vPOV = -uPOV;","vPositionW = uMVMatrix * vec4(aVertexPosition, 1.0);","vNormalW =  normalize(vec4(uNMatrix*aVertexNormal, 0.0));","}"];return{code:e.join("\n"),varList:this.webgl.createVarList(e)}}},{key:"fsSrc",value:function(){var e=[this.floatp,"uniform bool uUseLighting;","uniform bool uUseColor;","uniform vec3 uAmbientColor;","uniform vec3 uLightingDirection;","uniform vec3 uDirectionalColor;","uniform vec3 uMatEmissive;","uniform vec3 uMatAmbient;","uniform vec3 uMatDiffuse;","uniform vec3 uMatSpecular;","uniform float uMatSpecExp;","uniform float uAlpha;","varying vec3 vPOV;","varying vec4 vPositionW;","varying vec4 vNormalW;","varying lowp vec4 vVertexColor;","void main(void) {","vec4 vColor = vVertexColor;","vec4 Emissive = vec4(uMatEmissive, uAlpha);","vec4 Ambient = vec4(uAmbientColor * uMatAmbient, uAlpha);","vec4 Diffuse = vec4(uDirectionalColor * uMatDiffuse, uAlpha);","vec4 Specular = vec4(0.0, 0.0, 0.0, uAlpha);","if(uUseLighting) {","vec4 N = normalize(vNormalW);","vec4 LL = normalize(vec4(uLightingDirection, 1.0));","float NdotL = max( dot(N, LL), 0.0);","Diffuse = NdotL * Diffuse;","vec4 L = normalize(vec4(uLightingDirection, 1.0) - vPositionW);","vec4 EyePosW = vec4(vPOV, 0.0);","vec4 V = normalize(EyePosW - vPositionW );","vec4 H = normalize(L + V);","vec4 R = reflect(-L, N);","float RdotV = max(dot(R, V), 0.0);","float NdotH = max(dot(N, H), 0.0);","float spec = uMatSpecExp;","Specular = pow(RdotV, spec) * pow(NdotH, spec) * vec4(uDirectionalColor * uMatSpecular, 1.0);","}","gl_FragColor = (Emissive + Ambient + Diffuse + Specular) * vec4(vColor.rgb, vColor.a * uAlpha);","}"];return{code:e.join("\n"),varList:this.webgl.createVarList(e)}}},{key:"init",value:function(e){var t=this.setup(),r=t[0],i=(t[1],t[2]),n=t[3],a=(t[4],t[5]),o=t[6],s=t[7],l=(t[8],t[9],t[10],t[11],t[12]),u=a.shaderProgram;e&&(a.renderList=this.util.concatArr(a.renderList,e));var c=this.mvMatrix,h=(this.vMatrix,this.mMatrix,o.attribute.vec3.aVertexPosition),d=o.attribute.vec4.aVertexColor,f=o.attribute.vec3.aVertexNormal,m=s.uniform.bool.uUseLighting,v=s.uniform.vec3.uAmbientColor,p=s.uniform.vec3.uDirectionalColor,g=s.uniform.vec3.uLightingDirection,A=s.uniform.float.uAlpha,y=s.uniform.vec3.uMatEmissive,M=s.uniform.vec3.uMatAmbient,x=s.uniform.vec3.uMatDiffuse,b=s.uniform.vec3.uMatSpecular,E=s.uniform.float.uMatSpecExp,D=D=o.uniform.mat4.uPMatrix,w=w=o.uniform.mat4.uMVMatrix,S=o.uniform.mat3.uNMatrix,P=this.lights.getLight(this.lights.lightTypes.LIGHT_0),I=P.ambient,T=P.lightingDirection,R=P.directionalColor,F=o.uniform.float.uPointSize,C=o.uniform.vec3.uPOV,O=n.create(),k=T;a.update=function(e,t,r){e.setMV(t),n.normalFromMat4(O,t),r&&e.updateCoords()};var L=i.create();return a.render=function(e,t,n){if(a.renderList.length){r.useProgram(u),i.copy(L,c);for(var o=0,s=a.renderList.length;o<s;o++){var P=a.renderList[o];if(P&&0!==P.alpha){a.update(P,c,n);var T=P.matStarts;r.bindBuffer(r.ARRAY_BUFFER,P.geometry.vertices.buffer),r.enableVertexAttribArray(h),r.vertexAttribPointer(h,3,r.FLOAT,!1,0,0),r.bindBuffer(r.ARRAY_BUFFER,P.geometry.colors.buffer),r.enableVertexAttribArray(d),r.vertexAttribPointer(d,4,r.FLOAT,!1,0,0),r.uniform3fv(v,I),r.uniform3fv(g,k),r.uniform3fv(p,R),r.uniform3fv(C,t.position),r.uniform1f(F,P.pointSize),r.uniform1f(A,P.alpha),P.useLighting?r.uniform1i(m,1):r.uniform1i(m,0),r.bindBuffer(r.ARRAY_BUFFER,P.geometry.normals.buffer),r.enableVertexAttribArray(f),r.vertexAttribPointer(f,3,r.FLOAT,!1,0,0),r.uniformMatrix3fv(S,!1,O),r.uniformMatrix4fv(D,!1,e),r.uniformMatrix4fv(w,!1,c),r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,P.geometry.indices.buffer);for(var _=0;_<T.length;_++){var N=T[_],B=P.materials[N[0]];r.uniform3fv(M,B.ambient),r.uniform3fv(x,B.diffuse),r.uniform3fv(y,B.emissive),r.uniform3fv(b,B.specular),r.uniform1f(E,B.specularExponent),P.drawTris&&r.drawElements(r.TRIANGLES,N[2],l,N[1]),P.drawPoints&&r.drawElements(r.POINTS,N[2],l,N[1]),P.drawLines&&r.drawElements(r.LINES,N[2],l,N[1])}i.copy(c,L)}}}},a}}]),t}(u.default);t.default=c},function(e,t,r){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var s=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),l=r(3),u=i(l),c=function(e){function t(e,r,i,o,s,l,u){n(this,t);var c=a(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,r,i,o,s,l,u));return c.required.buffer.indices=!0,c.required.buffer.colors=!0,c.required.buffer.texCoords=!0,c.sortByDistance=!0,console.log("In ShaderFader class"),c}return o(t,e),s(t,[{key:"vsSrc",value:function(){var e=[this.floatp,"attribute vec3 "+this.webgl.attributeNames.aVertexPosition[0]+";","attribute vec4 "+this.webgl.attributeNames.aVertexColor[0]+";","attribute vec2 "+this.webgl.attributeNames.aTextureCoord[0]+";","attribute vec3 "+this.webgl.attributeNames.aVertexNormal[0]+";","uniform mat4 uMVMatrix;","uniform mat4 uPMatrix;","uniform mat3 uNMatrix;","uniform vec3 uPOV;","uniform float uPointSize;","varying vec3 vPOV;","varying vec4 vPositionW;","varying vec4 vNormalW;","varying vec2 vTextureCoord;","varying vec4 vVertexColor;","void main(void) {","gl_PointSize = uPointSize;","gl_Position = uPMatrix * uMVMatrix * vec4(aVertexPosition, 1.0);","vTextureCoord = aTextureCoord;","vVertexColor = aVertexColor;","vPOV = -uPOV;","vPositionW = uMVMatrix * vec4(aVertexPosition, 1.0);","vNormalW =  normalize(vec4(uNMatrix*aVertexNormal, 0.0));","}"];return{code:e.join("\n"),varList:this.webgl.createVarList(e)}}},{key:"fsSrc",value:function(){var e=[this.floatp,"uniform bool uUseLighting;","uniform bool uUseTexture;","uniform bool uUseColor;","uniform vec3 uAmbientColor;","uniform vec3 uLightingDirection;","uniform vec3 uDirectionalColor;","uniform vec3 uMatEmissive;","uniform vec3 uMatAmbient;","uniform vec3 uMatDiffuse;","uniform vec3 uMatSpecular;","uniform float uMatSpecExp;","uniform float uAlpha;","varying vec3 vPOV;","varying vec4 vPositionW;","varying vec4 vNormalW;","varying vec2 vTextureCoord;","varying vec4 vVertexColor;","uniform sampler2D uSampler;","void main(void) {","vec4 vColor;","if(uUseTexture) {","vColor = texture2D(uSampler, vec2(vTextureCoord.s, vTextureCoord.t));","} else {","vColor = vVertexColor;","}","vec4 Emissive = vec4(uMatEmissive, uAlpha);","vec4 Ambient = vec4(uAmbientColor * uMatAmbient, uAlpha);","vec4 Diffuse = vec4(uDirectionalColor * uMatDiffuse, uAlpha);","vec4 Specular = vec4(0.0, 0.0, 0.0, uAlpha);","if(uUseLighting) {","vec4 N = normalize(vNormalW);","vec4 LL = normalize(vec4(uLightingDirection, 1.0));","float NdotL = max( dot(N, LL), 0.0);","Diffuse = NdotL * Diffuse;","vec4 L = normalize(vec4(uLightingDirection, uAlpha) - vPositionW);","vec4 EyePosW = vec4(vPOV, 0.0);","vec4 V = normalize(EyePosW - vPositionW );","vec4 H = normalize(L + V);","vec4 R = reflect(-L, N);","float RdotV = max(dot(R, V), 0.0);","float NdotH = max(dot(N, H), 0.0);","float spec = uMatSpecExp;","Specular = pow(RdotV, spec) * pow(NdotH, spec) * vec4(uDirectionalColor * uMatSpecular, uAlpha);","} else {","Ambient.rgb *= uAlpha;","}","gl_FragColor = ((Emissive + Ambient + Diffuse + Specular) * vec4(vColor.rgb, vColor.a));","}"];return{code:e.join("\n"),varList:this.webgl.createVarList(e)}}},{key:"init",value:function(e){var t=this.setup(),r=t[0],i=(t[1],t[2]),n=t[3],a=(t[4],t[5]),o=t[6],s=t[7],l=(t[8],t[9],t[10],t[11],t[12]),u=a.shaderProgram;e&&(a.renderList=this.util.concatArr(a.renderList,e));var c=this.mvMatrix,h=(this.vMatrix,this.mMatrix,o.attribute.vec3.aVertexPosition),d=o.attribute.vec4.aVertexColor,f=o.attribute.vec2.aTextureCoord,m=o.attribute.vec3.aVertexNormal,v=s.uniform.sampler2D.uSampler,p=s.uniform.float.uAlpha,g=s.uniform.bool.uUseLighting,A=s.uniform.bool.uUseTexture,y=s.uniform.bool.uUseColor,M=s.uniform.vec3.uMatEmissive,x=s.uniform.vec3.uMatAmbient,b=s.uniform.vec3.uMatDiffuse,E=s.uniform.vec3.uMatSpecular,D=s.uniform.float.uMatSpecExp,w=s.uniform.vec3.uAmbientColor,S=s.uniform.vec3.uDirectionalColor,P=s.uniform.vec3.uLightingDirection,I=o.uniform.float.uPointSize,T=o.uniform.vec3.uPOV,R=o.uniform.mat4.uPMatrix,F=o.uniform.mat4.uMVMatrix,C=o.uniform.mat3.uNMatrix,O=(this.util.easeQuadIn,this.lights.getLight(this.lights.lightTypes.LIGHT_0)),k=O.ambient,L=O.lightingDirection,_=O.directionalColor,N=n.create(),B=L,V=function(e){var t=e.fade,r=t.endAlpha-t.startAlpha;r>0?(t.incr=t.eq(t.incr),e.alpha+=t.incr,e.alpha>=t.endAlpha&&(e.alpha=t.endAlpha,e.shader.movePrim(e,e.defaultShader))):r<=0&&(t.incr=t.eq(t.incr),e.alpha-=t.incr,e.alpha<=t.endAlpha&&(e.alpha=t.endAlpha,e.shader.movePrim(e,e.defaultShader)))};a.update=function(e,t,r){V(e),e.setMV(t),n.normalFromMat4(N,t),r&&e.updateCoords()};var U=i.create();return a.render=function(e,t,n){if(a.renderList.length){r.useProgram(u),i.copy(U,c);for(var o=0,s=a.renderList.length;o<s;o++){var O=a.renderList[o];if(O){a.update(O,c,n),r.bindBuffer(r.ARRAY_BUFFER,O.geometry.vertices.buffer),r.enableVertexAttribArray(h),r.vertexAttribPointer(h,3,r.FLOAT,!1,0,0),r.bindBuffer(r.ARRAY_BUFFER,O.geometry.colors.buffer),r.enableVertexAttribArray(d),r.vertexAttribPointer(d,4,r.FLOAT,!1,0,0),r.bindBuffer(r.ARRAY_BUFFER,O.geometry.texCoords.buffer),r.enableVertexAttribArray(f),r.vertexAttribPointer(f,2,r.FLOAT,!1,0,0),r.uniform1f(I,O.pointSize),r.uniform1f(p,O.alpha),r.uniform3fv(w,k),r.uniform3fv(P,B),r.uniform3fv(S,_),r.uniform3fv(T,t.position),O.useLighting?r.uniform1i(g,1):r.uniform1i(g,0),r.bindBuffer(r.ARRAY_BUFFER,O.geometry.normals.buffer),r.enableVertexAttribArray(m),r.vertexAttribPointer(m,3,r.FLOAT,!1,0,0),r.uniformMatrix3fv(C,!1,N),r.uniformMatrix4fv(R,!1,e),r.uniformMatrix4fv(F,!1,c),r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,O.geometry.indices.buffer);for(var L=O.matStarts,V=0;V<L.length;V++){var G=L[V],z=O.materials[G[0]];void 0!==z&&(r.uniform3fv(x,z.ambient),r.uniform3fv(b,z.diffuse),r.uniform3fv(M,z.emissive),r.uniform3fv(E,z.specular),r.uniform1f(D,z.specularExponent),z.map_Kd instanceof WebGLTexture&&(r.uniform1i(v,0),r.activeTexture(r.TEXTURE0),r.bindTexture(r.TEXTURE_2D,null),r.bindTexture(r.TEXTURE_2D,z.map_Kd)),O.useColorArray===!0?(r.uniform1i(y,1),r.uniform1i(A,0)):(r.uniform1i(y,0),r.uniform1i(A,1)),O.drawTris&&r.drawElements(r.TRIANGLES,G[2],l,G[1]),O.drawPoints&&r.drawElements(r.POINTS,G[2],l,G[1]),O.drawLines&&r.drawElements(r.LINES,G[2],l,G[1]))}i.copy(c,U)}}}},a}}]),t}(u.default);t.default=c},function(e,t,r){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var s=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),l=r(3),u=i(l),c=function(e){function t(e,r,i,o,s,l,u){n(this,t);var c=a(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,r,i,o,s,l,u));return console.log("In ShaderMetal class"),c.required.buffer.indices=!0,c.required.buffer.texCoords=!0,c.required.buffer.colors=!0,c.required.buffer.normals=!0,c.required.lights=1,c.required.textures=0,c}return o(t,e),s(t,[{key:"vsSrc",value:function(){var e=[this.floatp,"attribute vec3 "+this.webgl.attributeNames.aVertexPosition[0]+";","attribute vec2 "+this.webgl.attributeNames.aTextureCoord[0]+";","attribute vec3 "+this.webgl.attributeNames.aVertexNormal[0]+";","uniform mat4 uMVMatrix;","uniform mat4 uPMatrix;","uniform mat3 uNMatrix;","uniform vec3 uPOV;","varying vec3 vPOV;","varying vec4 vPositionW;","varying vec4 vNormalW;","varying vec2 vTextureCoord;","void main(void) {","    gl_Position = uPMatrix * uMVMatrix * vec4(aVertexPosition, 1.0);","}"];return{code:e.join("\n"),varList:this.webgl.createVarList(e)}}},{key:"fsSrc",value:function(){var e=[this.floatp,"void main(void) {","gl_FragColor = vec4(0.5, 0.5, 0.5, 1.0);","}"];return{code:e.join("\n"),varList:this.webgl.createVarList(e)}}},{key:"init",value:function(e){var t=this.setup(),r=t[0],i=(t[1],t[2]),n=t[3],a=(t[4],t[5]),o=(t[6],t[7],t[8],t[9],t[10],t[11],t[12],a.shaderProgram);e&&(a.renderList=this.util.concatArr(a.renderList,e));var s=this.mvMatrix;this.vMatrix,this.mMatrix;a.update=function(e,t,r){e.setMV(s),n.normalFromMat4(nMatrix,s),r&&e.updateCoords()};var l=i.create();a.render=function(e,t,n){if(a.renderList.length){r.useProgram(o),i.copy(l,s);for(var u=0,c=a.renderList.length;u<c;u++){var h=a.renderList[u];h&&0!==h.alpha&&(a.update(h,s,n),i.copy(s,l))}}}}}]),t}(u.default);t.default=c},function(e,t,r){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var s=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),l=r(2),u=i(l),c=function(e){function t(e,r,i,o){n(this,t);var s=a(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,r));return console.log("In ShaderPool class"),s.webgl=o,s.glmatrix=i,s.init,s}return o(t,e),s(t,[{key:"renderMono",value:function(){var e=this.keyList;for(var t in e)e[t].program.render()}},{key:"renderVR",value:function(e,t,r){var i=this.keyList;for(var n in this.keyList)i[n].program.renderVR(e,t,r)}}]),t}(u.default);t.default=c},function(e,t,r){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var s=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),l=r(3),u=i(l),c=function(e){function t(e,r,i,o,s,l,u){n(this,t);var c=a(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,r,i,o,s,l,u));return console.log("In ShaderSky class"),c.required.buffer.indices=!0,c.required.buffer.texCoords=!0,c.required.buffer.colors=!0,c.required.buffer.normals=!0,c.required.buffer.tangents=!0,c.required.lights=1,c.required.textures=5,c}return o(t,e),s(t,[{key:"vsSrc",value:function(){var e=[this.floatp,"attribute vec3 "+this.webgl.attributeNames.aVertexPosition[0]+";","attribute vec2 "+this.webgl.attributeNames.aTextureCoord[0]+";","attribute vec3 "+this.webgl.attributeNames.aVertexNormal[0]+";","uniform mat4 uMVMatrix;","uniform mat4 uPMatrix;","uniform mat3 uNMatrix;","uniform vec3 uPOV;","varying vec3 vPOV;","varying vec4 vPositionW;","varying vec4 vNormalW;","varying vec2 vTextureCoord;","void main(void) {","    gl_Position = uPMatrix * uMVMatrix * vec4(aVertexPosition, 1.0);","}"];return{code:e.join("\n"),varList:this.webgl.createVarList(e)}}},{key:"fsSrc",value:function(){var e=[this.floatp,"void main(void) {","gl_FragColor = vec4(0.5, 0.5, 0.5, 1.0);","}"];return{code:e.join("\n"),varList:this.webgl.createVarList(e)}}},{key:"init",value:function(e){var t=this.setup(),r=t[0],i=(t[1],t[2]),n=t[3],a=(t[4],t[5]),o=(t[6],t[7],t[8],t[9],t[10],t[11],t[12],a.shaderProgram);e&&(a.renderList=this.util.concatArr(a.renderList,e));var s=this.mvMatrix;this.vMatrix,this.mMatrix;a.update=function(e,t,r){e.setMV(s),n.normalFromMat4(nMatrix,s),r&&e.updateCoords()};var l=i.create();a.render=function(e,t,n){if(a.renderList.length){r.useProgram(o),i.copy(l,s);for(var u=0,c=a.renderList.length;u<c;u++){var h=a.renderList[u];h&&0!==h.alpha&&(a.update(h,s,n),i.copy(s,l))}}}}}]),t}(u.default);t.default=c},function(e,t,r){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var s=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),l=r(3),u=i(l),c=function(e){function t(e,r,i,o,s,l,u){n(this,t);var c=a(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,r,i,o,s,l,u));return console.log("In ShaderTerrain class"),c.required.buffer.indices=!0,c.required.buffer.texCoords=!0,c.required.buffer.normals=!0,c.required.lights=1,c.required.textures=1,c}return o(t,e),s(t,[{key:"vsSrc",value:function(){var e=[this.floatp,"attribute vec3 "+this.webgl.attributeNames.aVertexPosition[0]+";","attribute vec2 "+this.webgl.attributeNames.aTextureCoord[0]+";","attribute vec3 "+this.webgl.attributeNames.aVertexNormal[0]+";","uniform mat4 uMVMatrix;","uniform mat4 uPMatrix;","uniform mat3 uNMatrix;","uniform vec3 uPOV;","varying vec3 vPOV;","varying vec4 vPositionW;","varying vec4 vNormalW;","varying vec2 vTextureCoord;","void main(void) {","    gl_Position = uPMatrix * uMVMatrix * vec4(aVertexPosition, 1.0);","}"];return{code:e.join("\n"),varList:this.webgl.createVarList(e)}}},{key:"fsSrc",value:function(){var e=[this.floatp,"void main(void) {","gl_FragColor = vec4(0.5, 0.5, 0.5, 1.0);","}"];return{code:e.join("\n"),varList:this.webgl.createVarList(e)}}},{key:"init",value:function(e){var t=this.setup(),r=t[0],i=(t[1],t[2]),n=t[3],a=(t[4],t[5]),o=(t[6],t[7],t[8],t[9],t[10],t[11],t[12],a.shaderProgram);e&&(a.renderList=this.util.concatArr(a.renderList,e)),mvMatrix=this.mvMatrix,vMatrix=this.vMatrix,mMatrix=this.mMatrix,a.update=function(e,t,r){e.setMV(mvMatrix),n.normalFromMat4(nMatrix,mvMatrix),r&&e.updateCoords()};var s=i.create();a.render=function(e,t,n){if(a.renderList.length){r.useProgram(o),i.copy(s,mvMatrix);for(var l=0,u=a.renderList.length;l<u;l++){var c=a.renderList[l];c&&0!==c.alpha&&(a.update(c,mvMatrix,n),i.copy(mvMatrix,s))}}}}}]),t}(u.default);t.default=c},function(e,t,r){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var s=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),l=r(3),u=i(l),c=function(e){function t(e,r,i,o,s,l,u){n(this,t);var c=a(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,r,i,o,s,l,u));return c.required.buffer.indices=!0,c.required.buffer.colors=!0,c.required.buffer.normals=!0,c.required.lights=0,c.required.textures.map_Kd=!0,console.log("In ShaderTexture class"),c}return o(t,e),s(t,[{key:"vsSrc",value:function(){var e=[this.floatp,"attribute vec3 "+this.webgl.attributeNames.aVertexPosition[0]+";","attribute vec2 "+this.webgl.attributeNames.aTextureCoord[0]+";","attribute vec3 "+this.webgl.attributeNames.aVertexNormal[0]+";","uniform mat4 uMVMatrix;","uniform mat4 uPMatrix;","uniform mat3 uNMatrix;","uniform vec3 uPOV;","uniform float uPointSize;","varying vec3 vPOV;","varying vec4 vPositionW;","varying vec4 vNormalW;","varying vec2 vTextureCoord;","void main(void) {","gl_PointSize = uPointSize;","gl_Position = uPMatrix * uMVMatrix * vec4(aVertexPosition, 1.0);","vTextureCoord = aTextureCoord;","vPOV = -uPOV;","vPositionW = uMVMatrix * vec4(aVertexPosition, 1.0);","vNormalW =  normalize(vec4(uNMatrix*aVertexNormal, 0.0));","}"];return{code:e.join("\n"),varList:this.webgl.createVarList(e)}}},{key:"fsSrc",value:function(){var e=[this.floatp,"uniform bool uUseLighting;","uniform vec3 uAmbientColor;","uniform vec3 uLightingDirection;","uniform vec3 uDirectionalColor;","uniform vec3 uMatEmissive;","uniform vec3 uMatAmbient;","uniform vec3 uMatDiffuse;","uniform vec3 uMatSpecular;","uniform float uMatSpecExp;","uniform float uAlpha;","varying vec3 vPOV;","varying vec4 vPositionW;","varying vec4 vNormalW;","varying vec2 vTextureCoord;","uniform sampler2D uSampler;","void main(void) {","vec4 vColor = texture2D(uSampler, vec2(vTextureCoord.s, vTextureCoord.t));","vec4 Emissive = vec4(uMatEmissive, uAlpha);","vec4 Ambient = vec4(uAmbientColor * uMatAmbient, uAlpha);","vec4 Diffuse = vec4(uDirectionalColor * uMatDiffuse, uAlpha);","vec4 Specular = vec4(0.0, 0.0, 0.0, uAlpha);","if(uUseLighting) {","vec4 N = normalize(vNormalW);","vec4 LL = normalize(vec4(uLightingDirection, 1.0));","float NdotL = max( dot(N, LL), 0.0);","Diffuse = NdotL * Diffuse;","vec4 L = normalize(vec4(uLightingDirection, uAlpha) - vPositionW);","vec4 EyePosW = vec4(vPOV, 0.0);","vec4 V = normalize(EyePosW - vPositionW );","vec4 H = normalize(L + V);","vec4 R = reflect(-L, N);","float RdotV = max(dot(R, V), 0.0);","float NdotH = max(dot(N, H), 0.0);","float spec = uMatSpecExp;","Specular = pow(RdotV, spec) * pow(NdotH, spec) * vec4(uDirectionalColor * uMatSpecular, uAlpha);","} else {","Ambient.rgb *= uAlpha;","}","gl_FragColor =  (Emissive + Ambient + Diffuse + Specular) * vec4(vColor.rgb, vColor.a);","}"];return{code:e.join("\n"),varList:this.webgl.createVarList(e)}}},{key:"init",value:function(e){var t=this.setup(),r=t[0],i=(t[1],t[2]),n=t[3],a=(t[4],t[5]),o=t[6],s=t[7],l=(t[8],t[9],t[10],t[11],t[12]),u=a.shaderProgram;e&&(a.renderList=this.util.concatArr(a.renderList,e));var c=this.mvMatrix,h=(this.vMatrix,this.mMatrix,o.attribute.vec3.aVertexPosition),d=o.attribute.vec2.aTextureCoord,f=o.attribute.vec3.aVertexNormal,m=s.uniform.sampler2D.uSampler,v=s.uniform.float.uAlpha,p=s.uniform.bool.uUseLighting,g=s.uniform.vec3.uMatEmissive,A=s.uniform.vec3.uMatAmbient,y=s.uniform.vec3.uMatDiffuse,M=s.uniform.vec3.uMatSpecular,x=s.uniform.float.uMatSpecExp,b=s.uniform.vec3.uAmbientColor,E=s.uniform.vec3.uDirectionalColor,D=s.uniform.vec3.uLightingDirection,w=o.uniform.float.uPointSize,S=o.uniform.vec3.uPOV,P=o.uniform.mat4.uPMatrix,I=o.uniform.mat4.uMVMatrix,T=o.uniform.mat3.uNMatrix,R=this.lights.getLight(this.lights.lightTypes.LIGHT_0),F=R.ambient,C=R.lightingDirection,O=R.directionalColor,k=n.create(),L=C;a.update=function(e,t,r){e.setMV(t),n.normalFromMat4(k,t),r&&e.updateCoords()};var _=i.create();return a.render=function(e,t,n){if(a.renderList.length){r.useProgram(u),i.copy(_,c);for(var o=0,s=a.renderList.length;o<s;o++){var R=a.renderList[o];if(R&&0!==R.alpha){a.update(R,c,n),r.bindBuffer(r.ARRAY_BUFFER,R.geometry.vertices.buffer),r.enableVertexAttribArray(h),r.vertexAttribPointer(h,3,r.FLOAT,!1,0,0),r.bindBuffer(r.ARRAY_BUFFER,R.geometry.texCoords.buffer),r.enableVertexAttribArray(d),r.vertexAttribPointer(d,2,r.FLOAT,!1,0,0),r.uniform1i(m,0),r.uniform1f(w,R.pointSize),r.uniform1f(v,R.alpha),r.uniform3fv(b,F),r.uniform3fv(D,L),r.uniform3fv(E,O),r.uniform3fv(S,t.position),R.useLighting?r.uniform1i(p,1):r.uniform1i(p,0),r.uniform3fv(S,t.position),r.bindBuffer(r.ARRAY_BUFFER,R.geometry.normals.buffer),r.enableVertexAttribArray(f),r.vertexAttribPointer(f,3,r.FLOAT,!1,0,0),r.uniformMatrix3fv(T,!1,k),r.uniformMatrix4fv(P,!1,e),r.uniformMatrix4fv(I,!1,c),r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,R.geometry.indices.buffer);for(var C=R.matStarts,N=0;N<C.length;N++){var B=C[N],V=R.materials[B[0]];r.uniform3fv(A,V.ambient),r.uniform3fv(y,V.diffuse),r.uniform3fv(g,V.emissive),r.uniform3fv(M,V.specular),r.uniform1f(x,V.specularExponent),r.activeTexture(r.TEXTURE0),r.bindTexture(r.TEXTURE_2D,null),r.bindTexture(r.TEXTURE_2D,V.map_Kd),R.drawTris&&r.drawElements(r.TRIANGLES,B[2],l,B[1]),R.drawPoints&&r.drawElements(r.POINTS,B[2],l,B[1]),R.drawLines&&r.drawElements(r.LINES,B[2],l,B[1])}i.copy(c,_)}}}},a}}]),t}(u.default);t.default=c},function(e,t,r){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var s=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),l=r(3),u=i(l),c=function(e){function t(e,r,i,o,s,l,u){n(this,t);var c=a(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,r,i,o,s,l,u));return console.log("In ShaderWater class"),c.required.buffer.indices=!0,c.required.buffer.texCoords=!0,c.required.buffer.colors=!0,c.required.buffer.normals=!0,c.required.buffer.tangents=!0,c.required.lights=1,c.required.textures=5,c}return o(t,e),s(t,[{key:"vsSrc",value:function(){var e=[this.floatp,"attribute vec3 "+this.webgl.attributeNames.aVertexPosition[0]+";","attribute vec2 "+this.webgl.attributeNames.aTextureCoord[0]+";","attribute vec3 "+this.webgl.attributeNames.aVertexNormal[0]+";","uniform mat4 uMVMatrix;","uniform mat4 uPMatrix;","uniform mat3 uNMatrix;","uniform vec3 uPOV;","varying vec3 vPOV;","varying vec4 vPositionW;","varying vec4 vNormalW;","varying vec2 vTextureCoord;","void main(void) {","    gl_Position = uPMatrix * uMVMatrix * vec4(aVertexPosition, 1.0);","}"];
return{code:e.join("\n"),varList:this.webgl.createVarList(e)}}},{key:"fsSrc",value:function(){var e=[this.floatp,"void main(void) {","gl_FragColor = vec4(0.5, 0.5, 0.5, 1.0);","}"];return{code:e.join("\n"),varList:this.webgl.createVarList(e)}}},{key:"init",value:function(e){var t=this.setup(),r=t[0],i=(t[1],t[2]),n=t[3],a=(t[4],t[5]),o=(t[6],t[7],t[8],t[9],t[10],t[11],t[12],a.shaderProgram);e&&(a.renderList=this.util.concatArr(a.renderList,e));var s=this.mvMatrix;this.vMatrix,this.mMatrix;a.update=function(e,t,r){e.setMV(s),n.normalFromMat4(nMatrix,s),r&&e.updateCoords()};var l=i.create();a.render=function(e,t,n){if(a.renderList.length){r.useProgram(o),i.copy(l,s);for(var u=0,c=a.renderList.length;u<c;u++){var h=a.renderList[u];h&&0!==h.alpha&&(a.update(h,s,n),i.copy(s,l))}}}}}]),t}(u.default);t.default=c},function(e,t){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),n=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],i=arguments[1],n=arguments[2],a=arguments[3];r(this,e),console.log("in Ui"),this.UI_DOM="uidom",this.UI_VR="uivr",this.UI_FULLSCREEN="fullscreen",this.mode=this.UI_DOM,this.icons={vr:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAIAAAABkCAMAAAB5NchtAAAAYFBMVEUAAAAAAAD//wCAgAD//wDAwAD//wBAQAD//wDw8AD//wD//wD//wD//wCgoAAgIADg4AD//wBgYAD//wBwcAAwMAD//wDQ0ACQkABQUAD//wD//wD//wCwsAD//wD//wCnD3VfAAAAIHRSTlMAq6urVquBqyuroRULa6urq0Cri6urlqurq0s2IKt2YQWtHu0AAANCSURBVHgB7Zlpl7osAEfxqhW477Z//2/5NNMZjcIy9WnO/A/3bQn3sMAPEH8Ei8VisVgsFsumZ++9Iuv+G0yvMPO8aHVBMRt1KebsZe/IeIrl4TRaYc8Dqd/jvuLo/4BGNLoBIP2qZn3BmU9yKcZ1G6jFSE6QO4sDiJGsYO0sTgMbMQ4gcRbHf0vAWZ4Ydr8q4IInRrGB9LcF/H9RYAurXxVY/x2BHRwdjTxuAOm31Zimbn2AJs6nCnjgahNY0pG+WqPzlA7pLiGQSzT8xBmmatCQ29kCMUB93oRCBFkEII390MuqaB8IEW7OCqCcKRADKhM/BNEzgy3AOewHkwLcWQIlUIRaWFEgB9pfgtL2m6AAul4A3hVI+vo7DmpoljagDkIjLEDOEPChDsUdGea4kGPYb0MF8WSBCuMWfjI3QQpnIUy6yVSB1jxsAmNgqYBQPFJDOVUghUwYKK5l6rQQDayr/lQBIBy3Vl/wB2wDYKLAGorxu5WEgzAxS2A1XgAYzth/T6Cc1AXBcMh/V2Br+OL1INwvPAiddKDM0zvTMJsxDWNzmQFQmbZCFZqGwIyFaI1xakXQmJdizzheSOZsRoXx9sAUzFyTblhP3Yy6JojE2O04hSJ87ACZdJtF/XYgaYEovK9fJkO5m0Jrg3AFlLMi2REoNn2JHn3GMSYCtRMdmxqIlwilq+sV1zVnym4AJG0DpG1ya0DtHcSFYFcAxLNjucuVQvFNWt39ogVPyTd1zTeyXOBgUvkYzxoxPU3vK+mJE2e+wIXEvTqkx9zR6q+zr2lZaAZOfrw6+GUy92imsdaLK2/mRwTEej7rU+t8ATPytrjIMDX+Z4FYX/lXkC53QbEfcT+AngADBe4nr2hKqO9bTX5SoIHdwwko/5xAwkP+OoP/OYESijHHJY12tEDwsj9Tw61rYRyGhtA4/6rWfAzcQfqpy+oWTuKeEFgvJKCgerEKZsaoGL/4KljmwWILyjx2WejFJIL2+TIcCQP106WgMmsb8W4eytyecn0FOAx81qxvKG8e0RqAkxhJwAvqaZ9lYiybSPEMTxg5Pbf2QvEWh82FzOuJVj8Ewsh+pRHdPiULi8VisVgsFotliP8AcnQzhVuzTBwAAAAASUVORK5CYII=",htcvive:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAIAAAABkCAMAAAB5NchtAAAAt1BMVEUAAAAzMzP//wDNzQ0zMzP//wBlZSZAQDH//wBmZiaSkhpOTi/FxQ7//wC8vBCVlRqLix1MTCyxsRL09AT//wD//wClpRZ3dyLc3Ag+PjCAgB+dnRn//wD//wBwcCO0tBT//wBtbSRiYidhYSeurhSAgCGoqBj//wBZWSlXVyr//wByciP//wD//wD4+AKUlBt3dyf//wCBgR/NzQz//wD//wD//wDCwhGkpBf//wBZWSn//wD//wCqAxrVAAAAPXRSTlMAq6vj4+PkrYGr463hC+Grx+bhq4uW0sCr5ePO1lb1q6G9ufbVq6th47ZA48c29Mura8SrICsVq+O4q0t2ZYJ3CQAABbNJREFUeAHsld2umkAUhTtfMg6Kdi6AhDRDz9yIiQeJRoX48/7P1aDi0NT2NHHQG75LY7IWe6+159vAUwwMDAzMVlmWrap3ye/PXAn2b9FfAGmu9RZYvEF/A3UoGsIcNi/XP8FctKyjl89gXxy0cMzhXL1SPijkVnSpKQiWL5JfJmDkXHRZY4Akm/Vf/cwCSKnEbyC5sOl5EyvLBWnEnwYiALvsu/tE+fyxgaNO6fUoVDEQaSXGDwwYGF8KCXHV4/jTsGndXw0IlQJ21Ys+QC4aNLJ4aKAhB+zOv/7OQrQWXxu4rCGZea9fAtFR/I8BcQQC3wZinIDYIg8PDKzdZfbehQ0wF/8yUIAWLR/A0vPbx4doUelXBlTqN4h7oH18Ql3DYwPUOmz/5YLoKYCpcsMFDEfRJaQAOnMaA5kvA2dXgDUNySIgF100wSKh60CD9XeB2vWqCJJT1SwlCoVDRU3mdqfYOVCRrxzOrAtADfa62YBUdTMXu7ao+wgSXwvocjvzlSVtYxCmLvLx/VyEwN6DflYYI++UkhsHKeV08jn6nEyllAdumFJeMaYonr+HVWZll7Kcju78dLgfv5eldJhs9tT2N7S4z56MHK2844csZZfCPmHhZGmo9djF7Ve7VrfcKA9Dx3uYOgWvC24CAS4ypWx+mmmzH+3sZvr+D/alJHhkQjfIuc25DvKxJUtHcnbQefAPGKRdIvi9nB/v7Os125//koJCKhTB99hC0d9Hy8dWqP70Wb+VX79EH09AEnyHRKERDuRDq9F++q3/LsU5UpjgO4SoRR/R3IsBSWk9SIUwGEYBbMQ5Fh4MVj9Ica2aqueE/ZAXEgPEwqJKlU4rq08m3Oxv979RAPQTYRADKIa2r8ivdmiRdVmZVxq/yq89cei9BjLq1hpDSKVDMkySEIisFz4Y2ffw867WNTB5kIc972YKLtztiw2wDQ7YI7YKieGEGQmAGls3vl0AEAMoT4F61312zxGJL4cEIC0BrNsIAyIGAXP8Klhb3gcnTBn1dyF6JxDs0TAIAF1mLLu4YUTB4aefJJrDU46JxxOooAPyVadlVqMl8CO1pfL2lnEISCA/peYNaVZmo3uAv447Q/YJCN06LjckdOXhYP+MvYQPznEizIM1sGEQyIBivdVQJHLfrZy7gIltwqwxGCDlXENR4guakl7abHiZwL0bUjWAnWQREE9lXTfSbR1+rJgELKJ2JywCFLanmfAIZCmAlBQBPgFq4p5JQKa2xvgSoCb4BEqgSIKkAEpPAtQEn8AGNp1j40fAMcEmEFvhFaLxI+Ca4BMorNSJPQlQE2wCGXRwhEbmR8AxwSZgxW8IJf0IuCbYtyADdFiEVg7yCTgm+ATEkwaIIOYToCb4BNrv4zgmy/MJWBOeBFz41wImgRXVA9cToNXwv7GCZCnGoUrf3t7SSowAQw+82qEYRVXWdRmd5foDAWDnlO4mjpshCf8+tjP4003aCGSNFk5I7tBh5/ZMw/plvC6fWU3WQRqocL01UHSrAMw6WBuQpkUC+yJUgJHnemQ2vjf/2x9KqOTYHlWOA0yeJ3luSMXOsG9bMnWmIRfjX7g/SG/aIurGMnvqAw3cJc/Pz8kdoC3VUyOV0CLOHltOaW9G66qhJwAgeP5CQO5iiS3piQgWnMHtC32eIXV1DcgLBLJujFe4QuqT94Qyad8HCIHWsbmhRoddIDXCfEDGzEc3xzYKFs5UaJsHd9otzE4Q0kZKhUm+ddv5BSMCumxI83ENKNroDF1Dy0ChheXk94o2cV7JZAlAxWT//UREIBsDmKy3/pQ/qHSvwoZsss9gd6EI2Dkhm8E8ulSMFNSFYhS9HwzNPnyHxQ9S+IPOir3H5Y/LSHjDc1pu8Xp8iJsvf98LJq5/L7D/WLkSvi8mlsLL9Jrlpy/+yxMOq8mMv/Zsshqz+g033HDDDf8Db7OIUNFvKHcAAAAASUVORK5CYII=",oculusrift:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAIAAAABkCAMAAAB5NchtAAAAYFBMVEUAAAAAAAD//wBAQAD//wDAwACAgAD//wD//wCgoADx8QAgIAD//wDQ0AFgYAD//wDg4AD//wD//wD//wBwcAD//wCQjwD//wAwMAD//wCwsAD//wBQUAD//wD//wD//wALJkCDAAAAIHRSTlMAq6urgaurVqGrq6trq6sLqysgi6uWq0CrNqt2qxVhSxMoBJ0AAANiSURBVHgB7dnbjrJIFMXxXX8OlpwFEcSD7/+WE3cQpycTKbGmnS/hd8WFbZabWgWVltVqtfqTXTIL6lTLF9SWp05+X8sTtpTfdgTORgUJ3OS3bWBrRnvIvhEgNqMAwjXAV9ZAMNp/KcDT9wMkXwlQRaN8bcEaYA2wBlgDrAH+ywDlcXMK/0X782Fkw3/YdBfxoM5YrulK+UyZ8RnbeTj7VNt98L4izrkLPxhCBxAFZqk0TgBbf/L7k735yPAjQb2r52+6xW5KvbSQ9OZDxfPcWDdAu5OXGu6a+2UG9Mb4SBA+ftDsHbk9D9sXQOfvI0E3fnfCzCEyhCrI4aQDiIwXA7QicoLBbCGcCXA2gf6BvV96kSY6ggaC2T070/0dkB1UxpODjhTQc/xp/sxfwU6vPEmBsoZEs2zkhR3ketNuOgtP9BcddU1FcJQXSp1TDFkIgfFlC5sNHIxJoJZX2sdK8Roghs1JWw3ISyEUes+8BiggfJSgkZemQTUeA+hI50ugxqXiP0AzXwI1laX1HmC+BApITQHWc4D2cW8v8pouvh7wHMDCXle3qPnN2H+A+SeBusFgTO49wLTDyWvjQ2jrP8D4tRuZM0b1HmAswU7U7GbsP8C4tC4yZ9yz/QcoXEowbcaV7wCuJZg2Y78BHEugLuNnvQZwLYGy0Juz5wDuJRjfjHu/AVxLoK76Yb8BXEugOh1X4jNA4V6CaTOuYG98id1LMG3GAxx8vhUnziUYz1Ax5D7PBblzCcZXghRIjR/9VILyjf/JJv6ORlstQQ9W5k3nsxwSf0dDAnN2K8F0PjsAg/Eh4lGCq7jR97ctOrjP7QEq7dVN3JyALar3sAmp7QEtgZMjisTDDPZAnqCsuLqiofsELcRy6QAkaY46irPd1UJkNEESp2aZdAuQ9wHQNFkt76h1I0oj7vJDEbxrf8i5G7QGmbwtRB8G+4RPVGfdCNnJ27rHRlTkLBUV40YYygJ2qkBaxEOUQBs6aYA8GuKzUemyAWgVcjM5uK/i0kKVGvXBAOQC9H9fz7YUNxstcfocQCeLnB6bwDl6s8YZGiEYB9DKMkf0tSyuuGuP4q5ruYvOfa4DWKhhEnbvlijkoZWl6hZls4u8bxeibC2LlVcL4a2UZXbXhvZayv/barVa/QWitTau9tPhRAAAAABJRU5ErkJggg==",smartphone:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAIAAAABkCAMAAAB5NchtAAAAYFBMVEUAAAAAAAD//wCAgABAQADw8AD//wD//wDAwAD//wCgoADQ0AAgIABgYAD//wBQUACQkAAwMAD//wDg4AD//wD//wD//wCwsAD//wD//wD//wD//wBwcAD//wD//wD//wBHb2y0AAAAIHRSTlMAq6urq6uBVqsLq6urq4urq6tAq5aha6thNiAVqytLdhOYuoMAAAOISURBVHgB7Zntcqs4DIZXDzYh2HwQyEfSpOf+73KXE0Gy080MBqfdM8PzszONXl7JSBZ/raysrKysROO2/dZo6Zc/bfabb5PwcYCvAqDbfVv4/xYA5e3t4bcbeC0A0o/3xj/v+ZeA3Wb3ENAC7N+ahxNAW4wCSqAcBSQ+Azi9L/slYAuRQcCOnt0oQMRYoPx4o/3OyyhA8755CPgHB+zPb4kPUEvPSwd66l7BJX78yx5sJb95VQPym8pCt41+/Dqwjdx5cQpUgDRAGltACRj5ImBABShF/LNwAAqZKkByLY1ofAK5TBcgLm4h3oBMRuoXApyXAR+3EEtwMlC1L3uBrWTA6AsiCjugeU4v5Vd7t78Ajl6UKxDrjdg9FUAG7D9fvyltIkoLhzjxN2D9o7hed9xtCtB6PYuRLLhsmEWb2QgWfGw6FrFsTtweWMySUfVzT8/xamQGpqodPd15yeO3hSzA1xbgsJ0TX6efpSQWKLfz4mcy0lRJEEYGvJuloHzuPia3BONqL3fyGQpOwFXuVI6ZZOpDETygnB/P7zP9sToJIFfRR+0LoZ2p0+6nYzZ5JcEUGdofNQuXoJc/Xs3TDjcHkzHOUQ7SIAMSjb/sKFZ2UGBCZrQdWOlprE7Cs2kcUGkSyqkCfg0V6DT+Epz2ch9QBUAzJMDIQhqrL7Tj5En9NmSgVSeWUeljFNBNHsGP+p9WIpCpBVMHpHHAz9WApRg91BlMa8wpFJqBSmLg7q/1GjZTBRi1TKJwvec0gVOIAAOtRMGAu9dUGiggkyiol+ZPE7AKWAWsAlYBDbTRBfxAM1IvQwScIInajmvI793wMHUgqRcPJMY91lUtFCHzwFmrr1qQA29BjRSjv5NNvRl8AIPyWuaR02OlJ1Mnp8/lHRTDWN7MH0QBnYcwd0O76Xfzo/S42SexHh1orBqQT1/aXYa7aQO4BTVQ6+1O9GZ0C1iP5OPl1PkFp6CPT6MGdEHLaTMWk61kLsl4P2/CvmCko/WJrlrmULWP273Ty3FAFeRPV3xc4SWM5toCtM3o5C1wQc5V6+k4LJ+TydSZpYd69kesVJPXY47MI/eP+OWcRWUuir9mhHIsRKln7AlVwfMRNFUyHdPIgM+A7jJ3WZz81K54XJfb2v/Atlw5d7r1rcx3fy9Qtpv9j30xUba7kgWUu2XhVcMp7QimS08afWVlZWVl5f/N39MRN8Py5nBMAAAAAElFTkSuQmCC",emulated:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAIAAAABkCAMAAAB5NchtAAAALVBMVEUAAAD/c3P/c3P/c3P/c3P/c3P/c3P/c3P/c3P/c3P/c3P/c3P/c3P/c3P/c3MpA9IiAAAAD3RSTlMAq1aBK0RuoSCWC4thFTZMP6heAAABPklEQVR4AezBgQAAAACAoP2pF6kCAAAAAAAAAAC4ujLakRgEoSiigLU6//+5m2oEzWTfFps9D2YmNuEErupCSw/wEpklDK7a4DiFwwoer3+HHT5f/1UDDt8kOEcKE0aLIpwjzvofAMiy/GmIHCMjQYewxhgrZvhT2p59WlKAc6uXzD6HRCuGNhJpMzAB0g8dBGoY3DCYR2IViNuo0CcCEgdibccwKdoaN4Ev0hDQSH5eFWAAflXgArhOC9AU6KnMefx0EGBL+s4U6CtRX13vgd8u6SSPXm9U8xDI1vOHhpTyLsCWBA8BTZcUe5olRhPQHlUV8JmBUKqXFjOBYk/CrQIeLViRYgJw61mMLgIpfJNsowBqU1TAaQgKLWaa06QC3gZCa2vmkAT8BKCxWPnattnMy4p9BJRE+PDJ8A/4AWJiB8PyU8H6AAAAAElFTkSuQmCC",strikethrough:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAIAAAABkCAMAAAB5NchtAAABEVBMVEUAAAD/AAD/AAD/AAD/AAD/OgD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AQD/AgD/AAD/AAD/AAD/AQD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AQD/AAD/BQD/AQD/AAD/AAD/AAD/AAD/AAD/AAD/AgD/AAD/AAD/AAD/AAD/AgD/AAD+AQD/AAD+AAD/AAD/AAD/PgD/HQD/DAD/AAD/AAD/AQD+AAD/AQD/AQD/7AD/AAD/qwD//wD/xAD+dAD/XQD+ngD+WQD+2AD/EAD/fgD+HwD+cgD+yQD/AgD/gAD/MQD+RQD//wD//wD//wD//wD/hAAqGgnhAAAAW3RSTlMAq620sAOvqBEKoraSgg68sp1ZJQaln3t2cV0wGRWGlYtWTD84HgjAmGxoQzQgG7iPZGFIOy4sKYgju7urmpRpT01KRjIJGQ25srGkoqCNfWpXU0EyHmExKygcO7Wd2wAAA/RJREFUeAHtmmd+4kgUxNVB3aCAkASSyAgYsgkYjPE4h/HkPBv2/gfZsOrW7gVqvvC/QP9e+XW5qJZx5MgRLGE9aBSMn0YxXPu2PE8Xxk+i4VIiCLHGtcHQwFO661bL5B8kOb/bG1jMQ+AwSv6FjvwZehVOaoSq8z2SDMDnV7axpebnNKrtTANK69TlgmSUo/qiYkApBD4V2fy23Z61DCy7JGLZ+ouyPO+b4PEHMbfV9nM5CYvY21e6dwRR62c7wQsDy4t6h7JsfCZXvRL49oXTqqfkpyKeo+UfuFp+uvQnDfTt/+pIpi4/idZNsPzNdDwS2fik3O2DzWe4rxENs5IBeP2KfTc3f+LXzgwshVl7yfL5U/D4ZmFD9fGcur2mgeUx8alaP2q1+2j554nM5xcTtPmaM4cr9xG2E5yA3Wex6UiuxpedtIU9v7i7udLyC687L8KTv5afetZ0Dz6/1OtW1fyMjDcn6OSdrhjV6+/0CiY4e9xIKlTyF/FjycDSb1e1+QsraRhYmr2uzXT0jOrNIdZ8mkEkqFo/1j5FJ/+zms/LmfzMcrfo3mEeU538KZmEFfD/3vvc/PmyUw8NLIf1FdXuI69vi+DoF06rIyU/oTE6eRe3efInbDw9A0ff1u1Kmz+X13Vw9jAXQcfjJMP7cAqW/+nHpxEjGfTyzcfv2PGfP1+8JJqX776B5f/y9oLkXL5+/2AgeXj/+pLkXLz9Av77f3v3X/kvPj9jz//+8c2ljj5s9OnHE/jvf/rB08nL6wQLdPSqX+vkz6qr2xa4dzibjnX0IcLdFsHyN2KqzX9UnYbg4r94ey3V/IxerQ/wJ5/Okiv5uXMPTv6VcJJ3/jaFtX6arWuxbP4yx9c+rdM20+svoqCJlX/YrEdcRx+7C699Gokl1PqxKrz2KT3GQrmvoPIGHb0KPUcnL8pWKfx3/2ZMmDb/LrrzL+6nlke1+7gN+A+/ridIBru62YHfHFrp/1q3zQK8fieBY4vc/Gcm+slpIriWXybzArz2sShVt99PHuG1j0vz+ekG3bqVUovp45ftWQFf+xBt/pbbR5eug8RiRFPbo6Kf+fDL739nn363rDv/0Tht4nqHXx/+MIzmOiJlffucr7jk/+q3V0+G2Zj4S5on/0EJt/7Pf50/nMci/9ykOg0r6M5/JRlVl79Th7/3B47NtfzOfQn85BNOJNfJn8for33M/rksiyz5syjZoZP/rG3bKvhTPwCPX1nUozLJENxFd/7mrhbR3PzjLfpjp0FCvLzzr53A3/v9EdXJ3wkO6Oy1vzsnMlv/aveuZOAZDmpjixBBKDz5aw5pW9r+Ov/YC0+hEaCffI4cOfInY2NXGby88ZgAAAAASUVORK5CYII=",viveControl:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAIAAAABkCAMAAAB5NchtAAAAY1BMVEUAAAAAAAD//wCAgADAwABAQADw8AD//wD//wAwMADQ0ACgoAD//wDg4ABgYACQkAD//wBwcAD//wD//wD//wD//wD//wBQUACwsAD//wAgIAD//wD//wD//wD//wBaVgD//wAiIyFbAAAAIXRSTlMAq6urq6urK1arq6uBq6ura6sLoUB2Fauri6sgYTZLq5YNLwn5AAADR0lEQVR4Ae3aW5OiOheA4aw3B0gwHEDxYGv3//+V3yfVTkMpe99I2FPtczUXqcrLlNRadqne/mJ9ds03uzy/ZGeVXLvdMdLttq1K6H77xO7ap7r+CwbmoMtGV8a4e0OKhOzITay82L2+aaz3VeSmyxe/fgPgKlseIiOhapoA8JWpJX1wU3weeBT1ZwSo1XKuAMbfrw+m0v93MI6B+9TLFmyBYH0ECNrKj1NZOIDiFIB6yftFAmCsPNAOaOQA1Eve3wzXPBXAiRQLFWyBKCIGtMyIYJcqOAPODwHsZYYBK8sUnLvv+6WAIM+VwP0Mx3aZ+8UCwcsTGjAiSxTc7x9UAIe9TJ2ayHBoiYK+A/zkScEdtPUysGUVuIk/hwpgp16kBkr5YQ3POC0jBdCql+gn9w9s4ZgiNDIV4PqyCWTkgW8K4+4zQe9Pzz6TuXqJHAr5puXflK8PyCDKwEdcI/9kH/+8o+ZlAQpw+9vDOYBgZdaB+1kpgOyVa0h1qvh2khn3E5X48MrXUG07GHSXD+aHkQU2w9nggF2rXqY/cnPsh6kY5bkAxz9nydVL5ZuO+vZIbTc3DhvgfDtRA12mllJDNfcf8KEG5yzr1WIuc/MYaFUC7cx74KFTSRyhfP4ObFQSH6BlsNeFKe77uYZaJZF/B2g3mcMa8pQBPvIj+MQBhXgHuKKxTTH8y0sBV5VEBkYcoEc7WhADWboADfjJPl6mDYjTkaQhJA0IgIycgHQBihsjYwz6lAHuSYBKBHDTmVxCTBtQTNYS76BKGLCBz/FXVOvA+bQBtgQo9ic5lQeA0sImZYCUjJWSOGA/+YpqvNwDki4EtjIOZyo/2UfSLQRTDdSrBmjIf03ABcyqAdmzgGrtAAPZrwlogVUD1H8ywEG/agCgkvkCu2rA5h3wGGDhqJKpQc/8eWK1cfgOKGGnktnCYX4dSD8O3wHpA3pwj9P4otIBUq8DU++ADrxMRDirNcchoBJ6B+ygXDPgcRxa+Fo7YPOrAq5QyFgz3UfSj8MK8sQBUcYiXFRCLeCnHwF6lVI93QoD1CqpC1CN7+es0tr9/KpwH4GtSqw9AkSjTQSoVXJtzR9drtaQbR5+z5xcts23mfq7vf0P/dwpM3Idp1kAAAAASUVORK5CYII=",riftControl:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAIAAAABkCAMAAAB5NchtAAAAY1BMVEUAAAAAAAD//wDAwADx8QBAQAAQEADQ0ACAgACgoABwcABgYAAgIAD//wDg4AD//wD//wAwMACQjwD//wD//wD//wD//wD//wCwsAD//wBQUAD//wD//wD//wD//wD//wD//wCz89QSAAAAIXRSTlMAq6urq6urq6urq6urC6tWoaurQIErIGurdquLlhVLNmEagNWoAAAGW0lEQVR4Ae1abZOjOA+cFRjMS3ghZAKEhPz/X/ms4mkisui5ipdh6662P9wdlRvUltot2cnHvxJ/cT2W0/VPBf+8nUd6oD3f9mZxuPUVSVTTrok/z9GDJiCH427hpxbBrfnByI0Niei8U3hX96Lh4DPqmKVw2CH+0a09Q2QgYgaXz33iJ/WPFSQsxe9mUBJRHP1YR8rkvnc/nvX4jCF8bMj2fjztHB+oQwLGvpz2jZ9nTRDTAuP9c6/4URrTKsbyukd8G5KO8/W74+du9bEdYIyZDQSlqjxss/+6Ob4xJloqL7Q5FyLggEWQ/nyo03hDCp9sP1hwU+CJEfFTw3wyseok5/8zLfB8+U0GLVGBgF9hYMYd/jsjiXBw1oBe+XsufSMiA8FxSrkh1S4fRJSCWJjmXJO0EAwNP/ymS18rogYpD4nuh8NIVET8mCI3hiichZExmxwWHToG/gNDj3e7RFcHJ4qOnxsiiw+CpSc2y23iP7IciGjAywqiElWx7nl4zcCSDzql/8gyEcXivXSYjcFwRaCOcGEUhkuz4OOfg7vIZjEv43AhCusIGnTduIBUo+SRgdwGdohmBlw9D1yQZaf5K7yhYv8hDiTyXFjzE5aln31FDa0TC6P0lED+zGS7mI5CEp9aEmCrIgZcK3ikwKMxnEQ1E7EGzIdCbXlCACu05n+5ZPCHvjoshe/GRJOcELkK8BxGPTRN8BNdWnO74MVHUfdF0bE7+dgwAkTYA8Ihko7F+JyMKTCoeOGe4y8CNTH6twmIIhuiy4fESDREIRjA9xs3n0IiBK9yI6OHBMJ58BA1RJOMmJZjwEPBY9FDx02Z+LmACGeCn+8SECILXqzk5vw4YwbZg0D68N244+mBvYDyyBhOIKwKb/Aj8Mq/5YhwmeYRMLD8z+zhCCls8qkg5NCfwLpDmJAjDvG8L+f9CHN2BYwN0bgdgSOaBBpe1xE5QWBOTWWD5EdY6SYEzq5JSBvsmqZLc36OBhtYs4xfRHCSbQhUixLnTuRxupyd5VRiHgZRbkIAG1TCOAoUpMvjM6bTzOm134rAXXg0KMziCxprHNImFmOsIWrfJhCvExjh0RK5dkgLDRp69X43XiVwlZtsyaEL6RVxJN7h2wuWRnTj2mjIB5sEDkmM+JipPt/uhuZ5CLkvbfCfEQWI7xC83ZH7Z6AMPiZtUAdaNLSKRdzeHkgs3iZqMPGgpCI3ZrC2CYIC8QH7thEcRa0T9BLY4CqigiQK6Qo+TiSWOmATwQZXEdALiqaWH07v78P570P8+eerDb4cg9q2LctyKudrXU8RYvATL+9hg916/Gw5+x6OPXzQl8AkFmvQTi9rNojR8/KSw6l9vgJz7TuoRLDYaUi3wZBoPOh26uGEy3RnToY3dIhXxOtXEf4EMPzm4obmKN1pCYMjsEagJhq9jqep2Met2BkSGNw1An7tmIGE44B8Oyo2iMF9awJXueCGqOo1G4RXqwRS7GNvK8A9nVEkUGk93cuJgaOMOBApNqisT/pm4XlP08pt1y073EqvVRtaDR/y2YmpPGMNqwRCSEBr6Q1S5GNGYSTcVrPhSr1j8KwAcKieabdEnS4BxcxrpQI+Ooy1RtRB4lor8K8AdAgrijQJnLSzhVIBHx2mWiNiZv/3nsugAv46zDnR2jyeaTZ7/toEMTqFvw756B9o02CiSWB0f2EJJfLE5L4JUQ8EhfL+1omGt8B9g6+uM9JdgJQCUOqG9cuHP3BBzSi0CvQKa5ZgIzulP4NxMWMD6JLT2hZ0m8YQFOIPfE1AjbIHxvWcFZFvATRJW2UcLX+Nf/m6Re38ruoVTQ+KBK+rP3cZXHqUQ7HXhGqUA1lfHk+HOVW3kRipi88etQ14U69KEGj7cjpd7xXNl/cp+RdA72xLpLSGJN/85y24tltxQWtSG8Q0I7QRiuP/5bU+3i2RPQem3PGIM9zRbBof490rYmVMjdyPvBD/2wiwzeVKeLTgDUsQr81i3UpdHuGrcqvQ+vVc/utJKTJZsdkPSNSjMpAQIw4SmxqT2iTg2N8UHle0igkB24fXL6ldo7nQCy7txuH1a/rENZrD6VSWfdv25e10+vhO3FEDeS23H/CjImDAtdyOuAgGA67ldgPGss7ybTih0e2MMwlIxe3PYOynjz+CW8k4Xj/+Q/iL/wEs0FUtYkz0LgAAAABJRU5ErkJggg==",daydreamControl:"data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0idXRmLTgiPz48c3ZnIHZlcnNpb249IjEuMSIgaWQ9IkxheWVyXzEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgeG1sbnM6eGxpbms9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiIHg9IjBweCIgeT0iMHB4IiB2aWV3Qm94PSIwIDAgMTAwIDEyNSIgc3R5bGU9ImVuYWJsZS1iYWNrZ3JvdW5kOm5ldyAwIDAgMTAwIDEyNTsiIHhtbDpzcGFjZT0icHJlc2VydmUiPjxzdHlsZSB0eXBlPSJ0ZXh0L2NzcyI+LnN0MHtmaWxsOiMyODI4Mjg7fS5zdDF7ZmlsbDojQTBBMEEwO308L3N0eWxlPjxwYXRoIGNsYXNzPSJzdDAiIGQ9Ik01MC42LDExOWgtMC4yYy0xMC4xLDAtMTguNC04LjMtMTguNC0xOC40VjI2LjRDMzIsMTYuMyw0MC4zLDgsNTAuNCw4aDBDNjAuNiw4LDY5LDE2LjQsNjksMjYuNnY3NEM2OSwxMTAuNyw2MC43LDExOSw1MC42LDExOXoiLz48ZWxsaXBzZSBjbGFzcz0ic3QxIiBjeD0iNTAuNyIgY3k9Ijc5LjkiIHJ4PSI4LjQiIHJ5PSI4LjUiLz48ZWxsaXBzZSBjbGFzcz0ic3QxIiBjeD0iNTAuOCIgY3k9IjU4IiByeD0iOC40IiByeT0iOC41Ii8+PGVsbGlwc2UgY2xhc3M9InN0MSIgY3g9IjUwLjQiIGN5PSIyNy41IiByeD0iMTYuMSIgcnk9IjE2Ii8+PC9zdmc+",gamepadControl:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAIAAAABkCAMAAAB5NchtAAAAYFBMVEUAAAAAAAD//wDAwAD//wBAQACAgAD//wDw8AD//wD//wCgoAAwMADQ0AAgIAD//wCQkADg4AD//wBwcAD//wD//wD//wD//wBQUAD//wD//wD//wBgYACwsAD//wD//wCi9gSrAAAAIHRSTlMAq6urK6urVquBoaurq6sLq6uLq0AgFZarazZLq6t2YfI1sDIAAAUFSURBVHgB7ZnJdrM6EIRDScwDiBkP9vu/5ZUs+lpxbEmELP4F3y7nGLro6kGQrwMHBwcHBwcHB7yPJSe++cKRn+WFZz7uCD6eUxBIz7X/ladlAjEtp1+GX/DC4vk0PUUnpn57+PqOB4JFEpZAkcU+prV4wHJ5Yc5WCVs9HCZIyq4KVqpOQNI6kxBDkc8BMedQ3DfF7zMVPgy+cREAshO3skDSBN9pILnVG+JDEgU/aOBDWQSvFCWA1lvBACApgjdcEjjJybRcQOTkYQ5g8a2/7Gd8omAuGrJea01CQ0HsJyCl+HuoKFeJmYPBa4gAuAR7yVW9ymI2KlIAqY+ACbgGRIiVYCMl0OtyZua9uF8Cqv0CAIxrPQdE7pWCG9XxPgEMOMu7nSkDigrA2dkCAApTgBL9CwERgJjHAKJvqlIPB0SwS0CVJ0BJEwPJfAUSPQ86YHKPcirbC5OUJIApfJqzWCOX6xxoQPNAe+AxBC6URAUJeBAGbgRWLp2U3M1YSQKJRx9kQLFHwOVRaGMLlIHiCrT8i2e6Fhhwctfgs4wWLpHTiytaLwFXvXhHuk8C8Oc8aJzjmAMlCXj5ceolgJ6RBKyucy2gA252AWfg+hSQxpJeVqZi8hLQ6BCcBAjd+nd93xBonU0QBXtqIARw43H2CFisS5AvtF8AeDXBji5gVPUdA8DmBJrSmNAWjDyHkSQnAZGiCrwVUP+jERRfwVx9SNbtGcVzzlgXQpJBUnRXdqW05o424IB4FdByvk0ARZqGx+E6f1kRd8cmYAGxaxsK3Y4nSv7KDKR+m+CPzgPjOoOJAsgch4Hu/SE02AjTZsdmSj36kKbdfjoAS7/g9YmEvQ0AOFottAssQrq+NPqfcK6j0WF2yCBhHzXkCQARkYIf8Z3riAPMOudXGutRhILODWvmN9bc7KvIbivaFpLo06tIlpKCD4TWPrzTrd9RrW/nY/u+UnJ95q1juO5ibYLZloCp/pLUE9C97fyehomwDojavYosJ/3/D/vMpAhC0Im3tvZSaetDaxPQIqNahUlomps6nqO3fBdIAteVdMCrYBLRYYcOtrY3lti6iixXUoQUaPSe1CxA8xDESV9i7aWb3yp6pVq/89TLw+MGWL69TTEg4+qvDMh/14cLEDnmUJammZ5EydPLGsr0ApI2bUEJ2NqH9uKZI9XpK/nDkMxUXhofkJIimK/b+9BePAku0j8BiehUIs1aGrSogml5lZrKoU8f+nfhdd2rRRgW69ey9tsI1b5XYRiuW0Fs70P++aoZClbQCziAbDCvbc0PmxEUjX8furuQ3C2jrosYnvGJuoVENNElutKPQ/8+dHXhVQW8wSAdfy4yg2logdK/Dx1dOOs9x1OstO9MHBZQ+Lh+1GXk34f2LkxI89jHyxL3n16u6lN8v8XxQPn80FMA/LuQDKCYG5iAclsfArAYsBlumOB1Lh0AYTFgO3cywfNcSifS3QYQNZngOQgGINlvgMMEyoD/WwkZsN8EdxG2QOdrgL8J4t0cqD+9FYg/M8Bck4Trm3mdvVpW7TKAxtH8OonRW359eXErq/2j+fz/p6BF/pYWZg5CATUy9jFmQNI9PU1okX40AeJC//CkZO1iyACw9Z7Mfk9a6xCMAbvjmwqAkpVQZI6cxhlApJSrfdQLntxG58/PrVa68K+/YrxPUEzL4Jk1zuuvP4bTPf81Dg4ODg4ODg7+AwlERtddq/a6AAAAAElFTkSuQmCC",fullscreen:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAIAAAABkCAMAAAB5NchtAAAAUVBMVEUAAAAAAAD//wCAgADAwABAQAD//wD//wD//wDx8QAQEADQ0AAwMACgoADh4QCwsABwcABgYABQUACQkAAgIAD//wD//wD//wD//wD//wD//wCYxtj5AAAAG3RSTlMAq6urq6tWK4Grq6urq6urq6urq6tAFZZmiyDXexdmAAACxklEQVR4Ae2a3W6cMBCF6wMkMeYf2qR9/wetdiPnDJtEYs6ialX5u9obW9/i8Qwe82NPofDz6Vt+/ZN5XvAtzx4BYZ7HEeirLxgcAto8HNiEL6h9Avo8RaAIPJRAY0h+gakhmyTQn5aIYqctQcJJLGIMbBGnsMpBuOAMkhKEU7hSAZiDTpuA2L7/nF0C6LIxI0igx8cTHSufQPaOQGqDyAygys/SKYA6XGkAjEGjg53GJ0D1CcCkBcAADHyQXgEuHgAlDOzAGopA3D7+SBTCoOKjWyEJINml9GKCZ4EogNUGsw+zfbaoCawAFrudXZgEkoCYBIHrwI4JbQsOLvYz7ZdaEdj4FLvLz3AErnrP9VuDJBAaTrMwIg6w0feiXgdRwNYiRsQB8oqxGikCOYGYUKqOMVJ2vIavLtBGYOBmcr+DTNx+mkDomE4aHKcOZrRXIPOpFi3VYdrbalQj4xLgKiowgnQBxrEX7iGHAHnOy8idLFWj3sg8cXqPAGuRXI10gUyvvJKMrEaygH23aoQInMJJAqHWBJoiUASKQBEoAkXg/xFImsBylsAETWBozxHopD6VHaULmNORB56K3AJvL1d+A3HXapC7lHxDfH1554/vXKB3a+2JQj+Y2Lf7rjkM2xq1S4A3HVmg3XVJjmK7I1UW6Hnz4jgd7/pEDmx/SD6ef+411ccYbrpbusCi9QpveoRJFOBodku1LumqCiS5X3zTJ14kAUaQs2POAYxjRWDe95om4a6AYZAEAWYRoRrddreiIJBXndVIrUWV2q5vbK/JzWhmkASs/3znnWFUBGpbjQRsLWoEgeH+i0OTPSe/gN3FQcRmEq/AZG8+VFqbS30Co7350OlMNfEJMIkN1T30TKetQyCTzv6AwinQ4xxipwnM2PH25OAVltRKAtN5X9N1FChfUhWBIvAAH7WW74of7NPuQuEvZ9lH5JznAfgAAAAASUVORK5CYII=",world:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAIAAAABkCAMAAAB5NchtAAAAzFBMVEUAAAD//wA5OTlMTExGRkZBQUFTU1NiYmJZWVloaGhdXV2cnJvQ0BCqqqr09AOLi4vp6QeenhxLSzpbWzR0dHSurimysrGioqLa2gmUlJSBgYHt7Qvh4Q9iYjl3dyfY2BfCwhFMTD2mpifJyRu0tBRwcDFrayqHh0mIiDGEhCT39wOTkzW7uxmoqBhOTi96elN8fDxra0CRkSBgYFDX10qZmSjBwSDr6ytKSj5JST3ExEyzszOAgCGbm0O7uypNTT1CQkHFxYWoqHdBQUF5xNXLAAAARHRSTlMAq6urq6urq6urq6urq6urq6urq6urq6urq6urq6urq6sLq6urq6urq6urq6urraurq6urq6urq1Z0q6urq6sgRaurkO+wxToAAAiSSURBVHgB7ZgNc9rGFoZ5F4RDortZSVGuXEkgEGC+P7BxndiOm/b//6e7R0cSi+VprzDOnTvjp51px+OZ98l7zi5LGu+8knfesf743+Q+WZZY7YYqdZylPdxPRrHb/3Xpljd17KXjhAASH4DttlqW5tuvSHe7duKMXMvq+hI59u0iHWya2qL1xhPpe8NlLCzLnSRysW1tfTUYDNJw0mzGk4W091uSeMP4qTMWOj5eSDVxW83mVqZNzQDpdVOz0T8fxM03U/ASj+JHNtSk1WrpxAjzZrPdbs8hJ+2MeYR08zYK35Kl0PmxDTng+OYAuM5zAb/NbGzYm+35z0R3Bl2/uwDsOM/fStgc+uGDD/SuPxBaIUIkJ9Z5p/+QAInoSsh9i/KJW2CQpRO3QKQN2GGugH3rnPU/CBtAAKi4zN8C2HA8ER0MrrUNok3rbGOwhBA7aGbRIb89AJAnftSsJRno/7nm+2EGv/XHufKJBTLSScz5bQmEHM/MAUTrxxQZ8+sIkXt3vvwpEIJR6WCyaVNez8i/uLLDUILprbO1UNu7c+UvASxiX+GAVCr64RO9Xi/CgdntWgtpgzkkG7w+f0j5lh7/dp8q/A2zMF1fXFx8PBg8vXL/BeFk+Va+gPFmP0gjiSPCXu/et6HRAprSIO6/6vwX80dQ5PMGtjnrKoMiO8Q6U+k8M3iNgCDGAJR7EGhrrkHQ7hGdgntoflwcGUStVy7ASgKIOb9VFDCBJuL8zoEvM2iujA7aPhYnXwdPrs53AwA7yyiAuIWmZ+R/Ye55CKaBjcmpAt3iANrWQYANwrJrTv+tYAbNfWlAF7OUo9PyV3a+ANKjfLOBLQif83X654LfvoNYGwbtDeRpJ2GohHAVAMcooJ0JzHMBzufsS/4PiFT//DCEBbqn5LvAMLsBlKhM4BbEVZl/eXn56dOnS3K4KSrolBWkCE+pwAOQQDOyKg1ELJDnUzqjHf6sVKBtZ/EpR1ACkIAtrOcNfEDGmvOz+H9rWCE8ruCKZFVUvwK+AIFwxxMwG9gggwoo8v+lYYfvZgVXPCwf8SmXMBtA7bxnKzBABhdA8TqfIYOynrUfIWPeVotTLuEVJJjAH5kr8IO7KQrg+CyfDHgNf9xHYKI1HZu7EwSGwIwVWGKyyRvogeh1OlkBnP/161d2oBlIiYLwkZ6p1zKuP4FsC3fjIQyU7evnEFiAJpAX8DXj58+bm99DGKTz7DZsNxdJPQGrWAFXCHe6kC+8PELV633//v1GZxIv/Ir92CnuovYW/doTSAAkQmNZVrxfBKjBTM5mfA5ygaby6gq40ExZgE+BfgnZEf4B+fvNDTIejwQWk7oCXZ6A5vgiut7cypCIer2QIzP0LH7+/JqtoQSRUn4pMPHr5Lf4DPAEKjdhiox7XkLewRwW4ArCI4EYdXdQAdhVBOgisAuBjnEKmPIgElemQFP1T1gBzxQoK5AoPou+lPeAWcCnP5Hh5/ksYHv1BMbQiIoAVYCDQF6Bpvzza4FLZNweCQxqCjgAbEPA2EIUDRdXIRkUUP7nCER4JLCvcxe6vINLUalAszEEik+jMp7yL/NXCcp8Ehh16z1HbQC7fxAgg/I9kMdTAZ/LLTQF6lwEy5UIAIzFSzOYlwKFAStQOr/LfntExuPHwwSak24dgcCFZlURIIMBmPVHNjh6lF3S0/jLFTJ8owBXjeoIIIBGFLwo8OFjaaAVmM9ZfqeDjJTyWWAbYVpnB4DZzBQwDUqB3IAVGIrX+blAryxgL4E6DVgKgJy9LLAwBD4++25E8ZqLXi7ABcwVgKDWPeBJaJTz0hbYhYDG+Hr6hehkXLAA/8p2oED53ToClnBDZAQ7zxQgCoE2G7DCgQsiF9DpETJSd9eowZ0Qh+egGk4906AUYANW0OThhkAYglHzlrWr+R5QgFQokLYzHbGBIWAqGOi/NEzDkP05vtlsWd2aAhQjvKGsPElHQSHABqzAFuurue/3IhjIW3pLt1rWqKZAQgKa8TJAFaVJB4OBz9z2NBIVlD+hS5AEXK/mq9jhBxnhdpc2aqPCGZWU51vdp5rfC7r8WVASd53kv9SIUt9GRpnPK1AHseI3sYmlGY32gdJU+pZ2r/fD96+urj9oWMDmfCrA8mp/O1eAUxEgbDBNpm1C9x6RCxj5d7W/HQ8Bu4zO/hVVgaqCKbAoB8ATqAUtgRTPOBJoFfkvOEgQgzKfz0At/hIS8ESlA0OgZSocSTSRMSnyrW6/URuawU4851iADdiBLZgtMmKKp3wRN+pjjYFAiGoHS0OAFQwJ/mcCQlI+CYiHmgUwXQWsRAXLMQRYocIARMrxJxTAeDbgVCsQhYBVGFQdUhD7It+pXQDjSCjxDMsQKAwqEi0JIuZ81/Yap/GkZrPpcToxKgQ0h3jTJQYRcLwjh41TcSVCp7IGhYBrmQqmx54nYFmW50gEd42T8SSAZLo66sAFM7JyWs9JQXjeJAGQWI3T6Tv8MAuWXVeUHAtUJdgwCKCxx6LxGu4CDBNkqMQZe4IIqgIm3jJUEhnDsRD9xquwJDx3mkjkBPbSKQSEOModjSaObwfIkcmUWvuj8UpcGQiNt0sUDFimAM+QSj6IjG+NV+NhKBh3vFvaAf4WZfMbcnimfDaYChP3ATOlCWwDx3F2o5FLXUEj3fPkM55kgxIFwhEvMoRmeq585k5NqxmwxUusDgPoN85Gf3lkMH1JwOKb2gYQZANonJXx0NwCENLILtkVC2A1zszdcixKEhCCMSU8yvfEatVvnJ+u44mcMYhxdQEkEKy6D6vGm9DvRsVngl2uuokbAPYi8RpvRj8eyiBxuuMx7/oR44dIyZnD8W+HpS/lAEColHJyEju7IFW0WH1r/AIsPexxcrgLh9qh6wSLMaf/Ep4sMXakLNfQi3nvfz1/3TX+z3nnnXf+A3ZJ6hYGox7HAAAAAElFTkSuQmCC",gear:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAIAAAABkCAMAAAB5NchtAAAAYFBMVEUAAAAAAAD//wCAgAAwMAD//wD//wDw8ABAQAD//wDAwAD//wD//wD//wD//wD//wDg4ACgoAD//wD//wDQ0AD//wD//wBgYACwsAD//wBwcAAgIAD//wCQkABQUAD//wBkLwXoAAAAIHRSTlMAq6urq1ahq6uBqyBAKxULq6uWdqtri6urS6urNqurYepOiRMAAAQVSURBVHgB7ZrdkqI6F4a/PIEAQeQHAVGx7/8uv90VndG9yMGQNFO7yue42/VWsv7D/z58+PDhv0tZ3VJHVR13t37oeKf42lXEDcltTwEpkFm76G8WawHSPQUUcFevaBj2FDBCrl7Jofhxqy9eBqg3EjA/bH7uKMpnBEKm3gF+xWdPN8c2XxcAPH63AqveaaB6RCgARR036XQ4+tpFoRBgH3FYDzhMGTPsDXDOG6Ar/3GGHlr1zuLElSOQ5S1gDvHSHsBFKXUG+OoBcvXOxaVDcIczZcAhov0sf5pxtOrfnHigXVhIBUH2E+VIGoCTVpJLA9DkL38ZRUFpnvYd03m5qnUSraf3M6EKzz7O/haSDExwjRyd/c0Kxjq87E1qK3fgK+wCgEVtRwNlYAQ0KoRT4BGUQKICyCCsLnVwUtuxwXFQAecgFzhE6P5atY2cGI3aAORqEy4NBDP63OC+WIDM6nU/bSM1BUdASXTGb06TkkQrhwZ5B/eMd07iFBIg2hQkTxcww+07xMpDD2sZu4l0Ar30gRNg5pdbGgC0DMIxsBWuDmk/Anf1Riu73qqTZ5AA45DOG2fnsjc8sDK9DELsKMP1zJOu2hJ9HvvXp32poJGtsmNDQi4BTlZfcumAdPX6fwg3uN61Plu2BOQBrFrj6u30Usi8NSHdUAO0WmPxzsG1ce4qmaDfEHwXX4vhO84vUbcChvfCV4IAX4GpfP1TAl0sATn4fwtQqwAbWqHkj0+zgzyWAODPr7P42wJGyHe8ggAfCHDCK+DNnnsIUJl/JzqD9d9brETUwuC/totfQKxUfAeO3tbp6qsFQ7RipBpPYq877wTRQrqpHNtWa9mPeorrgDyAaz7p1rJpVVLgW0idVxUMgPYtrjD1nzeEg+HBSV4Cs7SPFUqf9OW2kaRKXVM6ydUL/asnViNSpwKKwjWlIXzJ+ThpAIbb0/0L1uxPMEbZ0stO63m6phjSvgCAZe1v5livE5NMBw2v2FwJRMKIvKa5txmOpk3UCpHekeoOrFonyS/6ksvsF3U877fvqTIX/2HMwCVgU1qEO0DAkmoKdwMTtqlsQyPhFrqobGD+q6vac+Ad1ECrtnMBDrsFgSQB+ghp4K62cc3cKiGIOuDJ5ASmjP9otSw+Pcli9fXNfvxns+QE0Kw9nOkGILsL+3EUTM/k6pDZoX1vIZNGvBeFKUD/fp81IJskgGE2j63tXTychiuw11/rrlTmJ+12l8cCyKYFYT+M44ijc14N+FJeisNUcT9gGADoH1EtZxALD4uVARiP8T9dorvJ2VkI+F5dmy794Y9YBrhE7UCDZ+crsKN9+RHJBMWeAiqAxp71N609wc5fUtUGQbXvx4R9xyum39W+o6rm9Ju52t/4hw8fPkTk/7PwOIFSnWjiAAAAAElFTkSuQmCC",backArrow:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAIAAAABkCAMAAAB5NchtAAAAJFBMVEUAAAD//wD//wD//wD//wD//wD//wD//wD//wD//wD//wD//wD1AQnGAAAADHRSTlMAq2uLC6EgdjuBKxXxMof/AAAAfElEQVR42u3ZMRaCMBREUX5IQGH/+8XC0tbMUe7dwJsiqf4CAAC/4NzH+gj2t1EvR7hfe7hfz3C/Qo+gr+9+09fX19fX19fX1/++raZpffmgJmrpAXX7AS3+CPPf0AILLLDAAgsssMACCyYcLAInm8DRKnC2Cx4uAQDgX12bvgZPVbPIBgAAAABJRU5ErkJggg=="},this.util=i,this.webgl=n,this.webvr=a,this.controls=null,this.vrButton=null,this.fullscreenButton=null,this.worldButton=null,this.poseButton=null,this.exitFullscreenButton=null,this.exitVRButton=null,this.bubbleArrow=null,this.cssProps={none:"none",absolute:"absolute",rel:"relative",ib:"inline-block",click:"click"},this.styles={controls:{position:this.cssProps.absolute,zIndex:10},modal:{zIndex:50},button:{backgroundSize:"cover",backgroundColor:"transparent",border:"0",userSelect:this.cssProps.none,webkitUserSelect:this.cssProps.none,MozUserSelect:this.cssProps.none,cursor:"pointer",position:this.cssProps.absolute,top:"0px",left:"0px",width:"64px",height:"50px",padding:"12px",margin:"8px",zIndex:100,display:this.cssProps.ib,boxSizing:"content-box"},emu:{zIndex:101},strikethrough:{zIndex:102},progress:{zIndex:7999},menuContainer:{cursor:"pointer",position:"relative",maxHeight:"180px",overflow:"hidden",padding:"9px",zIndex:8999},menu:{width:"100%",height:"100%",margin:"0",padding:"0",borderRadius:"2px",overflowY:"auto",lineHeight:"18px",paddingLeft:"0px",paddingRight:"18px"},menuItem:{margin:"0",padding:"0",border:"2px solid #abab00",backgroundColor:"white",borderBottom:"0px",opacity:.75,listStyle:this.cssProps.none,textAlign:"center"},menuActiveItem:{},menuContent:{},spinner:{zIndex:9998},tooltip:{position:this.cssProps.absolute,fontSize:"14px",lineHeight:"16px",fontFamily:"sans-serif",padding:"4px",padingBottom:"0px",borderRadius:"9px",left:"0px",top:"0px",backgroundColor:"rgba(248,255,164,0.7)",zIndex:"10000",display:this.cssProps.none},bubbleArrow:{position:this.cssProps.absolute,width:"0px",height:"0px",border:"10px solid",borderColor:"transparent transparent #880 transparent"}},this.vrHandleKeys=this.vrHandleKeys.bind(this),t&&this.init(this.UI_DOM)}return i(e,[{key:"init",value:function(e){e||(console.log("no mode provided, setting default"),e=this.mode),document.addEventListener("webkitfullscreenchange",this.fullscreenChange.bind(this),!1),document.addEventListener("mozfullscreenchange",this.fullscreenChange.bind(this),!1),document.addEventListener("msfullscreenchange",this.fullscreenChange.bind(this),!1),document.addEventListener(this.cssProps.click,this.clickChange.bind(this),!1),this.createUi()}},{key:"initNoGL",value:function(){this.modalMessage("WebGL is not present on your system")}},{key:"initBadGL",value:function(){this.modalMessage("WebGL is present, but failed to load")}},{key:"setWorld",value:function(e){this.world=e}},{key:"setControlsByMode",value:function(e){switch(this.mode){case this.UI_VR:this.exitVRButton.show(),this.vrButton.hide(),this.fullscreenButton.hide();break;case this.UI_FULLSCREEN:this.vrButton.hide(),this.fullscreenButton.hide(),this.exitFullscreenButton.show();break;case this.UI_DOM:this.exitVRButton.hide(),this.exitFullscreenButton.hide(),this.vrButton.show(),this.fullscreenButton.show()}}},{key:"hasPointerEvents",value:function(){return window.navigator.msPointerEnabled||"PointerEvent"in window}},{key:"clickChange",value:function(e){e.preventDefault(),e.stopPropagation(),this.worldMenu.contains(e.target)||this.worldMenu.hide()}},{key:"createUi",value:function(){var e=this;console.log("entering DOMUi");var t=this.webgl.getCanvas(),r=t.parentNode;r.style.margin="0",r.style.border="0",r.style.padding="0";var i=t.parentNode.querySelector(".webvr-mini-controls");i?this.controls=i:(this.controls=document.createElement("nav"),r.appendChild(i));for(var n in this.styles.controls)i.style[n]=this.styles.controls[n];if(this.tooltip=this.createTooltip(),t){var a=this.webvr;console.log("creating DOM Ui");var o=this.createButton("vrButton",this.icons.vr,0,0);o.tooltipActive="go to vr mode",o.tooltipInactive="vr mode not available",o.inactivate(),o.show(),this.util.emitter.on(this.util.emitter.events.VR_DISPLAY_READY,function(t){if(t.displayName){var r=t.displayName.toLowerCase();r.indexOf("vive")!==e.util.NOT_IN_LIST?(o.src=o.src=e.icons.htcvive,r.indexOf("emulat")!==e.util.NOT_IN_LIST&&o.emulated(e.icons.emulated)):r.indexOf("oculus")!==e.util.NOT_IN_LIST&&(o.src=o.src=e.icons.oculusrift)}o.activate()}),this.util.emitter.on(this.util.emitter.events.VR_DISPLAY_FAIL,function(e){o.inactivate()}),this.vrButton=o,o.addEventListener(this.cssProps.click,function(t){t.preventDefault(),t.stopPropagation(),e.vrButton.active&&(console.log("clicked vr button..."),e.vrButton.hide(),e.fullscreenButton.hide(),e.exitVRButton.show(),e.mode=e.UI_VR,e.fullscreenChange(t),addEventListener("keydown",e.vrHandleKeys),a.requestPresent())});var s=this.createButton("exitVR",this.icons.backArrow,0,0);s.tooltipActive="exit from VR",s.tooltipInactive="",a.hasWebVR()?s.activate():s.inactivate(),s.hide(),this.exitVRButton=s,this.util.emitter.on(this.util.emitter.events.VR_DISPLAY_READY,s.activate),s.addEventListener(this.cssProps.click,function(t){t.preventDefault(),t.stopPropagation(),console.log("clicked exit vr button"),e.exitVRButton.hide(),e.vrButton.show(),e.fullscreenButton.show(),a.exitPresent(),removeEventListener("keydown",e.vrHandleKeys)});var l=this.createButton("fullscreen",this.icons.fullscreen,0,72);l.tooltipActive="go to fullscreen mode",l.tooltipInactive="fullscreen mode not available",l.show(),this.hasFullscreen()?l.activate():l.inactivate(),this.fullscreenButton=l,l.addEventListener(this.cssProps.click,function(t){if(t.preventDefault(),t.stopPropagation(),e.fullscreenButton.active){console.log("clicked fullscreen button...");var i=Math.max(window.devicePixelRatio,1);e.oldWidth=r.clientWidth*i|0,e.oldHeight=r.clientHeight*i|0,r.style.width=e.util.getScreenWidth()+"px",r.style.height=e.util.getScreenHeight()+"px",e.mode=e.UI_DOM,e.worldMenu.hide(),e.requestFullscreen();var n=new Event("mouseleave");l.dispatchEvent(n)}});var u=this.createButton("exitFullscreen",this.icons.backArrow,0,0);u.tooltipActive="exit from Fullscreen",u.tooltipInactive="",this.hasFullscreen()?u.activate():u.inactivate(),u.hide(),this.exitFullscreenButton=u,u.addEventListener(this.cssProps.click,function(t){t.preventDefault(),t.stopPropagation(),e.exitFullscreenButton.active&&(console.log("clicked exit fullscreen button..."),e.exitFullscreen())}),this.exitFullscreenButton=u;var c=this.createButton("worlds",this.icons.world,0,144);c.tooltipActive="Select a World",c.tooltipInactive="No Worlds Available",c.activate(),c.show(),this.worldButton=c,c.addEventListener(this.cssProps.click,function(t){if(t.preventDefault(),t.stopPropagation(),e.worldButton.active){console.log("clicked world scenes...");var r=e.worldMenu,i=r.buildList(e.world.getWorldScenes());r.activate(),r.show(i)}});var h=this.createBubbleArrow(c),d=parseFloat(c.style.top)+parseFloat(c.style.height)+parseFloat(c.style.padding)+10,f=parseFloat(c.style.left)+parseFloat(c.style.width)/2-parseFloat(c.style.padding)+4,m=this.createMenu("worldMenu",null,d,f,null,null,h);m.addEventListener(this.cssProps.click,function(e){console.log("World name:"+e.target.innerHTML),console.log("CHANGING WORLD TO:"+e.target.innerHTML),m.hide()}),m.addEventListener("touchstart",function(e){console.log("start touch")}),m.addEventListener("touchmove",function(e){console.log("touch in menu")}),m.addEventListener("touchend",function(e){console.log("end touch")}),m.hide(),this.worldMenu=m;var v=this.createButton("gear",this.icons.gear,0,218,null,null);v.tooltipActive="Configure",v.tooltipInactive="Cannot configure",v.activate(),v.show(),this.gearButton=v,i.appendChild(o),
i.appendChild(s),i.appendChild(l),i.appendChild(u),i.appendChild(c),i.appendChild(m),i.appendChild(v)}else console.error("Ui::createDOMUi(): canvas not defined")}},{key:"createUiElement",value:function(e,t,r,i,n,a,o){e.className="webvr-mini-"+t;var s=e.style,l=this.styles[t];for(var u in l)s[u]=l[u];return this.util.isNumber(i)&&(s.top=parseFloat(i)+"px"),this.util.isNumber(n)&&(s.left=parseFloat(n)+"px"),this.util.isNumber(a)&&(s.zIndex=parseInt(a)),o&&(s.display=o),e.draggable=!1,e.addEventListener("dragstart",function(e){e.preventDefault(),e.stopPropagation()}),e.active=!0,e}},{key:"createButton",value:function(e,t,r,i,n,a,o){var s=this,l=this.createUiElement(document.createElement("img"),"button","webvr-mini-button",r,i,n,a);return l.name=e,l.src=t,l.tooltipActive=l.tooltipInactive="",l.hover=!1,l.addEventListener("mouseenter",function(e){var t=e.target;l.hover=!0;var r=t.style;r.filter=r.webkitFilter="drop-shadow(0 0 6px rgba(255,255,255,1))";var i=t.parentNode.querySelector(".webvr-mini-tooltip"),n=i.style;i.status="visible",t.active?i.innerHTML=t.tooltipActive:i.innerHTML=t.tooltipInactive,i.tid=setTimeout(function(){"visible"===i.status&&(n.left=16+parseFloat(r.left)+parseFloat(r.width)+"px",n.top=2+parseFloat(r.top)+"px",n.display=s.cssProps.ib,i.t2id=setTimeout(function(){var e=new Event("mouseleave");l.dispatchEvent(e)},3e3))},900)}),l.addEventListener("mouseleave",function(e){var t=e.target;l.hover=!1;var r=t.style;r.filter=r.webkitFilter="";var i=t.parentNode.querySelector(".webvr-mini-tooltip");i.status="invisible",i.tid&&(clearTimeout(i.tid),i.tid=null),i.t2id&&(i.t2id=null),i.style.display=s.cssProps.none,i.innerHTML=""}),l.emulated=function(e){if(!l.emulatedImg){var t=document.createElement("img");t.style.position=s.cssProps.absolute,t.style.top=l.style.top,t.style.left=l.style.left,t.style.width=l.style.width,t.style.height=l.style.height,t.style.padding=l.style.padding,t.style.zIndex=s.styles.emu.zIndex,s.hasPointerEvents()?t.style.pointerEvents=s.cssProps.none:t.addEventListener(s.cssProps.click,function(){var e=new Event(s.cssProps.click);l.dispatchEvent(e)},!1),t.style.display=s.cssProps.none,t.src=e,t.name="emulated",l.emulatedImg=t,s.controls.appendChild(t)}},l.strikethrough=function(e){if(!l.strikethroughImg){var t=document.createElement("img");t.style.position=s.cssProps.absolute,t.style.top=l.style.top,t.style.left=l.style.left,t.style.width=l.style.width,t.style.height=l.style.height,t.style.padding=l.style.padding,t.style.margin=l.style.margin,t.style.zIndex=s.styles.strikethrough.zIndex,t.style.display=s.cssProps.none,t.src=e,t.name="strikethrough",l.strikethroughImg=t,s.controls.appendChild(t)}},l.strikethrough(this.icons.strikethrough),l.activate=function(){l.active=!0,l.emulatedImg&&(l.emulatedImg.style.display=s.cssProps.ib),l.strikethroughImg&&(l.strikethroughImg.style.display=s.cssProps.none)},l.inactivate=function(){l.active=!1,l.strikethroughImg&&(l.strikethroughImg.style.display=s.cssProps.ib)},l.show=function(){l.style.display=s.cssProps.ib,l.emulatedImg&&(l.emulatedImg.style.display=s.cssProps.ib),l.active?l.strikethroughImg.style.display=s.cssProps.none:l.strikethroughImg.style.display=s.cssProps.ib},l.hide=function(){l.style.display=s.cssProps.none,l.emulatedImg&&(l.emulatedImg.style.display=s.cssProps.none),l.strikethroughImg&&(l.strikethroughImg.style.display=s.cssProps.none)},l}},{key:"createModal",value:function(e,t,r,i,n,a){var o=this,s=this.createUiElement(document.createElement("div"),"modal","webvr-mini-modal",r,i,n,a);return s.name=e,s.show=function(){s.style.display=o.cssProps.ib},s.hide=function(){s.style.display=o.cssProps.none},s}},{key:"modalMessage",value:function(e){console.error(e)}},{key:"createProgress",value:function(e,t,r,i,n,a){var o=this,s=this.createUiElement(document.createElement("img"),"progress","webvr-mini-progress",r,i,n,a);return s.name=e,s.show=function(){s.style.display=o.cssProps.ib},s.hide=function(){s.style.display=o.cssProps.none},s}},{key:"createMenu",value:function(e,t,r,i,n,a,o){var s=this,l=this.createUiElement(document.createElement("div"),"menuContainer","webvr-mini-menu",r,i,n,a);l.name=e,o&&(l.arrow=o),console.log("ARROW IS A:"+o);var u=document.createElement("ul");u.className="webvr-mini-menuList";for(var c in this.styles.menu)u.style[c]=this.styles.menu[c];return l.appendChild(u),l.buildItem=function(e,t,r){var i=document.createElement("li"),n=i.style;for(var a in s.styles.menuItem)n[a]=s.styles.menuItem[a];i.innerHTML="<div id="+e+">"+t+"</div>",n=i.childNodes[0].style;for(var o in s.styles.menuContent)n[o]=s.styles.menuContent[o];return i.addEventListener("mouseenter",function(e){e.target.style.opacity=1}),i.addEventListener("mouseleave",function(e){e.target.active||(e.target.style.opacity=s.styles.menuItem.opacity)}),i},l.getList=function(){return l.getElementsByTagName("ul")[0]},l.buildList=function(e){var t=l.getList();t.innerHTML="";var r=0,i=0,n=s.util.numKeys(e)-1;for(var a in e){var o=e[a],u=l.buildItem(a,o.name,o.active),c=u.style,h=u.childNodes[0].style;0===r&&(c.borderTopLeftRadius=c.borderTopRightRadius="8px",h.borderTopLeftRadius=h.borderTopRightRadius="6px"),r===n&&(c.borderBottomLeftRadius=c.borderBottomRightRadius="8px",h.borderBottomLeftRadius=h.borderBottomRightRadius="6px",c.border=s.styles.menuItem.border),o.active&&(c.backgroundColor="#ffffcc",c.opacity=1,u.active=!0,i=r*parseFloat(s.styles.menu.lineHeight)),t.appendChild(u),r++}for(var d=t.childNodes,f=0;f<d.length;f++)d[f].index=f;return i},l.show=function(e){l.style.display=s.cssProps.ib,l.style.opacity="1",o&&(o.style.opacity="1");var t=l.getList();t.scrollTop=e||0},l.hide=function(){l.style.display=s.cssProps.none,o&&(o.style.opacity=0)},l.visible=function(){return!(l.style.display!==s.cssProps.ib)},l.activate=function(){},l.deactivate=function(){},l.timeout=function(){},l}},{key:"createSpinner",value:function(e,t,r,i,n,a){var o=this,s=this.createUiElement(document.createElement("img"),"spinner","webvr-mini-spinner",r,i,n,a);return s.name=e,s.show=function(){s.style.display=o.cssProps.ib},s.hide=function(){s.style.display=o.cssProps.none},s}},{key:"createTooltip",value:function(e,t){var r=document.createElement("p");r.className="webvr-mini-tooltip",r.setAttribute("status","invisible");var i=r.style;for(var n in this.styles.tooltip)i[n]=this.styles.tooltip[n];return r.innerHTML="",this.tooltip=r,this.controls.appendChild(r),r}},{key:"createBubbleArrow",value:function(e){var t=document.createElement("div"),r=t.style;for(var i in this.styles.bubbleArrow)r[i]=this.styles.bubbleArrow[i];return r.top=parseFloat(e.style.top)+parseFloat(e.style.height)+parseFloat(e.style.padding)+"px",r.left=parseFloat(e.style.left)+parseFloat(e.style.width)/2+parseFloat(e.style.padding)/2+parseFloat(r.borderWidth)/2+"px",r.zIndex=this.styles.menuContainer.zIndex,r.opacity=0,this.controls.appendChild(t),t}},{key:"vrHandleKeys",value:function(e){switch(e.keyCode){case 27:console.log("AN ESCAPE"),this.mode=this.UI_DOM,this.exitVRButton.hide(),this.vrButton.show(),this.fullscreenButton.show(),this.webvr.exitPresent(),removeEventListener("keydown",this.vrHandleKeys)}}},{key:"hasFullscreen",value:function(){return!!(document.fullscreenEnabled||document.webkitFullscreenEnabled||document.mozFullScreenEnabled||document.msFullscreenEnabled)}},{key:"requestFullscreen",value:function(e){var t=this.webgl.getCanvas(),r=t.parentNode;r.requestFullscreen?r.requestFullscreen():r.mozRequestFullScreen?r.mozRequestFullScreen():r.webkitRequestFullscreen?r.webkitRequestFullscreen():r.msRequestFullscreen&&r.msRequestFullscreen()}},{key:"exitFullscreen",value:function(e){"function"==typeof document.exitFullscreen?document.exitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitExitFullscreen?document.webkitExitFullscreen():document.msExitFullscreen&&document.msExitFullscreen()}},{key:"fullscreenChange",value:function(e){var t=this.webgl.getCanvas(),r=t.parentNode,i=this.webgl.getContext();switch(this.mode){case this.UI_VR:console.log("from vr to dom..."),this.setControlsByMode(this.mode);break;case this.UI_FULLSCREEN:console.log("from fullscreen to DOM..."),r.style.width="",r.style.height="";var n=this.oldWidth,a=this.oldHeight;i.viewportWidth=n,i.viewportHeight=a,i.viewport(0,0,i.viewportWidth,i.viewportHeight),t.width=n,t.height=a,this.mode=this.UI_DOM,this.setControlsByMode(this.mode);break;default:case this.UI_DOM:console.log("from DOM to fullscreen..."),this.mode=this.UI_FULLSCREEN,this.setControlsByMode(this.mode)}}}]),e}();t.default=n},function(e,t,r){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),o=r(18),s=i(o),l=function(){function e(t){n(this,e),console.log("in Util"),this.NOT_IN_LIST=-1,this.DEFAULT_KEY="default",this.POSITIVE=1,this.NEGATIVE=-1,this.emitter=new s.default,this.setTrim(),this.setPerformance(),this.setFinite(),this.setSlice()}return a(e,[{key:"setTrim",value:function(){String.trim=String.trim||function(e){return this.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"")}}},{key:"setFinite",value:function(){Number.isFinite=Number.isFinite||function(e){return"number"==typeof e&&isFinite(e)}}},{key:"setPerformance",value:function(){Date.now=Date.now||function(){return(new Date).getTime()},window.performance=window.performance||{},window.performance.now=window.performance.now||function(){var e=Date.now();return Date.now()-e}}},{key:"setSlice",value:function(){Object.defineProperty&&(Uint16Array&&!Uint16Array.prototype.slice&&Object.defineProperty(Uint16Array.prototype,"slice",{value:Array.prototype.slice}),Uint32Array&&!Uint32Array.prototype.slice&&Object.defineProperty(Uint32Array.prototype,"slice",{value:Array.prototype.slice}),Float32Array&&!Float32Array.prototype.slice&&Object.defineProperty(Float32Array.prototype,"slice",{value:Array.prototype.slice}))}},{key:"isString",value:function(e){return"[object String]"===Object.prototype.toString.call(e)}},{key:"isWhitespace",value:function(e){return!/[^\s]/.test(e)}},{key:"isURL",value:function(e){return null!=/^[\w+:\/\/]/.exec(e)}},{key:"reverseString",value:function(e){return e.split?e.split("").reverse().join(""):null}},{key:"computeId",value:function(){var e=(new Date).getTime(),t="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){var r=(e+16*Math.random())%16|0;return e=Math.floor(e/16),("x"==t?r:3&r|8).toString(16)});return t}},{key:"parseJSON",value:function(e){var t=null;try{t=JSON.parse(e)}catch(e){e instanceof SyntaxError?console.error("Util::parseJSON(): JSON syntax error:"+e):console.error("Util::parseJSON(): JSON unknown error:"+e)}return t}},{key:"computeQueryString",value:function(e){var t=[],r=function(r){var i=Array.isArray(e[r])?e[r]:[e[r]];i.forEach(function(e){t.push(encodeURIComponent(r)+"="+encodeURIComponent(e))})};for(var i in e)r(i);return t.join("&")}},{key:"isNumber",value:function(e){return Number.isFinite(parseFloat(e))}},{key:"isPowerOfTwo",value:function(e){return e=parseInt(e),0===(e&e-1)}},{key:"isEven",value:function(e){return parseInt(e)%2==0}},{key:"isOdd",value:function(e){return 1==Math.abs(parseInt(e)%2)}},{key:"degToRad",value:function(e){return parseFloat(e)*Math.PI/180}},{key:"radToDeg",value:function(e){return 180*parseFloat(e)/Math.PI}},{key:"degToHours",value:function(e){return 24*e/360}},{key:"hoursToDeg",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return e=parseFloat(e),t=parseFloat(t),r=parseFloat(r),e&&(e*=15),t&&(t*=.25),r&&(r*=360/86400),e+t+r}},{key:"cartesianToUV",value:function(e){if(!e.length)return console.error("Util::uvToCartesian(): ARRAY not supplied (did you just use separate x, y, z?"),null;for(var t=new Float32Array(2*e.length/3),r=0,i=0;i<e.length;i+=3){var n=e[i],a=e[i+1],o=e[i+2],s=Math.sqrt(n*n+a*a+o*o);t[r++]=Math.acos(o/s),t[r++]=Math.acos(n/Math.sqrt(n*n+a*a))*(a<0?-1:1)}return t}},{key:"uvToCartesian",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;if(!e.length)return console.error("Util::uvToCartesian(): ARRAY not supplied (did you just add latitude and longitude?"),null;for(var n=new Float32Array(3*e.length/2),a=0,o=0;o<e.length;o+=2){var s=e[o],l=e[o+1];n[a++]=Math.cos(s)*Math.sin(l)*t,n[a++]=Math.sin(s)*Math.sin(l)*r,n[a++]=Math.cos(l)*i}return n}},{key:"hexToRGB",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return e=e.replace("#",""),{r:parseInt(e.substring(0,2),16)/t,g:parseInt(e.substring(2,4),16)/t,b:parseInt(e.substring(4,6),16)/t}}},{key:"latLongToCartesian",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1;return this.uvToCartesian([e,t],r,i,n)}},{key:"frac",value:function(e){return parseFloat(e)%1}},{key:"getRand",value:function(e,t){return void 0!==e&&void 0!==t||(t=1,e=0),e+(Math.random()+1/(1+this.getSeed()))%1*(t-e)}},{key:"getRandInt",value:function(e){return Math.floor(Math.random()*e)}},{key:"randomColor",value:function(){return[Math.abs(Math.random()),Math.abs(Math.random()),Math.abs(Math.random())]}},{key:"easeLinearIn",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.002;return e+t}},{key:"easeLinearOut",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.002;return e-t}},{key:"easeQuadIn",value:function(e){return e+e*e}},{key:"easeQuadOut",value:function(e){return e+e*e}},{key:"pulse",value:function(e,t,r,i,n){e>r?this.outfn(e):e<t&&this.infn(e)}},{key:"isObject",value:function(e){return e===Object(e)}},{key:"numKeys",value:function(e){return this.isObject(e)?Object.keys(e).length:this.NOT_IN_LIST}},{key:"getSortedKeys",value:function(e){var t=Object.keys(e);return t.sort(function(t,r){return e[r]-e[t]})}},{key:"isArray",value:function(e){var t=Object.prototype.toString.call(e);return t.indexOf("Array")>this.NOT_IN_LIST}},{key:"containsAll",value:function(e,t){return t.every(function(t){return e.includes(t)})}},{key:"compArr",value:function(e,t){return this.containsAll(e,t)&&this.containsAll(t,e)}},{key:"getArr",value:function(e,t,r){if(!e||t<0||r<1)return console.error("getArr() invalid params, arr:"+e+", index:"+t+" stride:"+r),-1;for(var i=[],n=2;n<r;n++)i.push(e[t*r+n]);return i}},{key:"setArr",value:function(e,t){var r=arguments.length;if(r<3)return console.error("setArr() no value or index specified"),-1;for(var i=r-2,n=2;n<r;n++)e[idx*i+n]-arguments[n];return idx}},{key:"copyArr",value:function(e){if(e.slice)return e.slice();for(var t=new Array(e.length),r=0;r<e.length;r++)t[r]=e[r];return t}},{key:"canFlatten",value:function(e){return"undefined"!=typeof e[0][0]&&e[0].constructor===Array}},{key:"flatten",value:function(e,t){t!==!0&&t!==!1&&(t=!1);for(var r=t&&e||e.slice(),i=[],n=r.shift();void 0!==n;n=r.shift())Array.isArray(n)?r.unshift.apply(r,n):i.push(n);return i}},{key:"unFlatten",value:function(e,t){for(var r=0,i=0,n=[],a=(new Array(e.length/t),0);a<e.length;a+=t){for(var o=new Array(t),s=0;s<t;s++)o[s]=e[i++];n[r++]=o}return n}},{key:"concatArr",value:function(e,t){var r=null,i=e.length,n=t.length;if(ArrayBuffer.isView(e))e instanceof Float32Array?(r=new Float32Array(i+n),!t instanceof Float32Array&&(t=Float32Array.from(t))):e instanceof Uint32Array?(r=new Uint32Array(i+n),!t instanceof Uint32Array&&(t=Uint32Array.from(t))):e instanceof Uint16Array&&(r=new Uint16Array(i+n),!t instanceof Uint16Array&&(t=Uint16Array.from(t))),r.set(e),r.set(t,i);else if(ArrayBuffer.isView(t)){for(var a=0;a<n;a++)e.push(t[a]);r=e}else r=e.concat(t);return r}},{key:"concatUniqueArr",value:function(){for(var e=[],t=arguments.length,r=Array(t),i=0;i<t;i++)r[i]=arguments[i];for(var n=0;n<r.length;n++)for(var a=r[n],o=0;o<a.length;o++)!a[o]in e&&e.push(a[o]);return e}},{key:"swap",value:function(e,t,r){var i=e[t];return e[t]=x[r],e[t]=i,e}},{key:"clearFalsy",value:function(e){return e.filter(function(e){return e})}},{key:"sort2DByColNum",value:function(e,t){e.sort(function(e,r){return e[t]-r[t]})}},{key:"getSeed",value:function(){var e=void 0;try{if(Uint32Array&&window.crypto&&window.crypto.getRandomValues){var t=new Uint32Array(1);window.crypto.getRandomValues(t),e=t.length?t[0]+"":null}}catch(e){}finally{e||(e=Math.floor(1e9*Math.random()).toString()+(new Date).getTime())}return e}},{key:"removeObjMember",value:function(e,t){e.hasOwnProperty(t)&&(!isNaN(parseInt(t))&&this instanceof Array?e.splice(t,1):delete e[t])}},{key:"getFilePath",value:function(e){return e?e.substring(0,e.lastIndexOf("/"))+"/":null}},{key:"getFileName",value:function(e){return e?e.replace(/^(.*[\/\\])?/,""):null}},{key:"getBaseName",value:function(e){return e?this.getFileName(e).replace(/(\.[^.]*)$/,""):null}},{key:"getFileExtension",value:function(e){return e?e.slice((e.lastIndexOf(".")-1>>>0)+2).toLowerCase():null}},{key:"isIFrame",value:function(){try{return window.self!==window.top}catch(e){return!0}return!1}},{key:"getMousePosition",value:function(e,t){var r=e.getBoundingClientRect();return{x:t.clientX-r.left,y:t.clientY-r.top}}},{key:"getGeolocation",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=this.emitter;navigator.geolocation.getCurrentPosition(function(e){r.emit(r.events.WORLD_GEOLOCATION_READY,e.coords)},function(i){console.error("Util::getGeolocation():Geolocation data not available, error:"+i),r.emit(r.events.WORLD_GEOLOCATION_READY,{latitude:e,longitude:t,altitude:0,accuracy:1,altitudeAccuracy:1,heading:0,speed:0})},{enableHighAccuracy:!0,timeout:5e3,maximumAge:0})}},{key:"isCompatMobile",value:function(){return this.hasTouch()&&this.hasDeviceOriention()(this.isIOS()||this.isGearVR()||this.isGooglePixel())}},{key:"hasTouch",value:function(){return!!("ontouchstart"in window||navigator.msMaxTouchPoints)}},{key:"hasDeviceOrientation",value:function(){return!!window.DeviceOrientationEvent}},{key:"isStandalone",value:function(){return!!window.matchMedia("(display-mode: standalone)").matches}},{key:"isLandscape",value:function(){return 90===window.orientation||window.orientation===-90}},{key:"isIOS",value:function(){var e=navigator.userAgent.match(/(iPad|iPhone|iphone|iPod).*?(OS |os |OS\_)(\d+((_|\.)\d)?((_|\.)\d)?)/);return null===e&&(e=!1),e}},{key:"isGooglePixel",value:function(){return/android.+;\s(pixel xl|pixel)\s/i.test(navigator.userAgent)}},{key:"isGearVR",value:function(){return/SamsungBrowser.+Mobile VR/i.test(navigator.userAgent)}},{key:"getScreenWidth",value:function(){return window.screen.width}},{key:"getScreenHeight",value:function(){return window.screen.height}},{key:"getWindowWidth",value:function(){return window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth}},{key:"getWindowHeight",value:function(){return window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight}}]),e}();t.default=l},function(e,t){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),a=function(){function e(t,i,n,a){r(this,e),console.log("in webGL class"),this.gl=null,this.contextCount=0,this.version=0,this.glMatrix=i,this.util=n,this.NOT_IN_LIST=n.NOT_IN_LIST,this.attributeNames={aVertexPosition:["aVertexPosition",0],aVertexColor:["aVertexColor",1],aTextureCoord:["aTextureCoord",2],aTextureCoord1:["aTextureCoord1",3],aTextureCoord2:["aTextureCoord2",4],aTextureCoord3:["aTextureCoord3",5],aTextureCoord4:["aTextureCoord4",6],aTextureCoord5:["aTextureCoord5",7],aVertexNormal:["aVertexNormal",8],aVertexTangent:["aVertexTangent",9]},this.near=.1,this.far=100,this.stats={},t===!0&&this.init(document.getElementById("webvr-mini-canvas")),a&&(this.debug=a)}return n(e,[{key:"init",value:function(e,t,r){var i=this;if(e)e=this.util.isString(e)?document.getElementById(e):e;else{e=document.createElement("canvas"),e.width=480,e.height=320;var n=document.createElement("div");n.className="webvr-mini-player";var a=document.createElement("div");a.className="webvr-mini-controls",n.appendChild(a),n.appendChild(e),document.body.appendChild(n)}if(e){var o=e.getBoundingClientRect();if(e.width=o.width,e.height=o.height,this.oldWidth=this.util.getWindowWidth(),this.oldHeight=this.util.getWindowHeight(),this.gl=this.createContext(e),this.gl){var s=this.gl;if(s.getParameter&&s.getShaderPrecisionFormat){var l=this.stats;l.highp=s.getShaderPrecisionFormat(s.FRAGMENT_SHADER,s.HIGH_FLOAT).precision,l.maxTextureSize=s.getParameter(s.MAX_TEXTURE_SIZE),l.maxCubeSize=s.getParameter(s.MAX_CUBE_MAP_TEXTURE_SIZE),l.maxRenderbufferSize=s.getParameter(s.MAX_RENDERBUFFER_SIZE),l.combinedUnits=s.getParameter(s.MAX_COMBINED_TEXTURE_IMAGE_UNITS),l.maxVSattribs=s.getParameter(s.MAX_VERTEX_ATTRIBS),l.maxVertexShader=s.getParameter(s.MAX_VERTEX_UNIFORM_VECTORS),l.maxFragmentShader=s.getParameter(s.MAX_FRAGMENT_UNIFORM_VECTORS)}else this.stats=!1;return e.addEventListener("webglcontextlost",function(e){console.error("error: webglcontextlost event, context count:"+i.contextCount),t&&(i.gl=null,t(e)),e.preventDefault()},!1),e.addEventListener("webglcontextrestored",function(e){console.error("error: webglcontextrestored event, context count:"+i.contextCount),r&&r(e),e.preventDefault()},!1),s.viewportWidth=e.width,s.viewportHeight=e.height,window.addEventListener("resize",function(e){i.resizeCanvas(),e.preventDefault()},!1),this.clearTextures(),this.glDefaults(),this.clear(),this.gl}console.error("no WebGL context")}else console.error(" no WebGL canvas");return null}},{key:"glDefaults",value:function(){var e=this.getContext();e&&(e.enable(e.DEPTH_TEST),e.enable(e.CULL_FACE),e.clearDepth(1),e.depthFunc(e.LEQUAL),e.enable(e.BLEND),e.blendFunc(e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA),e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!0),e.clearColor(0,0,0,1))}},{key:"hasWebGL",value:function(){return!!this.getContext()}},{key:"index32Support",value:function(e){return!!e.getExtension("OES_element_index_uint")}},{key:"derivativeSupport",value:function(e){var t=!!e.FRAGMENT_SHADER_DERIVATIVE_HINT;if(!t){var r=e.getExtension("GL_OES_standard_derivatives");r&&(t=!0,e.FRAGMENT_SHADER_DERIVATIVE_HINT=r.FRAGMENT_SHADER_DERIVATIVE_HINT_OES),e.FRAGMENT_SHADER_DERIVATIVE_HINT&&(this.stats.lodSupport=!!e.getExtension("EXT_shader_texture_lod"))}return t}},{key:"vertexArraySupport",value:function(e){var t=!!e.VERTEX_ARRAY_BINDING;if(!t){var r=e.getExtension("OES_vertex_array_object");r&&(t=!0,e.VERTEX_ARRAY_BINDING=r.VERTEX_ARRAY_BINDING_OES,e.createVertexArray=function(){return r.createVertexArrayOES()},e.deleteVertexArray=function(e){r.deleteVertexArrayOES(e)},e.isVertexArray=function(e){return r.isVertexArrayOES(e)},e.bindVertexArray=function(e){r.bindVertexArrayOES(e)})}return t}},{key:"depthTextureSupport",value:function(e){var t=!(!e.DEPTH_COMPONENT||!e.DEPTH_STENCIL);if(!t){var r=e.getExtension("WEBGL_depth_texture")||e.getExtension("MOZ_WEBGL_depth_texture")||e.getExtension("WEBKIT_WEBGL_depth_texture");r&&(t=!0,e.DEPTH_COMPONENT=r.DEPTH_COMPONENT,e.DEPTH_STENCIL=r.DEPTH_STENCIL)}return t}},{key:"anisotropicSupport",value:function(e){var t=!!e.TEXTURE_MAX_ANISOTROPY_EXT;if(!t){var r=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic");r&&(t=!0,e.TEXTURE_MAX_ANISOTROPY_EXT=r.TEXTURE_MAX_ANISOTROPY_EXT)}return t}},{key:"S3TCTextureSupport",value:function(e){var t=!!e.COMPRESSED_RGB_S3TC_DXT1_EXT;if(!t){var r=e.getExtension("WEBGL_compressed_texture_s3tc")||e.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");r&&(t=!0,e.COMPRESSED_RGB_S3TC_DXT1_EXT=r.COMPRESSED_RGB_S3TC_DXT1_EXT,e.COMPRESSED_RGBA_S3TC_DXT1_EXT=r.COMPRESSED_RGBA_S3TC_DXT1_EXT,e.COMPRESSED_RGBA_S3TC_DXT3_EXT=r.COMPRESSED_RGBA_S3TC_DXT3_EXT,e.COMPRESSED_RGBA_S3TC_DXT5_EXT=r.COMPRESSED_RGBA_S3TC_DXT5_EXT)}return t}},{key:"PVRTCTextureSupport",value:function(e){var t=!!e.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(!t){var r=e.getExtension("WEBGL_compressed_texture_pvrtc ")||e.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");r&&(t=!0,e.COMPRESSED_RGB_PVRTC_4BPPV1_IMG=r.COMPRESSED_RGB_PVRTC_4BPPV1_IMG,e.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG=r.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG,e.COMPRESSED_RGB_PVRTC_2BPPV1_IMG=r.COMPRESSED_RGB_PVRTC_2BPPV1_IMG,e.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG=r.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG)}return t}},{key:"ETC1TextureSupport",value:function(e){var t=!(!e.COMPRESSED_RGB_ETC1_WEBGL&&!e.COMPRESSED_RGB_ETC1);if(!t){var r=e.getExtension("WEBGL_compressed_texture_etc1");r&&(t=!0,e.COMPRESSED_RGB_ETC1_WEBGL=r.COMPRESSED_RGB_ETC1_WEBGL)}return t}},{key:"getError",value:function(){var e="webgl.glError():",t=this.getContext();switch(t.getError()){case t.NO_ERROR:return e+"gl.NO_ERROR";case t.INVALID_ENUM:return e+"gl.INVALID_ENUM";case t.INVALID_VALUE:return e+"gl.INVALID_VALUE";case t.INVALID_OPERATION:return e+"gl.INVALID_OPERATION";case t.INVALID_FRAMEBUFFER_OPERATION:return e+"gl.INVALID_FRAMEBUFFER_OPERATION";case t.OUT_OF_MEMORY:return e+"gl.OUT_OF_MEMORY";case t.CONTEXT_LOST_WEBGL:return e+"gl.CONTEXT_LOST_WEBGL"}}},{key:"checkFramebuffer",value:function(e,t){var r=e.checkFramebufferStatus(e.FRAMEBUFFER);switch(r){case e.FRAMEBUFFER_UNSUPPORTED:return"Framebuffer is unsupported";case e.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:return"Framebuffer incomplete attachment";case e.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:return"Framebuffer incomplete dimensions";case e.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:return"Framebuffer incomplete missing attachment";default:return!0}}},{key:"enableBlending",value:function(e,t,r){var i=this.getContext();r&&i.blendEquation(i[r]),e&&t&&i.blendFunc(i[e],i[t]),i.enable(i.BLEND),i.depthMask(!1)}},{key:"disableBlending",value:function(){var e=this.getContext();e.disable(e.BLEND),e.depthMask(!0)}},{key:"getCanvas",value:function(){return this.gl?this.gl.canvas:null}},{key:"resizeCanvas",value:function(e){if(this.ready()){console.log("resize");var t=this.util.getWindowWidth(),r=this.util.getWindowHeight();if(e||t!==this.oldWidth){var i=Math.max(window.devicePixelRatio,1),n=this.getContext(),a=this.getCanvas(),o=a.clientWidth*i|0,s=a.clientHeight*i|0;a.width=o,a.height=s,n.viewportWidth=o,n.viewportHeight=s,n.viewport(0,0,n.viewportWidth,n.viewportHeight)}this.oldWidth=t,this.oldHeight=r}return!1}},{key:"createContext",value:function(e){if(!window.WebGLRenderingContext)return console.error("this browser does not support webgl"),null;var t=null;t&&this.contextCount>0&&(console.warn("killing context"),this.killContext(),this.contextCount--,this.gl=null);for(var r=["webgl2","experimental-webgl2","webgl","experimental-webgl"],n=0;n<r.length;){try{if(this.debug){if(t=this.debug.makeDebugContext(e.getContext(r[n]))){console.warn("using debug context"),"function"!==t.getParameter&&(t=e.getContext(r[n]),console.warn("unable to use debug context, trying release:"+r[n]," getParameter:"+i(t.getParameter)));break}}else if(t=e.getContext(r[n])){console.warn("using release context mode:"+r[n]);break}}catch(e){console.warn("failed to load context:"+r[n])}n++}if(t&&"function"==typeof t.getParameter){switch(this.contextCount++,this.gl=t,this.version=t.getParameter(t.VERSION).toLowerCase(),1!=n&&3!=n||console.warn("experimental context, .getParameter() may not work"),console.log("version:"+t.getParameter(t.VERSION)),this.stats.uint32=!0,this.stats.supported=t.getSupportedExtensions(),n){case 0:case 1:this.version=2;break;case 2:case 3:default:this.version=1,this.stats.uint32=this.index32Support(t)}this.stats.anisotrophic=this.anisotropicSupport(t),this.stats.vertexArrays=this.vertexArraySupport(t),this.stats.derivatives=this.derivativeSupport(t),this.stats.depthTextures=this.depthTextureSupport(t),this.stats.pvrtcTextures=this.PVRTCTextureSupport(t),this.stats.etc1Textures=this.ETC1TextureSupport(t),this.stats.setcTextures=this.S3TCTextureSupport(t),this.stats.uint32?this.MAX_DRAWELEMENTS=2e9:this.MAX_DRAWELEMENTS=65534}else console.error("WebGL::createContext(): no WebGL available"),this.gl=null;return this.gl}},{key:"getContext",value:function(){return this.gl||console.warn("warning webgl context not initialized"),this.gl}},{key:"killContext",value:function(){console.log("in killcontext, count:"+this.contextCount),this.contextCount&&(console.log("killing WebGL context, count before:"+this.contextCount),this.gl.getExtension("WEBGL_lose_context").loseContext(),this.contextCount--)}},{key:"ready",value:function(){this.gl;return!(!this.gl||!this.glMatrix)}},{key:"clear",value:function(){var e=this.gl;e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT)}},{key:"clearTextures",value:function(){for(var e=this.gl,t=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS),r=0;r<t;r++)e.activeTexture(e.TEXTURE0+r),e.bindTexture(e.TEXTURE_2D,null),e.bindTexture(e.TEXTURE_CUBE_MAP,null);e.bindBuffer(e.ARRAY_BUFFER,null),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,null),e.bindRenderbuffer(e.RENDERBUFFER,null),e.bindFramebuffer(e.FRAMEBUFFER,null)}},{key:"createShader",value:function(e,t){var r=null;if(e&&t){if(this.ready()){var i=this.gl;t.replace(/^[ \t]*\n/,""),e===i.VERTEX_SHADER?r=i.createShader(e):e===i.FRAGMENT_SHADER?r=i.createShader(e):console.error("createShader: type not recognized:"+e),i.shaderSource(r,t),i.compileShader(r),i.getShaderParameter(r,i.COMPILE_STATUS)||(console.error("createShader:"+i.getShaderInfoLog(r)),r=null)}}else console.error("createShader: invalid params, type:"+e+" source:"+t);return r}},{key:"createVertexShader",value:function(e){return this.createShader(this.gl.VERTEX_SHADER,e)}},{key:"createFragmentShader",value:function(e){return this.createShader(this.gl.FRAGMENT_SHADER,e)}},{key:"fetchShader",value:function(e,t){var r=this;return fetch(t,{method:"POST",mode:"cors",redirect:"follow",headers:new Headers({"Content-Type":"text/plain"})}).then(function(e){return console.log(text),!!e.ok&&e.text()}).then(function(t){if(t)return r.createShader(e,t)}),null}},{key:"fetchVertexShader",value:function(e){return this.fetchShader(this.gl.VERTEX_SHADER,e)}},{key:"fetchFragmentShader",value:function(e){return this.fetchShader(this.gl.FRAGMENT_SHADER,e)}},{key:"createShaderFromTag",value:function(e){if(this.util.isString(e)&&(e=document.getElementById(e)),!e)return console.error("createShaderFromTag: not found ("+e+")"),!1;var t=null;if("x-shader/x-vertex"==e.type)t=this.gl.VERTEX_SHADER;else{if("x-shader/x-fragment"!=e.type)return console.error("createShaderFromTag: type not found:("+e.type+")"),null;t=this.gl.FRAGMENT_SHADER}for(var r="",i=e.firstChild;i;)3==i.nodeType&&(r+=i.textContent),i=i.nextSibling;return this.createShader(t,r)}},{key:"createProgram",value:function(e,t){if(!e||!t)return console.error("createProgram: parameter error, vs:"+e+" fs:"+t),null;var r={};if(this.ready()){var i=this.gl,n=this.createVertexShader(e.code),a=this.createFragmentShader(t.code),o=i.createProgram();
i.attachShader(o,n),i.attachShader(o,a);for(var s in this.attributeNames)i.bindAttribLocation(o,this.attributeNames[s][1],this.attributeNames[s][0]);i.linkProgram(o),i.getProgramParameter(o,i.LINK_STATUS)?(r.shaderProgram=o,r.vsVars=e.varList,r.fsVars=t.varList,r.renderList=[]):(console.error("WebGL::createProgram():"+i.getProgramInfoLog(o)),this.checkShaders(e,t,o))}return r}},{key:"createVarList",value:function(e){var t=e.length,r=this.NOT_IN_LIST,i=" ",n={},a=["attribute","uniform","varying"];if(t)for(var o=0;o<t;o++){var s=e[o];if(s.indexOf("void main")!==r)break;for(var l=0;l<a.length;l++){var u=a[l];if(n[u]||(n[u]={}),s.indexOf(u)>r){s=s.replace(/;\s*$/,""),s=s.split(i);var c=s.shift();n[c]||(n[c]={});var h=s.shift();n[c][h]||(n[c][h]={});var d=s.shift();n[c][h][d]||(n[c][h][d]="empty")}}}return n}},{key:"setAttributeArrays",value:function(e,t){this.gl;for(var r in t){var i=t[r];for(var n in i)i[n]=this.attributeNames[n][1]}return t}},{key:"setUniformLocations",value:function(e,t){var r=this.gl;for(var i in t){var n=t[i];for(var a in n)n[a]=r.getUniformLocation(e,a)}return t}},{key:"getAttributes",value:function(e){for(var t=this.gl,r={},i=t.getProgramParameter(e,t.ACTIVE_ATTRIBUTES),n=0;n<i;n++){var a=t.getActiveAttrib(e,n);r[a.name]=t.getAttribLocation(e,a.name)}return r.count=i,r}},{key:"getUniforms",value:function(e){for(var t=this.gl,r={},i=t.getProgramParameter(e,t.ACTIVE_UNIFORMS),n="",a=0;a<i;a++){var o=t.getActiveUniform(e,a);n=o.name.replace("[0]",""),r[n]=t.getUniformLocation(e,n)}return r.count=i,r}},{key:"getVarying",value:function(e){}},{key:"checkShaders",value:function(e,t,r){var i=this.gl;return!!i.getProgramParameter(r,i.LINK_STATUS)||(e&&!i.getShaderParameter(e,i.COMPILE_STATUS)?console.error("error creating the vertex shader, "+i.getShaderInfoLog(e)):t&&!i.getShaderParameter(t,i.COMPILE_STATUS)?console.error("error creating the fragment shader, "+i.getShaderInfoLog(t)):console.error("error in gl program linking"),i.deleteProgram(r),!1)}},{key:"checkBufferObjects",value:function(e){return e&&e instanceof ArrayBuffer}},{key:"enumToString",value:function(e,t){for(var r in e)if(e[r]==t)return r;return"0x"+t.toString(16)}}]),e}();t.default=a},function(e,t){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),n=function(){function e(t,i,n,a){r(this,e),console.log("in webVR class"),this.util=i,this.glMatrix=n,this.webgl=a,window.displayName="window",this.displays=[window],this.cDisplay=this.displays[0],this.frameData=null,this.PLAYER_HEIGHT=1.75,this.stats={version:0},t===!0&&this.init()}return i(e,[{key:"setWorld",value:function(e){this.world=e}},{key:"init",value:function(){var e=this,t=this.stats,r=null;this.cDisplay=this.displays[0],navigator.getVRDisplays?navigator.getVRDisplays().then(function(i){if(console.log("WebVR::init(): webvr 1.1 is available"),e.stats.version=1.1,"VRFrameData"in window&&(e.frameData=new VRFrameData),e.frameData)if(console.log("WebVR::init(): VRFrameData is available for "+i.length+" headsets"),i.length>0){console.log("WebVR::init(): "+i.length+" displays are available");for(var n=0;n<i.length;n++)r=i[n],void 0===r.displayName&&(r.displayName="Generic WebVR device"),console.log("WebVR::init(): pushing display ("+r.displayName+")"),e.displays.push(r);r=e.cDisplay=e.displays[1],r&&(console.log("WebVR::init(): valid vr display ("+r.displayName+") present"),r.isPresenting&&(console.warn("WebVR::init(): ("+r.displayName+") was already presenting, exit first"),e.exitPresent(1)),r.depthNear?e.webgl.near=r.depthNear:r.depthNear=e.webgl.near,r.depthFar?e.webgl.far=r.depthFar:r.depthFar=e.webgl.far,t.displayName=r.displayName,e.setStageParameters(r),e.util.emitter.emit(e.util.emitter.events.VR_DISPLAY_READY,r),window.addEventListener("vrdisplaypresentchange",e.presentChange.bind(e),!1),window.addEventListener("vrdisplayconnected",e.displayConnected.bind(e),!1),window.addEventListener("vrdisplaydisconnected",e.displayDisconnected.bind(e),!1),window.addEventListener("vrdisplayactivate",e.displayActivated.bind(e),!1),window.addEventListener("vrdisplaydeactivate",e.displayDeactivated.bind(e),!1),window.addEventListener("vrdisplayblur",e.displayBlur.bind(e),!1),window.addEventListener("vrdisplayfocus",e.displayFocus.bind(e),!1))}else console.warn("WebVR::init(): no VR displays found"),e.util.emitter.emit(e.util.emitter.events.VR_DISPLAY_FAIL,r);else console.warn("WebVR::init(): invalid VRFrameData for "+r),e.util.emitter.emit(e.util.emitter.events.VR_DISPLAY_FAIL,r)},function(t){console.warn("WebVR::init(): reject navigator.getVRDisplays, error is:"+t+", display is:"+r),e.util.emitter.emit(e.util.emitter.events.VR_DISPLAY_FAIL,r)}).catch(function(t){console.warn("WebVR::init(): error navigator.getVRDisplays:"+t+" display is:"+r),e.util.emitter.emit(e.util.emitter.events.VR_DISPLAY_FAIL,r)}):(console.warn("WebVR::init(): WebVR API not present, or obsolete version"),this.util.emitter.emit(this.util.emitter.events.VR_DISPLAY_FAIL,r))}},{key:"getFrameData",value:function(){var e=this.cDisplay,t=this.frameData;if(e.getFrameData){var r=e.getFrameData(t);return r?t:(console.error("WebVR::getFrameData(): display ("+e.displayName+"), display.getFrameData returned:"+r),null)}return console.error("WebVR::getFrame(): display ("+e.displayName+") does not have VRFrameData"),null}},{key:"hasWebVR",value:function(){return!!("VRFrameData"in window&&"getVRDisplays"in navigator)}},{key:"hasWebVRDisplay",value:function(){return!!(this.hasWebVR()&&this.cDisplay&&this.cDisplay.getFrameData)}},{key:"hasRoomscale",value:function(){return this.cDisplay&&this.cDisplay.capabilities&&cDisplay.capabilities.hasPosition}},{key:"getDisplay",value:function(){return this.cDisplay}},{key:"setStageParameters",value:function(e){var t=e,r=t.stageParameters;r?(console.log("WebVR::setStageParameters(): vr display stageParameters present"),r.sizeX>0&&r.sizeZ>0?console.log("WebVR::setStageParameters(): device ("+t.displayName+") stageParameters sizeX:"+r.sizeX+" and sizeZ:"+r.sizeZ):console.log("WebVR::setStageParameters(): device ("+t.displayName+") reported stageParameters without a size, using defaults (3000)")):console.error("WebVR::setStageParameters(): device ("+t.displayName+") did not report stage parameters")}},{key:"getStandingViewMatrix",value:function(e,t,r){var i=this.glMatrix.mat4,n=this.cDisplay;return n.stageParameters?(i.invert(e,n.stageParameters.sittingToStandingTransform),i.multiply(e,t,e)):(i.identity(e),i.translate(e,e,[0,this.PLAYER_HEIGHT,0]),i.invert(e,e),i.multiply(e,t,e)),e}},{key:"requestPresent",value:function(e){var t=this;if(null===this.world)return console.error("WebVR::requestPresent(): world not available"),!1;void 0===e&&(e=1),console.log("WebVR::requestPresent(): display("+this.cDisplay.displayName+")");var r=this.world,i=this.displays[e];return i&&i.capabilities&&i.capabilities.canPresent?i.requestPresent([{source:this.webgl.getCanvas()}]).then(function(){r.stop(),t.cDisplay=i,r.start(),console.log("WebVR::requestPresent(): present was successful")},function(e){console.error("WebVR::requestPresent(): reject, error:"+e+" for display:"+i)}).catch(function(e){console.warn("WebVR::requestPresent(): catch, error is:"+e+" for display:"+i)}):console.error("WebVR::requestPresent(): vrdisplay ("+i.displayName+") has invalid configuration"),!1}},{key:"exitPresent",value:function(e){var t=this;if(console.log("WebVR::exitPresent(): event"),null===this.world)return console.error("WebVR::requestPresent(): world not available"),!1;var r=this.cDisplay,i=this.world;void 0!==e&&(r=this.displays[e]),r.exitPresent?r.exitPresent().then(function(){i.stop(),t.cDisplay=t.displays[0],i.start(),console.log("WebVR::exitPresent(): exited display ("+r.displayName+") presentation to ("+t.cDisplay.displayName+")")},function(e){console.error("WebVR::exitPresent(): reject for display("+r.displayName+"), error:"+e),t.util.emitter.emit(t.util.emitter.events.VR_DISPLAY_FAIL,r)}).catch(function(e){console.warn("WebVR::exitPresent(): error for display ("+r.displayName+"), error:"+e),t.util.emitter.emit(t.util.emitter.events.VR_DISPLAY_FAIL,r)}):(console.error("WebVR::exitPresent(): display ("+r.displayName+") is not a vr display"),this.util.emitter.emit(this.util.emitter.events.VR_DISPLAY_FAIL,r))}},{key:"vrResize",value:function(){var e=this.cDisplay,t=this.webgl.getContext(),r=this.webgl.getCanvas(),i=r.parentNode;console.log("WebVR::vrResize(): resize for display ("+e.displayName+")"),this.oldWidth=i.clientWidth*n|0,this.oldHeight=i.clientHeight*n|0;var n=Math.max(window.devicePixelRatio,1);if(e&&e.isPresenting){console.log("WebVR::vrResize(): display ("+e.displayName+") currently presenting");var a=e.getEyeParameters("left"),o=e.getEyeParameters("right"),s=2*Math.max(a.renderWidth,o.renderWidth),l=Math.max(a.renderHeight,o.renderHeight);r.width=s,r.height=l,t.viewportWidth=s,t.viewportHeight=l,t.viewport(0,0,t.viewportWidth,t.viewportHeight),console.log("WebVR::vrResize(): new width:"+r.width+" height:"+r.height)}else i.style.width="",i.style.height="",console.log("WebVR::vrResize(): calling standard window resize"),this.webgl.resizeCanvas(!0)}},{key:"presentChange",value:function(){var e=this.cDisplay;this.vrResize(),console.log("WebVR::presentChange(): event for "+e.displayName),e.isPresenting?e.capabilities&&e.capabilities.hasExternalDisplay:e.capabilities&&e.capabilities.hasExternalDisplay}},{key:"displayBlur",value:function(){console.warn("WebVR::displayBlur(): display blur event")}},{key:"displayFocus",value:function(){console.warn("WebVR::displayFocus(): display focus event")}},{key:"displayActivated",value:function(){console.warn("WebVR::displayActivated(): display activation event")}},{key:"displayDeactivated",value:function(){console.warn("WebVR::displayDeactivated(): display deactivation event")}},{key:"displayConnected",value:function(){console.warn("WebVR::displayConnected(): display connected event")}},{key:"displayDisconnected",value:function(){console.warn("WebVR::displayDisconnected(): display disconnected event")}},{key:"reportWebVR",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;if(this.util.isNumber(e)&&(e=this.displays[e]||null),e){var t=e.capabilities||{};return{id:e.displayId,name:e.displayName,present:t.canPresent||!1,externalHMD:t.hasExternalDisplay||!1,pose:t.hasPosition||!1,orientation:t.hasOrientation||!1,maxLayers:t.maxLayers||!1}}return null}}]),e}();t.default=n},function(e,t,r){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var s=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),l=r(2),u=i(l),c=r(7),h=i(c),d=r(13),f=i(d),m=r(21),v=i(m),p=r(5),g=i(p),A=r(6),y=(i(A),r(4)),M=(i(y),r(12)),x=i(M),b=function(e){function t(e,r,i,o,s,l,u,c){n(this,t);var d=a(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,i.util));return console.log("in World class"),d.glMatrix=r,d.webgl=i,d.util=i.util,d.vr=o,d.gamepad=s,d.shaderPool=l,d.texturePool=new f.default(e,d.util,i),d.materialPool=new v.default(e,d.util,i,d.texturePool),d.modelPool=new g.default(e,d.util,i,d.texturePool,d.materialPool),d.geometryPool=new h.default(e,d.util,r,i,d.modelPool),d.primFactory=new x.default(!0,d),d.default(),d.lights=u,d.ui=c,d.worldMimeTypes={json:"text/plain",gltf:"text/tgltf",gltfBinary:"bin/gltf"},d.worldPaths=["world/default-world.json","world/gltf-world.json","world/obj-world.json","world/tangled-world.json","world/celestial-world.json"],d.stats={fps:0},d.canvas=i.getCanvas(),d.glMatrix=i.glMatrix,d.wvMatrix=r.mat4.create(),d.pMatrix=d.glMatrix.mat4.create(),d.mvMatrix=d.glMatrix.mat4.create(),d.last=performance.now(),d.rafId=null,d.counters={fps:0,fps_max:300,geolocate:0,geolocate_max:18e3,housekeep:0},d.render=d.render.bind(d),d.defaultKey=d.addAsset(d.default(),"").key,d.util.emitter.on(d.util.emitter.events.VR_DISPLAY_READY,function(e){null!==d.rafId&&(console.log("VR_DISPLAY_READY, display typeof:"+d.vr.getDisplay()),d.stop(),d.start())}),d.util.emitter.on(d.util.emitter.events.WORLD_GEOLOCATION_READY,function(e){if(console.log("World::WORLD_GEOLOCATION_READY event"),d.util.isNumber(e.latitude)&&d.util.isNumber(e.longitude)){d.geoData=e;for(var t=0;t<d.primFactory.prims.length;t++){var r=d.primFactory.prims[t];r.geolocate===!0&&(console.log("World::WORLD_GEOLOCATION_READY event, setting geoData lat:"+e.latitude+" long:"+e.longitude),d.computeSkyRotation(r,e))}}}),d}return o(t,e),s(t,[{key:"default",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[0,0,-5],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[0,0,0],r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[100,100,100],i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"no name",n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"none",a=(arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]?arguments[6]:null),o=arguments.length>7&&void 0!==arguments[7]?arguments[7]:{},s={scene:{active:!1,name:i,description:n,dimensions:r[0],position:e[0],rotation:t[0],light:a,connections:o}},l=s.scene;return this.position=l.position,this.rotation=l.rotation,this.dimensions=l.dimensions,this.name=l.name,this.description=l.description,this.geolocate=l.geolocate,this.connections=l.connections,a&&this.setLights(l.lights),s}},{key:"getWorlds",value:function(){return this.getAllAssets()}},{key:"getActiveWorld",value:function(){for(var e in this.keyList){var t=this.keyList[e];if(t.scene.active)return t}return null}},{key:"getWorldScenes",value:function(){var e={},t=this.getAllAssets();for(var r in t){var i=t[r];e[r]=i.scene}return window.w=e,e}},{key:"setActiveWorld",value:function(e){for(var t in this.keyList){var r=this.keyList[t];r.key===e.key?r.scene.active=!0:r.scene.active=!1}this.computeWorld(e)}},{key:"setLights",value:function(e){for(var t in e){e[t];this.lights.setLight(this.lights.lightTypes[t],t.ambient,t.lightingDirection,t.directionalColor,t.active)}}},{key:"getPOV",value:function(){return{position:this.position,rotation:this.rotation}}},{key:"resize",value:function(e,t,r){console.error("world::resize(): not implemented yet!")}},{key:"computeWorld",value:function(e,t){var r=this.glMatrix.vec3,i=(this.glMatrix.vec4,this.primFactory.geometryPool.vec5),n=this.primFactory.geometryPool.typeList,a=(this.primFactory.geometryPool.directions,this.util),o=[];if(!e.scene)return console.warn("World::computeWorld(): World with no scene:"+t),null;if(t&&(e.scene.path=t),e.scene.active=JSON.parse(e.scene.active),e.scene.active===!0)for(var s in e){var l=e[s];if("scene"===s)this.position=l.position,this.rotation=l.rotation,this.setLights(l.lights),l.geolocate&&a.getGeolocation();else{console.log("I is:"+s+", CHECKING SHADER for "+e.scene.name+" is:"+l.shader+" for prim: "+l.name);var u=this.shaderPool.getAssetByName(l.shader);if(u.name&&console.log("GETTING SHADER:"+u.name),u){this.util.isNumber(l.dimensions[3])&&(l.dimensions[3]=parseFloat(l.dimensions[3])),this.util.isNumber(l.dimensions[4])&&(l.dimensions[4]=parseFloat(l.dimensions[4])),this.util.isNumber(l.divisions[3])&&(l.divisions[3]=parseFloat(l.divisions[3])),this.util.isNumber(l.divisions[4])&&(l.divisions[4]=parseFloat(l.divisions[4])),l.useColorArray&&(l.useColorArray=JSON.parse(l.useColorArray)),l.useFaceTextures&&(l.useFaceTextures=JSON.parse(l.useFaceTextures)),l.useLighting&&(l.useLighting=JSON.parse(l.useLighting)),l.useMetaData&&(l.useMetaData=JSON.parse(l.useMetaData));var c=this.primFactory.createPrim(this.shaderPool.getAssetByName(l.shader),n[l.type],s,i(parseFloat(l.dimensions[0]),parseFloat(l.dimensions[1]),parseFloat(l.dimensions[2]),l.dimensions[3],l.dimensions[4]),i(parseFloat(l.divisions[0]),parseFloat(l.divisions[1]),parseFloat(l.divisions[2]),l.divisions[3],l.divisions[4]),r.fromValues(parseFloat(l.position[0]),parseFloat(l.position[1]),parseFloat(l.position[2])),r.fromValues(parseFloat(l.acceleration[0]),parseFloat(l.acceleration[1]),parseFloat(l.acceleration[2])),r.fromValues(a.degToRad(l.rotation[0]),a.degToRad(l.rotation[1]),a.degToRad(l.rotation[2])),r.fromValues(a.degToRad(l.angular[0]),a.degToRad(l.angular[1]),a.degToRad(l.angular[2])),l.textures,l.models,l.useColorArray,l.useFaceTextures,l.useLighting,l.useMetaData,l.pSystem,l.animSystem);c&&o.push(c)}else console.error("World::getWorld(): invalid Shader:"+s+", shader:"+l.shader+" for Prim:"+s.name)}}return this.util.emitter.emit(this.emitter.events.WORLD_DEFINITION_READY),console.log("WORLD EMITTING:"+e.scene.name),o}},{key:"getWorld",value:function(e){var t=this;if(this.util.isWhitespace(e))console.error("World::getWorld(): no path supplied, not loading");else{var r=this.worldMimeTypes[this.util.getFileExtension(e)],i=this.util;r?this.doRequest(e,0,function(r){if(r.data){var n=i.parseJSON(r.data);i.computeId();if(n){var a=t.computeWorld(n,e);if(a&&(t.addAsset(n,""),a.length>0)){for(var o=0;o<a.length;o++)a[o].worldKey=n.key;t.primFactory.setActivePrims(n.key)}}else console.error("World::getWorld():World file:"+e+" could not be parsed")}else console.error("World::getWorld(): World file, no data found for:"+r.path)},!0,r,0):console.error('World::getWorld(): file type "'+i.getFileExtension(e)+'" in:'+e+" not supported, not loading")}}},{key:"saveWorld",value:function(e){console.error("World::saveWorld(): not implemented yet!")}},{key:"computeSkyRotation",value:function(e,t){if(!e.geolocate)return void console.error("World::computeSkyRotation(): prim "+e.name+" does not geolocate");if(this.util.isNumber(t.latitude)&&this.util.isNumber(t.longitude)){e.rotation[0]=this.util.degToRad(-90+t.latitude);var r=new Date,i=this.util.hoursToDeg(r.getUTCHours(),r.getUTCMinutes(),r.getUTCSeconds());e.rotation[1]=-this.util.degToRad(t.longitude-i),e.rotation[2]=this.util.degToRad(90)}else console.warn("World::computeSkyRotation(): invalid geoData")}},{key:"computeSunPosition",value:function(e){}},{key:"computePlanetPositions",value:function(e){}},{key:"init",value:function(){this.glMatrix.vec3,this.glMatrix.vec4,this.primFactory.geometryPool.vec5,this.primFactory.geometryPool.typeList,this.primFactory.geometryPool.directions,this.util;this.s0=this.shaderPool.getAssetByName("shaderFader"),this.s1=this.shaderPool.getAssetByName("shaderTexture"),this.s2=this.shaderPool.getAssetByName("shaderColor");for(var e=0;e<this.worldPaths.length;e++)this.getWorld(this.worldPaths[e]);this.r0=this.s0.init(),this.r1=this.s1.init(),this.r2=this.s2.init(),this.start()}},{key:"start",value:function(){return console.log("World::start(): starting animation"),this.vr.setWorld(this),this.gamepad.setWorld(this),this.ui.setWorld(this),this.rafId=this.vr.getDisplay().requestAnimationFrame(this.render)}},{key:"stop",value:function(){return console.log("World::stop(): stopping animation"),this.vr.getDisplay().cancelAnimationFrame(this.rafId),this.rafId=null}},{key:"housekeep",value:function(){}},{key:"update",value:function(){var e=this.counters;e.fps++;var t=performance.now(),r=t-this.last;e.fps>e.fps_max&&(this.stats.fps=parseInt(1e3/(r/this.counters.fps))+" fps",this.last=t,e.fps=0),e.geolocate++,e.geolocate>e.geolocate_max&&(e.geolocate=0,this.util.getGeolocation());this.lights.getPos()}},{key:"getWorldViewMatrix",value:function(e){var t=this.glMatrix.mat4,r=this.getPOV();t.rotate(e,e,r.rotation[1],[0,1,0]),t.rotate(e,e,r.rotation[0],[1,0,0]),t.translate(e,e,r.position)}},{key:"render",value:function(){var e=this.glMatrix.mat4,t=this.wvMatrix,r=this.vr,i=this.getPOV();this.update(),this.webgl.clear();var n=r.getDisplay();if(e.identity(t),n)if(n.isPresenting){this.rafId=n.requestAnimationFrame(this.render);var a=r.getFrameData();null!==a?(this.getWorldViewMatrix(t),this.r1.renderVR(r,a,t,i),this.r2.renderVR(r,a,t,i),this.r0.renderVR(r,a,t,i),n.submitFrame()):console.error("World::render(): invalid VRFrameData")}else this.rafId=n.requestAnimationFrame(this.render),this.getWorldViewMatrix(t),this.r1.renderMono(t,i),this.r2.renderMono(t,i),this.r0.renderMono(t,i);else console.error("World::render(): no display")}}]),t}(u.default);t.default=b},function(e,t,r){t.glMatrix=r(1),t.mat2=r(36),t.mat2d=r(37),t.mat3=r(14),t.mat4=r(38),t.quat=r(39),t.vec2=r(40),t.vec3=r(15),t.vec4=r(16)},function(e,t,r){var i=r(1),n={};n.create=function(){var e=new i.ARRAY_TYPE(4);return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e},n.clone=function(e){var t=new i.ARRAY_TYPE(4);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},n.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},n.identity=function(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e},n.fromValues=function(e,t,r,n){var a=new i.ARRAY_TYPE(4);return a[0]=e,a[1]=t,a[2]=r,a[3]=n,a},n.set=function(e,t,r,i,n){return e[0]=t,e[1]=r,e[2]=i,e[3]=n,e},n.transpose=function(e,t){if(e===t){var r=t[1];e[1]=t[2],e[2]=r}else e[0]=t[0],e[1]=t[2],e[2]=t[1],e[3]=t[3];return e},n.invert=function(e,t){var r=t[0],i=t[1],n=t[2],a=t[3],o=r*a-n*i;return o?(o=1/o,e[0]=a*o,e[1]=-i*o,e[2]=-n*o,e[3]=r*o,e):null},n.adjoint=function(e,t){var r=t[0];return e[0]=t[3],e[1]=-t[1],e[2]=-t[2],e[3]=r,e},n.determinant=function(e){return e[0]*e[3]-e[2]*e[1]},n.multiply=function(e,t,r){var i=t[0],n=t[1],a=t[2],o=t[3],s=r[0],l=r[1],u=r[2],c=r[3];return e[0]=i*s+a*l,e[1]=n*s+o*l,e[2]=i*u+a*c,e[3]=n*u+o*c,e},n.mul=n.multiply,n.rotate=function(e,t,r){var i=t[0],n=t[1],a=t[2],o=t[3],s=Math.sin(r),l=Math.cos(r);return e[0]=i*l+a*s,e[1]=n*l+o*s,e[2]=i*-s+a*l,e[3]=n*-s+o*l,e},n.scale=function(e,t,r){var i=t[0],n=t[1],a=t[2],o=t[3],s=r[0],l=r[1];return e[0]=i*s,e[1]=n*s,e[2]=a*l,e[3]=o*l,e},n.fromRotation=function(e,t){var r=Math.sin(t),i=Math.cos(t);return e[0]=i,e[1]=r,e[2]=-r,e[3]=i,e},n.fromScaling=function(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=t[1],e},n.str=function(e){return"mat2("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"},n.frob=function(e){return Math.sqrt(Math.pow(e[0],2)+Math.pow(e[1],2)+Math.pow(e[2],2)+Math.pow(e[3],2))},n.LDU=function(e,t,r,i){return e[2]=i[2]/i[0],r[0]=i[0],r[1]=i[1],r[3]=i[3]-e[2]*r[1],[e,t,r]},n.add=function(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e[3]=t[3]+r[3],e},n.subtract=function(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e[3]=t[3]-r[3],e},n.sub=n.subtract,n.exactEquals=function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]},n.equals=function(e,t){var r=e[0],n=e[1],a=e[2],o=e[3],s=t[0],l=t[1],u=t[2],c=t[3];return Math.abs(r-s)<=i.EPSILON*Math.max(1,Math.abs(r),Math.abs(s))&&Math.abs(n-l)<=i.EPSILON*Math.max(1,Math.abs(n),Math.abs(l))&&Math.abs(a-u)<=i.EPSILON*Math.max(1,Math.abs(a),Math.abs(u))&&Math.abs(o-c)<=i.EPSILON*Math.max(1,Math.abs(o),Math.abs(c))},n.multiplyScalar=function(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e},n.multiplyScalarAndAdd=function(e,t,r,i){return e[0]=t[0]+r[0]*i,e[1]=t[1]+r[1]*i,e[2]=t[2]+r[2]*i,e[3]=t[3]+r[3]*i,e},e.exports=n},function(e,t,r){var i=r(1),n={};n.create=function(){var e=new i.ARRAY_TYPE(6);return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e[4]=0,e[5]=0,e},n.clone=function(e){var t=new i.ARRAY_TYPE(6);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t},n.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e},n.identity=function(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e[4]=0,e[5]=0,e},n.fromValues=function(e,t,r,n,a,o){var s=new i.ARRAY_TYPE(6);return s[0]=e,s[1]=t,s[2]=r,s[3]=n,s[4]=a,s[5]=o,s},n.set=function(e,t,r,i,n,a,o){return e[0]=t,e[1]=r,e[2]=i,e[3]=n,e[4]=a,e[5]=o,e},n.invert=function(e,t){var r=t[0],i=t[1],n=t[2],a=t[3],o=t[4],s=t[5],l=r*a-i*n;return l?(l=1/l,e[0]=a*l,e[1]=-i*l,e[2]=-n*l,e[3]=r*l,e[4]=(n*s-a*o)*l,e[5]=(i*o-r*s)*l,e):null},n.determinant=function(e){return e[0]*e[3]-e[1]*e[2]},n.multiply=function(e,t,r){var i=t[0],n=t[1],a=t[2],o=t[3],s=t[4],l=t[5],u=r[0],c=r[1],h=r[2],d=r[3],f=r[4],m=r[5];return e[0]=i*u+a*c,e[1]=n*u+o*c,e[2]=i*h+a*d,e[3]=n*h+o*d,e[4]=i*f+a*m+s,e[5]=n*f+o*m+l,e},n.mul=n.multiply,n.rotate=function(e,t,r){var i=t[0],n=t[1],a=t[2],o=t[3],s=t[4],l=t[5],u=Math.sin(r),c=Math.cos(r);return e[0]=i*c+a*u,e[1]=n*c+o*u,e[2]=i*-u+a*c,e[3]=n*-u+o*c,e[4]=s,e[5]=l,e},n.scale=function(e,t,r){var i=t[0],n=t[1],a=t[2],o=t[3],s=t[4],l=t[5],u=r[0],c=r[1];return e[0]=i*u,e[1]=n*u,e[2]=a*c,e[3]=o*c,e[4]=s,e[5]=l,e},n.translate=function(e,t,r){var i=t[0],n=t[1],a=t[2],o=t[3],s=t[4],l=t[5],u=r[0],c=r[1];return e[0]=i,e[1]=n,e[2]=a,e[3]=o,e[4]=i*u+a*c+s,e[5]=n*u+o*c+l,e},n.fromRotation=function(e,t){var r=Math.sin(t),i=Math.cos(t);return e[0]=i,e[1]=r,e[2]=-r,e[3]=i,e[4]=0,e[5]=0,e},n.fromScaling=function(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=t[1],e[4]=0,e[5]=0,e},n.fromTranslation=function(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e[4]=t[0],e[5]=t[1],e},n.str=function(e){return"mat2d("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+")"},n.frob=function(e){return Math.sqrt(Math.pow(e[0],2)+Math.pow(e[1],2)+Math.pow(e[2],2)+Math.pow(e[3],2)+Math.pow(e[4],2)+Math.pow(e[5],2)+1)},n.add=function(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e[3]=t[3]+r[3],e[4]=t[4]+r[4],e[5]=t[5]+r[5],e},n.subtract=function(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e[3]=t[3]-r[3],e[4]=t[4]-r[4],e[5]=t[5]-r[5],e},n.sub=n.subtract,n.multiplyScalar=function(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e[4]=t[4]*r,e[5]=t[5]*r,e},n.multiplyScalarAndAdd=function(e,t,r,i){return e[0]=t[0]+r[0]*i,e[1]=t[1]+r[1]*i,e[2]=t[2]+r[2]*i,e[3]=t[3]+r[3]*i,e[4]=t[4]+r[4]*i,e[5]=t[5]+r[5]*i,e},n.exactEquals=function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]},n.equals=function(e,t){var r=e[0],n=e[1],a=e[2],o=e[3],s=e[4],l=e[5],u=t[0],c=t[1],h=t[2],d=t[3],f=t[4],m=t[5];return Math.abs(r-u)<=i.EPSILON*Math.max(1,Math.abs(r),Math.abs(u))&&Math.abs(n-c)<=i.EPSILON*Math.max(1,Math.abs(n),Math.abs(c))&&Math.abs(a-h)<=i.EPSILON*Math.max(1,Math.abs(a),Math.abs(h))&&Math.abs(o-d)<=i.EPSILON*Math.max(1,Math.abs(o),Math.abs(d))&&Math.abs(s-f)<=i.EPSILON*Math.max(1,Math.abs(s),Math.abs(f))&&Math.abs(l-m)<=i.EPSILON*Math.max(1,Math.abs(l),Math.abs(m))},e.exports=n},function(e,t,r){var i=r(1),n={scalar:{},SIMD:{}};n.create=function(){var e=new i.ARRAY_TYPE(16);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},n.clone=function(e){var t=new i.ARRAY_TYPE(16);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},n.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},n.fromValues=function(e,t,r,n,a,o,s,l,u,c,h,d,f,m,v,p){var g=new i.ARRAY_TYPE(16);return g[0]=e,g[1]=t,g[2]=r,g[3]=n,g[4]=a,g[5]=o,g[6]=s,g[7]=l,g[8]=u,g[9]=c,g[10]=h,g[11]=d,g[12]=f,g[13]=m,g[14]=v,g[15]=p,g},n.set=function(e,t,r,i,n,a,o,s,l,u,c,h,d,f,m,v,p){return e[0]=t,e[1]=r,e[2]=i,e[3]=n,e[4]=a,e[5]=o,e[6]=s,e[7]=l,e[8]=u,e[9]=c,e[10]=h,e[11]=d,e[12]=f,e[13]=m,e[14]=v,e[15]=p,e},n.identity=function(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},n.scalar.transpose=function(e,t){if(e===t){var r=t[1],i=t[2],n=t[3],a=t[6],o=t[7],s=t[11];e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=r,e[6]=t[9],e[7]=t[13],e[8]=i,e[9]=a,e[11]=t[14],e[12]=n,e[13]=o,e[14]=s}else e[0]=t[0],e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=t[1],e[5]=t[5],e[6]=t[9],e[7]=t[13],e[8]=t[2],e[9]=t[6],e[10]=t[10],e[11]=t[14],e[12]=t[3],e[13]=t[7],e[14]=t[11],e[15]=t[15];return e},n.SIMD.transpose=function(e,t){var r,i,n,a,o,s,l,u,c,h;return r=SIMD.Float32x4.load(t,0),i=SIMD.Float32x4.load(t,4),n=SIMD.Float32x4.load(t,8),a=SIMD.Float32x4.load(t,12),o=SIMD.Float32x4.shuffle(r,i,0,1,4,5),s=SIMD.Float32x4.shuffle(n,a,0,1,4,5),l=SIMD.Float32x4.shuffle(o,s,0,2,4,6),u=SIMD.Float32x4.shuffle(o,s,1,3,5,7),SIMD.Float32x4.store(e,0,l),SIMD.Float32x4.store(e,4,u),o=SIMD.Float32x4.shuffle(r,i,2,3,6,7),s=SIMD.Float32x4.shuffle(n,a,2,3,6,7),c=SIMD.Float32x4.shuffle(o,s,0,2,4,6),h=SIMD.Float32x4.shuffle(o,s,1,3,5,7),SIMD.Float32x4.store(e,8,c),SIMD.Float32x4.store(e,12,h),e},n.transpose=i.USE_SIMD?n.SIMD.transpose:n.scalar.transpose,n.scalar.invert=function(e,t){var r=t[0],i=t[1],n=t[2],a=t[3],o=t[4],s=t[5],l=t[6],u=t[7],c=t[8],h=t[9],d=t[10],f=t[11],m=t[12],v=t[13],p=t[14],g=t[15],A=r*s-i*o,y=r*l-n*o,M=r*u-a*o,x=i*l-n*s,b=i*u-a*s,E=n*u-a*l,D=c*v-h*m,w=c*p-d*m,S=c*g-f*m,P=h*p-d*v,I=h*g-f*v,T=d*g-f*p,R=A*T-y*I+M*P+x*S-b*w+E*D;return R?(R=1/R,e[0]=(s*T-l*I+u*P)*R,e[1]=(n*I-i*T-a*P)*R,e[2]=(v*E-p*b+g*x)*R,e[3]=(d*b-h*E-f*x)*R,e[4]=(l*S-o*T-u*w)*R,e[5]=(r*T-n*S+a*w)*R,e[6]=(p*M-m*E-g*y)*R,e[7]=(c*E-d*M+f*y)*R,e[8]=(o*I-s*S+u*D)*R,e[9]=(i*S-r*I-a*D)*R,e[10]=(m*b-v*M+g*A)*R,e[11]=(h*M-c*b-f*A)*R,e[12]=(s*w-o*P-l*D)*R,e[13]=(r*P-i*w+n*D)*R,e[14]=(v*y-m*x-p*A)*R,e[15]=(c*x-h*y+d*A)*R,e):null},n.SIMD.invert=function(e,t){var r,i,n,a,o,s,l,u,c,h,d=SIMD.Float32x4.load(t,0),f=SIMD.Float32x4.load(t,4),m=SIMD.Float32x4.load(t,8),v=SIMD.Float32x4.load(t,12);return o=SIMD.Float32x4.shuffle(d,f,0,1,4,5),i=SIMD.Float32x4.shuffle(m,v,0,1,4,5),r=SIMD.Float32x4.shuffle(o,i,0,2,4,6),i=SIMD.Float32x4.shuffle(i,o,1,3,5,7),o=SIMD.Float32x4.shuffle(d,f,2,3,6,7),a=SIMD.Float32x4.shuffle(m,v,2,3,6,7),n=SIMD.Float32x4.shuffle(o,a,0,2,4,6),a=SIMD.Float32x4.shuffle(a,o,1,3,5,7),o=SIMD.Float32x4.mul(n,a),o=SIMD.Float32x4.swizzle(o,1,0,3,2),s=SIMD.Float32x4.mul(i,o),l=SIMD.Float32x4.mul(r,o),o=SIMD.Float32x4.swizzle(o,2,3,0,1),s=SIMD.Float32x4.sub(SIMD.Float32x4.mul(i,o),s),l=SIMD.Float32x4.sub(SIMD.Float32x4.mul(r,o),l),l=SIMD.Float32x4.swizzle(l,2,3,0,1),o=SIMD.Float32x4.mul(i,n),o=SIMD.Float32x4.swizzle(o,1,0,3,2),s=SIMD.Float32x4.add(SIMD.Float32x4.mul(a,o),s),c=SIMD.Float32x4.mul(r,o),o=SIMD.Float32x4.swizzle(o,2,3,0,1),s=SIMD.Float32x4.sub(s,SIMD.Float32x4.mul(a,o)),c=SIMD.Float32x4.sub(SIMD.Float32x4.mul(r,o),c),c=SIMD.Float32x4.swizzle(c,2,3,0,1),o=SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(i,2,3,0,1),a),o=SIMD.Float32x4.swizzle(o,1,0,3,2),n=SIMD.Float32x4.swizzle(n,2,3,0,1),s=SIMD.Float32x4.add(SIMD.Float32x4.mul(n,o),s),u=SIMD.Float32x4.mul(r,o),o=SIMD.Float32x4.swizzle(o,2,3,0,1),s=SIMD.Float32x4.sub(s,SIMD.Float32x4.mul(n,o)),u=SIMD.Float32x4.sub(SIMD.Float32x4.mul(r,o),u),u=SIMD.Float32x4.swizzle(u,2,3,0,1),o=SIMD.Float32x4.mul(r,i),o=SIMD.Float32x4.swizzle(o,1,0,3,2),u=SIMD.Float32x4.add(SIMD.Float32x4.mul(a,o),u),c=SIMD.Float32x4.sub(SIMD.Float32x4.mul(n,o),c),o=SIMD.Float32x4.swizzle(o,2,3,0,1),u=SIMD.Float32x4.sub(SIMD.Float32x4.mul(a,o),u),c=SIMD.Float32x4.sub(c,SIMD.Float32x4.mul(n,o)),o=SIMD.Float32x4.mul(r,a),o=SIMD.Float32x4.swizzle(o,1,0,3,2),l=SIMD.Float32x4.sub(l,SIMD.Float32x4.mul(n,o)),u=SIMD.Float32x4.add(SIMD.Float32x4.mul(i,o),u),o=SIMD.Float32x4.swizzle(o,2,3,0,1),l=SIMD.Float32x4.add(SIMD.Float32x4.mul(n,o),l),u=SIMD.Float32x4.sub(u,SIMD.Float32x4.mul(i,o)),
o=SIMD.Float32x4.mul(r,n),o=SIMD.Float32x4.swizzle(o,1,0,3,2),l=SIMD.Float32x4.add(SIMD.Float32x4.mul(a,o),l),c=SIMD.Float32x4.sub(c,SIMD.Float32x4.mul(i,o)),o=SIMD.Float32x4.swizzle(o,2,3,0,1),l=SIMD.Float32x4.sub(l,SIMD.Float32x4.mul(a,o)),c=SIMD.Float32x4.add(SIMD.Float32x4.mul(i,o),c),h=SIMD.Float32x4.mul(r,s),h=SIMD.Float32x4.add(SIMD.Float32x4.swizzle(h,2,3,0,1),h),h=SIMD.Float32x4.add(SIMD.Float32x4.swizzle(h,1,0,3,2),h),o=SIMD.Float32x4.reciprocalApproximation(h),h=SIMD.Float32x4.sub(SIMD.Float32x4.add(o,o),SIMD.Float32x4.mul(h,SIMD.Float32x4.mul(o,o))),(h=SIMD.Float32x4.swizzle(h,0,0,0,0))?(SIMD.Float32x4.store(e,0,SIMD.Float32x4.mul(h,s)),SIMD.Float32x4.store(e,4,SIMD.Float32x4.mul(h,l)),SIMD.Float32x4.store(e,8,SIMD.Float32x4.mul(h,u)),SIMD.Float32x4.store(e,12,SIMD.Float32x4.mul(h,c)),e):null},n.invert=i.USE_SIMD?n.SIMD.invert:n.scalar.invert,n.scalar.adjoint=function(e,t){var r=t[0],i=t[1],n=t[2],a=t[3],o=t[4],s=t[5],l=t[6],u=t[7],c=t[8],h=t[9],d=t[10],f=t[11],m=t[12],v=t[13],p=t[14],g=t[15];return e[0]=s*(d*g-f*p)-h*(l*g-u*p)+v*(l*f-u*d),e[1]=-(i*(d*g-f*p)-h*(n*g-a*p)+v*(n*f-a*d)),e[2]=i*(l*g-u*p)-s*(n*g-a*p)+v*(n*u-a*l),e[3]=-(i*(l*f-u*d)-s*(n*f-a*d)+h*(n*u-a*l)),e[4]=-(o*(d*g-f*p)-c*(l*g-u*p)+m*(l*f-u*d)),e[5]=r*(d*g-f*p)-c*(n*g-a*p)+m*(n*f-a*d),e[6]=-(r*(l*g-u*p)-o*(n*g-a*p)+m*(n*u-a*l)),e[7]=r*(l*f-u*d)-o*(n*f-a*d)+c*(n*u-a*l),e[8]=o*(h*g-f*v)-c*(s*g-u*v)+m*(s*f-u*h),e[9]=-(r*(h*g-f*v)-c*(i*g-a*v)+m*(i*f-a*h)),e[10]=r*(s*g-u*v)-o*(i*g-a*v)+m*(i*u-a*s),e[11]=-(r*(s*f-u*h)-o*(i*f-a*h)+c*(i*u-a*s)),e[12]=-(o*(h*p-d*v)-c*(s*p-l*v)+m*(s*d-l*h)),e[13]=r*(h*p-d*v)-c*(i*p-n*v)+m*(i*d-n*h),e[14]=-(r*(s*p-l*v)-o*(i*p-n*v)+m*(i*l-n*s)),e[15]=r*(s*d-l*h)-o*(i*d-n*h)+c*(i*l-n*s),e},n.SIMD.adjoint=function(e,t){var r,i,n,a,o,s,l,u,c,h,d,f,m,r=SIMD.Float32x4.load(t,0),i=SIMD.Float32x4.load(t,4),n=SIMD.Float32x4.load(t,8),a=SIMD.Float32x4.load(t,12);return c=SIMD.Float32x4.shuffle(r,i,0,1,4,5),s=SIMD.Float32x4.shuffle(n,a,0,1,4,5),o=SIMD.Float32x4.shuffle(c,s,0,2,4,6),s=SIMD.Float32x4.shuffle(s,c,1,3,5,7),c=SIMD.Float32x4.shuffle(r,i,2,3,6,7),u=SIMD.Float32x4.shuffle(n,a,2,3,6,7),l=SIMD.Float32x4.shuffle(c,u,0,2,4,6),u=SIMD.Float32x4.shuffle(u,c,1,3,5,7),c=SIMD.Float32x4.mul(l,u),c=SIMD.Float32x4.swizzle(c,1,0,3,2),h=SIMD.Float32x4.mul(s,c),d=SIMD.Float32x4.mul(o,c),c=SIMD.Float32x4.swizzle(c,2,3,0,1),h=SIMD.Float32x4.sub(SIMD.Float32x4.mul(s,c),h),d=SIMD.Float32x4.sub(SIMD.Float32x4.mul(o,c),d),d=SIMD.Float32x4.swizzle(d,2,3,0,1),c=SIMD.Float32x4.mul(s,l),c=SIMD.Float32x4.swizzle(c,1,0,3,2),h=SIMD.Float32x4.add(SIMD.Float32x4.mul(u,c),h),m=SIMD.Float32x4.mul(o,c),c=SIMD.Float32x4.swizzle(c,2,3,0,1),h=SIMD.Float32x4.sub(h,SIMD.Float32x4.mul(u,c)),m=SIMD.Float32x4.sub(SIMD.Float32x4.mul(o,c),m),m=SIMD.Float32x4.swizzle(m,2,3,0,1),c=SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(s,2,3,0,1),u),c=SIMD.Float32x4.swizzle(c,1,0,3,2),l=SIMD.Float32x4.swizzle(l,2,3,0,1),h=SIMD.Float32x4.add(SIMD.Float32x4.mul(l,c),h),f=SIMD.Float32x4.mul(o,c),c=SIMD.Float32x4.swizzle(c,2,3,0,1),h=SIMD.Float32x4.sub(h,SIMD.Float32x4.mul(l,c)),f=SIMD.Float32x4.sub(SIMD.Float32x4.mul(o,c),f),f=SIMD.Float32x4.swizzle(f,2,3,0,1),c=SIMD.Float32x4.mul(o,s),c=SIMD.Float32x4.swizzle(c,1,0,3,2),f=SIMD.Float32x4.add(SIMD.Float32x4.mul(u,c),f),m=SIMD.Float32x4.sub(SIMD.Float32x4.mul(l,c),m),c=SIMD.Float32x4.swizzle(c,2,3,0,1),f=SIMD.Float32x4.sub(SIMD.Float32x4.mul(u,c),f),m=SIMD.Float32x4.sub(m,SIMD.Float32x4.mul(l,c)),c=SIMD.Float32x4.mul(o,u),c=SIMD.Float32x4.swizzle(c,1,0,3,2),d=SIMD.Float32x4.sub(d,SIMD.Float32x4.mul(l,c)),f=SIMD.Float32x4.add(SIMD.Float32x4.mul(s,c),f),c=SIMD.Float32x4.swizzle(c,2,3,0,1),d=SIMD.Float32x4.add(SIMD.Float32x4.mul(l,c),d),f=SIMD.Float32x4.sub(f,SIMD.Float32x4.mul(s,c)),c=SIMD.Float32x4.mul(o,l),c=SIMD.Float32x4.swizzle(c,1,0,3,2),d=SIMD.Float32x4.add(SIMD.Float32x4.mul(u,c),d),m=SIMD.Float32x4.sub(m,SIMD.Float32x4.mul(s,c)),c=SIMD.Float32x4.swizzle(c,2,3,0,1),d=SIMD.Float32x4.sub(d,SIMD.Float32x4.mul(u,c)),m=SIMD.Float32x4.add(SIMD.Float32x4.mul(s,c),m),SIMD.Float32x4.store(e,0,h),SIMD.Float32x4.store(e,4,d),SIMD.Float32x4.store(e,8,f),SIMD.Float32x4.store(e,12,m),e},n.adjoint=i.USE_SIMD?n.SIMD.adjoint:n.scalar.adjoint,n.determinant=function(e){var t=e[0],r=e[1],i=e[2],n=e[3],a=e[4],o=e[5],s=e[6],l=e[7],u=e[8],c=e[9],h=e[10],d=e[11],f=e[12],m=e[13],v=e[14],p=e[15],g=t*o-r*a,A=t*s-i*a,y=t*l-n*a,M=r*s-i*o,x=r*l-n*o,b=i*l-n*s,E=u*m-c*f,D=u*v-h*f,w=u*p-d*f,S=c*v-h*m,P=c*p-d*m,I=h*p-d*v;return g*I-A*P+y*S+M*w-x*D+b*E},n.SIMD.multiply=function(e,t,r){var i=SIMD.Float32x4.load(t,0),n=SIMD.Float32x4.load(t,4),a=SIMD.Float32x4.load(t,8),o=SIMD.Float32x4.load(t,12),s=SIMD.Float32x4.load(r,0),l=SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(s,0,0,0,0),i),SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(s,1,1,1,1),n),SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(s,2,2,2,2),a),SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(s,3,3,3,3),o))));SIMD.Float32x4.store(e,0,l);var u=SIMD.Float32x4.load(r,4),c=SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(u,0,0,0,0),i),SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(u,1,1,1,1),n),SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(u,2,2,2,2),a),SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(u,3,3,3,3),o))));SIMD.Float32x4.store(e,4,c);var h=SIMD.Float32x4.load(r,8),d=SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(h,0,0,0,0),i),SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(h,1,1,1,1),n),SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(h,2,2,2,2),a),SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(h,3,3,3,3),o))));SIMD.Float32x4.store(e,8,d);var f=SIMD.Float32x4.load(r,12),m=SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(f,0,0,0,0),i),SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(f,1,1,1,1),n),SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(f,2,2,2,2),a),SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(f,3,3,3,3),o))));return SIMD.Float32x4.store(e,12,m),e},n.scalar.multiply=function(e,t,r){var i=t[0],n=t[1],a=t[2],o=t[3],s=t[4],l=t[5],u=t[6],c=t[7],h=t[8],d=t[9],f=t[10],m=t[11],v=t[12],p=t[13],g=t[14],A=t[15],y=r[0],M=r[1],x=r[2],b=r[3];return e[0]=y*i+M*s+x*h+b*v,e[1]=y*n+M*l+x*d+b*p,e[2]=y*a+M*u+x*f+b*g,e[3]=y*o+M*c+x*m+b*A,y=r[4],M=r[5],x=r[6],b=r[7],e[4]=y*i+M*s+x*h+b*v,e[5]=y*n+M*l+x*d+b*p,e[6]=y*a+M*u+x*f+b*g,e[7]=y*o+M*c+x*m+b*A,y=r[8],M=r[9],x=r[10],b=r[11],e[8]=y*i+M*s+x*h+b*v,e[9]=y*n+M*l+x*d+b*p,e[10]=y*a+M*u+x*f+b*g,e[11]=y*o+M*c+x*m+b*A,y=r[12],M=r[13],x=r[14],b=r[15],e[12]=y*i+M*s+x*h+b*v,e[13]=y*n+M*l+x*d+b*p,e[14]=y*a+M*u+x*f+b*g,e[15]=y*o+M*c+x*m+b*A,e},n.multiply=i.USE_SIMD?n.SIMD.multiply:n.scalar.multiply,n.mul=n.multiply,n.scalar.translate=function(e,t,r){var i,n,a,o,s,l,u,c,h,d,f,m,v=r[0],p=r[1],g=r[2];return t===e?(e[12]=t[0]*v+t[4]*p+t[8]*g+t[12],e[13]=t[1]*v+t[5]*p+t[9]*g+t[13],e[14]=t[2]*v+t[6]*p+t[10]*g+t[14],e[15]=t[3]*v+t[7]*p+t[11]*g+t[15]):(i=t[0],n=t[1],a=t[2],o=t[3],s=t[4],l=t[5],u=t[6],c=t[7],h=t[8],d=t[9],f=t[10],m=t[11],e[0]=i,e[1]=n,e[2]=a,e[3]=o,e[4]=s,e[5]=l,e[6]=u,e[7]=c,e[8]=h,e[9]=d,e[10]=f,e[11]=m,e[12]=i*v+s*p+h*g+t[12],e[13]=n*v+l*p+d*g+t[13],e[14]=a*v+u*p+f*g+t[14],e[15]=o*v+c*p+m*g+t[15]),e},n.SIMD.translate=function(e,t,r){var i=SIMD.Float32x4.load(t,0),n=SIMD.Float32x4.load(t,4),a=SIMD.Float32x4.load(t,8),o=SIMD.Float32x4.load(t,12),s=SIMD.Float32x4(r[0],r[1],r[2],0);t!==e&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11]),i=SIMD.Float32x4.mul(i,SIMD.Float32x4.swizzle(s,0,0,0,0)),n=SIMD.Float32x4.mul(n,SIMD.Float32x4.swizzle(s,1,1,1,1)),a=SIMD.Float32x4.mul(a,SIMD.Float32x4.swizzle(s,2,2,2,2));var l=SIMD.Float32x4.add(i,SIMD.Float32x4.add(n,SIMD.Float32x4.add(a,o)));return SIMD.Float32x4.store(e,12,l),e},n.translate=i.USE_SIMD?n.SIMD.translate:n.scalar.translate,n.scalar.scale=function(e,t,r){var i=r[0],n=r[1],a=r[2];return e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i,e[3]=t[3]*i,e[4]=t[4]*n,e[5]=t[5]*n,e[6]=t[6]*n,e[7]=t[7]*n,e[8]=t[8]*a,e[9]=t[9]*a,e[10]=t[10]*a,e[11]=t[11]*a,e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},n.SIMD.scale=function(e,t,r){var i,n,a,o=SIMD.Float32x4(r[0],r[1],r[2],0);return i=SIMD.Float32x4.load(t,0),SIMD.Float32x4.store(e,0,SIMD.Float32x4.mul(i,SIMD.Float32x4.swizzle(o,0,0,0,0))),n=SIMD.Float32x4.load(t,4),SIMD.Float32x4.store(e,4,SIMD.Float32x4.mul(n,SIMD.Float32x4.swizzle(o,1,1,1,1))),a=SIMD.Float32x4.load(t,8),SIMD.Float32x4.store(e,8,SIMD.Float32x4.mul(a,SIMD.Float32x4.swizzle(o,2,2,2,2))),e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},n.scale=i.USE_SIMD?n.SIMD.scale:n.scalar.scale,n.rotate=function(e,t,r,n){var a,o,s,l,u,c,h,d,f,m,v,p,g,A,y,M,x,b,E,D,w,S,P,I,T=n[0],R=n[1],F=n[2],C=Math.sqrt(T*T+R*R+F*F);return Math.abs(C)<i.EPSILON?null:(C=1/C,T*=C,R*=C,F*=C,a=Math.sin(r),o=Math.cos(r),s=1-o,l=t[0],u=t[1],c=t[2],h=t[3],d=t[4],f=t[5],m=t[6],v=t[7],p=t[8],g=t[9],A=t[10],y=t[11],M=T*T*s+o,x=R*T*s+F*a,b=F*T*s-R*a,E=T*R*s-F*a,D=R*R*s+o,w=F*R*s+T*a,S=T*F*s+R*a,P=R*F*s-T*a,I=F*F*s+o,e[0]=l*M+d*x+p*b,e[1]=u*M+f*x+g*b,e[2]=c*M+m*x+A*b,e[3]=h*M+v*x+y*b,e[4]=l*E+d*D+p*w,e[5]=u*E+f*D+g*w,e[6]=c*E+m*D+A*w,e[7]=h*E+v*D+y*w,e[8]=l*S+d*P+p*I,e[9]=u*S+f*P+g*I,e[10]=c*S+m*P+A*I,e[11]=h*S+v*P+y*I,t!==e&&(e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e)},n.scalar.rotateX=function(e,t,r){var i=Math.sin(r),n=Math.cos(r),a=t[4],o=t[5],s=t[6],l=t[7],u=t[8],c=t[9],h=t[10],d=t[11];return t!==e&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[4]=a*n+u*i,e[5]=o*n+c*i,e[6]=s*n+h*i,e[7]=l*n+d*i,e[8]=u*n-a*i,e[9]=c*n-o*i,e[10]=h*n-s*i,e[11]=d*n-l*i,e},n.SIMD.rotateX=function(e,t,r){var i=SIMD.Float32x4.splat(Math.sin(r)),n=SIMD.Float32x4.splat(Math.cos(r));t!==e&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]);var a=SIMD.Float32x4.load(t,4),o=SIMD.Float32x4.load(t,8);return SIMD.Float32x4.store(e,4,SIMD.Float32x4.add(SIMD.Float32x4.mul(a,n),SIMD.Float32x4.mul(o,i))),SIMD.Float32x4.store(e,8,SIMD.Float32x4.sub(SIMD.Float32x4.mul(o,n),SIMD.Float32x4.mul(a,i))),e},n.rotateX=i.USE_SIMD?n.SIMD.rotateX:n.scalar.rotateX,n.scalar.rotateY=function(e,t,r){var i=Math.sin(r),n=Math.cos(r),a=t[0],o=t[1],s=t[2],l=t[3],u=t[8],c=t[9],h=t[10],d=t[11];return t!==e&&(e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=a*n-u*i,e[1]=o*n-c*i,e[2]=s*n-h*i,e[3]=l*n-d*i,e[8]=a*i+u*n,e[9]=o*i+c*n,e[10]=s*i+h*n,e[11]=l*i+d*n,e},n.SIMD.rotateY=function(e,t,r){var i=SIMD.Float32x4.splat(Math.sin(r)),n=SIMD.Float32x4.splat(Math.cos(r));t!==e&&(e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]);var a=SIMD.Float32x4.load(t,0),o=SIMD.Float32x4.load(t,8);return SIMD.Float32x4.store(e,0,SIMD.Float32x4.sub(SIMD.Float32x4.mul(a,n),SIMD.Float32x4.mul(o,i))),SIMD.Float32x4.store(e,8,SIMD.Float32x4.add(SIMD.Float32x4.mul(a,i),SIMD.Float32x4.mul(o,n))),e},n.rotateY=i.USE_SIMD?n.SIMD.rotateY:n.scalar.rotateY,n.scalar.rotateZ=function(e,t,r){var i=Math.sin(r),n=Math.cos(r),a=t[0],o=t[1],s=t[2],l=t[3],u=t[4],c=t[5],h=t[6],d=t[7];return t!==e&&(e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=a*n+u*i,e[1]=o*n+c*i,e[2]=s*n+h*i,e[3]=l*n+d*i,e[4]=u*n-a*i,e[5]=c*n-o*i,e[6]=h*n-s*i,e[7]=d*n-l*i,e},n.SIMD.rotateZ=function(e,t,r){var i=SIMD.Float32x4.splat(Math.sin(r)),n=SIMD.Float32x4.splat(Math.cos(r));t!==e&&(e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]);var a=SIMD.Float32x4.load(t,0),o=SIMD.Float32x4.load(t,4);return SIMD.Float32x4.store(e,0,SIMD.Float32x4.add(SIMD.Float32x4.mul(a,n),SIMD.Float32x4.mul(o,i))),SIMD.Float32x4.store(e,4,SIMD.Float32x4.sub(SIMD.Float32x4.mul(o,n),SIMD.Float32x4.mul(a,i))),e},n.rotateZ=i.USE_SIMD?n.SIMD.rotateZ:n.scalar.rotateZ,n.fromTranslation=function(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=t[0],e[13]=t[1],e[14]=t[2],e[15]=1,e},n.fromScaling=function(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=t[1],e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=t[2],e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},n.fromRotation=function(e,t,r){var n,a,o,s=r[0],l=r[1],u=r[2],c=Math.sqrt(s*s+l*l+u*u);return Math.abs(c)<i.EPSILON?null:(c=1/c,s*=c,l*=c,u*=c,n=Math.sin(t),a=Math.cos(t),o=1-a,e[0]=s*s*o+a,e[1]=l*s*o+u*n,e[2]=u*s*o-l*n,e[3]=0,e[4]=s*l*o-u*n,e[5]=l*l*o+a,e[6]=u*l*o+s*n,e[7]=0,e[8]=s*u*o+l*n,e[9]=l*u*o-s*n,e[10]=u*u*o+a,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e)},n.fromXRotation=function(e,t){var r=Math.sin(t),i=Math.cos(t);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=i,e[6]=r,e[7]=0,e[8]=0,e[9]=-r,e[10]=i,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},n.fromYRotation=function(e,t){var r=Math.sin(t),i=Math.cos(t);return e[0]=i,e[1]=0,e[2]=-r,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=r,e[9]=0,e[10]=i,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},n.fromZRotation=function(e,t){var r=Math.sin(t),i=Math.cos(t);return e[0]=i,e[1]=r,e[2]=0,e[3]=0,e[4]=-r,e[5]=i,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},n.fromRotationTranslation=function(e,t,r){var i=t[0],n=t[1],a=t[2],o=t[3],s=i+i,l=n+n,u=a+a,c=i*s,h=i*l,d=i*u,f=n*l,m=n*u,v=a*u,p=o*s,g=o*l,A=o*u;return e[0]=1-(f+v),e[1]=h+A,e[2]=d-g,e[3]=0,e[4]=h-A,e[5]=1-(c+v),e[6]=m+p,e[7]=0,e[8]=d+g,e[9]=m-p,e[10]=1-(c+f),e[11]=0,e[12]=r[0],e[13]=r[1],e[14]=r[2],e[15]=1,e},n.getTranslation=function(e,t){return e[0]=t[12],e[1]=t[13],e[2]=t[14],e},n.getRotation=function(e,t){var r=t[0]+t[5]+t[10],i=0;return r>0?(i=2*Math.sqrt(r+1),e[3]=.25*i,e[0]=(t[6]-t[9])/i,e[1]=(t[8]-t[2])/i,e[2]=(t[1]-t[4])/i):t[0]>t[5]&t[0]>t[10]?(i=2*Math.sqrt(1+t[0]-t[5]-t[10]),e[3]=(t[6]-t[9])/i,e[0]=.25*i,e[1]=(t[1]+t[4])/i,e[2]=(t[8]+t[2])/i):t[5]>t[10]?(i=2*Math.sqrt(1+t[5]-t[0]-t[10]),e[3]=(t[8]-t[2])/i,e[0]=(t[1]+t[4])/i,e[1]=.25*i,e[2]=(t[6]+t[9])/i):(i=2*Math.sqrt(1+t[10]-t[0]-t[5]),e[3]=(t[1]-t[4])/i,e[0]=(t[8]+t[2])/i,e[1]=(t[6]+t[9])/i,e[2]=.25*i),e},n.fromRotationTranslationScale=function(e,t,r,i){var n=t[0],a=t[1],o=t[2],s=t[3],l=n+n,u=a+a,c=o+o,h=n*l,d=n*u,f=n*c,m=a*u,v=a*c,p=o*c,g=s*l,A=s*u,y=s*c,M=i[0],x=i[1],b=i[2];return e[0]=(1-(m+p))*M,e[1]=(d+y)*M,e[2]=(f-A)*M,e[3]=0,e[4]=(d-y)*x,e[5]=(1-(h+p))*x,e[6]=(v+g)*x,e[7]=0,e[8]=(f+A)*b,e[9]=(v-g)*b,e[10]=(1-(h+m))*b,e[11]=0,e[12]=r[0],e[13]=r[1],e[14]=r[2],e[15]=1,e},n.fromRotationTranslationScaleOrigin=function(e,t,r,i,n){var a=t[0],o=t[1],s=t[2],l=t[3],u=a+a,c=o+o,h=s+s,d=a*u,f=a*c,m=a*h,v=o*c,p=o*h,g=s*h,A=l*u,y=l*c,M=l*h,x=i[0],b=i[1],E=i[2],D=n[0],w=n[1],S=n[2];return e[0]=(1-(v+g))*x,e[1]=(f+M)*x,e[2]=(m-y)*x,e[3]=0,e[4]=(f-M)*b,e[5]=(1-(d+g))*b,e[6]=(p+A)*b,e[7]=0,e[8]=(m+y)*E,e[9]=(p-A)*E,e[10]=(1-(d+v))*E,e[11]=0,e[12]=r[0]+D-(e[0]*D+e[4]*w+e[8]*S),e[13]=r[1]+w-(e[1]*D+e[5]*w+e[9]*S),e[14]=r[2]+S-(e[2]*D+e[6]*w+e[10]*S),e[15]=1,e},n.fromQuat=function(e,t){var r=t[0],i=t[1],n=t[2],a=t[3],o=r+r,s=i+i,l=n+n,u=r*o,c=i*o,h=i*s,d=n*o,f=n*s,m=n*l,v=a*o,p=a*s,g=a*l;return e[0]=1-h-m,e[1]=c+g,e[2]=d-p,e[3]=0,e[4]=c-g,e[5]=1-u-m,e[6]=f+v,e[7]=0,e[8]=d+p,e[9]=f-v,e[10]=1-u-h,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},n.frustum=function(e,t,r,i,n,a,o){var s=1/(r-t),l=1/(n-i),u=1/(a-o);return e[0]=2*a*s,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=2*a*l,e[6]=0,e[7]=0,e[8]=(r+t)*s,e[9]=(n+i)*l,e[10]=(o+a)*u,e[11]=-1,e[12]=0,e[13]=0,e[14]=o*a*2*u,e[15]=0,e},n.perspective=function(e,t,r,i,n){var a=1/Math.tan(t/2),o=1/(i-n);return e[0]=a/r,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=a,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=(n+i)*o,e[11]=-1,e[12]=0,e[13]=0,e[14]=2*n*i*o,e[15]=0,e},n.perspectiveFromFieldOfView=function(e,t,r,i){var n=Math.tan(t.upDegrees*Math.PI/180),a=Math.tan(t.downDegrees*Math.PI/180),o=Math.tan(t.leftDegrees*Math.PI/180),s=Math.tan(t.rightDegrees*Math.PI/180),l=2/(o+s),u=2/(n+a);return e[0]=l,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=u,e[6]=0,e[7]=0,e[8]=-((o-s)*l*.5),e[9]=(n-a)*u*.5,e[10]=i/(r-i),e[11]=-1,e[12]=0,e[13]=0,e[14]=i*r/(r-i),e[15]=0,e},n.ortho=function(e,t,r,i,n,a,o){var s=1/(t-r),l=1/(i-n),u=1/(a-o);return e[0]=-2*s,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*l,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=2*u,e[11]=0,e[12]=(t+r)*s,e[13]=(n+i)*l,e[14]=(o+a)*u,e[15]=1,e},n.lookAt=function(e,t,r,a){var o,s,l,u,c,h,d,f,m,v,p=t[0],g=t[1],A=t[2],y=a[0],M=a[1],x=a[2],b=r[0],E=r[1],D=r[2];return Math.abs(p-b)<i.EPSILON&&Math.abs(g-E)<i.EPSILON&&Math.abs(A-D)<i.EPSILON?n.identity(e):(d=p-b,f=g-E,m=A-D,v=1/Math.sqrt(d*d+f*f+m*m),d*=v,f*=v,m*=v,o=M*m-x*f,s=x*d-y*m,l=y*f-M*d,v=Math.sqrt(o*o+s*s+l*l),v?(v=1/v,o*=v,s*=v,l*=v):(o=0,s=0,l=0),u=f*l-m*s,c=m*o-d*l,h=d*s-f*o,v=Math.sqrt(u*u+c*c+h*h),v?(v=1/v,u*=v,c*=v,h*=v):(u=0,c=0,h=0),e[0]=o,e[1]=u,e[2]=d,e[3]=0,e[4]=s,e[5]=c,e[6]=f,e[7]=0,e[8]=l,e[9]=h,e[10]=m,e[11]=0,e[12]=-(o*p+s*g+l*A),e[13]=-(u*p+c*g+h*A),e[14]=-(d*p+f*g+m*A),e[15]=1,e)},n.str=function(e){return"mat4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+", "+e[9]+", "+e[10]+", "+e[11]+", "+e[12]+", "+e[13]+", "+e[14]+", "+e[15]+")"},n.frob=function(e){return Math.sqrt(Math.pow(e[0],2)+Math.pow(e[1],2)+Math.pow(e[2],2)+Math.pow(e[3],2)+Math.pow(e[4],2)+Math.pow(e[5],2)+Math.pow(e[6],2)+Math.pow(e[7],2)+Math.pow(e[8],2)+Math.pow(e[9],2)+Math.pow(e[10],2)+Math.pow(e[11],2)+Math.pow(e[12],2)+Math.pow(e[13],2)+Math.pow(e[14],2)+Math.pow(e[15],2))},n.add=function(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e[3]=t[3]+r[3],e[4]=t[4]+r[4],e[5]=t[5]+r[5],e[6]=t[6]+r[6],e[7]=t[7]+r[7],e[8]=t[8]+r[8],e[9]=t[9]+r[9],e[10]=t[10]+r[10],e[11]=t[11]+r[11],e[12]=t[12]+r[12],e[13]=t[13]+r[13],e[14]=t[14]+r[14],e[15]=t[15]+r[15],e},n.subtract=function(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e[3]=t[3]-r[3],e[4]=t[4]-r[4],e[5]=t[5]-r[5],e[6]=t[6]-r[6],e[7]=t[7]-r[7],e[8]=t[8]-r[8],e[9]=t[9]-r[9],e[10]=t[10]-r[10],e[11]=t[11]-r[11],e[12]=t[12]-r[12],e[13]=t[13]-r[13],e[14]=t[14]-r[14],e[15]=t[15]-r[15],e},n.sub=n.subtract,n.multiplyScalar=function(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e[4]=t[4]*r,e[5]=t[5]*r,e[6]=t[6]*r,e[7]=t[7]*r,e[8]=t[8]*r,e[9]=t[9]*r,e[10]=t[10]*r,e[11]=t[11]*r,e[12]=t[12]*r,e[13]=t[13]*r,e[14]=t[14]*r,e[15]=t[15]*r,e},n.multiplyScalarAndAdd=function(e,t,r,i){return e[0]=t[0]+r[0]*i,e[1]=t[1]+r[1]*i,e[2]=t[2]+r[2]*i,e[3]=t[3]+r[3]*i,e[4]=t[4]+r[4]*i,e[5]=t[5]+r[5]*i,e[6]=t[6]+r[6]*i,e[7]=t[7]+r[7]*i,e[8]=t[8]+r[8]*i,e[9]=t[9]+r[9]*i,e[10]=t[10]+r[10]*i,e[11]=t[11]+r[11]*i,e[12]=t[12]+r[12]*i,e[13]=t[13]+r[13]*i,e[14]=t[14]+r[14]*i,e[15]=t[15]+r[15]*i,e},n.exactEquals=function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[7]===t[7]&&e[8]===t[8]&&e[9]===t[9]&&e[10]===t[10]&&e[11]===t[11]&&e[12]===t[12]&&e[13]===t[13]&&e[14]===t[14]&&e[15]===t[15]},n.equals=function(e,t){var r=e[0],n=e[1],a=e[2],o=e[3],s=e[4],l=e[5],u=e[6],c=e[7],h=e[8],d=e[9],f=e[10],m=e[11],v=e[12],p=e[13],g=e[14],A=e[15],y=t[0],M=t[1],x=t[2],b=t[3],E=t[4],D=t[5],w=t[6],S=t[7],P=t[8],I=t[9],T=t[10],R=t[11],F=t[12],C=t[13],O=t[14],k=t[15];return Math.abs(r-y)<=i.EPSILON*Math.max(1,Math.abs(r),Math.abs(y))&&Math.abs(n-M)<=i.EPSILON*Math.max(1,Math.abs(n),Math.abs(M))&&Math.abs(a-x)<=i.EPSILON*Math.max(1,Math.abs(a),Math.abs(x))&&Math.abs(o-b)<=i.EPSILON*Math.max(1,Math.abs(o),Math.abs(b))&&Math.abs(s-E)<=i.EPSILON*Math.max(1,Math.abs(s),Math.abs(E))&&Math.abs(l-D)<=i.EPSILON*Math.max(1,Math.abs(l),Math.abs(D))&&Math.abs(u-w)<=i.EPSILON*Math.max(1,Math.abs(u),Math.abs(w))&&Math.abs(c-S)<=i.EPSILON*Math.max(1,Math.abs(c),Math.abs(S))&&Math.abs(h-P)<=i.EPSILON*Math.max(1,Math.abs(h),Math.abs(P))&&Math.abs(d-I)<=i.EPSILON*Math.max(1,Math.abs(d),Math.abs(I))&&Math.abs(f-T)<=i.EPSILON*Math.max(1,Math.abs(f),Math.abs(T))&&Math.abs(m-R)<=i.EPSILON*Math.max(1,Math.abs(m),Math.abs(R))&&Math.abs(v-F)<=i.EPSILON*Math.max(1,Math.abs(v),Math.abs(F))&&Math.abs(p-C)<=i.EPSILON*Math.max(1,Math.abs(p),Math.abs(C))&&Math.abs(g-O)<=i.EPSILON*Math.max(1,Math.abs(g),Math.abs(O))&&Math.abs(A-k)<=i.EPSILON*Math.max(1,Math.abs(A),Math.abs(k))},e.exports=n},function(e,t,r){var i=r(1),n=r(14),a=r(15),o=r(16),s={};s.create=function(){var e=new i.ARRAY_TYPE(4);return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e},s.rotationTo=function(){var e=a.create(),t=a.fromValues(1,0,0),r=a.fromValues(0,1,0);return function(i,n,o){var l=a.dot(n,o);return l<-.999999?(a.cross(e,t,n),a.length(e)<1e-6&&a.cross(e,r,n),a.normalize(e,e),s.setAxisAngle(i,e,Math.PI),i):l>.999999?(i[0]=0,i[1]=0,i[2]=0,i[3]=1,i):(a.cross(e,n,o),i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=1+l,s.normalize(i,i))}}(),s.setAxes=function(){var e=n.create();return function(t,r,i,n){return e[0]=i[0],e[3]=i[1],e[6]=i[2],e[1]=n[0],e[4]=n[1],e[7]=n[2],e[2]=-r[0],e[5]=-r[1],e[8]=-r[2],s.normalize(t,s.fromMat3(t,e))}}(),s.clone=o.clone,s.fromValues=o.fromValues,s.copy=o.copy,s.set=o.set,s.identity=function(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e},s.setAxisAngle=function(e,t,r){r*=.5;var i=Math.sin(r);return e[0]=i*t[0],e[1]=i*t[1],e[2]=i*t[2],e[3]=Math.cos(r),e},s.getAxisAngle=function(e,t){var r=2*Math.acos(t[3]),i=Math.sin(r/2);return 0!=i?(e[0]=t[0]/i,e[1]=t[1]/i,e[2]=t[2]/i):(e[0]=1,e[1]=0,e[2]=0),r},s.add=o.add,s.multiply=function(e,t,r){var i=t[0],n=t[1],a=t[2],o=t[3],s=r[0],l=r[1],u=r[2],c=r[3];return e[0]=i*c+o*s+n*u-a*l,e[1]=n*c+o*l+a*s-i*u,e[2]=a*c+o*u+i*l-n*s,e[3]=o*c-i*s-n*l-a*u,e},s.mul=s.multiply,s.scale=o.scale,s.rotateX=function(e,t,r){r*=.5;var i=t[0],n=t[1],a=t[2],o=t[3],s=Math.sin(r),l=Math.cos(r);return e[0]=i*l+o*s,e[1]=n*l+a*s,e[2]=a*l-n*s,e[3]=o*l-i*s,e},s.rotateY=function(e,t,r){r*=.5;var i=t[0],n=t[1],a=t[2],o=t[3],s=Math.sin(r),l=Math.cos(r);return e[0]=i*l-a*s,e[1]=n*l+o*s,e[2]=a*l+i*s,e[3]=o*l-n*s,e},s.rotateZ=function(e,t,r){r*=.5;var i=t[0],n=t[1],a=t[2],o=t[3],s=Math.sin(r),l=Math.cos(r);return e[0]=i*l+n*s,e[1]=n*l-i*s,e[2]=a*l+o*s,e[3]=o*l-a*s,e},s.calculateW=function(e,t){var r=t[0],i=t[1],n=t[2];return e[0]=r,e[1]=i,e[2]=n,e[3]=Math.sqrt(Math.abs(1-r*r-i*i-n*n)),e},s.dot=o.dot,s.lerp=o.lerp,s.slerp=function(e,t,r,i){var n,a,o,s,l,u=t[0],c=t[1],h=t[2],d=t[3],f=r[0],m=r[1],v=r[2],p=r[3];return a=u*f+c*m+h*v+d*p,a<0&&(a=-a,f=-f,m=-m,v=-v,p=-p),1-a>1e-6?(n=Math.acos(a),o=Math.sin(n),s=Math.sin((1-i)*n)/o,l=Math.sin(i*n)/o):(s=1-i,l=i),e[0]=s*u+l*f,e[1]=s*c+l*m,e[2]=s*h+l*v,e[3]=s*d+l*p,e},s.sqlerp=function(){var e=s.create(),t=s.create();return function(r,i,n,a,o,l){return s.slerp(e,i,o,l),s.slerp(t,n,a,l),s.slerp(r,e,t,2*l*(1-l)),r}}(),s.invert=function(e,t){var r=t[0],i=t[1],n=t[2],a=t[3],o=r*r+i*i+n*n+a*a,s=o?1/o:0;return e[0]=-r*s,e[1]=-i*s,e[2]=-n*s,e[3]=a*s,e},s.conjugate=function(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=t[3],e},s.length=o.length,s.len=s.length,s.squaredLength=o.squaredLength,s.sqrLen=s.squaredLength,s.normalize=o.normalize,s.fromMat3=function(e,t){var r,i=t[0]+t[4]+t[8];if(i>0)r=Math.sqrt(i+1),e[3]=.5*r,r=.5/r,e[0]=(t[5]-t[7])*r,e[1]=(t[6]-t[2])*r,e[2]=(t[1]-t[3])*r;else{var n=0;t[4]>t[0]&&(n=1),t[8]>t[3*n+n]&&(n=2);var a=(n+1)%3,o=(n+2)%3;r=Math.sqrt(t[3*n+n]-t[3*a+a]-t[3*o+o]+1),e[n]=.5*r,r=.5/r,e[3]=(t[3*a+o]-t[3*o+a])*r,e[a]=(t[3*a+n]+t[3*n+a])*r,e[o]=(t[3*o+n]+t[3*n+o])*r}return e},s.str=function(e){return"quat("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"},s.exactEquals=o.exactEquals,s.equals=o.equals,e.exports=s},function(e,t,r){var i=r(1),n={};n.create=function(){var e=new i.ARRAY_TYPE(2);return e[0]=0,e[1]=0,e},n.clone=function(e){var t=new i.ARRAY_TYPE(2);return t[0]=e[0],t[1]=e[1],t},n.fromValues=function(e,t){var r=new i.ARRAY_TYPE(2);return r[0]=e,r[1]=t,r},n.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e},n.set=function(e,t,r){return e[0]=t,e[1]=r,e},n.add=function(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e},n.subtract=function(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e},n.sub=n.subtract,n.multiply=function(e,t,r){return e[0]=t[0]*r[0],e[1]=t[1]*r[1],e},n.mul=n.multiply,n.divide=function(e,t,r){return e[0]=t[0]/r[0],e[1]=t[1]/r[1],e},n.div=n.divide,n.ceil=function(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e},n.floor=function(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e},n.min=function(e,t,r){return e[0]=Math.min(t[0],r[0]),e[1]=Math.min(t[1],r[1]),e},n.max=function(e,t,r){return e[0]=Math.max(t[0],r[0]),e[1]=Math.max(t[1],r[1]),e},n.round=function(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e},n.scale=function(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e},n.scaleAndAdd=function(e,t,r,i){return e[0]=t[0]+r[0]*i,e[1]=t[1]+r[1]*i,e},n.distance=function(e,t){var r=t[0]-e[0],i=t[1]-e[1];return Math.sqrt(r*r+i*i)},n.dist=n.distance,n.squaredDistance=function(e,t){var r=t[0]-e[0],i=t[1]-e[1];return r*r+i*i},n.sqrDist=n.squaredDistance,n.length=function(e){var t=e[0],r=e[1];return Math.sqrt(t*t+r*r)},n.len=n.length,n.squaredLength=function(e){var t=e[0],r=e[1];return t*t+r*r},n.sqrLen=n.squaredLength,n.negate=function(e,t){return e[0]=-t[0],e[1]=-t[1],e},n.inverse=function(e,t){return e[0]=1/t[0],e[1]=1/t[1],e},n.normalize=function(e,t){var r=t[0],i=t[1],n=r*r+i*i;return n>0&&(n=1/Math.sqrt(n),e[0]=t[0]*n,e[1]=t[1]*n),e},n.dot=function(e,t){return e[0]*t[0]+e[1]*t[1]},n.cross=function(e,t,r){var i=t[0]*r[1]-t[1]*r[0];return e[0]=e[1]=0,e[2]=i,e},n.lerp=function(e,t,r,i){var n=t[0],a=t[1];return e[0]=n+i*(r[0]-n),e[1]=a+i*(r[1]-a),e},n.random=function(e,t){t=t||1;var r=2*i.RANDOM()*Math.PI;return e[0]=Math.cos(r)*t,e[1]=Math.sin(r)*t,e},n.transformMat2=function(e,t,r){var i=t[0],n=t[1];return e[0]=r[0]*i+r[2]*n,e[1]=r[1]*i+r[3]*n,e},n.transformMat2d=function(e,t,r){var i=t[0],n=t[1];return e[0]=r[0]*i+r[2]*n+r[4],e[1]=r[1]*i+r[3]*n+r[5],e},n.transformMat3=function(e,t,r){var i=t[0],n=t[1];return e[0]=r[0]*i+r[3]*n+r[6],e[1]=r[1]*i+r[4]*n+r[7],e},n.transformMat4=function(e,t,r){var i=t[0],n=t[1];return e[0]=r[0]*i+r[4]*n+r[12],e[1]=r[1]*i+r[5]*n+r[13],e},n.forEach=function(){var e=n.create();return function(t,r,i,n,a,o){var s,l;for(r||(r=2),i||(i=0),l=n?Math.min(n*r+i,t.length):t.length,s=i;s<l;s+=r)e[0]=t[s],e[1]=t[s+1],a(e,e,o),t[s]=e[0],t[s+1]=e[1];return t}}(),n.str=function(e){return"vec2("+e[0]+", "+e[1]+")"},n.exactEquals=function(e,t){return e[0]===t[0]&&e[1]===t[1]},n.equals=function(e,t){var r=e[0],n=e[1],a=t[0],o=t[1];return Math.abs(r-a)<=i.EPSILON*Math.max(1,Math.abs(r),Math.abs(a))&&Math.abs(n-o)<=i.EPSILON*Math.max(1,Math.abs(n),Math.abs(o))},e.exports=n},function(e,t){function r(){throw new Error("setTimeout has not been defined")}function i(){throw new Error("clearTimeout has not been defined")}function n(e){if(c===setTimeout)return setTimeout(e,0);if((c===r||!c)&&setTimeout)return c=setTimeout,setTimeout(e,0);try{return c(e,0)}catch(t){try{return c.call(null,e,0)}catch(t){return c.call(this,e,0)}}}function a(e){if(h===clearTimeout)return clearTimeout(e);if((h===i||!h)&&clearTimeout)return h=clearTimeout,clearTimeout(e);try{return h(e)}catch(t){try{return h.call(null,e)}catch(t){return h.call(this,e)}}}function o(){v&&f&&(v=!1,f.length?m=f.concat(m):p=-1,m.length&&s())}function s(){if(!v){var e=n(o);v=!0;for(var t=m.length;t;){for(f=m,m=[];++p<t;)f&&f[p].run();p=-1,t=m.length}f=null,v=!1,a(e)}}function l(e,t){this.fun=e,this.array=t}function u(){}var c,h,d=e.exports={};!function(){try{c="function"==typeof setTimeout?setTimeout:r}catch(e){c=r}try{h="function"==typeof clearTimeout?clearTimeout:i}catch(e){h=i}}();var f,m=[],v=!1,p=-1;d.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)t[r-1]=arguments[r];m.push(new l(e,t)),1!==m.length||v||n(s)},l.prototype.run=function(){this.fun.apply(null,this.array)},d.title="browser",d.browser=!0,d.env={},d.argv=[],d.version="",d.versions={},d.on=u,d.addListener=u,d.once=u,d.off=u,d.removeListener=u,d.removeAllListeners=u,d.emit=u,d.binding=function(e){throw new Error("process.binding is not supported")},d.cwd=function(){return"/"},d.chdir=function(e){throw new Error("process.chdir is not supported")},d.umask=function(){return 0}},function(e,t){(function(t){WebGLDebugUtils=function(){function e(e){if(null==m){m={},v={};for(var t in e)"number"==typeof e[t]&&(m[e[t]]=t,v[t]=e[t])}}function r(){if(null==m)throw"WebGLDebugUtils.init(ctx) not called"}function i(e){return r(),void 0!==m[e]}function n(e){r();var t=m[e];return void 0!==t?"gl."+t:"/*UNKNOWN WebGL ENUM*/ 0x"+e.toString(16)}function a(e,t,r,i){var a=f[e];if(void 0!==a){var a=a[t];if(void 0!==a&&a[r]){if("object"==typeof a[r]&&void 0!==a[r].enumBitwiseOr){for(var o=a[r].enumBitwiseOr,s=0,l=[],u=0;u<o.length;++u){var c=v[o[u]];0!==(i&c)&&(s|=c,l.push(n(c)))}return s===i?l.join(" | "):n(i)}return n(i)}}return null===i?"null":void 0===i?"undefined":i.toString()}function o(e,t){for(var r="",i=t.length,n=0;n<i;++n)r+=(0==n?"":", ")+a(e,i,n,t[n]);return r}function s(e,t,r){e.__defineGetter__(r,function(){return t[r]}),e.__defineSetter__(r,function(e){t[r]=e})}function l(t,r,i,o){function u(e,t){return function(){i&&i(t,arguments);var n=e[t].apply(e,arguments),a=o.getError();return 0!=a&&(c[a]=!0,r(a,t,arguments)),n}}o=o||t,e(t),r=r||function(e,t,r){for(var i="",o=r.length,s=0;s<o;++s)i+=(0==s?"":", ")+a(t,o,s,r[s]);d("WebGL error "+n(e)+" in "+t+"("+i+")")};var c={},h={};for(var f in t)if("function"==typeof t[f])if("getExtension"!=f)h[f]=u(t,f);else{var m=u(t,f);h[f]=function(){var e=m.apply(t,arguments);return l(e,r,i,o)}}else s(h,t,f);return h.getError=function(){for(var e in c)if(c.hasOwnProperty(e)&&c[e])return c[e]=!1,e;return t.NO_ERROR},h}function u(e){var t=e.getParameter(e.MAX_VERTEX_ATTRIBS),r=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,r);for(var i=0;i<t;++i)e.disableVertexAttribArray(i),e.vertexAttribPointer(i,4,e.FLOAT,!1,0,0),e.vertexAttrib1f(i,0);e.deleteBuffer(r);for(var n=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS),i=0;i<n;++i)e.activeTexture(e.TEXTURE0+i),e.bindTexture(e.TEXTURE_CUBE_MAP,null),e.bindTexture(e.TEXTURE_2D,null);for(e.activeTexture(e.TEXTURE0),e.useProgram(null),e.bindBuffer(e.ARRAY_BUFFER,null),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,null),e.bindFramebuffer(e.FRAMEBUFFER,null),e.bindRenderbuffer(e.RENDERBUFFER,null),e.disable(e.BLEND),e.disable(e.CULL_FACE),e.disable(e.DEPTH_TEST),e.disable(e.DITHER),e.disable(e.SCISSOR_TEST),e.blendColor(0,0,0,0),e.blendEquation(e.FUNC_ADD),e.blendFunc(e.ONE,e.ZERO),e.clearColor(0,0,0,0),e.clearDepth(1),e.clearStencil(-1),e.colorMask(!0,!0,!0,!0),e.cullFace(e.BACK),e.depthFunc(e.LESS),e.depthMask(!0),e.depthRange(0,1),e.frontFace(e.CCW),e.hint(e.GENERATE_MIPMAP_HINT,e.DONT_CARE),e.lineWidth(1),e.pixelStorei(e.PACK_ALIGNMENT,4),e.pixelStorei(e.UNPACK_ALIGNMENT,4),e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,!1),e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),e.UNPACK_COLORSPACE_CONVERSION_WEBGL&&e.pixelStorei(e.UNPACK_COLORSPACE_CONVERSION_WEBGL,e.BROWSER_DEFAULT_WEBGL),e.polygonOffset(0,0),e.sampleCoverage(1,!1),e.scissor(0,0,e.canvas.width,e.canvas.height),e.stencilFunc(e.ALWAYS,0,4294967295),e.stencilMask(4294967295),e.stencilOp(e.KEEP,e.KEEP,e.KEEP),e.viewport(0,0,e.canvas.width,e.canvas.height),e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT|e.STENCIL_BUFFER_BIT);e.getError(););}function c(e){function t(e){return"function"==typeof e?e:function(t){e.handleEvent(t)}}function r(e){var t=e.addEventListener;e.addEventListener=function(r,i,n){switch(r){case"webglcontextlost":E(i);break;case"webglcontextrestored":D(i);break;default:t.apply(e,arguments)}}}function i(){for(var e=Object.keys(b),t=0;t<e.length;++t)delete b[e]}function n(){++y,p||A==y&&e.loseContext()}function a(e,t){var r=e[t];return function(){if(n(),!p){var t=r.apply(e,arguments);return t}}}function o(){for(var e=0;e<g.length;++e){var t=g[e];t instanceof WebGLBuffer?h.deleteBuffer(t):t instanceof WebGLFramebuffer?h.deleteFramebuffer(t):t instanceof WebGLProgram?h.deleteProgram(t):t instanceof WebGLRenderbuffer?h.deleteRenderbuffer(t):t instanceof WebGLShader?h.deleteShader(t):t instanceof WebGLTexture&&h.deleteTexture(t)}}function l(e){return{statusMessage:e,preventDefault:function(){M=!0}}}function c(e){for(var t in e)"function"==typeof e[t]?d[t]=a(e,t):s(d,e,t);
d.getError=function(){if(n(),!p)for(var e;e=h.getError();)b[e]=!0;for(var e in b)if(b[e])return delete b[e],e;return d.NO_ERROR};for(var r=["createBuffer","createFramebuffer","createProgram","createRenderbuffer","createShader","createTexture"],i=0;i<r.length;++i){var o=r[i];d[o]=function(t){return function(){if(n(),p)return null;var r=t.apply(e,arguments);return r.__webglDebugContextLostId__=v,g.push(r),r}}(e[o])}for(var l=["getActiveAttrib","getActiveUniform","getBufferParameter","getContextAttributes","getAttachedShaders","getFramebufferAttachmentParameter","getParameter","getProgramParameter","getProgramInfoLog","getRenderbufferParameter","getShaderParameter","getShaderInfoLog","getShaderSource","getTexParameter","getUniform","getUniformLocation","getVertexAttrib"],i=0;i<l.length;++i){var o=l[i];d[o]=function(t){return function(){return n(),p?null:t.apply(e,arguments)}}(d[o])}for(var u=["isBuffer","isEnabled","isFramebuffer","isProgram","isRenderbuffer","isShader","isTexture"],i=0;i<u.length;++i){var o=u[i];d[o]=function(t){return function(){return n(),!p&&t.apply(e,arguments)}}(d[o])}return d.checkFramebufferStatus=function(t){return function(){return n(),p?d.FRAMEBUFFER_UNSUPPORTED:t.apply(e,arguments)}}(d.checkFramebufferStatus),d.getAttribLocation=function(t){return function(){return n(),p?-1:t.apply(e,arguments)}}(d.getAttribLocation),d.getVertexAttribOffset=function(t){return function(){return n(),p?0:t.apply(e,arguments)}}(d.getVertexAttribOffset),d.isContextLost=function(){return p},d}var h,d,f=[],m=[],d={},v=1,p=!1,g=[],A=0,y=0,M=!1,x=0,b={};e.getContext=function(t){return function(){var r=t.apply(e,arguments);if(r instanceof WebGLRenderingContext){if(r!=h){if(h)throw"got different context";h=r,d=c(h)}return d}return r}}(e.getContext);var E=function(e){f.push(t(e))},D=function(e){m.push(t(e))};return r(e),e.loseContext=function(){if(!p){for(p=!0,A=0,++v;h.getError(););i(),b[h.CONTEXT_LOST_WEBGL]=!0;var t=l("context lost"),r=f.slice();setTimeout(function(){for(var i=0;i<r.length;++i)r[i](t);x>=0&&setTimeout(function(){e.restoreContext()},x)},0)}},e.restoreContext=function(){p&&m.length&&setTimeout(function(){if(!M)throw"can not restore. webglcontestlost listener did not call event.preventDefault";o(),u(h),p=!1,y=0,M=!1;for(var e=m.slice(),t=l("context restored"),r=0;r<e.length;++r)e[r](t)},0)},e.loseContextInNCalls=function(e){if(p)throw"You can not ask a lost contet to be lost";A=y+e},e.getNumCalls=function(){return y},e.setRestoreTimeout=function(e){x=e},e}"undefined"==typeof window&&(window=t);var h=function(e){window.console&&window.console.log&&window.console.log(e)},d=function(e){window.console&&window.console.error?window.console.error(e):h(e)},f={enable:{1:{0:!0}},disable:{1:{0:!0}},getParameter:{1:{0:!0}},drawArrays:{3:{0:!0}},drawElements:{4:{0:!0,2:!0}},createShader:{1:{0:!0}},getShaderParameter:{2:{1:!0}},getProgramParameter:{2:{1:!0}},getShaderPrecisionFormat:{2:{0:!0,1:!0}},getVertexAttrib:{2:{1:!0}},vertexAttribPointer:{6:{2:!0}},bindTexture:{2:{0:!0}},activeTexture:{1:{0:!0}},getTexParameter:{2:{0:!0,1:!0}},texParameterf:{3:{0:!0,1:!0}},texParameteri:{3:{0:!0,1:!0,2:!0}},texImage2D:{9:{0:!0,2:!0,6:!0,7:!0},6:{0:!0,2:!0,3:!0,4:!0}},texSubImage2D:{9:{0:!0,6:!0,7:!0},7:{0:!0,4:!0,5:!0}},copyTexImage2D:{8:{0:!0,2:!0}},copyTexSubImage2D:{8:{0:!0}},generateMipmap:{1:{0:!0}},compressedTexImage2D:{7:{0:!0,2:!0}},compressedTexSubImage2D:{8:{0:!0,6:!0}},bindBuffer:{2:{0:!0}},bufferData:{3:{0:!0,2:!0}},bufferSubData:{3:{0:!0}},getBufferParameter:{2:{0:!0,1:!0}},pixelStorei:{2:{0:!0,1:!0}},readPixels:{7:{4:!0,5:!0}},bindRenderbuffer:{2:{0:!0}},bindFramebuffer:{2:{0:!0}},checkFramebufferStatus:{1:{0:!0}},framebufferRenderbuffer:{4:{0:!0,1:!0,2:!0}},framebufferTexture2D:{5:{0:!0,1:!0,2:!0}},getFramebufferAttachmentParameter:{3:{0:!0,1:!0,2:!0}},getRenderbufferParameter:{2:{0:!0,1:!0}},renderbufferStorage:{4:{0:!0,1:!0}},clear:{1:{0:{enumBitwiseOr:["COLOR_BUFFER_BIT","DEPTH_BUFFER_BIT","STENCIL_BUFFER_BIT"]}}},depthFunc:{1:{0:!0}},blendFunc:{2:{0:!0,1:!0}},blendFuncSeparate:{4:{0:!0,1:!0,2:!0,3:!0}},blendEquation:{1:{0:!0}},blendEquationSeparate:{2:{0:!0,1:!0}},stencilFunc:{3:{0:!0}},stencilFuncSeparate:{4:{0:!0,1:!0}},stencilMaskSeparate:{2:{0:!0}},stencilOp:{3:{0:!0,1:!0,2:!0}},stencilOpSeparate:{4:{0:!0,1:!0,2:!0,3:!0}},cullFace:{1:{0:!0}},frontFace:{1:{0:!0}},drawArraysInstancedANGLE:{4:{0:!0}},drawElementsInstancedANGLE:{5:{0:!0,2:!0}},blendEquationEXT:{1:{0:!0}}},m=null,v=null;return{init:e,mightBeEnum:i,glEnumToString:n,glFunctionArgToString:a,glFunctionArgsToString:o,makeDebugContext:l,makeLostContextSimulatingCanvas:c,resetToInitialState:u}}(),e.exports=WebGLDebugUtils}).call(t,function(){return this}())}]);